class Converter{#e;constructor(...e){this.#e=[...e]}get cmConvert(){return r.call(this.#e)}get inConvert(){return t.call(this.#e)}}function e(){const e=this.filter((e=>Number(e)?e:"string"==typeof e&&e?+e.trim():void 0));try{if(!e||e.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(e){return e}return e}function t(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t/e).toFixed(3)))}return t}function r(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t*e).toFixed(0)))}return t}class RegexChecker{#e;constructor(...e){this.#e=[...e]}get regexSizes(){return s.call(this.#e)}}function s(){try{const e=this.map((e=>{const t=/[0-9]{1,3}/.test(e);return!Number.isNaN(e)&&t})),t="Not a valid entry to RegexChecker!";if(e.includes(!1))throw new TypeError(t)}catch(e){return console.error(e),e}}class CubCalc{#t;#r;#s;constructor(e,t,r){this.#t=+e,this.#r=+t,this.#s=+r}get cubCalcAir(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/6e3).toFixed(3)}(this.#t,this.#r,this.#s)}get cubArea(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/1e6).toFixed(3)}(this.#t,this.#r,this.#s)}}class Hexaedro{constructor(e,t,r){try{if(!e||!t||!r)throw new TypeError("Please, provide a correct x, z or y value.")}catch(e){return e}this.x=+e,this.z=+t,this.y=+r}}class ArtWork extends Hexaedro{coordinates;packMaterials;code;#t;#r;#s;constructor(e,t,r,s,a){super(t,r,s);try{if(!e||e.trim()<=0){const t=`Please, provide a valid code. Current: ${e}`;throw new TypeError(t)}}catch(e){return e}this.code=""+e,this.#t=+t,this.#r=+r,this.#s=+s,this.packMaterials=a}#a(){const e={x:structuredClone(this.#t),z:structuredClone(this.#r),y:structuredClone(this.#s)};return this.packMaterials&&this.packMaterials.length&&this.packMaterials.map((t=>{e.x+=2*t[2],e.z+=2*t[2],e.y+=2*t[2]})),[this.code,e.x,e.z,e.y]}#i(e,t){return e.map(((e,r)=>{const s=[this.packMaterials[r][0]];return s.push(+(100*t/e).toFixed(0)),s}),0)}#n(e){return e.map(((e,t)=>"Roll"===this.packMaterials[t][5]?[e[0],+(e[1]/100).toFixed(2)]:[e[0],Math.ceil(e[1]/100)]),0)}#o(e){return e.map((e=>1-+(e[1]/100).toFixed(3)%1))}#c(){const e=this.packingDemanded,t=this.packMaterials.map((e=>e[1]*e[3]/100)),r=this.#i(t,e),s=t.map(((t,s)=>[r[s][0],t>e]),0),a=this.#o(r),i=this.packMaterials.map((e=>e[4])),n=this.packMaterials.map((e=>[e[5],t[0],e[0]])),o=i.map(((e,t)=>{const s=+(r[t][1]/100*e).toFixed(2);return[r[t][0],s,+e]}),0),c=this.#n(r,a);return{demand:e,percent:r,reuse:s,residual:a,types:n,cost:o,quantity:c}}get arr(){return[this.code,this.#t,this.#r,this.#s]}get cAir(){return new CubCalc(this.#t,this.#r,this.#s).cubCalcAir}get cubed(){return new CubCalc(this.#t,this.#r,this.#s).cubArea}get autoConvert(){let{x:e,z:t,y:r}=this;const s=new Converter(e,t,r).cmConvert;return e=s[0],t=s[1],r=s[2],[this.code,e,t,r]}get data(){return{code:this.code,x:this.#t,z:this.#r,y:this.#s,packing:this.packMaterials}}get packingDemanded(){const{x:e,z:t,y:r}=this;return+(2*(e*r+e*t+r*t)/100).toFixed(5)}get cratePosition(){return this.coordinates}get packedSized(){return this.#a()}get packInfo(){return this.#c()}set defCoordinate(e){this.coordinates=e}}class ArrangerLargestCanvas{#l;constructor(e){return this.#l=e,this.#u()}#h(){const e=this.filter((e=>e.x>=213&&e.y>=213?e:0));return!!e.length&&e}#u(){const{sorted:e}=this.#l,t=this.#h.call(e);return t&&t.map((e=>{e&&this.#l.sorted.splice(this.#l.sorted.indexOf(e),1)})),t&&(this.#l.largest=t),this.#l}}class ArrangerNoCanvas{#d;constructor(e){return this.#d=e,this.#p()}#m(e){e.map((e=>{this.sorted.splice(this.sorted.indexOf(e),1)}))}#g(){let{sorted:e,sameSize:t}=this.#d;let r=e.filter((e=>e.z>15)),s=t.filter((e=>e.z>15)),a=[];return r.map((e=>a.push(e))),this.#m.call(this.#d,r),s.map((e=>a.push(e))),this.#m.call(this.#d,s),e=null,t=null,r=null,s=null,this.#d.noCanvas=a,this.#d}#p(){return this.#g()}}class ArrangerSameSize{#l;constructor({sorted:e}){return this.#l=e,this.#y()}#f(){const e=[];return this.map((t=>{let r,s=0;if(t.z<=10)for(s in this)a=this[s],i=t,r=a.cubed<=i.cubed&&a.code!==i.code,!e.includes(this[s])&&r&&e.push(this[s]);var a,i})),e}#C(e,t){const r=t.x,s=t.y,a=t.cubed;return e.x===r&&e.y===s&&e.cubed<=a}#b(e){const t=[];return e.map((r=>{let s=[],a=0;for(a in e)this.#C(e[a],r)&&!t.includes(e[a])&&s.push(e[a]);s.length>=4&&s.map((e=>{t.push(e)})),s=null})),t}#y(){const e=this.#f.call(this.#l),t=this.#b(e);return t.map((e=>{this.#l.splice(this.#l.indexOf(e),1)})),{sorted:this.#l,sameSize:t}}}class ArrangerStarter{#l;constructor(e){return this.#l=e,this.#w()}#k(){return this.#l.map((e=>{const t=e.arr;return t.push(e.cubed),t}))}#S(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#S(r,t).concat(s,this.#S(a,t))}#w(){const e=this.#k(),t=this.#S(e,4),r=[];return t.map((e=>{this.#l.find((t=>e[0]===t.code?r.push(t):0))})),{sorted:r}}}class ArrangerTube{#l;constructor(e){return this.#l=e,this.#x()}#x(){const{noCanvas:e}=this.#l,t=e.filter((e=>{const t=e.z<35&&e.y<35,r=e.z===e.y;if(t&&r&&e.x!==e.y&&r)return e}));return t.map((e=>{this.#l.noCanvas.splice(this.#l.noCanvas.indexOf(e),1)})),this.#l.tubes=t,this.#l}}class Arranger{#v;constructor(e){this.#v=e;const t=this.#A();return t&&"TypeError"===t.constructor.name?t:(this.#z(),Object.assign(Arranger,{list:this.#v}))}#z(){this.#I(),this.#y(),this.#E(),this.#T(),this.#L()}#A(){try{const e=e=>0===e.length||!e;if(!Array.isArray(this.#v)||e(this.#v)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#v.map((e=>"ArtWork"===e.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(e){return e}}#I(){this.#v=new ArrangerStarter(this.#v)}#y(){this.#v=new ArrangerSameSize(this.#v)}#E(){this.#v=new ArrangerNoCanvas(this.#v)}#T(){this.#v=new ArrangerLargestCanvas(this.#v)}#L(){this.#v=new ArrangerTube(this.#v)}}class CrateMaker{#P;#B;constructor(e,t=!1){if(!e)return!1;this.#P=e,this.#B=t}#O(e){const t=["Pinewood","Plywood"],r=e.filter((e=>t.includes(e[5]))),s=e.filter((e=>"Foam Sheet"===e[5]));let a=0,i=0,n=0,o=0,c=0;return r.map((e=>{a+=+e[2],i+=+e[2]})),s&&s.length&&s.map((e=>{if(this.#P>1&&e[2]<=2.5)return this.#B&&(this.#B=!1,n+=+e[2]),o=e[2],i+=+e[2]*(this.#P-1);a+=+e[2],i+=+e[2],n+=+e[2],e[2]>2.5&&(c=2*e[2])})),a*=2,i*=2,n*=2,{x:a,z:i,y:n,div:o,pad:c}}#N(){let{materials:e,crating:t}=localStorage;const r=[];return e=JSON.parse(e),t=JSON.parse(t),t.map((t=>{const s=e.find((e=>e[0]===t));s&&r.push(s)})),r.length?this.#O(r):{x:0,z:0,y:0}}get outSizes(){return this.#N()}}class WorksCoordinates{#F;#R;#D;#_;constructor(e=!1){e&&(this.#R=e,this.#_=this.#q())}#q(){const e={emptyArea:[],artLocation:new Map,baseSize:this.#R,plotter3D:new Map,innerSize:[],finalSize:[],layers:[],get reset(){this.emptyArea=[[0,0,this.baseSize[0],this.baseSize[2]]]},get fillGaps(){const e=[];return this.layers.map((t=>{const{vacuum:r,works:s}=t,a=((e,t=0)=>(e.map((e=>!t||e.work[2]>t[1]?t=[e.work[0],e.work[2]]:0)),t))(s),{total:i,sizes:n}=((e,t=0,r=[])=>(e.map((e=>{if(e[0]===e[2]&&e[1]===e[3])return;let s=e[2]-e[0],a=e[3]-e[1];!s&&a&&(s=e[0]),s&&!a&&(a=e[1]),r.push([+s.toFixed(2),+a.toFixed(2)]),t+=+(s*a).toFixed(3)})),{total:t,sizes:r}))(r);e.push({highestZ:a,total:i,sizes:n})})),e},set defineLayer(e){const t=structuredClone(this.emptyArea),r=structuredClone(e[1]);this.layers.push({vacuum:t,works:r}),this.reset}};return e.reset,e}#W(e,t,{x:r,y:s,flip:a}){const{emptyArea:i}=this.#_,n=i[0][2],o=i[0][3];if(n===r&&o===s||n===s&&o===r)return;if(i.length>1){const c=i[0][0]===t[0];c&&!a?i[0][0]+=r:i[0][1]+=s;const l=i[0][0],u=i[0][1],h=l+r===n?n:0,d=u+s===o?o:0,p=c?[r+l,d,n,o]:[l,d,n,o],m=c?[h,s+u,n,o]:[h,u,n,o];return i.splice(e,1),c&&p[0]<n&&i.push(p),void(!c&&m[1]<o&&i.push(m))}const c=!(r===n)&&[r,0,n,o],l=!(s===o)&&[0,s,n,o];c&&i.push(c),l&&i.push(l)}#U(e,t){const r=t[0]===t[2]&&t[1]===t[3],s=t[2],a=t[3],i=e[1]+t[0]<=s&&t[0]<s,n=e[3]+t[1]<=a&&t[1]<a,o=e[3]+t[0]<=s&&t[0]<s,c=e[1]+t[1]<=a&&t[1]<a;return{check01:!r&&(i&&n),check02:!r&&(o&&c)}}#M({emptyArea:e,found:t,art:r,ind:s,pos:a}){e.length>1&&0===a&&a++;const i=e[a],n=e[0][0]===e[0][2]&&e[0][1]===e[0][3];if(t||!i||n)return t;const{check01:o,check02:c}=this.#U(r,i),l=e[0][2],u=e[0][3],h=r[1]===l&&r[3]===u||r[3]===l&&r[1]===u;let d,p,m=!1;return o?(t=!0,d=r[1],p=r[3],this.#D[s].defCoordinate={x:e[a][0],z:r[2],y:e[a][1]},0===a&&(e[0][0]=(d||p>0)&&!h?d:l,e[0][1]=(d>0||p)&&!h?p:u)):c&&(t=!0,d=r[3],p=r[1],r.push('<i class="nf nf-oct-sync"></i>'),m=!0,this.#D[s].defCoordinate={x:e[a][1],z:r[2],y:e[a][0]},0===a&&(e[0][1]=(d||p>0)&&!h?e[0][2]-r[3]:u,e[0][0]=(d>0||p)&&!h?e[0][3]-r[1]:l)),t?this.#W(a,i,{x:d,y:p,flip:m}):a++,this.#M({emptyArea:e,found:t,art:r,ind:s,pos:a})}#$(e,t,r){const s=void 0===e.emptyArea[0]&&void 0===e.emptyArea[1],a=e.emptyArea[0][0]===e.emptyArea[0][2],i=e.emptyArea[0][1]===e.emptyArea[0][3];if(s||!t[r]||a&&i)return e;let n;const{emptyArea:o,feat:c}=e,l=t[r],u=this.#D.findIndex((e=>e.code===l[0])),h={emptyArea:o,found:!1,art:l,ind:u,pos:0};return this.#M(h)&&(n=t.splice(r,1).flat(),c.push({work:n,list:r,raw:u})),this.#$(e,t,r-1)}get bluePrintCoordinates(){return this.#_}get fillLayer(){const{info:e,list:t,len:r,raw:s}=this.#F;return this.#D=s,!!this.#F&&this.#$(e,t,r)}set fillPreparing(e){this.#F=e}}class CraterPythagoras{#l;#u;#D;#_;constructor(e){return e&&0!==e.length?(this.#D=e,this.#u=e.map((e=>e.arr)),this.#l=structuredClone(this.#u),this.#J()):{largest:!1}}#j(e,t,r,s=1){if(!e.length&&!r)return this.#_;const{emptyArea:a}=this.#_,i={emptyArea:a,feat:[]},n=e.length-1;let o;return t.fillPreparing={info:i,list:e,len:n,raw:this.#D},o=t.fillLayer,this.#_.defineLayer=[s,o.feat],this.#j(e,t,r-1,s+1)}#X(e,t,r,s){const a=new WorksCoordinates(e);this.#_=a.bluePrintCoordinates,this.#j(this.#l,a,t),this.#D.map((e=>this.#_.artLocation.set(e.code,e))),this.#_.innerSize=[e[0]+s,r+s,e[2]+s]}#H(e,t){const r=new CrateMaker(t).outSizes,s=+(e[0]+r.x).toFixed(3),a=+(e[1]+r.z).toFixed(3),i=+(e[2]+r.y).toFixed(3),n=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=i%1>0?i:i.toFixed(0),l=r.div&&t.length>1?e[1]+r.div*(t-1):e[1];return this.#X(e,t,l,r.pad),[+n,+o,+c]}#Y(e){const t=e[2]**2,r=57600,s=t>r?t-r:r-t,a=~~(100*Math.sqrt(s))/100;return this.#_.finalSize=[e[0],a,240],[...this.#_.finalSize]}#G(e){let t,r=0,s=0,a=0;return e.map((e=>{r<e[1]&&(r=e[1]),s<e[2]&&(s=e[2]),a<e[3]&&(a=e[3])})),t=r>=a?this.#H([r,s,a],e.length):this.#H([a,s,r],e.length),t}#Z(e){let t;return t=this.#G(e),e.map((e=>{e[1]<=t[2]&&e[3]>t[2]&&e.push('<i class="nf nf-oct-sync"></i>')})),this.#Y(t)}#V(){let e,t=[];for(;this.#u.length;)e=this.#u.splice(0,3),t.push(this.#Z(e)),t.push({works:e});return t[0].push(this.#_),t}#J(){const e=this.#V();return this.largest={crates:e}}}class CraterStandard{#D;#l;#K;#Q;#_;#ee;#P=0;constructor(e,t,r,s){return e&&0!==e.length?(this.#D=e,this.#l=e.map((e=>e.packedSized)),this.#K=r??4,this.#Q=t,this.#te([],s)):{standard:!1}}#te(e,t){switch(t){case!1:return e=this.#re(),this.#Q?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e};case!0:return e=this.#se([],1,structuredClone(this.#l)),this.#Q?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e}}}#ae(e,t){let r,s,a,i,n,o=0,c=0;for(n in e)r=e[n][0]>t[n][0],s=e[n][0]!==t[n][0],a=e[n][2]>t[n][2],i=e[n][2]!==t[n][2],r&&s?o+=1:s&&(c+=1),a&&i?o+=1:i&&(c+=1);return{opt1:o,opt2:c}}#ie(e,t){let r=0,s=0,a=0,i=0,n=2;return e.map((e=>e[0]<=300&&e[2]<=160?r++:a++)),t.map((e=>e[0]<=300&&e[2]<=160?s++:i++)),a===i?n=r<=s?1:2:a<i&&(n=r>=s?1:2),{bestArrange:n}}#re(){const e={opt1:this.#se([],0,structuredClone(this.#l)),opt2:this.#se([],1,structuredClone(this.#l))},t=[],r=[],s=new WeakSet;Object.entries(e).map((e=>{"opt1"===e[0]?e[1].map(((e,r)=>r%2==0?t.push(e):0),0):e[1].map(((e,t)=>t%2==0?r.push(e):0),0)}));let a,i;return a=t.length===r.length?this.#ae(t,r):this.#ie(t,r),i=a.hasOwnProperty("bestArrange")?a.bestArrange:a.opt1<=a.opt2?1:2,s.add(a),1===i?e.opt1:e.opt2}#ne(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#ne(r,t).concat(s,this.#ne(a,t))}#oe(e,t){let r=0,s=0,a=0;const i=new CrateMaker(this.#P).outSizes;if(this.#P>1)for(s in t)Object.entries(t[s]).map((e=>{e.includes("status")||(e[1].map((e=>{e[2]>a&&(a=e[2])})),r+=a,a=0)}));a=i.div*(this.#P-1)+r,this.#_.innerSize=[e[0]+i.pad,a+i.pad,e[2]+i.pad],i.x+=e[0],i.z+=r,i.y+=e[2],i.y+=8;const n=i.x%1>0?i.x.toFixed(3):i.x.toFixed(0),o=i.z%1>0?i.z.toFixed(3):i.z.toFixed(0),c=i.y%1>0?i.y.toFixed(3):i.y.toFixed(0);return this.#D.map((e=>this.#_.artLocation.set(e.code,e))),this.#_.finalSize=[+n,+o,+c],[+n,+o,+c,structuredClone(this.#_)]}#ce(e,t){switch(this){case 1:Array.isArray(t[0])?e.push({layer1:t}):e.push({layer1:[t]});break;case 2:Array.isArray(t[0])?e.push({layer2:t}):e.push({layer2:[t]});break;case 3:Array.isArray(t[0])?e.push({layer3:t}):e.push({layer3:[t]});break;case 4:Array.isArray(t[0])?e.push({layer4:t}):e.push({layer4:[t]});break;case 5:Array.isArray(t[0])?e.push({layer5:t}):e.push({layer5:[t]});break;default:return}return e}#le(e,t){const r=new WorksCoordinates(e);this.#_=r.bluePrintCoordinates;const s=[];let a,i,n,o=[],c=0;try{for(;c++<this.#K&&t.length;){const{emptyArea:e}=this.#_;a={emptyArea:e,feat:[]},r.fillPreparing={info:a,list:t,len:t.length-1,raw:this.#D},i=r.fillLayer,n=structuredClone(i),o=n.feat.map((e=>{const t=this.#D.find((t=>t.code===e.work[0])).arr,r=structuredClone(e.work);return r[1]=t[1],r[2]=t[2],r[3]=t[3],r})),this.#ce.call(c,s,o),this.#_.defineLayer=[c,i.feat],o=null,i=null,a=null,o=[]}}catch(e){console.error(e)}return this.#P=c-1,delete this.#_.defineLayer,delete this.#_.reset,{crate:s,measure:e,list:t}}#ue(e,t,r){if(r<0)return e.x<e.y&&([e.x,e.y]=[e.y,e.x]),e;const s=t.length>5;return e.x=e.x<t[r][1]?t[r][1]:e.x,e.x=s&&e.x>=t[r][1]&&e.x+t[r][1]<=this.#ee?e.x+t[r][1]:e.x,e.z=t[r][2]>e.z?t[r][2]:e.z,e.y=t[r][3]>e.y?t[r][3]:e.y,e.y=s&&e.y>=t[r][3]&&e.y+t[r][3]<=140?e.y+t[r][3]:e.y,this.#ue(e,t,r-1)}#he(e){const{x:t,z:r,y:s}=this.#ue({x:0,z:0,y:0},e,e.length-1);return[t,r,s]}#de(e){let t=e.map((e=>(e.push(e[1]*e[3]),e)));return t=this.#ne(t,5),t=t.map((e=>(e.pop(),e))),e=t}#se(e,t,r){if(!r.length)return e;this.#ee=t?250:180,r=this.#de(r);const s=this.#he(r),{crate:a,measure:i,list:n}=this.#le(s,r);return e.push(this.#oe(i,a)),e.push({works:a}),this.#se(e,t,n)}}class CraterLastCheckReArranger{#pe;constructor(e){return"crates ahead"===e[0]&&(this.#pe=e,this.#me())}#ne(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];let i=0;for(i in e)e[i][t]<=s[0][t]?r.push(e[i]):a.push(e[i]);return this.#ne(r,t).concat(s,this.#ne(a,t))}#ge(e,t,r){const s=e[t],{works:a}=s;return a.map((e=>{Object.entries(e).map((e=>{e[1].map((e=>{1===e.length?r.push(e[0][0]):e.map((e=>Array.isArray(e[0])?r.push(e[0]):0))}))}))})),structuredClone(r)}#ye(e,t){const r=new WeakSet,s=t.works.length;let a,i=0,n=!0;for(;i++<e.length&&n;)i%2==1&&(a=1===s?structuredClone(t.works[0]):structuredClone(t.works),this.#ge(e,i,a),a=this.#ne(a,4),a=new CraterStandard(a,!1,5,!0),a.crates.length===e.length&&(e.splice(i,1,a.crates[1]),e.splice(i-1,1,a.crates[0]),n=!1),r.add(a));return!n}#fe(e,t,r){return r<0?t:(r%2==1&&this.#ye(e,t[r])&&(t.splice(r-1,2),r=t.length),this.#fe(e,t,r-1))}#Ce(e){let t,r,s=0;for(r in e)if(s++%2==1&&5===e[r].works.length&&(t=e[r].works[4].layer5),t)break;return!!t&&{info:r,works:t}}#be(e,t){let r,s=[];return Object.entries(t).map((e=>{e[1].map((e=>{let t;for(t in e)e[t].length>0&&Array.isArray(e[t])&&e[t].map((e=>s.push(e)))}))})),e.map((e=>s.push(e))),r=this.#ne(s,4),r}#we(e,t,r,s){return e[s].works.pop(),e[s-1][1]-=10,e.splice(t-1,1,r.crates[0]),e.splice(t,1,r.crates[1]),e}#ke(){const{crates:e}=this.#pe.standardCrate,t=this.#Ce(e);let r,s,a,i,n=0;if(t)for(i in e){if(!Array.isArray(e[i])&&n!==+t.info&&(r=this.#be(t.works,e[i]),s=new CraterStandard(r,!1,5,!0),a=2===s.crates.length,a)){this.#we(e,n,s,t.info);break}n++}}#me(){const e=this.#pe.sameSizeCrate.crates,t=this.#pe.sameSizeCrate.backUp,r=this.#pe.standardCrate.crates;let s;if(e&&r){if(s=e.length,this.#fe(r,e,s),e.length===t.length)return this.#pe.sameSizeCrate.backUp=!1,void(this.#pe.standardCrate.backUp=!1);this.#ke()}}}class CraterNotCanvas{#d;#D;#_;#l;constructor(e){return e&&0!==e.length?(this.#D=e,this.#d=e.map((e=>e.arr)),this.#l=e.map((e=>e.arr)),this.#E()):{noCanvas:!1}}#ne(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#ne(r,t).concat(s,this.#ne(a,t))}#X(e){const t=new WorksCoordinates(e);this.#_=t.bluePrintCoordinates;const{emptyArea:r}=this.#_,s={emptyArea:r,feat:[]},a=this.#l.length-1;let i;t.fillPreparing={info:s,list:this.#l,len:a,raw:this.#D},i=t.fillLayer,this.#_.defineLayer=[1,i.feat],this.#D.map((e=>this.#_.artLocation.set(e.code,e)))}#H(e){const t=new CrateMaker(this.#d).outSizes,r=+(e[0]+t.x).toFixed(3),s=+(e[1]+t.z).toFixed(3),a=+(e[2]+t.y).toFixed(3),i=r%1>0?r:r.toFixed(0),n=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=t.div?e[1]+t.div*this.#d.length:e[1];return this.#X([+i,+n,+o]),this.#_.innerSize=[e[0]+t.pad,c+t.pad,e[2]+t.pad],this.#_.finalSize=[+i,+n,+o],[...this.#_.finalSize,this.#_]}#Se(e){let t,r=0,s=0,a=0,i=0;return t=e.length/2,e.map((e=>{t-- >0&&(r+=e[1],s<e[2]&&(s=e[2])),a=e[1],i<e[2]&&(i=e[2])})),a>r||(a=r),i+=s,{newX:a,newZ:i}}#xe(e){const t=e.length>4&&e.length%2==0;let r,s=0,a=0,i=0;return e.map((e=>{s+=e[1],a=e[2]>a?e[2]:a,i=e[3]>i?e[3]:i})),(s>277||t)&&(r=this.#Se(e),s=r.newX,a=r.newZ),this.#H([s,a,i])}#ve(e,t){const r=e[1]===t[1]&&e[1]<277,s=e[2]===t[2]&&e[2]<177,a=e[3]<=132;return!!(r&&s&&a)}#Ae(e,t,r,s){return s.length%2==0&&e>554&&2*t+10<177?s.length:0===r||s[0][1]>554?1:r}#ze(e){let t=10*e.length,r=0,s=0;const a=e[0];return e.map((e=>{const i=this.#ve(e,a),n=e[2]-a[2],o=a[2]-e[2];(!0===i||(n>0&&n<=10||o>0&&o<=10))&&(s++,t+=e[1],r+=e[3])})),this.#Ae(t,r,s,e)}#Ie(e){if(!Array.isArray(e))return e;let t=e.map((e=>(e.push(e[1]*e[2]),e)));return t=this.#ne(t,5),t=t.map((e=>(e.pop(),e))),this.#d=t}#E(){const e=[];let t;for(this.#Ie(this.#d);this.#d.length>0;)t=this.#ze(this.#d),t=this.#d.splice(0,t),t.length>0?(e.push(this.#xe(t)),e.push({works:t})):(e.push(this.#xe(this.#d.splice(0,1))),e.push({works:t}));return{crates:e}}}class CraterSameSize{#d;#Ee;#D;#_;constructor(e){return e&&0!==e.length?(this.#D=structuredClone(e),this.#d=e.map((e=>e.arr)),this.#Ee=e[0].packedSized,this.#Te()):{sameSize:!1}}#j(e,t,r=1){if(!e.length)return this.#_;const{emptyArea:s}=this.#_,a={emptyArea:s,feat:[]},i=e.length-1;let n;return t.fillPreparing={info:a,list:e,len:i,raw:this.#D},n=t.fillLayer,this.#_.defineLayer=[r,n.feat],this.#j(e,t,r+1)}#X(e,t){const r=JSON.parse(localStorage.getItem("materials")),s=JSON.parse(localStorage.getItem("crating"));let a;s.map((e=>{const t=r.filter((t=>{return e===(r=t)[0]&&r[2]<5&&"Foam Sheet"===r[5];var r}));t.length&&(a=t.flat())})),t&&(e[2]=+a[2]);const i=new WorksCoordinates(e);this.#_=i.bluePrintCoordinates;const n=structuredClone(this.#d);return this.#j(n,i),this.#D.map((e=>this.#_.artLocation.set(e.code,e))),e}#Le(e,t){const r=new CrateMaker(this.#d.length,t).outSizes,s=+(e[0]+r.x).toFixed(3),a=+(e[1]+r.z).toFixed(3),i=+(e[2]+r.y).toFixed(3),n=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=i%1>0?i:i.toFixed(0),l=e[1]+r.div*this.#d.length;return this.#X([+n,+o,+c],t),this.#_.innerSize=[e[0]+crate.pad,l+crate.pad,e[2]+crate.pad],this.#_.finalSize=[+n,+o,+c],[...this.#_.finalSize,this.#D]}#Pe(e,t,r){const s=e.map((e=>{const s=e[0]+t[0]<=r[0],a=e[1]+t[1]<=r[1],i=e[2]+t[2]<=r[2];if(s&&a&&i)return e}));return void 0!==s[0]&&s.map((t=>e.splice(e.indexOf(t),1))),void 0!==s[0]}#Be(e,t){let r=[];return void 0!==t.map((t=>{const s=t[0]===e[0][0],a=t[2]===e[0][2],i=t[0]===e[0][0]-this.#Ee[1],n=t[2]===e[0][2]-this.#Ee[3];if(s&&a||i&&n)return t;if(r.length>0){if(this.#Pe(r,t,e))return t}else r.push(t)}))[0]}#Oe(e,t){const r=e.shift(),s=Array.isArray(t[0])?t[0].length:t.length;let a,i,n,o;return r?(a=s%2+s/2,i=e[0],n=a*this.#Ee[2],o=e[2]):(a=s%2+s,i=e[0],n=a*this.#Ee[2],o=e[2]),this.#Le([i,n,o],r)}#Ne(e,t){const r=t.length>3?[t[0][1],t[0][2],t[0][3]]:t;let s=e[0],a=e[1],i=e[2]+r[2],n=!1;return i>132&&s<132?([i,s]=[s,i],n=!0):i>e[2]&&(n=!0),[n,[s,a,i]]}#Fe(e){let t,r,s=e.splice(0,1).flat(),a=e.splice(0,1).flat();return e.length>0&&(t=this.#Be(s,e)),t?(s=this.#Ne(s,e.splice(0,1)),e[0].map((e=>a[0][0].push(e))),e.splice(0,e[0].length)):a[0].length>10&&a[0].length%2==0?s=this.#Ne(s,a[0]):s.unshift(!1),Array.isArray(a[0][0])&&(a=a.flat()),r=this.#Oe(s.flat(),a),{crate:r,works:a}}#Re(e){const t=[];let r;for(;e.length;)r=this.#Fe(e),t.push(r.crate),t.push({works:r.works});return t}#De(){let e=this.#d[0][1],t=this.#d[0][2],r=this.#d[0][3],s=[[e,t,r]],a=[];return this.#d.map((i=>{i[2]<=14&&(i[1]!==e&&i[3]!==r&&(s.push([a]),e=i[1],t=i[2],r=i[3],s.push([e,t,r]),a=[]),a.push(i))})),s.push(a),s[1][0].length>=4?s:null}#Te(){let e=this.#De();if(null===e)return null;const t=this.#Re(e);return e=null,{crates:t,backUp:structuredClone(t)}}}class CraterTube{#_e;#qe;#_;#D;constructor(e){if(!e||0===e.length)return{tube:!1};this.#D=e,this.#_e=e.map((e=>e.arr)),this.#qe=35;return this.#_e.filter((e=>e[2]<this.#qe&&e)).find((e=>!1!==e))?this.#We():{tube:!1}}#We(){return this.#Ue(),this.#_e}#Me(e,t){const r=new WorksCoordinates(e);this.#_=r.bluePrintCoordinates;const{emptyArea:s}=this.#_;let a,i={emptyArea:s,feat:[]},n=Array.isArray(t[0])?t.length-1:0;r.fillPreparing={info:i,list:t,len:n,raw:this.#D},a=r.fillLayer,this.#_.defineLayer=[1,a.feat],this.#_.innerSize=[e[0],e[1],e[2]],this.#D.map((e=>this.#_.artLocation.set(e.code,e)))}#$e(e){let t=e[0][1],r=e[0][2],s=0;return e.map((e=>{t=e[1]>t?e[1]:t,r=e[2]>r?e[2]:r,s+=e[3]})),[t,r,s]}#Je(){const e=new CrateMaker(1),t=+(this[0]+e.x).toFixed(3),r=+(this[1]+e.z).toFixed(3),s=+(this[2]+e.y).toFixed(3),a=t%1>0?t:t.toFixed(0),i=r%1>0?r:r.toFixed(0),n=s%1>0?s:s.toFixed(0);return this.#Me([this[0]+e.pad,this[1]+e.pad,this[2]+e.pad],structuredClone(list)),this.#_.finalSize=[+a,+i,+n],[...this.#_.finalSize]}#je(e){const t=this.#$e(e);return this.#Je(t,e)}#Xe(e){switch(e.length){case 1:case 2:case 3:case 4:return this.#je(e)}}#He(e){const t=[];let r;for(;e.length>=3;)r=e.splice(0,3),t.push(this.#Xe(r.length,r)),t.push({works:r});return t}#Ye(){const e=this.#_e.filter((e=>{if(e[2]>this.#qe)return e}));return e.map((e=>{this.#_e.splice(this.#_e.indexOf(e),1)})),e}#Ue(){let e=[],t=[];const r=this.#Ye();for((r.length>0||r.length>3)&&t.push(this.#He(r));this.#_e.length;)e=this.#_e.splice(0,3),t.push(this.#Xe(e)),t.push({works:e});return this.#_e.length>=1&&(t.push(this.#Xe(this.#_e.length,this.#_e)),t.push({works:this.#_e})),this.#_e={crates:t}}}class Crater{#v;#Ge;constructor(e){return e!==Arranger?{crater:!1}:(this.#v=e.list,this.#Ge=["crates ahead"],Object.assign(Crater,this.#Ze()))}#Ze(){let e=0;const t=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(e in this.#je(),this.#Ve(),this.#Ke(),this.#Qe(),this.#et(),this.#tt(),this.#Ge)this.#Ge[e]?.hasOwnProperty("crates")&&t.includes(e)||delete this.#Ge[e];return this.#rt(),this.#st(),this.#at(),this.#it(),Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#nt(),this.#ot(),this.#ct()),{crates:this.#Ge}}#je(){const e=new CraterTube(this.#v?.tubes);this.#Ge.tubeCrate=e}#Ve(){const e=new CraterPythagoras(this.#v?.largest);this.#Ge.largestCrate=e}#Ke(){const e=new CraterSameSize(this.#v?.sameSize);this.#Ge.sameSizeCrate=e}#Qe(){const e=new CraterNotCanvas(this.#v?.noCanvas);this.#Ge.noCanvasCrate=e}#et(){const e=this.#Ge.sameSizeCrate.hasOwnProperty("crates"),t=new CraterStandard(this.#v?.sorted,e,4,!1);this.#Ge.standardCrate=t}#tt(){new CraterLastCheckReArranger(this.#Ge)}#rt(){let e=0;const t=[],r=e=>{Array.isArray(e)&&t.push(e)};for(e in this.#Ge)this.#Ge[e]?.crates?.map(r);this.#Ge.allCrates=t}#ct(){let e,t,r=0;const s=[],a=e=>{Array.isArray(e)&&s.push(e)};for(r in this.#Ge)e="sameSizeCrate"===this.#Ge[r],t="standardCrate"===this.#Ge[r],(e||t)&&this.#Ge[r]?.backUp?.map(a),this.#Ge[r]?.crates?.map(a);this.#Ge.allCratesBackUp=s}#st(){let e=0;const t=e=>{if(Array.isArray(e)&&e.length>=3){const t=e[0],r=e[1],s=e[2],a=new CubCalc(t,r,s).cubCalcAir,i=4===e.length?e.splice(3,1,a):e.push(a);Array.isArray(i)&&e.push(i)}};for(e in this.#Ge)this.#Ge[e]?.crates?.map(t);Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#Ge?.sameSizeCrate?.backUp?.map(t),this.#Ge?.standardCrate?.backUp?.map(t))}#at(){let e=0,t=[];const r=e=>{Array.isArray(e)&&t.push(e[3])};for(e in this.#Ge)this.#Ge[e]?.crates?.map(r);t=t.reduce(((e,t)=>e+t),0),this.#Ge.airCubTotal=t.toFixed(3)}#nt(){let e,t,r=[],s=0;const a=e=>{Array.isArray(e)&&r.push(e[3])};for(s in this.#Ge)e="sameSizeCrate"===this.#Ge[s],t="standardCrate"===this.#Ge[s],e||t?this.#Ge[s]?.backUp?.map(a):e||t||this.#Ge[s]?.crates?.map(a);r=r.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ge.airCubTotalBackUp=r}#lt(e){if(Array.isArray(e)){const t=e[0],r=e[1],s=e[2];return t>300||r>200||s>160?"CARGO":"PAX"}}#it(){let e,t=0,r=0,s=0;for(s in this.#Ge)this.#Ge[s]?.crates?.map((s=>{e=this.#lt(s),"PAX"===e?t++:"CARGO"===e&&r++}));this.#Ge.whichAirPort=[{PAX:t},{CARGO:r}]}#ot(){let e,t,r,s=0,a=0,i=0;for(s in this.#Ge)e="sameSizeCrate"===this.#Ge[s],t="standardCrate"===this.#Ge[s],e||t?this.#Ge[s]?.backUp?.map((e=>{r=this.#lt(e),"PAX"===r?a++:"CARGO"===r&&i++})):e||t||this.#Ge[s]?.crates?.map((e=>{r=this.#lt(e),"PAX"===r?a++:"CARGO"===r&&i++}));this.#Ge.whichAirPortBackUp=[{PAX:a},{CARGO:i}]}}class UnitAdapter{#l;#ut;constructor(e,t){return this.#l=e,this.#ut=t,this.#ht()}#dt(){try{if(!Array.isArray(this.#l)){throw new TypeError("Please, provide a valid list.")}if(this.#l.some((e=>"ArtWork"!==e.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#ut&&"in"!==this.#ut){throw new TypeError("Please, provide a valid unit.")}}catch(e){return e}return"pass"}async#ht(){let e;const t=this.#dt();switch("pass"!==t?"error":"cm"===this.#ut?"cm":"in"){case"error":return t;case"cm":return e=await this.#pt(),e;case"in":return e=await this.#mt(),e}}#gt(e){const t=e?.hasOwnProperty("crates"),r=e?.hasOwnProperty("backUp");return Array.isArray(e)?e.map(a):e?.hasOwnProperty("crates")?((t||r)&&(e.crates=e.crates.map((e=>4===e.length?a(e):(Array.isArray(e.works[0])?e.works=e.works.map(a):e.works=e.works.map(i),e))),console.log(e.crates)),e):e}#yt(){return this.#l.map((e=>{const t=e.autoConvert,r=t[0],s=t[1],a=t[2],i=t[3];return new ArtWork(r,s,a,i)}))}#ft(e){let t=0;for(t in e)e[t].hasOwnProperty("crates")&&(e[t]=this.#gt(e[t]));return e.sameSizeCrate?.hasOwnProperty("backUp")&&(e.airCubTotalBackUp=+(.061023*e.airCubTotalBackUp).toFixed(3),e.allCratesBackUp=this.#gt(e.allCratesBackUp)),e.allCrates=this.#gt(e.allCrates),e}async#pt(){return await Promise.resolve(new Arranger(this.#l)).then((e=>new Crater(e))).then((e=>e.crates)).catch((e=>e))}async#mt(){return await Promise.resolve(this.#yt()).then((e=>new Arranger(e))).then((e=>new Crater(e))).then((e=>this.#ft(e.crates))).catch((e=>e))}}function a(e){const t=.061023;let r,s,a,i;switch(console.log(e),e.length){case 4:return s=e[0],a=e[1],i=e[2],r=Array.from(new Converter(s,a,i).inConvert),r.push(+(e[3]*t).toFixed(3)),r;case 5:return s=e[1],a=e[2],i=e[3],r=Array.from(new Converter(s,a,i).inConvert),r.unshift(e[0]),r.push(+(e[3]*t).toFixed(3)),r;case 6:return s=e[1],a=e[2],i=e[3],r=Array.from(new Converter(s,a,i).inConvert),r.unshift(e[0]),r.push(+(e[3]*t).toFixed(3)),r.push(e[5]),r}}function i(e){let t;for(t in e)Array.isArray(e[t][0][0][0])?e[t][0].map((e=>e.splice(0,1,a(e[0])))):e[t]=[a(e[t][0])];return e}class GraphicCrates{#Ct;#bt;#wt;#kt;constructor(e){const{Plotly:t}=globalThis;this.#wt=t,this.#kt=e,this.#Ct=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#bt={title:{font:{family:"Saira, sans-serif",sizes:24,weight:900,style:"italic",color:"#FFFFFFAA"},x:.5,xref:"paper",automargin:!0},legend:{title:{text:"Open Layers:",font:{family:"Mitr, sans-serif",size:14}},font:{family:"Mitr, sans-serif",sizes:14,color:"#FFFFFFAA"},x:.1,y:.9,orientation:"h"},margin:{t:0,l:0,b:0,r:0,pad:10},scene:{xaxis:{title:{text:"Length - (cm)"}},yaxis:{title:{text:"Depth - (cm)"}},zaxis:{title:{text:"Height - (cm)"}},camera:{eye:{x:0,y:2.5,z:1}}},paper_bgcolor:"#96979C",autocolorscale:!0,autosize:!0}}#St(e,t){const r=[0,1,1,0,0,1,1,0],s=[0,0,1,1,0,0,1,1],a=[0,0,0,0,1,1,1,1],i=this.#Ct.map((e=>{const i=t[e[0]],n=t[e[1]];return{x:[i.x,n.x],z:[i.y,n.y],y:[i.z,n.z],i:r,j:s,k:a,name:"Work",type:"mesh3d",color:"#BBBADD",showlegend:!1,opacity:.5}}));return e.push(i),e}#xt(e,t,r){return this.#Ct.forEach((s=>{const a=t[s[0]],i=t[s[1]];e.push({x:[a.x,i.x],y:[a.y,i.y],z:[a.z,i.z],name:"Crate-01",mode:"lines",type:"scatter3d",line:{color:r?"#555FEF":"#3DDDDD",width:3},showlegend:!1,legendgroup:"sides"})})),e}#vt(){let e=this.#xt([],[{x:0,y:0,z:0},{x:100,y:0,z:0},{x:100,y:30,z:0},{x:0,y:30,z:0},{x:0,y:0,z:100},{x:100,y:0,z:100},{x:100,y:30,z:100},{x:0,y:30,z:100}],1);return e=this.#xt(e,[{x:10,y:10,z:10},{x:90,y:10,z:10},{x:90,y:20,z:10},{x:10,y:20,z:10},{x:10,y:10,z:90},{x:90,y:10,z:90},{x:90,y:20,z:90},{x:10,y:20,z:90}],0),e}get show(){const e=this.#vt();return this.#wt.newPlot("plotter-display",e,this.#bt,{displaylogo:!1})}}function n(e,t,r){return+(e/r*t).toFixed(0)}function o(e,t){return e>=1024?function(e){const t=800;let r,s;e[0]>e[1]?(r=t,s=+(e[1]/e[0]*t).toFixed(0)):(s=t,r=+(e[0]/e[1]*t).toFixed(0));return{x:r,y:s}}(t):function(e){const t=.87,r=globalThis.screen.availWidth*t,s=globalThis.screen.availHeight*t;let a,i;e[0]>e[1]?(a=r,i=+(e[1]/e[0]*s).toFixed(0)):(i=s,a=+(e[0]/e[1]*r).toFixed(0));return{x:a,y:i}}(t)}class TubeRender{#At;#_e;#zt;constructor({works:e},t,r){return this.#At=t,this.#zt=[r[0]+5,r[1],r[2]+3],this.#_e=Array.isArray(e[0])?e:[e],this.#It()}#Et({x:e,y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?c(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#Tt({x:e,y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),a=e.at(-1),i=.5*t.at(-1),n=.5*a-10*r.length*.5,o=1===t.length?i:c(t)+i;return s.setAttribute("x",n),s.setAttribute("y",o),s.innerHTML=r[0],s}#It(){let e,t,r;const s=document.createDocumentFragment(),a=[],i=[],o="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#_e.map((c=>{if("in"===o){const e=c[0];(c=new Converter(c[1],c[2],c[3]).cmConvert).unshift(e)}t=n(c[1],this.#At.x,this.#zt[0]),r=n(c[3],this.#At.y,this.#zt[2]),t>this.#At.x&&(t=this.#At.x),r>this.#At.y&&(r=this.#At.y),a.push(t),i.push(r),s.appendChild(this.#Et({x:a,y:i})),e=[{x:a,y:i},c,this.#zt],s.appendChild(this.#Tt.apply(null,e))})),s}}function c(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class StandardRender{#Lt;#Pt;#zt;#Bt;constructor({works:e},t,r,s){return this.#Pt=t,this.#Bt=structuredClone(t),this.#zt=r,this.#Lt=Object.values(e[s])[0],this.#Bt.x2=this.#Bt.x,this.#Bt.y2=this.#Bt.y,this.#Ot()}#Et({pos:e,values:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=this.#Pt.x,a=this.#Pt.y,i=.95;return r.setAttribute("x",e[0]+1),r.setAttribute("y",e[1]+1),t[0]>=s*i||e[0]+t[0]+1>=s*i?r.setAttribute("width",t[0]-20):r.setAttribute("width",t[0]),t[1]>=a*i||e[1]+t[1]>=a*i?r.setAttribute("height",t[1]-20):r.setAttribute("height",t[1]),r}#Tt({pos:e,values:t},r){const s=this.#Pt.x,a=this.#Pt.y,i=document.createElementNS("http://www.w3.org/2000/svg","text"),n=.5;let o,c;return o=t[0]>=.95*s?e[0]+t[0]*n-20:e[0]+t[0]*n,c=t[0]>=.95*a?e[1]+t[1]*n-20:e[1]+t[1]*n,i.setAttribute("x",o-7*r.length*n),i.setAttribute("y",c),i.innerHTML=r,i}#Nt(e,t){const r=this.#Bt.y>0&&t<=this.#Bt.y,s=this.#Bt.x>0&&e<=this.#Bt.x;let a,i;r&&(this.#Bt.y-=t),s&&(this.#Bt.x-=e),a=0===this.#Bt.y,i=0===this.#Bt.x,a&&(this.#Bt.x2-=e),i&&(this.#Bt.y2-=t)}#Ft(e,t,r,s){return Object.entries(t).map((t=>{const{fillX:a,fillY:i,next:n}=t[1],o=+(r/t[1].values[0]).toFixed(4),c=+(s/t[1].values[1]).toFixed(4),l=e.y===n[1]&&a+o<=1,u=e.x===n[0]&&i+c<=1;l&&(t[1].fillX=+(a+o).toFixed(4)),u&&(t[1].fillY=+(i+c).toFixed(4)),t[1].fillX>=1&&(t[1].next[1]=null),t[1].fillY>=1&&(t[1].next[0]=null)})),this.#Nt(r,s),t}#Rt(e,t){const{next:r,pos:s,values:a}=e[t];let i,n,o;for(o in e)o!==t&&(i=s[0]===e[o].pos[0]&&0!==s[0],n=s[1]===e[o].pos[1]&&0!==s[1],i&&s[1]<e[o].next[1]?(s[1]=e[o].next[1],r[1]=s[1]+a[1]):n&&s[0]<e[o].next[0]&&(s[0]=e[o].next[0],r[0]=s[0]+a[0]));return e}#Dt(e,t,r,s,a,i){let n,o,c,l;const u=this.#Pt.x,h=this.#Pt.y,d=s.x+r.next[0]===u||this.#Bt.x===s.x,p=s.y+r.next[1]===h||this.#Bt.y===s.y;return this.#Ft(s,t,a,i),n=p&&s.y*r.fillY===r.next[1]?null:s.x+a,o=d&&s.x*r.fillX===r.next[0]?null:s.y+i,c=null===n||o>=h?1:0,l=null===o||n>=u?1:0,t[e]={values:[a,i],pos:[s.x,s.y],next:[n,o],fillX:c,fillY:l},this.#Rt(t,e),t}#_t(e,t,r){let s,a;const{next:i,pos:n,values:o,fillX:c,fillY:l}=e,u=this.#Pt.x,h=this.#Pt.y,d=0===n[0]?i[0]:n[0],p=0===n[1]?i[1]:n[1],m=c+t/o[0]<=1,g=l+r/o[1]<=1,y=null===d&&o[0]+t<=u&&0===n[0],f=null===p&&o[1]+r<=h&&0===n[1];return y||f?(s=y?n[0]:null===p?i[0]:n[0],a=f?n[1]:null===d?i[1]:n[1],0===s&&0===a&&(s=void 0),0===a&&0===a&&(a=void 0),0===s&&c>0&&(s=c*o[0]),0===a&&l>0&&(s=l*o[1])):d+t<=this.#Pt.x?(s=i[0]+t<=this.#Pt.x?i[0]:void 0,a=n[1]+r<=this.#Pt.y?n[1]:void 0):p+r<=this.#Pt.y&&(s=n[0]+t<=this.#Pt.x?n[0]:void 0,a=i[1]+r<=this.#Pt.y?i[1]:void 0),(0===s&&c>0||null===s)&&(s=void 0),!s&&this.#Bt.y>=r&&(s=~~n[0]),!s&&!m&&g&&(s=~~(c*o[0]+n[0])),0===a&&!g&&(a=void 0),0===a&&g&&(a=l*o[1]+n[1]),0===a&&0===this.#Bt.x&&(a=~~i[1]),void 0!==s&&void 0!==a&&{x:s,y:a}}#qt(e,t,r,s){const a=s.at(-1);let i,n,o=s.length;for(n of s)if(o-- >1&&(e[n]&&(i=this.#_t(e[n],t,r)),i)){this.#Dt(a,e,e[n],i,t,r);break}return e}#Wt(e,t,r,s){let a,i,n,o;return 0===Object.entries(e).length?(a=this.#Pt.x-t==0?null:t,i=this.#Pt.y-r==0?null:r,n=this.#Bt.x+t===this.#Pt.x?1:0,o=this.#Bt.y+r===this.#Pt.y?1:0,e[s]={values:[t,r],pos:[0,0],next:[a,i],fillX:n,fillY:o},this.#Nt(t,r)):this.#qt(e,t,r,s),e}#Ut(e){const t=document.createDocumentFragment();let r;for(r in e)t.appendChild(this.#Et(e[r])),t.appendChild(this.#Tt(e[r],r));return t}#Mt(e){let t,r;const s={},a=[],i="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return e.map((async e=>{if("in"===i){const t=e[0];(e=Array.from(new Converter(e[1],e[2],e[3]).cmConvert)).unshift(t)}'<i class="nf nf-oct-sync"></i>'===e.at(-1)?(t=n(e[3],this.#Pt.x,this.#zt[0]),r=n(e[1],this.#Pt.y,this.#zt[2])):(t=n(e[1],this.#Pt.x,this.#zt[0]),r=n(e[3],this.#Pt.y,this.#zt[2])),t>this.#Pt.x&&(t=this.#Pt.x),r>this.#Pt.y&&(r=this.#Pt.y),a.push(e[0]),await this.#Wt(s,t,r,a)}),0),this.#Ut(s)}#Ot(){const e=this.#Lt.map((e=>{if(Array.isArray(e))return e}));return this.#Mt(e)}}class LargestRender{#At;#Lt;#zt;constructor({works:e},t,r,s){return this.#At=t,this.#zt=r,this.#Lt=Array.isArray(e[0])?[e[s]]:e,this.#$t()}#Et({x:e,y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?l(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#Tt({x:e,y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),a=e.at(-1),i=.5*t.at(-1),n=.5*a-10*r.length*.5,o=1===t.length?i:l(t)+i;return s.setAttribute("x",n),s.setAttribute("y",o),s.innerHTML=r[0],s}#$t(){let e,t,r;const s=document.createDocumentFragment(),a=[],i=[],o="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#Lt.map((c=>{if("in"===o){const e=c[0];(c=new Converter(c[1],c[2],c[3]).cmConvert).unshift(e)}e=n(c[1],this.#At.x,this.#zt[0]),t=n(c[3],this.#At.y,c[3]),e>this.#At.x&&(e=this.#At.x),t>this.#At.y&&(t=this.#At.y),a.push(e),i.push(t),s.appendChild(this.#Et({x:a,y:i})),r=[{x:a,y:i},c,this.#zt],s.appendChild(this.#Tt.apply(null,r))})),s}}function l(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class sameSizeRender{#At;#Lt;#zt;constructor({works:e},t,r,s){return this.#At=t,this.#zt=r,this.#Lt=this.#Jt(e,s),this.#$t()}#Jt(e,t){const r=this.#zt[2]/e[0][3];let s=[],a=[];return e.map((e=>{a.push(e),a.length===r&&(s.push([...a]),a=[])})),s[t]}#Et({X:e,Y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?u(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#Tt({X:e,Y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),a=e.at(-1),i=.5*t.at(-1),n=.5*a,o=1===t.length?i:u(t)+i;return s.setAttribute("x",n-10*r.length*.5),s.setAttribute("y",o),s.innerHTML=r[0],s}#$t(){let e,t,r;const s=document.createDocumentFragment(),a=[],i=[],o="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#Lt.map((c=>{if("in"===o){const e=c[0];(c=new Converter(c[1],c[2],c[3]).cmConvert).unshift(e)}t=n(c[1],this.#At.x,this.#zt[0]),r=n(c[3],this.#At.y,this.#zt[2]),t>this.#At.x&&(t=this.#At.x),r>this.#At.y&&(r=this.#At.y),a.push(t),i.push(r),s.appendChild(this.#Et({X:a,Y:i})),e=[{X:a,Y:i},c,this.#zt],s.appendChild(this.#Tt.apply(null,e))})),s}}function u(e){const t=e.reduce(((e,t)=>e+t),0);return 2===e.length?e.at(-2):t-e.at(-1)}class noCanvasRender{#Pt;#jt;#zt;constructor({works:e},t,r){return this.#Pt=t,this.#zt=r,this.#jt=e,this.#$t()}#Xt(e,t){let r,s;const a=d(e,t,this.#Pt);return e.includes(0)||t.includes(0)?(r=a.x,s=a.y):(r=e.includes(0)||1!==e.length?a.x:0,s=t.includes(0)||e.includes(0)?a.y:0),{posX:r,posY:s}}#Et({X:e,Y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=this.#Xt(e,t),{x:a,y:i}=this.#Pt;return r.setAttribute("x",s.posX+1),r.setAttribute("y",s.posY+1),e.at(-1)>=a||s.posX+e.at(-1)+1>=a?r.setAttribute("width",e.at(-1)-35.7):r.setAttribute("width",e.at(-1)),t.at(-1)>=i||s.posY+t.at(-1)>=i?r.setAttribute("height",t.at(-1)-20):r.setAttribute("height",t.at(-1)),r}#Tt({X:e,Y:t},r,s){const a=document.createElementNS("http://www.w3.org/2000/svg","text"),i=.5,n=+h(e).toFixed(0);let o,c;const l=d(e,t,s);return e.includes(0)||t.includes(0)?(o=l.x+(e.at(-1)*i-10*r.length*i),c=l.y+t.at(-1)*i):(o=e.includes(0)?l.x(e.at(-1)*i-10*r.length*i):n+e.at(-1)*i,c=t.includes(0)||e.includes(0)?l.y+t.at(-1)*i:t.at(-1)*i),a.setAttribute("x",o),a.setAttribute("y",c),a.innerHTML=r[0],a}#Ht(e,t,r,s){let a=r,i=[],n=[];for(;a>=0&&0!==e[a];)i.push(e[a]),a--;for(a=r;a>=0&&0!==t[a];)n.push(t[a]),a--;i=i.reduce(((e,t)=>e+t),0),n=n.reduce(((e,t)=>e+t),0),i>=s.x&&e.push(0),n>=s.y&&t.push(0)}#$t(){let e,t,r;const s=document.createDocumentFragment(),a=[],i=[],o="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#jt.map(((c,l)=>{if("in"===o){const e=c[0];(c=new Converter(c[1],c[2],c[3]).cmConvert).unshift(e)}t=n(c[1],this.#Pt.x,this.#zt[0]),r=n(c[2],this.#Pt.y,this.#zt[1]),t>this.#Pt.x&&(t=this.#Pt.x),r>this.#Pt.y&&(r=this.#Pt.y),a.push(t),i.push(r),s.appendChild(this.#Et({X:a,Y:i})),e=[{X:a,Y:i},c,this.#Pt],s.appendChild(this.#Tt.apply(null,e)),this.#Ht(a,i,l,this.#Pt)})),s}}function h(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}function d(e,t,r){let s,a,i,n=0,o=0;const c=h(e),l=h(t);return e.map((e=>0===e&&n++)),t.map((e=>0===e&&o++)),s=c-n*r.x,a=c<r.x||l<r.y?0:l-o*r.y,0===s&&t.includes(0)&&(i=t.indexOf(r.y),s=i>=0?e[i]:e[t.indexOf(0)-1]),a>=r.y&&(a=l-o*r.y-t.at(-1)),{x:s,y:a}}function p({type:e,crate:t,works:r},s){const a=function(){const e=document.querySelector(".crate-layer");if(e.parentNode)for(;e.firstChild;)e.removeChild(e.firstChild);return e}(),i=globalThis.screen.availWidth,n=[t[0]-23,t[1]-23,t[2]-28];let c;switch(c=o(i,[n[0],n[2]]),a.setAttribute("width",c.x),a.setAttribute("height",c.y),e){case"tubeCrate":a.appendChild(new TubeRender(r,c,n));break;case"largestCrate":a.appendChild(new LargestRender(r,c,n,s));break;case"sameSizeCrate":a.appendChild(new sameSizeRender(r,c,n,s));break;case"noCanvasCrate":c=o(i,[n[0],n[1]]),a.setAttribute("width",c.x),a.setAttribute("height",c.y),a.appendChild(new noCanvasRender(r,c,n));break;case"standardCrate":a.appendChild(new StandardRender(r,c,n,s))}return a}function m(){const e=document.getElementById("layers"),t=function(){const e=JSON.parse(localStorage.getItem("doneList"));let t,r,s,a=document.getElementById("selected-crate").value.split(" ")[1];for(t in e)e[t]?.hasOwnProperty("crates")&&e[t].crates.map(((i,n)=>{Array.isArray(i)&&0==--a&&(r=e[t].crates[n+1],s={type:t,crate:i,works:r})}),0);return s}(),r=+sessionStorage.getItem("numLayer");e.appendChild(p(t,r-1))}function g(e,t,r){let s;return"sameSizeCrate"===r?e[r].crates.map(((a,i)=>{if(0===t&&void 0===s){const t=28,n=e[r].crates[i-1][2]===a.works[0][3]+a.works[1][3]+t;s=n?a.works.length/2:a.works.length}(i%2==0||0===i)&&t--}),0):e[r].crates.map(((e,a)=>{0===t&&a%2==1&&(s="tubeCrate"===r||"noCanvasCrate"===r?1:e.works.length),(a%2==0||0===a)&&t--}),0),{layers:s,counter:t}}function y(e){const t=sessionStorage.getItem("layers"),r=document.getElementById("layer-count");r.innerText=void 0===e?`Current layer: 1 / ${t}`:`Current layer: ${e} / ${t}`}function f(e){const t=sessionStorage,r=Number.parseInt(t.getItem("layers")),s=Number.parseInt(t.getItem("numLayer"));let a;"next"===e.target.id||"layer-next"===e.target.id?(a=s+1,a<=r?(y(a),t.setItem("numLayer",a),a--):(a=r-1,t.setItem("numLayer",r))):(a=s-1,a>=1?(y(a),t.setItem("numLayer",a)):(a=1,t.setItem("numLayer",a))),C(),m()}function C(){const e=document.querySelector(".crate-layer");if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild)}function b(e,t){e.map((e=>{e&&(e.setAttribute("aria-hidden",!1),e.setAttribute("aria-expanded",!0))}))}async function w(){!function(){const e=new GraphicCrates,t=document.querySelectorAll(".toggle__plotter"),r=document.getElementById("layers"),s=sessionStorage.getItem("plotter")??!1;let a;for(a of t)"true"===a.ariaHidden?(a.ariaHidden="false",r.ariaHidden="true"):"false"===a.ariaHidden&&(a.ariaHidden="true",r.ariaHidden="false",s||(e.show,sessionStorage.setItem("plotter","true")))}()}function k(){const e=document.getElementById("layers"),t=function(){const e=JSON.parse(localStorage.getItem("doneList"));let t,r,s,a=document.getElementById("selected-crate").value.split(" ")[1];for(t in e)e[t]?.hasOwnProperty("crates")&&e[t].crates.map(((i,n)=>{Array.isArray(i)&&0==--a&&(r=e[t].crates[n+1],s={type:t,crate:i,works:r})}),0);return s}(),r=+sessionStorage.getItem("numLayer");e.appendChild(plotter(t,r-1))}function S(e,t,r,s){switch(e){case 409:!async function(e,t,r){if(confirm("This estimate already exist. Would you like to update it?")){const s="/api/v1/update/estimates";try{const a=await fetch(s,{method:"PUT",body:e,headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));403===a&&S(a,r)}catch(e){alert(`ATTENTION: ${e}`)}}else alert("Not updated!")}(r,s,t);break;case 403:!async function(e){const t={"Content-Type":"application/json; charset=UTF-8"};try{const r=await fetch("/api/v1/shift/tokens",{method:"POST",headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));x(e),console.log(r)}catch(e){alert(`ATTENTION: ${e}`)}}(t)}}async function x(e){const t=JSON.stringify(e),r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{S(await fetch("/api/v1/newEstimate",{method:"POST",body:t,headers:r}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),e,t,r)}catch(e){alert(`ATTENTION: ${e}`)}else!function(e){const t=localStorage,r=t.getItem("offResults"),s=void 0!==r&&JSON.parse(r);s?(s.push(e),t.removeItem("offResults"),t.setItem("offResults",JSON.stringify(s))):t.setItem("offResults",JSON.stringify([e]))}(e.reference)}function v(){const e="Results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}function A(e,t=!1){const r=localStorage.getItem("refNumb"),s="Results",a=globalThis.indexedDB.open(s),i=globalThis.navigator.onLine;a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const n=a.target.result.transaction(s,"readwrite").objectStore(s),o=n.get(e.reference);o.onsuccess=async()=>{void 0===o.result?n.add(e):await Promise.resolve(n.delete(o.result.reference)).then(n.add(e)),z(r,t)},i||function(e,t){const r="off_line_results",s=document.getElementById("input_estimate").value,a=globalThis.indexedDB.open(r);a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const i=a.target.result.transaction(r,"readwrite").objectStore(r),n=i.get(e.reference);n.onsuccess=()=>{(void 0===n.result||i.delete(n.result.reference))&&i.add(e),z(s,t)}}}(e)}}async function z(e,t=!1){const r=globalThis.indexedDB.open("Results");r.onerror=e=>{alert(`WARNING: ${e.target.errorCode}`)},r.onsuccess=()=>{const s=r.result.transaction("Results").objectStore("Results").get(e);s.onsuccess=async()=>{const e=localStorage.getItem("refNumb"),r=s.result;globalThis.sessionStorage.setItem(e,JSON.stringify(r)),!1===t&&await async function(e){const{reference:t,list:r,crates:s}=e,a={reference:t,list:r,crates:Object.assign({},s)};await x(a)}(s.result),"crate"===t&&await async function(e){const t={"Content-Type":"application/json; charset=UTF-8"},{reference:r,list:s,crates:a}=e,i={reference:r,list:s,crates:Object.assign({},a)};try{await fetch("/api/v1/update/estimates",{method:"PUT",body:JSON.stringify(i),headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)))}catch(e){alert(`ATTENTION: ${e}`)}finally{return"updated"}}(s.result)}}}async function I(){const e=await B();let t=document.getElementById("count");return e&&e.length>0&&document.getElementById("statusList").setAttribute("content",e.length),t.innerText=e?"Counting: "+e?.length:"Counting 0",t}async function E(){let e;const t=document.getElementById("cub-meter");return e=await B(),e=e?.reduce(((e,t)=>e+t.cubed),0)??0,t.innerText="Cub: "+(1e3*e/1e3).toFixed(3)+"m³",t}async function T(){let e,t,r;return r="Air-Cub: ",t=document.getElementById("cub-air"),e=await B(),e=e?.reduce(((e,t)=>e+t.cAir),0)??0,t.innerText="Air-Cub: "+(1e3*e/1e3).toFixed(3),t}async function L(e=!1){const t={},r=new WeakSet,s=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let a,i=document.cookie.split("=")[1];const n=await async function(){const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",t=await B();let r;return 0===t.length?alert("Oops! Sounds like you do not added any work yet. Please, try again!"):(r=await Promise.resolve(new UnitAdapter(t,e)),r)}(),o=document.querySelector(":root"),c=document.querySelector(".update-materials"),l=document.querySelector(".materials");return(e||confirm("Ready to crate all works?")&&n)&&(!function(){const e=new DocumentFragment,t=new DocumentFragment,r=document.createElement("panel-info"),s=document.createElement("panel-info"),a=document.getElementById("first_pane"),i=document.getElementById("second_pane");for(;a.firstChild;)a.removeChild(a.firstChild);for(;i.firstChild;)i.removeChild(i.firstChild);r.id="first-pane",s.id="second-pane",r.setAttribute("name","pane1"),s.setAttribute("name","pane2"),e.append(r),t.append(s),a.append(e),i.append(t)}(),t.reference=s,a=await B(),t.list=a.map((e=>e.data)),t.crates=n,A(t,e),c.setAttribute("name","materials-used"),l.setAttribute("name","packed-works"),l.setAttribute("content","crates"),("FULL"===i||"PLOTTER"===i||!i)&&(document.getElementById("crate-layers").disabled=!1),o.style.setProperty("--layer-state","block"),sessionStorage.removeItem("crate")),r.add(t),"Crated"}async function P(e=!1){document.getElementById("input_code").value="",document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="";const t=document.getElementById("show-layer"),r=document.querySelectorAll("padding-dialog").length,s=document.querySelector(":root"),a=document.querySelector(".update-materials");let i=document.cookie;i=i.split("=")[1],t&&t.hasChildNodes()&&w(),globalThis.document.getElementById("input_estimate").select(),globalThis.document.getElementById("input_code").select(),"update-materials"!==a.getAttribute("name")&&a.setAttribute("name","update-materials"),I(),E(),T(),r>0&&sessionStorage.setItem("CLOSED","NOW"),s.style.setProperty("--layer-state","none")}async function B(){const e=localStorage,t=[];let r;const s=["doneList","mode","storage","currency","metrica","refNumb","offResults","FETCHED","materials","packing","crating"];return Object.entries(e).map((e=>{!s.includes(e[0])&&t.push(JSON.parse(e[1]))})),t.length>0&&(r=t.map((e=>{const{code:t,x:r,z:s,y:a,packing:i}=e;return new ArtWork(t,r,s,a,i)}))),r||void 0}function O(e){const t=function(e){let t=2;const r=/^[0-9\.0-9]{1,7}$/;for(;--t>=0;)if(!r.test(e[t]))switch(t){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return e}([e[1],e[2],e[3]].map((e=>parseInt(e))));const r=/[^-a-z-A-Z-0-9]/g,s=document.getElementById("input_estimate").value,a=function(){const e=JSON.parse(localStorage.getItem("packing")),t=JSON.parse(localStorage.getItem("materials")),r=[];return!(!e||0===e.length)&&(e.filter((e=>{r.push(t.find((t=>t[0]===e)).flat())})),r)}();let i=0;if(!a)return alert("Please, select some packing material to apply to the artwork."),"material";if(r.test(e[0])||r.test(s))return alert('Found special character NOT allowed on "Work code",\t\tor "Estimate" input. Please, try again!'),!1;for(i in localStorage.key(i))if(e[0]===localStorage.key(i))return alert(`${e[0]} already added to the list. Please, try again`),!1;return function(){const e=localStorage.getItem("refNumb"),t=document.getElementById("input_estimate").value;e&&e!==t&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",t),document.getElementById("input_estimate").value=t):document.getElementById("input_estimate").value=e);localStorage.setItem("refNumb",t)}(),!!Array.isArray(t)&&new ArtWork(e[0],t[0],t[1],t[2],a)}async function N(){const e=document.getElementById("input_estimate").value,t=document.getElementById("input_code").value,r=document.getElementById("input_length").value,s=document.getElementById("input_depth").value,a=document.getElementById("input_height").value;let i;return e?""===(t&&r&&s&&a)?(alert("Oops! Do not forget to fill each field. Please, try again!"),function(){let e=!1;["input_estimate","input_code","input_length","input_depth","input_height"].find((t=>{const r=document.getElementById(t);if(console.log(r.value),!r.value&&!e)return e=!0,r.select()}))}()):(i=O([t,r,s,a]),i&&"material"!==i&&(await async function({code:e}){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s;return r?(s=Number.parseInt(r[r.length-1]),s+=1,r.push([s,e]),t.setItem("codes",JSON.stringify(r))):t.setItem("codes",JSON.stringify([[0,e]]))}(i.data),localStorage.setItem(i.data.code,JSON.stringify(i.data)),localStorage.setItem("storage","art-work"),I(),T(),E(),P()),i&&"material"!==i?P():0):alert('Attention! Please, add the "Doc:" reference field!')}function F(){const e=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(e))!function(e){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s=0;for(;r[s][1]!==e&&s<=r.length;)s++;r.splice(s,1),t.setItem("codes",JSON.stringify(r))}(e),localStorage.removeItem(e),I(),T(),E();else{if(null===e)return P();alert(`"${e}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),P()}function R(e){const t=document.createDocumentFragment();return e.map((e=>{const r=document.createElement("option");r.textContent=e,t.appendChild(r)})),t}function D(e,t,r,s){const a=JSON.parse(sessionStorage.getItem("currency")),i=1e3,n=Number.parseFloat(r.value)===a[e],o=Number.parseFloat(s.value)===a[t];return e===t?n?s.value:r.value:n&&o?~~(a[e]*a[t]*i)/i:a[e]<a[t]?!0===n?~~(s.value/a[t]*a[e]*i)/i:~~(r.value*a[t]/a[e]*i)/i:!0===o?~~(r.value*a[t]/a[e]*i)/i:~~(s.value/a[t]*a[e]*i)/i}async function _(){const e=await fetch("/api/v1/currencies",{method:"GET"}).then((async e=>await e.json())).catch((e=>alert(`CurrencyError: ${e}!`))),{rates:t}=e.response,r=globalThis.sessionStorage;return t&&r.setItem("currency",JSON.stringify(t))}function q(e,t){const r=JSON.parse(sessionStorage.getItem("currency"));if(!r)return!1;t.value=r[e]}async function W(){await _(),await async function(){const e=JSON.parse(sessionStorage.getItem("currency")),t=document.getElementById("coin1"),r=document.getElementById("coin2"),s=Object.keys(e);if(!e)return"Error";t.appendChild(R(s)),r.appendChild(R(s))}()}function U(e,t,r,s){return"centimeters"===e?function(e,t,r,s){const a=2.54,i=.01,n=M(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(n.checked1)return $(r,s,a,"in");return $(r,s,i,"m")}(e,t,r,s):"inches"===e?function(e,t,r,s){const a=.393,i=.0254,n=M(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(n.checked2)return $(r,s,a,"cm");return $(r,s,i,"m")}(e,t,r,s):function(e,t,r,s){const a=.01,i=.0254,n=M(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(n.checked3)return $(r,s,a,"cm");return $(r,s,i,"in")}(e,t,r,s)}function M(e,t){return{checked1:"centimeters"===e&&"inches"===t,checked2:"inches"===e&&"centimeters"===t,checked3:"meters"===e&&"centimeters"===t}}function $(e,t,r,s){const a=1e3;return"m"!==s?e.value>t.value?~~(e.value/r*a)/a:~~(t.value*r*a)/a:e.value<t.value?~~(t.value/r*a)/a:~~(e.value*r*a)/a}function J(){const e=new DocumentFragment,t=document.createElement("panel-info");return t.setAttribute("name","status"),t.id="statusList",t.class="addedStatus",t.setAttribute("content",0),e.appendChild(t)}if(globalThis.onstorage=()=>{E(),T(),I()},globalThis.onload=async()=>{const e=localStorage.getItem("mode"),t=document.getElementById("status-frame"),r=document.getElementById("statusList");sessionStorage.removeItem("onCrate"),sessionStorage.removeItem("plotter"),r?r.setAttribute("content","reload"):t.append(J()),Y(),null===e&&localStorage.setItem("mode","light"),G(),function(){const e=localStorage.getItem("mode"),t=document.body;switch(e){case"light":document.getElementById("light-mode").checked=!0,t.classList.remove("dark-mode"),t.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,t.classList.remove("light-mode"),t.classList.toggle("dark-mode")}}(),async function(){const e=new DocumentFragment,t=new DocumentFragment,r=document.createElement("pack-up"),s=document.createElement("pack-down"),a=document.getElementById("contents1"),i=document.getElementById("contents2");r.setAttribute("name","select-materials"),r.className="materials",r.ariaHidden="false",s.setAttribute("name","update-materials"),s.setAttribute("content","0"),s.className="update-materials",e.appendChild(r),t.appendChild(s),a.appendChild(e),i.appendChild(t)}()},!localStorage.getItem("metrica")){const e=document.getElementById("cm").value;localStorage.setItem("metrica",e)}function j(){const e=localStorage.getItem("metrica"),t=confirm("Attention! You are going to change the measurement of the works.");e&&void 0!==e?t&&("cm - centimeters"===e?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")):localStorage.setItem("metrica",document.getElementById("cm").value),G()}const X=()=>{Y(),L();const e=document.querySelector(".result");sessionStorage.getItem("codes")&&(e&&"true"===e.ariaHidden&&b([e]),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};const H=()=>{const e=document.querySelector(".result"),t=document.getElementById("layers"),r=document.querySelector(".plotter__menu"),s=document.getElementById("statusList"),a=document.getElementById("status-frame"),i=document.getElementById("first_pane"),n=document.getElementById("second_pane"),o=document.querySelector(".side-menu");confirm("Do you really want to delete the whole list?")&&(!function(){const{mode:e,metrica:t,materials:r}=localStorage;localStorage.clear(),sessionStorage.clear(),localStorage.setItem("mode",e),localStorage.setItem("metrica",t),localStorage.setItem("materials",r),I(),E(),T()}(),P(!0),globalThis.document.getElementById("input_estimate").value="",globalThis.document.getElementById("input_estimate").select(),b([e,t,r]),s.setAttribute("content",void 0),a.removeChild(document.getElementById("statusList")),i.firstChild&&i.removeChild(document.getElementById("first-pane")),n.firstChild&&n.removeChild(document.getElementById("second-pane")),a.append(J()),o.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),document.querySelector(".materials").setAttribute("name","select-materials"))};function Y(){const e=localStorage.getItem("refNumb");let t=document.cookie;return t=t.split("=")[1],e&&(document.getElementById("input_estimate").value=e),v(),function(){const e="Materials",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"materials"}),r.createIndex("materials","materials",{unique:!0})}}(),"OFF"!==t&&"FULL"!==t||function(){const e="off_line_results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}(),E()&&T()&&I()}function G(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function Z({works:e}){let t=[];const r=Array.isArray(e[0][0])?e[0]:e;return r?.map((e=>{let r;if(Array.isArray(e))return t.push(e);for(r in e)t.push(r),1===e[r].length?t.push(e[r][0]):Array.isArray(e[0])?e[r][0].map((e=>t.push(e))):e[r].map((e=>t.push(e)))})),t}function V(e){if(!e)return"There is no crates. Please, try again!";const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",r=e.map((e=>{let r;return"string"==typeof e?`LAYER layer ${e?.at(-1)}:`:e.length>=5?(r=`CODE: ${e[0]} - ${e[1]} x ${e[2]} x ${e[3]} - ${t}`,r):4===e.length?(r=`CRATE: ${e[0]} x ${e[1]} x ${e[2]} - ${t}`,r):void 0})),s=function(e,t){for(;t--;)e=(e=(e=(e=(e=e.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return e=(e=e.replace("[","")).replace("]","")}(JSON.stringify(r),r.length);navigator.clipboard.writeText(s)}function K(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>{(Array.isArray(e.data.crates)||e.data.hasOwnProperty("crates"))&&function({crates:e}){sessionStorage.setItem("copy1","done!"),V(e.allCrates)}(e.data)}}function Q(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>function({crates:e}){let t,r,s=[];for(t in e)e[t].hasOwnProperty("crates")&&e[t].crates.map(((e,t)=>{switch(t%2){case 0:s.push(e);break;case 1:r=Z(e),r.map((e=>s.push(e))),r=null}}),0);return sessionStorage.setItem("copy2","done!"),V(s)}(e.data)}function ee(e){localStorage.setItem("mode",e),function(e){const t=document.body.classList;t.remove("light-mode"),t.remove("dark-mode"),"dark"===e?t.add("dark-mode"):t.add("light-mode")}(e)}function te(e){const t=e.target.closest(".accordion-panel");if("body-app"===e.target.id)return re();t&&function(e){const t=e.parentElement.querySelectorAll("button"),r=e.parentElement.querySelectorAll(".menu__input");t.forEach((e=>{e.setAttribute("aria-expanded",!1)})),r.forEach((e=>{e.setAttribute("aria-hidden",!0)})),function(e){e.querySelector("button").setAttribute("aria-expanded",!0),e.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(e)}(t)}function re(){const e=document.querySelector(".accordion-panel");let t,r,s;for(t in e)r=e.parentElement.querySelectorAll("button"),s=e.parentElement.querySelectorAll(".menu__input"),r.forEach((e=>{e.setAttribute("aria-expanded",!1)})),s.forEach((e=>{e.setAttribute("aria-hidden",!0)}))}function se(){const e=document.getElementById("statusList"),t=document.getElementById("status-frame"),r=document.querySelector(".side-menu");t.removeChild(document.getElementById("statusList")),t.append(J()),e.setAttribute("content","FETCHED"),r.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),E(),T(),I()}async function ae(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),r=await new Promise(((r,s)=>{t.postMessage(e),t.onmessage=e=>{void 0!==e?r(e.data):s(void 0)}}));return!!r&&(document.getElementById("input_estimate").value=e,sessionStorage.setItem("FETCHED",JSON.stringify(r)),se(),ie([r]),"IDB data Found.")}async function ie(e){try{if(e?.hasOwnProperty("crates")){document.getElementById("input_estimate").value=e.reference;const{materials:t}=localStorage;return sessionStorage.clear(),sessionStorage.setItem("FETCHED",JSON.stringify(e,null)),localStorage.setItem("materials",t),se()}throw new TypeError("Data not found!")}catch(e){return e}}async function ne(e){const t=`/api/v1/estimates/${e}`,r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){return await fetch(t,{method:"GET",headers:r}).then((async e=>await e.json())).then(ie).catch((e=>alert(`Search ERROR! \n ${e}`)))}}async function oe(){const e=document.getElementById("estimate_getter").value,t=(r=document.getElementById("input_estimate").value,async e=>{r&&r!==e&&P(!0)});var r;if(!function(e){switch(/[^-a-z-A-Z-0-9]/g.test(e)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(e)){const r=[ae(e),ne(e)];await Promise.all(r).then((async r=>{r[0]||0!==r[1]?.length?await Promise.resolve(t(e)).then((async()=>{if(r[1]?.length>0){A({reference:r[1][0].reference_id,crates:r[1][0].crates.crates,list:r[1][0].works.list},!0)}else L(!0)})):alert("Document not found! Please, try again.")}))}}function ce(){globalThis.navigator.serviceWorker.ready.then((async e=>{await caches.delete("craterCache_v1"),await caches.delete("status_V1"),await caches.delete("pane1_v1"),await caches.delete("pane2_v1"),await e.unregister()}))}async function le(){confirm("Are you sure to logout?")&&await fetch("/api/v1/logout",{method:"GET"}).then(ce).then((e=>globalThis.location.assign(e.url))).catch((async()=>{await Promise.resolve(ce).then(globalThis.location.replace("https://ottocratesolver.com/login"))}))}globalThis.onkeydown=e=>{const t="Enter"===e.key&&!0===e.ctrlKey,r=!0===e.ctrlKey&&"V"===e.key,s="Escape"===e.key;t&&X(),r&&w(),s&&re(),e.stopImmediatePropagation()},globalThis.onafterprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.onbeforeprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.document.getElementById("main-app").addEventListener("click",(e=>{const t=document.querySelector(".materials"),r=document.querySelector(".update-materials");let{id:s,className:a,attributes:i}=e.target;{const{shadowRoot:e}=t,r=e.querySelector(".upPane");r?.addEventListener("click",(e=>{const{id:t,className:s,tagName:a}=e.target,i=new CustomEvent("open-crate",{bubbles:!0,composed:!0,detail:{id:t,className:s,tagName:a}});r.dispatchEvent(i)}),!0)}{const{shadowRoot:e}=r,t=e.querySelector(".data-update");t?.addEventListener("click",(e=>{const{id:r,className:s}=e.target,a=new CustomEvent("update-materials-info",{bubbles:!0,composed:!0,detail:{id:r,className:s}});t.dispatchEvent(a),e.stopImmediatePropagation()}))}switch("crates"===i.content&&(a="crates"),s||(s=a)){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":te(e);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:e}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${e}`),globalThis.deferredPrompt=null}();break;case"add-btn":N();break;case"remove-btn":F();break;case"clear-btn":H();break;case"crate-btn":case"crate_btn":X();break;case"copy-pane1":K();break;case"copy-pane2":Q();break;case"logout":case"logout-btn":le();break;case"exchange-header":W(),async function(){const e=sessionStorage.getItem("currency"),t=JSON.parse(sessionStorage.getItem("coin1")),r=JSON.parse(sessionStorage.getItem("coin2")),s=document.getElementById("coin1"),a=document.getElementById("coin2");null!==t&&(s.value=t),null!==r&&(a.value=r),null===e&&await _()}(),te(e);break;case"ex-btn":case"exchange-btn":W(),te(e);break;case"fetch-btn":oe();break;case"crate-layers":case"layer-crate":w();break;case"previous":case"layer-prev":case"next":case"layer-next":f(e);break;case"settings-content":"update-materials"!==a&&"new-material"!==a&&t.setAttribute("content","settings-content");break;case"packages":"update-materials"!==a&&"select-materials"!==a&&t.setAttribute("content","packages");break;case"select-materials":"update-materials"!==a&&"select-materials"!==a&&t.setAttribute("content","select-materials");break;case"materials":"update-materials"!==a&&"select-materials"!==a&&t.setAttribute("content","confirm-save");break;case"report":case"report":t.setAttribute("name","packages");break;case"pack-opts":case"works-packed":t.setAttribute("name","works-packed");break;case"reset-sizes":t.setAttribute("name","reset-sizes");break;case"reset-szs":t.setAttribute("name","reset-szs");break;case"adding-material":t.setAttribute("name","adding-material");break;case"add__new__field":t.setAttribute("name","add__new__field");break;case"cancel-remove":t.setAttribute("name","cancel-remove");break;case"new-material":t.setAttribute("name","new-material");break;case"confirm-save":t.setAttribute("name","confirm-save");break;case"printer-icon":case"printer-btn":case"printer-svg":case"printer":globalThis.print()}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(e=>{switch(e.preventDefault(),e.target.id){case"input_estimate":v();break;case"in":case"cm":j();break;case"dark-mode":ee("dark");break;case"light-mode":ee("light");break;case"coin1":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(e)),q(e,t)}();break;case"coin2":!function(){const e=document.getElementById("coin2").value,t=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(e)),q(e,t)}();break;case"units1":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"units2":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"selected-crate":!async function(){let e,t,r=+document.getElementById("selected-crate").value.split(" ")[1],s=JSON.parse(localStorage.getItem("doneList"));for(t in s)s[t].hasOwnProperty("crates")&&r>0&&s[t].crates.length>0&&(e=g(s,r,t),r=e.counter);sessionStorage.setItem("layers",e.layers),sessionStorage.setItem("numLayer",1),y()}(),function(){const e=document.getElementById("selected-crate").value;C(),k(e.split(" ")[1])}()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(e=>{let{id:t,className:r}=e.target;switch(t||(t=r)){case"coin1-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");q(t,s),s.value=`$ ${D(e,t,r,s)}`}();break;case"coin2-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");q(e,r),r.value=`$ ${D(e,t,r,s)}`}();break;case"input-unit1":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");s.value=0,s.value=U(e,t,r,s)}();break;case"input-unit2":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");r.value=0,r.value=U(e,t,r,s)}()}}),!0),globalThis.onsubmit=e=>{e.preventDefault()},globalThis.document.getElementById("main-app").addEventListener("open-crate",(e=>{const{id:t,className:r,tagName:s}=e.detail,a=document.querySelector(".materials");"A"===s&&a.setAttribute("content",`${t}-${r}`)}),!0),globalThis.document.getElementById("main-app").addEventListener("update-materials-info",(e=>{const{id:t}=e.detail,r=document.querySelector(".update-materials");e.stopImmediatePropagation(),"update-info"===t&&r.setAttribute("name","update")}),!0),globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(e=>{"Enter"===e.key&&oe()})),globalThis.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),console.log("👍","beforeinstallprompt",e),globalThis.deferredPrompt=e}));
