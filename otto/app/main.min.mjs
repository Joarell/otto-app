class Converter{#e;constructor(...e){this.#e=[...e]}get cmConvert(){return r.call(this.#e)}get inConvert(){return t.call(this.#e)}}function e(){const e=this.filter((e=>Number(e)?e:"string"==typeof e&&e?+e.trim():void 0));try{if(!e||e.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(e){return e}return e}function t(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t/e).toFixed(3)))}return t}function r(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t*e).toFixed(0)))}return t}class RegexChecker{#e;constructor(...e){this.#e=[...e]}get regexSizes(){return s.call(this.#e)}}function s(){try{const e=this.map((e=>{const t=/[0-9]{1,3}/.test(e);return!Number.isNaN(e)&&t})),t="Not a valid entry to RegexChecker!";if(e.includes(!1))throw new TypeError(t)}catch(e){return console.error(e),e}}class CubCalc{#t;#r;#s;constructor(e,t,r){this.#t=+e,this.#r=+t,this.#s=+r}get cubCalcAir(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/6e3).toFixed(3)}(this.#t,this.#r,this.#s)}get cubArea(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/1e6).toFixed(3)}(this.#t,this.#r,this.#s)}}class Hexaedro{constructor(e,t,r){try{if(!e||!t||!r)throw new TypeError("Please, provide a correct x, z or y value.")}catch(e){return e}this.x=+e,this.z=+t,this.y=+r}}class ArtWork extends Hexaedro{coordinates;packMaterials;code;#t;#r;#s;constructor(e,t,r,s,a){super(t,r,s);try{if(!e||e.trim()<=0){const t=`Please, provide a valid code. Current: ${e}`;throw new TypeError(t)}}catch(e){return e}this.code=""+e,this.#t=+t,this.#r=+r,this.#s=+s,this.packMaterials=a}#a(){const e={x:structuredClone(this.#t),z:structuredClone(this.#r),y:structuredClone(this.#s)};return this.packMaterials&&this.packMaterials.length&&this.packMaterials.map((t=>{e.x+=2*t[2],e.z+=2*t[2],e.y+=2*t[2]})),[this.code,e.x,e.z,e.y]}#n(e,t){return e.map(((e,r)=>{const s=[this.packMaterials[r][0]];return s.push(+(100*t/e).toFixed(0)),s}),0)}#i(e){return e.map(((e,t)=>"Roll"===this.packMaterials[t][5]?[e[0],+(e[1]/100).toFixed(2)]:[e[0],Math.ceil(e[1]/100)]),0)}#o(e){return e.map((e=>1-+(e[1]/100).toFixed(3)%1))}#c(){const e=this.packingDemanded,t=this.packMaterials.map((e=>e[1]*e[3]/100)),r=this.#n(t,e),s=t.map(((t,s)=>[r[s][0],t>e]),0),a=this.#o(r),n=this.packMaterials.map((e=>e[4])),i=this.packMaterials.map(((e,r)=>[e[5],t[r],e[0]]),0),o=n.map(((e,t)=>{const s=+(r[t][1]/100*e).toFixed(2);return[r[t][0],s,+e]}),0),c=this.#i(r,a);return{demand:e,percent:r,reuse:s,residual:a,types:i,cost:o,quantity:c}}get arr(){return[this.code,this.#t,this.#r,this.#s]}get cAir(){return new CubCalc(this.#t,this.#r,this.#s).cubCalcAir}get cubed(){return new CubCalc(this.#t,this.#r,this.#s).cubArea}get autoConvert(){let{x:e,z:t,y:r}=this;const s=new Converter(e,t,r).cmConvert;return e=s[0],t=s[1],r=s[2],[this.code,e,t,r]}get data(){return{code:this.code,x:this.#t,z:this.#r,y:this.#s,packing:this.packMaterials}}get packingDemanded(){const{x:e,z:t,y:r}=this;return+(2*(e*r+e*t+r*t)/100).toFixed(5)}get cratePosition(){return this.coordinates}get packedSized(){return this.#a()}get packInfo(){return this.#c()}set defCoordinate(e){this.coordinates=e}}class ArrangerLargestCanvas{#l;constructor(e){return this.#l=e,this.#u()}#d(){const e=this.filter((e=>e.x>=213&&e.y>=213?e:0));return!!e.length&&e}#u(){const{sorted:e}=this.#l,t=this.#d.call(e);return t&&t.map((e=>{e&&this.#l.sorted.splice(this.#l.sorted.indexOf(e),1)})),t&&(this.#l.largest=t),this.#l}}class ArrangerNoCanvas{#h;constructor(e){return this.#h=e,this.#m()}#p(e){e.map((e=>{this.sorted.splice(this.sorted.indexOf(e),1)}))}#g(){let{sorted:e,sameSize:t}=this.#h;let r=e.filter((e=>e.z>15)),s=t.filter((e=>e.z>15)),a=[];return r.map((e=>a.push(e))),this.#p.call(this.#h,r),s.map((e=>a.push(e))),this.#p.call(this.#h,s),e=null,t=null,r=null,s=null,this.#h.noCanvas=a,this.#h}#m(){return this.#g()}}class ArrangerSameSize{#l;constructor({sorted:e}){return this.#l=e,this.#y()}#f(){const e=[];return this.map((t=>{let r,s=0;if(t.z<=10)for(s in this)a=this[s],n=t,r=a.cubed<=n.cubed&&a.code!==n.code,!e.includes(this[s])&&r&&e.push(this[s]);var a,n})),e}#k(e,t){const r=t.x,s=t.y,a=t.cubed;return e.x===r&&e.y===s&&e.cubed<=a}#w(e){const t=[];return e.map((r=>{let s=[],a=0;for(a in e)this.#k(e[a],r)&&!t.includes(e[a])&&s.push(e[a]);s.length>=4&&s.map((e=>{t.push(e)})),s=null})),t}#y(){const e=this.#f.call(this.#l),t=this.#w(e);return t.map((e=>{this.#l.splice(this.#l.indexOf(e),1)})),{sorted:this.#l,sameSize:t}}}class ArrangerStarter{#l;constructor(e){return this.#l=e,this.#C()}#b(){return this.#l.map((e=>{const t=e.arr;return t.push(e.cubed),t}))}#S(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#S(r,t).concat(s,this.#S(a,t))}#C(){const e=this.#b(),t=this.#S(e,4),r=[];return t.map((e=>{this.#l.find((t=>e[0]===t.code?r.push(t):0))})),{sorted:r}}}class ArrangerTube{#l;constructor(e){return this.#l=e,this.#v()}#v(){const{noCanvas:e}=this.#l,t=e.filter((e=>{const t=e.z<35&&e.y<35,r=e.z===e.y;if(t&&r&&e.x!==e.y&&r)return e}));return t.map((e=>{this.#l.noCanvas.splice(this.#l.noCanvas.indexOf(e),1)})),this.#l.tubes=t,this.#l}}class Arranger{#A;constructor(e){this.#A=e;const t=this.#I();return t&&"TypeError"===t.constructor.name?t:(this.#T(),Object.assign(Arranger,{list:this.#A}))}#T(){this.#E(),this.#y(),this.#x(),this.#z(),this.#B()}#I(){try{const e=e=>0===e.length||!e;if(!Array.isArray(this.#A)||e(this.#A)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#A.map((e=>"ArtWork"===e.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(e){return e}}#E(){this.#A=new ArrangerStarter(this.#A)}#y(){this.#A=new ArrangerSameSize(this.#A)}#x(){this.#A=new ArrangerNoCanvas(this.#A)}#z(){this.#A=new ArrangerLargestCanvas(this.#A)}#B(){this.#A=new ArrangerTube(this.#A)}}class CrateMaker{#P;#L;constructor(e,t=!1){if(!e)return!1;this.#P=e,this.#L=t}#O(e){const t=["Pinewood","Plywood"],r=e.filter((e=>t.includes(e[5]))),s=e.filter((e=>"Foam Sheet"===e[5]));let a=0,n=0,i=0,o=0,c=0;return r.map((e=>{a+=+e[2],n+=+e[2]})),s&&s.length&&s.map((e=>{if(this.#P>1&&e[2]<=2.5)return this.#L&&(this.#L=!1,i+=+e[2]),o=e[2],n+=+e[2]*(this.#P-1);a+=+e[2],n+=+e[2],i+=+e[2],e[2]>2.5&&(c=2*e[2])})),a*=2,n*=2,i*=2,{x:a,z:n,y:i,div:o,pad:c}}#N(){let{materials:e,crating:t}=localStorage;const r=[];return e=JSON.parse(e),t=JSON.parse(t),t.map((t=>{const s=e.find((e=>e[0]===t));s&&r.push(s)})),r.length?this.#O(r):{x:0,z:0,y:0}}get outSizes(){return this.#N()}}class WorksCoordinates{#F;#D;#R;#_;constructor(e=!1){e&&(this.#D=e,this.#_=this.#q())}#q(){const e={emptyArea:[],artLocation:new Map,baseSize:this.#D,plotter3D:new Map,innerSize:[],finalSize:[],layers:[],get reset(){this.emptyArea=[[0,0,this.baseSize[0],this.baseSize[2]]]},get fillGaps(){const e=[];return this.layers.map((t=>{const{vacuum:r,works:s}=t,a=((e,t=0)=>(e.map((e=>!t||e.work[2]>t[1]?t=[e.work[0],e.work[2]]:0)),t))(s),{total:n,sizes:i}=((e,t=0,r=[])=>(e.map((e=>{if(e[0]===e[2]&&e[1]===e[3])return;let s=e[2]-e[0],a=e[3]-e[1];!s&&a&&(s=e[0]),s&&!a&&(a=e[1]),r.push([+s.toFixed(2),+a.toFixed(2)]),t+=+(s*a).toFixed(3)})),{total:t,sizes:r}))(r);e.push({highestZ:a,total:n,sizes:i})})),e},set defineLayer(e){const t=structuredClone(this.emptyArea),r=structuredClone(e[1]);this.layers.push({vacuum:t,works:r}),this.reset}};return e.reset,e}#U(e,t,{x:r,y:s,flip:a}){const{emptyArea:n}=this.#_,i=n[0][2],o=n[0][3];if(i===r&&o===s||i===s&&o===r)return;if(n.length>1){const c=n[0][0]===t[0];c&&!a?n[0][0]+=r:n[0][1]+=s;const l=n[0][0],u=n[0][1],d=l+r===i?i:0,h=u+s===o?o:0,m=c?[r+l,h,i,o]:[l,h,i,o],p=c?[d,s+u,i,o]:[d,u,i,o];return n.splice(e,1),c&&m[0]<i&&n.push(m),void(!c&&p[1]<o&&n.push(p))}const c=!(r===i)&&[r,0,i,o],l=!(s===o)&&[0,s,i,o];c&&n.push(c),l&&n.push(l)}#M(e,t){const r=t[0]===t[2]&&t[1]===t[3],s=t[2],a=t[3],n=e[1]+t[0]<=s&&t[0]<s,i=e[3]+t[1]<=a&&t[1]<a,o=e[3]+t[0]<=s&&t[0]<s,c=e[1]+t[1]<=a&&t[1]<a;return{check01:!r&&(n&&i),check02:!r&&(o&&c)}}#W({emptyArea:e,found:t,art:r,ind:s,pos:a}){e.length>1&&0===a&&a++;const n=e[a],i=e[0][0]===e[0][2]&&e[0][1]===e[0][3];if(t||!n||i)return t;const{check01:o,check02:c}=this.#M(r,n),l=e[0][2],u=e[0][3],d=r[1]===l&&r[3]===u||r[3]===l&&r[1]===u;let h,m,p=!1;return o?(t=!0,h=r[1],m=r[3],this.#R[s].defCoordinate={x:e[a][0],z:r[2],y:e[a][1]},0===a&&(e[0][0]=(h||m>0)&&!d?h:l,e[0][1]=(h>0||m)&&!d?m:u)):c&&(t=!0,h=r[3],m=r[1],r.push('<i class="nf nf-oct-sync"></i>'),p=!0,this.#R[s].defCoordinate={x:e[a][1],z:r[2],y:e[a][0]},0===a&&(e[0][1]=(h||m>0)&&!d?e[0][2]-r[3]:u,e[0][0]=(h>0||m)&&!d?e[0][3]-r[1]:l)),t?this.#U(a,n,{x:h,y:m,flip:p}):a++,this.#W({emptyArea:e,found:t,art:r,ind:s,pos:a})}#$(e,t,r){const s=void 0===e.emptyArea[0]&&void 0===e.emptyArea[1],a=e.emptyArea[0][0]===e.emptyArea[0][2],n=e.emptyArea[0][1]===e.emptyArea[0][3];if(s||!t[r]||a&&n)return e;let i;const{emptyArea:o,feat:c}=e,l=t[r],u=this.#R.findIndex((e=>e.code===l[0])),d={emptyArea:o,found:!1,art:l,ind:u,pos:0};return this.#W(d)&&(i=t.splice(r,1).flat(),c.push({work:i,list:r,raw:u})),this.#$(e,t,r-1)}get bluePrintCoordinates(){return this.#_}get fillLayer(){const{info:e,list:t,len:r,raw:s}=this.#F;return this.#R=s,!!this.#F&&this.#$(e,t,r)}set fillPreparing(e){this.#F=e}}class CraterPythagoras{#l;#u;#R;#_;constructor(e){return e&&0!==e.length?(this.#R=e,this.#u=e.map((e=>e.arr)),this.#l=structuredClone(this.#u),this.#j()):{largest:!1}}#J(e,t,r,s=1){if(!e.length&&!r)return this.#_;const{emptyArea:a}=this.#_,n={emptyArea:a,feat:[]},i=e.length-1;let o;return t.fillPreparing={info:n,list:e,len:i,raw:this.#R},o=t.fillLayer,this.#_.defineLayer=[s,o.feat],this.#J(e,t,r-1,s+1)}#H(e,t,r,s){const a=new WorksCoordinates(e);this.#_=a.bluePrintCoordinates,this.#J(this.#l,a,t),this.#R.map((e=>this.#_.artLocation.set(e.code,e))),this.#_.innerSize=[e[0]+s,r+s,e[2]+s]}#X(e,t){const r=new CrateMaker(t).outSizes,s=+(e[0]+r.x).toFixed(3),a=+(e[1]+r.z).toFixed(3),n=+(e[2]+r.y).toFixed(3),i=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=n%1>0?n:n.toFixed(0),l=r.div&&t.length>1?e[1]+r.div*(t-1):e[1];return this.#H(e,t,l,r.pad),[+i,+o,+c]}#G(e){const t=e[2]**2,r=57600,s=t>r?t-r:r-t,a=~~(100*Math.sqrt(s))/100;return this.#_.finalSize=[e[0],a,240],[...this.#_.finalSize]}#Z(e){let t,r=0,s=0,a=0;return e.map((e=>{r<e[1]&&(r=e[1]),s<e[2]&&(s=e[2]),a<e[3]&&(a=e[3])})),t=r>=a?this.#X([r,s,a],e.length):this.#X([a,s,r],e.length),t}#Y(e){let t;return t=this.#Z(e),e.map((e=>{e[1]<=t[2]&&e[3]>t[2]&&e.push('<i class="nf nf-oct-sync"></i>')})),this.#G(t)}#K(){let e,t=[];for(;this.#u.length;)e=this.#u.splice(0,3),t.push(this.#Y(e)),t.push({works:e});return t[0].push(this.#_),t}#j(){const e=this.#K();return this.largest={crates:e}}}class CraterStandard{#R;#l;#V;#Q;#_;#ee;#P=0;constructor(e,t,r,s){return e&&0!==e.length?(this.#R=e,this.#l=e.map((e=>e.packedSized)),this.#V=r??4,this.#Q=t,this.#te([],s)):{standard:!1}}#te(e,t){switch(t){case!1:return e=this.#re(),this.#Q?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e};case!0:return e=this.#se([],1,structuredClone(this.#l)),this.#Q?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e}}}#ae(e,t){let r,s,a,n,i,o=0,c=0;for(i in e)r=e[i][0]>t[i][0],s=e[i][0]!==t[i][0],a=e[i][2]>t[i][2],n=e[i][2]!==t[i][2],r&&s?o+=1:s&&(c+=1),a&&n?o+=1:n&&(c+=1);return{opt1:o,opt2:c}}#ne(e,t){let r=0,s=0,a=0,n=0,i=2;return e.map((e=>e[0]<=300&&e[2]<=160?r++:a++)),t.map((e=>e[0]<=300&&e[2]<=160?s++:n++)),a===n?i=r<=s?1:2:a<n&&(i=r>=s?1:2),{bestArrange:i}}#re(){const e={opt1:this.#se([],0,structuredClone(this.#l)),opt2:this.#se([],1,structuredClone(this.#l))},t=[],r=[],s=new WeakSet;Object.entries(e).map((e=>{"opt1"===e[0]?e[1].map(((e,r)=>r%2==0?t.push(e):0),0):e[1].map(((e,t)=>t%2==0?r.push(e):0),0)}));let a,n;return a=t.length===r.length?this.#ae(t,r):this.#ne(t,r),n=a.hasOwnProperty("bestArrange")?a.bestArrange:a.opt1<=a.opt2?1:2,s.add(a),1===n?e.opt1:e.opt2}#ie(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#ie(r,t).concat(s,this.#ie(a,t))}#oe(e,t){let r=0,s=0,a=0;const n=new CrateMaker(this.#P).outSizes;if(this.#P>1)for(s in t)Object.entries(t[s]).map((e=>{e.includes("status")||(e[1].map((e=>{e[2]>a&&(a=e[2])})),r+=a,a=0)}));a=n.div*(this.#P-1)+r,this.#_.innerSize=[e[0]+n.pad,a+n.pad,e[2]+n.pad],n.x+=e[0],n.z+=r,n.y+=e[2],n.y+=8;const i=n.x%1>0?n.x.toFixed(3):n.x.toFixed(0),o=n.z%1>0?n.z.toFixed(3):n.z.toFixed(0),c=n.y%1>0?n.y.toFixed(3):n.y.toFixed(0);return this.#R.map((e=>this.#_.artLocation.set(e.code,e))),this.#_.finalSize=[+i,+o,+c],[+i,+o,+c,structuredClone(this.#_)]}#ce(e,t){switch(this){case 1:Array.isArray(t[0])?e.push({layer1:t}):e.push({layer1:[t]});break;case 2:Array.isArray(t[0])?e.push({layer2:t}):e.push({layer2:[t]});break;case 3:Array.isArray(t[0])?e.push({layer3:t}):e.push({layer3:[t]});break;case 4:Array.isArray(t[0])?e.push({layer4:t}):e.push({layer4:[t]});break;case 5:Array.isArray(t[0])?e.push({layer5:t}):e.push({layer5:[t]});break;default:return}return e}#le(e,t){const r=new WorksCoordinates(e);this.#_=r.bluePrintCoordinates;const s=[];let a,n,i,o=[],c=0;try{for(;c++<this.#V&&t.length;){const{emptyArea:e}=this.#_;a={emptyArea:e,feat:[]},r.fillPreparing={info:a,list:t,len:t.length-1,raw:this.#R},n=r.fillLayer,i=structuredClone(n),o=i.feat.map((e=>{const t=this.#R.find((t=>t.code===e.work[0])).arr,r=structuredClone(e.work);return r[1]=t[1],r[2]=t[2],r[3]=t[3],r})),this.#ce.call(c,s,o),this.#_.defineLayer=[c,n.feat],o=null,n=null,a=null,o=[]}}catch(e){console.error(e)}return this.#P=c-1,delete this.#_.defineLayer,delete this.#_.reset,{crate:s,measure:e,list:t}}#ue(e,t,r){if(r<0)return e.x<e.y&&([e.x,e.y]=[e.y,e.x]),e;const s=t.length>5;return e.x=e.x<t[r][1]?t[r][1]:e.x,e.x=s&&e.x>=t[r][1]&&e.x+t[r][1]<=this.#ee?e.x+t[r][1]:e.x,e.z=t[r][2]>e.z?t[r][2]:e.z,e.y=t[r][3]>e.y?t[r][3]:e.y,e.y=s&&e.y>=t[r][3]&&e.y+t[r][3]<=140?e.y+t[r][3]:e.y,this.#ue(e,t,r-1)}#de(e){const{x:t,z:r,y:s}=this.#ue({x:0,z:0,y:0},e,e.length-1);return[t,r,s]}#he(e){let t=e.map((e=>(e.push(e[1]*e[3]),e)));return t=this.#ie(t,5),t=t.map((e=>(e.pop(),e))),e=t}#se(e,t,r){if(!r.length)return e;this.#ee=t?250:180,r=this.#he(r);const s=this.#de(r),{crate:a,measure:n,list:i}=this.#le(s,r);return e.push(this.#oe(n,a)),e.push({works:a}),this.#se(e,t,i)}}class CraterLastCheckReArranger{#me;constructor(e){return"crates ahead"===e[0]&&(this.#me=e,this.#pe())}#ie(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];let n=0;for(n in e)e[n][t]<=s[0][t]?r.push(e[n]):a.push(e[n]);return this.#ie(r,t).concat(s,this.#ie(a,t))}#ge(e,t,r){const s=e[t],{works:a}=s;return a.map((e=>{Object.entries(e).map((e=>{e[1].map((e=>{1===e.length?r.push(e[0][0]):e.map((e=>Array.isArray(e[0])?r.push(e[0]):0))}))}))})),structuredClone(r)}#ye(e,t){const r=new WeakSet,s=t.works.length;let a,n=0,i=!0;for(;n++<e.length&&i;)n%2==1&&(a=1===s?structuredClone(t.works[0]):structuredClone(t.works),this.#ge(e,n,a),a=this.#ie(a,4),a=new CraterStandard(a,!1,5,!0),a.crates.length===e.length&&(e.splice(n,1,a.crates[1]),e.splice(n-1,1,a.crates[0]),i=!1),r.add(a));return!i}#fe(e,t,r){return r<0?t:(r%2==1&&this.#ye(e,t[r])&&(t.splice(r-1,2),r=t.length),this.#fe(e,t,r-1))}#ke(e){let t,r,s=0;for(r in e)if(s++%2==1&&5===e[r].works.length&&(t=e[r].works[4].layer5),t)break;return!!t&&{info:r,works:t}}#we(e,t){let r,s=[];return Object.entries(t).map((e=>{e[1].map((e=>{let t;for(t in e)e[t].length>0&&Array.isArray(e[t])&&e[t].map((e=>s.push(e)))}))})),e.map((e=>s.push(e))),r=this.#ie(s,4),r}#Ce(e,t,r,s){return e[s].works.pop(),e[s-1][1]-=10,e.splice(t-1,1,r.crates[0]),e.splice(t,1,r.crates[1]),e}#be(){const{crates:e}=this.#me.standardCrate,t=this.#ke(e);let r,s,a,n,i=0;if(t)for(n in e){if(!Array.isArray(e[n])&&i!==+t.info&&(r=this.#we(t.works,e[n]),s=new CraterStandard(r,!1,5,!0),a=2===s.crates.length,a)){this.#Ce(e,i,s,t.info);break}i++}}#pe(){const e=this.#me.sameSizeCrate.crates,t=this.#me.sameSizeCrate.backUp,r=this.#me.standardCrate.crates;let s;if(e&&r){if(s=e.length,this.#fe(r,e,s),e.length===t.length)return this.#me.sameSizeCrate.backUp=!1,void(this.#me.standardCrate.backUp=!1);this.#be()}}}class CraterNotCanvas{#h;#R;#_;#l;constructor(e){return e&&0!==e.length?(this.#R=e,this.#h=e.map((e=>e.arr)),this.#l=e.map((e=>e.arr)),this.#x()):{noCanvas:!1}}#ie(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),a=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):a.push(e)})),this.#ie(r,t).concat(s,this.#ie(a,t))}#H(e){const t=new WorksCoordinates(e);this.#_=t.bluePrintCoordinates;const{emptyArea:r}=this.#_,s={emptyArea:r,feat:[]},a=this.#l.length-1;let n;t.fillPreparing={info:s,list:this.#l,len:a,raw:this.#R},n=t.fillLayer,this.#_.defineLayer=[1,n.feat],this.#R.map((e=>this.#_.artLocation.set(e.code,e)))}#X(e){const t=new CrateMaker(this.#h).outSizes,r=+(e[0]+t.x).toFixed(3),s=+(e[1]+t.z).toFixed(3),a=+(e[2]+t.y).toFixed(3),n=r%1>0?r:r.toFixed(0),i=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=t.div?e[1]+t.div*this.#h.length:e[1];return this.#H([+n,+i,+o]),this.#_.innerSize=[e[0]+t.pad,c+t.pad,e[2]+t.pad],this.#_.finalSize=[+n,+i,+o],[...this.#_.finalSize,this.#_]}#Se(e){let t,r=0,s=0,a=0,n=0;return t=e.length/2,e.map((e=>{t-- >0&&(r+=e[1],s<e[2]&&(s=e[2])),a=e[1],n<e[2]&&(n=e[2])})),a>r||(a=r),n+=s,{newX:a,newZ:n}}#ve(e){const t=e.length>4&&e.length%2==0;let r,s=0,a=0,n=0;return e.map((e=>{s+=e[1],a=e[2]>a?e[2]:a,n=e[3]>n?e[3]:n})),(s>277||t)&&(r=this.#Se(e),s=r.newX,a=r.newZ),this.#X([s,a,n])}#Ae(e,t){const r=e[1]===t[1]&&e[1]<277,s=e[2]===t[2]&&e[2]<177,a=e[3]<=132;return!!(r&&s&&a)}#Ie(e,t,r,s){return s.length%2==0&&e>554&&2*t+10<177?s.length:0===r||s[0][1]>554?1:r}#Te(e){let t=10*e.length,r=0,s=0;const a=e[0];return e.map((e=>{const n=this.#Ae(e,a),i=e[2]-a[2],o=a[2]-e[2];(!0===n||(i>0&&i<=10||o>0&&o<=10))&&(s++,t+=e[1],r+=e[3])})),this.#Ie(t,r,s,e)}#Ee(e){if(!Array.isArray(e))return e;let t=e.map((e=>(e.push(e[1]*e[2]),e)));return t=this.#ie(t,5),t=t.map((e=>(e.pop(),e))),this.#h=t}#x(){const e=[];let t;for(this.#Ee(this.#h);this.#h.length>0;)t=this.#Te(this.#h),t=this.#h.splice(0,t),t.length>0?(e.push(this.#ve(t)),e.push({works:t})):(e.push(this.#ve(this.#h.splice(0,1))),e.push({works:t}));return{crates:e}}}class CraterSameSize{#h;#xe;#R;#_;constructor(e){return e&&0!==e.length?(this.#R=structuredClone(e),this.#h=e.map((e=>e.arr)),this.#xe=e[0].packedSized,this.#ze()):{sameSize:!1}}#J(e,t,r=1){if(!e.length)return this.#_;const{emptyArea:s}=this.#_,a={emptyArea:s,feat:[]},n=e.length-1;let i;return t.fillPreparing={info:a,list:e,len:n,raw:this.#R},i=t.fillLayer,this.#_.defineLayer=[r,i.feat],this.#J(e,t,r+1)}#H(e,t){const r=JSON.parse(localStorage.getItem("materials")),s=JSON.parse(localStorage.getItem("crating"));let a;s.map((e=>{const t=r.filter((t=>{return e===(r=t)[0]&&r[2]<5&&"Foam Sheet"===r[5];var r}));t.length&&(a=t.flat())})),t&&(e[2]=+a[2]);const n=new WorksCoordinates(e);this.#_=n.bluePrintCoordinates;const i=structuredClone(this.#h);return this.#J(i,n),this.#R.map((e=>this.#_.artLocation.set(e.code,e))),e}#Be(e,t){const r=new CrateMaker(this.#h.length,t).outSizes,s=+(e[0]+r.x).toFixed(3),a=+(e[1]+r.z).toFixed(3),n=+(e[2]+r.y).toFixed(3),i=s%1>0?s:s.toFixed(0),o=a%1>0?a:a.toFixed(0),c=n%1>0?n:n.toFixed(0),l=e[1]+r.div*this.#h.length;return this.#H([+i,+o,+c],t),this.#_.innerSize=[e[0]+crate.pad,l+crate.pad,e[2]+crate.pad],this.#_.finalSize=[+i,+o,+c],[...this.#_.finalSize,this.#R]}#Pe(e,t,r){const s=e.map((e=>{const s=e[0]+t[0]<=r[0],a=e[1]+t[1]<=r[1],n=e[2]+t[2]<=r[2];if(s&&a&&n)return e}));return void 0!==s[0]&&s.map((t=>e.splice(e.indexOf(t),1))),void 0!==s[0]}#Le(e,t){let r=[];return void 0!==t.map((t=>{const s=t[0]===e[0][0],a=t[2]===e[0][2],n=t[0]===e[0][0]-this.#xe[1],i=t[2]===e[0][2]-this.#xe[3];if(s&&a||n&&i)return t;if(r.length>0){if(this.#Pe(r,t,e))return t}else r.push(t)}))[0]}#Oe(e,t){const r=e.shift(),s=Array.isArray(t[0])?t[0].length:t.length;let a,n,i,o;return r?(a=s%2+s/2,n=e[0],i=a*this.#xe[2],o=e[2]):(a=s%2+s,n=e[0],i=a*this.#xe[2],o=e[2]),this.#Be([n,i,o],r)}#Ne(e,t){const r=t.length>3?[t[0][1],t[0][2],t[0][3]]:t;let s=e[0],a=e[1],n=e[2]+r[2],i=!1;return n>132&&s<132?([n,s]=[s,n],i=!0):n>e[2]&&(i=!0),[i,[s,a,n]]}#Fe(e){let t,r,s=e.splice(0,1).flat(),a=e.splice(0,1).flat();return e.length>0&&(t=this.#Le(s,e)),t?(s=this.#Ne(s,e.splice(0,1)),e[0].map((e=>a[0][0].push(e))),e.splice(0,e[0].length)):a[0].length>10&&a[0].length%2==0?s=this.#Ne(s,a[0]):s.unshift(!1),Array.isArray(a[0][0])&&(a=a.flat()),r=this.#Oe(s.flat(),a),{crate:r,works:a}}#De(e){const t=[];let r;for(;e.length;)r=this.#Fe(e),t.push(r.crate),t.push({works:r.works});return t}#Re(){let e=this.#h[0][1],t=this.#h[0][2],r=this.#h[0][3],s=[[e,t,r]],a=[];return this.#h.map((n=>{n[2]<=14&&(n[1]!==e&&n[3]!==r&&(s.push([a]),e=n[1],t=n[2],r=n[3],s.push([e,t,r]),a=[]),a.push(n))})),s.push(a),s[1][0].length>=4?s:null}#ze(){let e=this.#Re();if(null===e)return null;const t=this.#De(e);return e=null,{crates:t,backUp:structuredClone(t)}}}class CraterTube{#_e;#qe;#_;#R;constructor(e){if(!e||0===e.length)return{tube:!1};this.#R=e,this.#_e=e.map((e=>e.arr)),this.#qe=35;return this.#_e.filter((e=>e[2]<this.#qe&&e)).find((e=>!1!==e))?this.#Ue():{tube:!1}}#Ue(){return this.#Me(),this.#_e}#We(e,t){const r=new WorksCoordinates(e);this.#_=r.bluePrintCoordinates;const{emptyArea:s}=this.#_;let a,n={emptyArea:s,feat:[]},i=Array.isArray(t[0])?t.length-1:0;r.fillPreparing={info:n,list:t,len:i,raw:this.#R},a=r.fillLayer,this.#_.defineLayer=[1,a.feat],this.#_.innerSize=[e[0],e[1],e[2]],this.#R.map((e=>this.#_.artLocation.set(e.code,e)))}#$e(e){let t=e[0][1],r=e[0][2],s=0;return e.map((e=>{t=e[1]>t?e[1]:t,r=e[2]>r?e[2]:r,s+=e[3]})),[t,r,s]}#je(){const e=new CrateMaker(1),t=+(this[0]+e.x).toFixed(3),r=+(this[1]+e.z).toFixed(3),s=+(this[2]+e.y).toFixed(3),a=t%1>0?t:t.toFixed(0),n=r%1>0?r:r.toFixed(0),i=s%1>0?s:s.toFixed(0);return this.#We([this[0]+e.pad,this[1]+e.pad,this[2]+e.pad],structuredClone(list)),this.#_.finalSize=[+a,+n,+i],[...this.#_.finalSize]}#Je(e){const t=this.#$e(e);return this.#je(t,e)}#He(e){switch(e.length){case 1:case 2:case 3:case 4:return this.#Je(e)}}#Xe(e){const t=[];let r;for(;e.length>=3;)r=e.splice(0,3),t.push(this.#He(r.length,r)),t.push({works:r});return t}#Ge(){const e=this.#_e.filter((e=>{if(e[2]>this.#qe)return e}));return e.map((e=>{this.#_e.splice(this.#_e.indexOf(e),1)})),e}#Me(){let e=[],t=[];const r=this.#Ge();for((r.length>0||r.length>3)&&t.push(this.#Xe(r));this.#_e.length;)e=this.#_e.splice(0,3),t.push(this.#He(e)),t.push({works:e});return this.#_e.length>=1&&(t.push(this.#He(this.#_e.length,this.#_e)),t.push({works:this.#_e})),this.#_e={crates:t}}}class Crater{#A;#Ze;constructor(e){return e!==Arranger?{crater:!1}:(this.#A=e.list,this.#Ze=["crates ahead"],Object.assign(Crater,this.#Ye()))}#Ye(){let e=0;const t=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(e in this.#Je(),this.#Ke(),this.#Ve(),this.#Qe(),this.#et(),this.#tt(),this.#Ze)this.#Ze[e]?.hasOwnProperty("crates")&&t.includes(e)||delete this.#Ze[e];return this.#rt(),this.#st(),this.#at(),this.#nt(),Array.isArray(this.#Ze?.sameSizeCrate?.backUp)&&(this.#it(),this.#ot(),this.#ct()),{crates:this.#Ze}}#Je(){const e=new CraterTube(this.#A?.tubes);this.#Ze.tubeCrate=e}#Ke(){const e=new CraterPythagoras(this.#A?.largest);this.#Ze.largestCrate=e}#Ve(){const e=new CraterSameSize(this.#A?.sameSize);this.#Ze.sameSizeCrate=e}#Qe(){const e=new CraterNotCanvas(this.#A?.noCanvas);this.#Ze.noCanvasCrate=e}#et(){const e=this.#Ze.sameSizeCrate.hasOwnProperty("crates"),t=new CraterStandard(this.#A?.sorted,e,4,!1);this.#Ze.standardCrate=t}#tt(){new CraterLastCheckReArranger(this.#Ze)}#rt(){let e=0;const t=[],r=e=>{Array.isArray(e)&&t.push(e)};for(e in this.#Ze)this.#Ze[e]?.crates?.map(r);this.#Ze.allCrates=t}#ct(){let e,t,r=0;const s=[],a=e=>{Array.isArray(e)&&s.push(e)};for(r in this.#Ze)e="sameSizeCrate"===this.#Ze[r],t="standardCrate"===this.#Ze[r],(e||t)&&this.#Ze[r]?.backUp?.map(a),this.#Ze[r]?.crates?.map(a);this.#Ze.allCratesBackUp=s}#st(){let e=0;const t=e=>{if(Array.isArray(e)&&e.length>=3){const t=e[0],r=e[1],s=e[2],a=new CubCalc(t,r,s).cubCalcAir,n=4===e.length?e.splice(3,1,a):e.push(a);Array.isArray(n)&&e.push(n)}};for(e in this.#Ze)this.#Ze[e]?.crates?.map(t);Array.isArray(this.#Ze?.sameSizeCrate?.backUp)&&(this.#Ze?.sameSizeCrate?.backUp?.map(t),this.#Ze?.standardCrate?.backUp?.map(t))}#at(){let e=0,t=[];const r=e=>{Array.isArray(e)&&t.push(e[3])};for(e in this.#Ze)this.#Ze[e]?.crates?.map(r);t=t.reduce(((e,t)=>e+t),0),this.#Ze.airCubTotal=t.toFixed(3)}#it(){let e,t,r=[],s=0;const a=e=>{Array.isArray(e)&&r.push(e[3])};for(s in this.#Ze)e="sameSizeCrate"===this.#Ze[s],t="standardCrate"===this.#Ze[s],e||t?this.#Ze[s]?.backUp?.map(a):e||t||this.#Ze[s]?.crates?.map(a);r=r.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ze.airCubTotalBackUp=r}#lt(e){if(Array.isArray(e)){const t=e[0],r=e[1],s=e[2];return t>300||r>200||s>160?"CARGO":"PAX"}}#nt(){let e,t=0,r=0,s=0;for(s in this.#Ze)this.#Ze[s]?.crates?.map((s=>{e=this.#lt(s),"PAX"===e?t++:"CARGO"===e&&r++}));this.#Ze.whichAirPort=[{PAX:t},{CARGO:r}]}#ot(){let e,t,r,s=0,a=0,n=0;for(s in this.#Ze)e="sameSizeCrate"===this.#Ze[s],t="standardCrate"===this.#Ze[s],e||t?this.#Ze[s]?.backUp?.map((e=>{r=this.#lt(e),"PAX"===r?a++:"CARGO"===r&&n++})):e||t||this.#Ze[s]?.crates?.map((e=>{r=this.#lt(e),"PAX"===r?a++:"CARGO"===r&&n++}));this.#Ze.whichAirPortBackUp=[{PAX:a},{CARGO:n}]}}class UnitAdapter{#l;#ut;constructor(e,t){return this.#l=e,this.#ut=t,this.#dt()}#ht(){try{if(!Array.isArray(this.#l)){throw new TypeError("Please, provide a valid list.")}if(this.#l.some((e=>"ArtWork"!==e.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#ut&&"in"!==this.#ut){throw new TypeError("Please, provide a valid unit.")}}catch(e){return e}return"pass"}async#dt(){let e;const t=this.#ht();switch("pass"!==t?"error":"cm"===this.#ut?"cm":"in"){case"error":return t;case"cm":return e=await this.#mt(),e;case"in":return e=await this.#pt(),e}}#gt(e){const t=e?.hasOwnProperty("crates"),r=e?.hasOwnProperty("backUp");return Array.isArray(e)?e.map(a):e?.hasOwnProperty("crates")?((t||r)&&(e.crates=e.crates.map((e=>4===e.length?a(e):(Array.isArray(e.works[0])?e.works=e.works.map(a):e.works=e.works.map(n),e))),console.log(e.crates)),e):e}#yt(){return this.#l.map((e=>{const t=e.autoConvert,r=t[0],s=t[1],a=t[2],n=t[3];return new ArtWork(r,s,a,n)}))}#ft(e){let t=0;for(t in e)e[t].hasOwnProperty("crates")&&(e[t]=this.#gt(e[t]));return e.sameSizeCrate?.hasOwnProperty("backUp")&&(e.airCubTotalBackUp=+(.061023*e.airCubTotalBackUp).toFixed(3),e.allCratesBackUp=this.#gt(e.allCratesBackUp)),e.allCrates=this.#gt(e.allCrates),e}async#mt(){return await Promise.resolve(new Arranger(this.#l)).then((e=>new Crater(e))).then((e=>e.crates)).catch((e=>e))}async#pt(){return await Promise.resolve(this.#yt()).then((e=>new Arranger(e))).then((e=>new Crater(e))).then((e=>this.#ft(e.crates))).catch((e=>e))}}function a(e){const t=.061023;let r,s,a,n;switch(console.log(e),e.length){case 4:return s=e[0],a=e[1],n=e[2],r=Array.from(new Converter(s,a,n).inConvert),r.push(+(e[3]*t).toFixed(3)),r;case 5:return s=e[1],a=e[2],n=e[3],r=Array.from(new Converter(s,a,n).inConvert),r.unshift(e[0]),r.push(+(e[3]*t).toFixed(3)),r;case 6:return s=e[1],a=e[2],n=e[3],r=Array.from(new Converter(s,a,n).inConvert),r.unshift(e[0]),r.push(+(e[3]*t).toFixed(3)),r.push(e[5]),r}}function n(e){let t;for(t in e)Array.isArray(e[t][0][0][0])?e[t][0].map((e=>e.splice(0,1,a(e[0])))):e[t]=[a(e[t][0])];return e}class largestCrateRender{#Ze;#kt;constructor(e,t){this.#Ze=e,this.#kt=t}#wt(){return{result:undefined,meta:this.#kt}}get composeCrate(){return this.#wt()}}class notCanvasCrateRender{#Ze;#kt;constructor(e,t){this.#Ze=e,this.#kt=t}#wt(){return{result:undefined,meta:this.#kt}}get composeCrate(){return this.#wt()}}let i={showlegend:!0,legend:{title:{text:"Crate Layers:",font:{family:"Mitr, sans-serif",size:14}},font:{family:"Mitr, sans-serif",sizes:14,color:"#FFFFFFAA"},x:.02,xanchor:"left",y:.99,yanchor:"top",orientation:"v",groupclick:"sides"},legendgrouptitle:{},margin:{t:0,l:0,b:0,r:0,pad:10},scene:{xaxis:{title:{text:"Length - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",ticks:"outside"},yaxis:{title:{text:"Depth - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},zaxis:{title:{text:"Height - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},camera:{eye:{x:-2,y:3,z:1}}},paper_bgcolor:"#96979C"};class TraceMaker{#Ct;#bt;#St=new Map;constructor(){[["frame","#BF5E30"],["walls","#555FEF"],["padding","#222725"],["div","#BEBBBB"],["works","#BB0056BB"],["fill","#0B8325"],["structure","#002A3D"]].map((e=>{this.#St.set(e[0],e[1])})),this.#Ct=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]}#vt(){const{info:e,coordinates:t,name:r}=this.#bt,s=this.#St.get(r);return this.#Ct.forEach(((a,n)=>{const i=t[a[0]],o=t[a[1]];e.push({x:[i.x,o.x],y:[i.y,o.y],z:[i.z,o.z],name:r,mode:"lines",type:"scatter3d",line:{color:s,width:3},ids:r,showlegend:0===n,legendgroup:r,hovertemplate:"L: %{x}<br>H: %{z}<br>D: %{y}<br>",contour:{show:0===n,color:"#BB0056BB",width:2}})})),e}set data(e){this.#bt=e}get defineTrace(){return this.#vt()}}class DesignWalls{#bt;#St=new Map;#At;constructor(){[["frame","#A39D29"],["walls","#3DDDDD"],["padding","#222725"],["div","#EFECBBBE"],["works","#BB0056BB"],["fill","#2DD751"],["structure","#557AEC"]].map((e=>{this.#St.set(e[0],e[1])})),this.#At=[[[0,1,2],[0,2,3]],[[4,7,6],[4,6,5]],[[0,3,7],[0,7,4]],[[1,5,6],[1,6,2]],[[0,4,5],[0,5,1]],[[3,2,6],[3,6,7]]]}#It(){const{width:e,depth:t,height:r,offsetX:s,offsetZ:a,offsetY:n,info:i,name:o}=this.#bt,c=this.#St.get(o),l=[[0,0,0],[e,0,0],[e,t,0],[0,t,0],[0,0,r],[e,0,r],[e,t,r],[0,t,r]].map((e=>[e[0]+s,e[1]+n,e[2]+a])),u=l.map((e=>e[0])),d=l.map((e=>e[1])),h=l.map((e=>e[2])),m=[],p=[],g=[];return this.#At.map((e=>{e.map((e=>{m.push(e[0]),p.push(e[1]),g.push(e[2])}))})),i.push({x:u,y:d,z:h,i:m,j:p,k:g,name:o,type:"mesh3d",color:c,showlegend:!1,legendgroup:o,opacity:.2,flatshading:!0,showscale:!0,contour:{show:!0,color:"white",width:2}}),i}set objectData(e){this.#bt=e}get designSides(){return this.#It()}}class sameSizeCrateRender{#Ze;#kt;constructor(e,t){this.#Ze=e,this.#kt=t}#wt(){return{result:undefined,meta:this.#kt}}get composeCrate(){return this.#wt()}}class standardCrateRender{#Ze;#kt;constructor(e,t){this.#Ze=e,this.#kt=t}#wt(){return{result:undefined,meta:this.#kt}}get composeCrate(){return this.#wt()}}class tubeCrateRender{#Ze;#kt;constructor(e,t){this.#Ze=e,this.#kt=t}#wt(){return{result:undefined,meta:this.#kt}}get composeCrate(){return this.#wt()}}class GraphicCrates{#Tt;#Ct;#Ze;constructor(){const{Plotly:e}=globalThis;this.#Ze=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"],this.#Ct=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#Tt=e}async#Et(){const e=localStorage.getItem("refNumb"),t=new Worker(new URL("../panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});t.postMessage(e);return await new Promise(((r,s)=>{t.onmessage=t=>{const{data:a}=t;a?.reference===e?r(a):s(t)}}))}#xt(e,t){return this.#Ct.forEach((r=>{const s=t[r[0]],a=t[r[1]];e.push({x:[s.x,a.x],y:[s.y,a.y],z:[s.z,a.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:0,line:{color:"#00000000"}})})),e}#zt(e){const t=[];let r=structuredClone(i);return this.#Ze.map((s=>{const a=e.get(s);let n;switch(a?s:0){case"tubeCrate":n=new tubeCrateRender(a,r);const e=n.composeCrate;t.push(e.result),r=e.meta,n=null;break;case"largestCrate":n=new largestCrateRender(a,r);const s=n.composeCrate;t.push(s.result),r=s.meta,n=null;break;case"sameSizeCrate":n=new sameSizeCrateRender(a,r);const i=n.composeCrate;t.push(i.result),r=i.meta,n=null;break;case"noCanvasCrate":n=new notCanvasCrateRender(a,r);const o=n.composeCrate;t.push(o.result),r=o.meta,n=null;break;case"standardCrate":n=new standardCrateRender(a,r);const c=n.composeCrate;t.push(c.result),r=c.meta,n=null}})),t.unshift(r),t}async#Bt(){const{crates:e}=await this.#Et()||!1,t=new Map;if(e){Object.entries(e).map((e=>{this.#Ze.includes(e[0])&&t.set(e[0],e[1])}));const r=this.#zt(t);globalThis.sessionStorage.setItem("crate",`1/${e.allCrates.length}`),globalThis.sessionStorage.setItem("graphics",JSON.stringify(r)),document.getElementById("layer-count").innerText=`Courrent crate: 1 / ${e.allCrates.length}`}}async#Pt(){const e=new DesignWalls,t=new TraceMaker,r=[{x:0,y:0,z:0},{x:100,y:0,z:0},{x:100,y:30,z:0},{x:0,y:30,z:0},{x:0,y:0,z:100},{x:100,y:0,z:100},{x:100,y:30,z:100},{x:0,y:30,z:100}];let s=this.#xt([],r);await this.#Bt(),t.data={info:s,coordinates:r,name:"walls"},s=t.defineTrace,e.objectData={width:100,depth:30,height:100,info:s,name:"walls",offsetX:0,offsetZ:0,offsetY:0},s=e.designSides,t.data={info:s,coordinates:[{x:10,y:10,z:10},{x:90,y:10,z:10},{x:90,y:20,z:10},{x:10,y:20,z:10},{x:10,y:10,z:90},{x:90,y:10,z:90},{x:90,y:20,z:90},{x:10,y:20,z:90}],name:"works"},s=t.defineTrace,e.objectData={width:80,depth:10,height:80,info:s,name:"works",offsetX:10,offsetZ:10,offsetY:10},s=e.designSides,s=e.designSides,i.legendgrouptitle.Walls={text:"Crate sides."},i.legendgrouptitle.Works={text:"Works sides."},this.#Tt.newPlot("plotter-display",s,i,{displaylogo:!1})}get show(){this.#Pt()}}async function o(){const e=new GraphicCrates,t=document.querySelectorAll(".toggle__plotter"),r=document.getElementById("layers");let s;for(s of t)"true"===s.ariaHidden?(s.ariaHidden="false",r.ariaHidden="true"):"false"===s.ariaHidden&&(s.ariaHidden="true",r.ariaHidden="false",sessionStorage.getItem("plotter")||(e.show,sessionStorage.setItem("plotter","true")))}function c(e,t,r,s){switch(e){case 409:!async function(e,t,r){if(confirm("This estimate already exist. Would you like to update it?")){const s="/api/v1/update/estimates";try{const a=await fetch(s,{method:"PUT",body:e,headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));403===a&&c(a,r)}catch(e){alert(`ATTENTION: ${e}`)}}else alert("Not updated!")}(r,s,t);break;case 403:!async function(e){const t={"Content-Type":"application/json; charset=UTF-8"};try{const r=await fetch("/api/v1/shift/tokens",{method:"POST",headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));l(e),console.log(r)}catch(e){alert(`ATTENTION: ${e}`)}}(t)}}async function l(e){const t=JSON.stringify(e),r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{c(await fetch("/api/v1/newEstimate",{method:"POST",body:t,headers:r}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),e,t,r)}catch(e){alert(`ATTENTION: ${e}`)}else!function(e){const t=localStorage,r=t.getItem("offResults"),s=void 0!==r&&JSON.parse(r);s?(s.push(e),t.removeItem("offResults"),t.setItem("offResults",JSON.stringify(s))):t.setItem("offResults",JSON.stringify([e]))}(e.reference)}function u(){const e="Results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}function d(e,t=!1){const r=localStorage.getItem("refNumb"),s="Results",a=globalThis.indexedDB.open(s),n=globalThis.navigator.onLine;a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const i=a.target.result.transaction(s,"readwrite").objectStore(s),o=i.get(e.reference);o.onsuccess=async()=>{void 0===o.result?i.add(e):await Promise.resolve(i.delete(o.result.reference)).then(i.add(e)),h(r,t)},n||function(e,t){const r="off_line_results",s=document.getElementById("input_estimate").value,a=globalThis.indexedDB.open(r);a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const n=a.target.result.transaction(r,"readwrite").objectStore(r),i=n.get(e.reference);i.onsuccess=()=>{(void 0===i.result||n.delete(i.result.reference))&&n.add(e),h(s,t)}}}(e)}}async function h(e,t=!1){const r=globalThis.indexedDB.open("Results");r.onerror=e=>{alert(`WARNING: ${e.target.errorCode}`)},r.onsuccess=()=>{const s=r.result.transaction("Results").objectStore("Results").get(e);s.onsuccess=async()=>{const e=localStorage.getItem("refNumb"),r=s.result;globalThis.sessionStorage.setItem(e,JSON.stringify(r)),!1===t&&await async function(e){const{reference:t,list:r,crates:s}=e,a={reference:t,list:r,crates:Object.assign({},s)};await l(a)}(s.result),"crate"===t&&await async function(e){const t={"Content-Type":"application/json; charset=UTF-8"},{reference:r,list:s,crates:a}=e,n={reference:r,list:s,crates:Object.assign({},a)};try{await fetch("/api/v1/update/estimates",{method:"PUT",body:JSON.stringify(n),headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)))}catch(e){alert(`ATTENTION: ${e}`)}finally{return"updated"}}(s.result)}}}async function m(){const e=await k();let t=document.getElementById("count");return e&&e.length>0&&document.getElementById("statusList").setAttribute("content",e.length),t.innerText=e?"Counting: "+e?.length:"Counting 0",t}async function p(){let e;const t=document.getElementById("cub-meter");return e=await k(),e=e?.reduce(((e,t)=>e+t.cubed),0)??0,t.innerText="Cub: "+(1e3*e/1e3).toFixed(3)+"m³",t}async function g(){let e,t,r;return r="Air-Cub: ",t=document.getElementById("cub-air"),e=await k(),e=e?.reduce(((e,t)=>e+t.cAir),0)??0,t.innerText="Air-Cub: "+(1e3*e/1e3).toFixed(3),t}async function y(e=!1){const t={},r=new WeakSet,s=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let a,n=document.cookie.split("=")[1];const i=await async function(){const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",t=await k();let r;return 0===t.length?alert("Oops! Sounds like you do not added any work yet. Please, try again!"):(r=await Promise.resolve(new UnitAdapter(t,e)),r)}(),o=document.querySelector(":root"),c=document.querySelector(".update-materials"),l=document.querySelector(".materials");return(e||confirm("Ready to crate all works?")&&i)&&(!function(){const e=new DocumentFragment,t=new DocumentFragment,r=document.createElement("panel-info"),s=document.createElement("panel-info"),a=document.getElementById("first_pane"),n=document.getElementById("second_pane");for(;a.firstChild;)a.removeChild(a.firstChild);for(;n.firstChild;)n.removeChild(n.firstChild);r.id="first-pane",s.id="second-pane",r.setAttribute("name","pane1"),s.setAttribute("name","pane2"),e.append(r),t.append(s),a.append(e),n.append(t)}(),t.reference=s,a=await k(),t.list=a.map((e=>e.data)),t.crates=i,d(t,e),c.setAttribute("name","materials-used"),l.setAttribute("name","packed-works"),l.setAttribute("content","crates"),("FULL"===n||"PLOTTER"===n||!n)&&(document.getElementById("crate-layers").disabled=!1),o.style.setProperty("--layer-state","block"),sessionStorage.removeItem("crate")),r.add(t),"Crated"}async function f(e=!1){document.getElementById("input_code").value="",document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="";const t=document.getElementById("show-layer"),r=document.querySelectorAll("padding-dialog").length,s=document.querySelector(":root"),a=document.querySelector(".update-materials");let n=document.cookie;n=n.split("=")[1],t&&t.hasChildNodes()&&o(),globalThis.document.getElementById("input_estimate").select(),globalThis.document.getElementById("input_code").select(),"update-materials"!==a.getAttribute("name")&&a.setAttribute("name","update-materials"),m(),p(),g(),r>0&&sessionStorage.setItem("CLOSED","NOW"),s.style.setProperty("--layer-state","none")}async function k(){const e=localStorage,t=[];let r;const s=["doneList","mode","storage","currency","metrica","refNumb","offResults","FETCHED","materials","packing","crating"];return Object.entries(e).map((e=>{!s.includes(e[0])&&t.push(JSON.parse(e[1]))})),t.length>0&&(r=t.map((e=>{const{code:t,x:r,z:s,y:a,packing:n}=e;return new ArtWork(t,r,s,a,n)}))),r||void 0}function w(e){const t=function(e){let t=2;const r=/^[0-9\.0-9]{1,7}$/;for(;--t>=0;)if(!r.test(e[t]))switch(t){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return e}([e[1],e[2],e[3]].map((e=>parseInt(e))));const r=/[^-a-z-A-Z-0-9]/g,s=document.getElementById("input_estimate").value,a=function(){const e=JSON.parse(localStorage.getItem("packing")),t=JSON.parse(localStorage.getItem("materials")),r=[];return!(!e||0===e.length)&&(e.filter((e=>{r.push(t.find((t=>t[0]===e)).flat())})),r)}();let n=0;if(!a)return alert("Please, select some packing material to apply to the artwork."),"material";if(r.test(e[0])||r.test(s))return alert('Found special character NOT allowed on "Work code",\t\tor "Estimate" input. Please, try again!'),!1;for(n in localStorage.key(n))if(e[0]===localStorage.key(n))return alert(`${e[0]} already added to the list. Please, try again`),!1;return function(){const e=localStorage.getItem("refNumb"),t=document.getElementById("input_estimate").value;e&&e!==t&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",t),document.getElementById("input_estimate").value=t):document.getElementById("input_estimate").value=e);localStorage.setItem("refNumb",t)}(),!!Array.isArray(t)&&new ArtWork(e[0],t[0],t[1],t[2],a)}async function C(){const e=document.getElementById("input_estimate").value,t=document.getElementById("input_code").value,r=document.getElementById("input_length").value,s=document.getElementById("input_depth").value,a=document.getElementById("input_height").value;let n;return e?""===(t&&r&&s&&a)?(alert("Oops! Do not forget to fill each field. Please, try again!"),function(){let e=!1;["input_estimate","input_code","input_length","input_depth","input_height"].find((t=>{const r=document.getElementById(t);if(console.log(r.value),!r.value&&!e)return e=!0,r.select()}))}()):(n=w([t,r,s,a]),n&&"material"!==n&&(await async function({code:e}){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s;return r?(s=Number.parseInt(r[r.length-1]),s+=1,r.push([s,e]),t.setItem("codes",JSON.stringify(r))):t.setItem("codes",JSON.stringify([[0,e]]))}(n.data),localStorage.setItem(n.data.code,JSON.stringify(n.data)),localStorage.setItem("storage","art-work"),m(),g(),p(),f()),n&&"material"!==n?f():0):alert('Attention! Please, add the "Doc:" reference field!')}function b(){const e=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(e))!function(e){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s=0;for(;r[s][1]!==e&&s<=r.length;)s++;r.splice(s,1),t.setItem("codes",JSON.stringify(r))}(e),localStorage.removeItem(e),m(),g(),p();else{if(null===e)return f();alert(`"${e}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),f()}function S(e){const t=document.createDocumentFragment();return e.map((e=>{const r=document.createElement("option");r.textContent=e,t.appendChild(r)})),t}function v(e,t,r,s){const a=JSON.parse(sessionStorage.getItem("currency")),n=1e3,i=Number.parseFloat(r.value)===a[e],o=Number.parseFloat(s.value)===a[t];return e===t?i?s.value:r.value:i&&o?~~(a[e]*a[t]*n)/n:a[e]<a[t]?!0===i?~~(s.value/a[t]*a[e]*n)/n:~~(r.value*a[t]/a[e]*n)/n:!0===o?~~(r.value*a[t]/a[e]*n)/n:~~(s.value/a[t]*a[e]*n)/n}async function A(){const e=await fetch("/api/v1/currencies",{method:"GET"}).then((async e=>await e.json())).catch((e=>alert(`CurrencyError: ${e}!`))),{rates:t}=e.response,r=globalThis.sessionStorage;return t&&r.setItem("currency",JSON.stringify(t))}function I(e,t){const r=JSON.parse(sessionStorage.getItem("currency"));if(!r)return!1;t.value=r[e]}async function T(){await A(),await async function(){const e=JSON.parse(sessionStorage.getItem("currency")),t=document.getElementById("coin1"),r=document.getElementById("coin2"),s=Object.keys(e);if(!e)return"Error";t.appendChild(S(s)),r.appendChild(S(s))}()}function E(e,t,r,s){return"centimeters"===e?function(e,t,r,s){const a=2.54,n=.01,i=x(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked1)return z(r,s,a,"in");return z(r,s,n,"m")}(e,t,r,s):"inches"===e?function(e,t,r,s){const a=.393,n=.0254,i=x(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked2)return z(r,s,a,"cm");return z(r,s,n,"m")}(e,t,r,s):function(e,t,r,s){const a=.01,n=.0254,i=x(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked3)return z(r,s,a,"cm");return z(r,s,n,"in")}(e,t,r,s)}function x(e,t){return{checked1:"centimeters"===e&&"inches"===t,checked2:"inches"===e&&"centimeters"===t,checked3:"meters"===e&&"centimeters"===t}}function z(e,t,r,s){const a=1e3;return"m"!==s?e.value>t.value?~~(e.value/r*a)/a:~~(t.value*r*a)/a:e.value<t.value?~~(t.value/r*a)/a:~~(e.value*r*a)/a}function B(){const e=new DocumentFragment,t=document.createElement("panel-info");return t.setAttribute("name","status"),t.id="statusList",t.class="addedStatus",t.setAttribute("content",0),e.appendChild(t)}if(globalThis.onstorage=()=>{p(),g(),m()},globalThis.onload=async()=>{const e=localStorage.getItem("mode"),t=document.getElementById("status-frame"),r=document.getElementById("statusList");sessionStorage.removeItem("onCrate"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"),r?r.setAttribute("content","reload"):t.append(B()),N(),null===e&&localStorage.setItem("mode","light"),F(),function(){const e=localStorage.getItem("mode"),t=document.body;switch(e){case"light":document.getElementById("light-mode").checked=!0,t.classList.remove("dark-mode"),t.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,t.classList.remove("light-mode"),t.classList.toggle("dark-mode")}}(),async function(){const e=new DocumentFragment,t=new DocumentFragment,r=document.createElement("pack-up"),s=document.createElement("pack-down"),a=document.getElementById("contents1"),n=document.getElementById("contents2");r.setAttribute("name","select-materials"),r.className="materials",r.ariaHidden="false",s.setAttribute("name","update-materials"),s.setAttribute("content","0"),s.className="update-materials",e.appendChild(r),t.appendChild(s),a.appendChild(e),n.appendChild(t)}()},!localStorage.getItem("metrica")){const e=document.getElementById("cm").value;localStorage.setItem("metrica",e)}function P(){const e=localStorage.getItem("metrica"),t=confirm("Attention! You are going to change the measurement of the works.");e&&void 0!==e?t&&("cm - centimeters"===e?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")):localStorage.setItem("metrica",document.getElementById("cm").value),F()}const L=()=>{N(),y();const e=document.querySelector(".result");sessionStorage.getItem("codes")&&(e&&"true"===e.ariaHidden&&o(),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};const O=()=>{const e=document.querySelector(".result"),t=document.getElementById("layers"),r=document.querySelector(".plotter__menu"),s=document.getElementById("statusList"),a=document.getElementById("status-frame"),n=document.getElementById("first_pane"),i=document.getElementById("second_pane"),o=document.querySelector(".side-menu");confirm("Do you really want to delete the whole list?")&&(!function(){const{mode:e,metrica:t,materials:r}=localStorage;localStorage.clear(),sessionStorage.clear(),localStorage.setItem("mode",e),localStorage.setItem("metrica",t),localStorage.setItem("materials",r),m(),p(),g()}(),f(!0),globalThis.document.getElementById("input_estimate").value="",globalThis.document.getElementById("input_estimate").select(),openCloseDisplay([e,t,r]),s.setAttribute("content",void 0),a.removeChild(document.getElementById("statusList")),n.firstChild&&n.removeChild(document.getElementById("first-pane")),i.firstChild&&i.removeChild(document.getElementById("second-pane")),a.append(B()),o.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),document.querySelector(".materials").setAttribute("name","select-materials"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"))};function N(){const e=localStorage.getItem("refNumb");let t=document.cookie;return t=t.split("=")[1],e&&(document.getElementById("input_estimate").value=e),u(),function(){const e="Materials",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"materials"}),r.createIndex("materials","materials",{unique:!0})}}(),"OFF"!==t&&"FULL"!==t||function(){const e="off_line_results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}(),p()&&g()&&m()}function F(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function D({works:e}){let t=[];const r=Array.isArray(e[0][0])?e[0]:e;return r?.map((e=>{let r;if(Array.isArray(e))return t.push(e);for(r in e)t.push(r),1===e[r].length?t.push(e[r][0]):Array.isArray(e[0])?e[r][0].map((e=>t.push(e))):e[r].map((e=>t.push(e)))})),t}function R(e){if(!e)return"There is no crates. Please, try again!";const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",r=e.map((e=>{let r;return"string"==typeof e?`LAYER layer ${e?.at(-1)}:`:e.length>=5?(r=`CODE: ${e[0]} - ${e[1]} x ${e[2]} x ${e[3]} - ${t}`,r):4===e.length?(r=`CRATE: ${e[0]} x ${e[1]} x ${e[2]} - ${t}`,r):void 0})),s=function(e,t){for(;t--;)e=(e=(e=(e=(e=e.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return e=(e=e.replace("[","")).replace("]","")}(JSON.stringify(r),r.length);navigator.clipboard.writeText(s)}function _(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>{(Array.isArray(e.data.crates)||e.data.hasOwnProperty("crates"))&&function({crates:e}){sessionStorage.setItem("copy1","done!"),R(e.allCrates)}(e.data)}}function q(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>function({crates:e}){let t,r,s=[];for(t in e)e[t].hasOwnProperty("crates")&&e[t].crates.map(((e,t)=>{switch(t%2){case 0:s.push(e);break;case 1:r=D(e),r.map((e=>s.push(e))),r=null}}),0);return sessionStorage.setItem("copy2","done!"),R(s)}(e.data)}function U(e){localStorage.setItem("mode",e),function(e){const t=document.body.classList;t.remove("light-mode"),t.remove("dark-mode"),"dark"===e?t.add("dark-mode"):t.add("light-mode")}(e)}function M(e){const t=e.target.closest(".accordion-panel");if("body-app"===e.target.id)return W();t&&function(e){const t=e.parentElement.querySelectorAll("button"),r=e.parentElement.querySelectorAll(".menu__input");t.forEach((e=>{e.setAttribute("aria-expanded",!1)})),r.forEach((e=>{e.setAttribute("aria-hidden",!0)})),function(e){e.querySelector("button").setAttribute("aria-expanded",!0),e.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(e)}(t)}function W(){const e=document.querySelector(".accordion-panel");let t,r,s;for(t in e)r=e.parentElement.querySelectorAll("button"),s=e.parentElement.querySelectorAll(".menu__input"),r.forEach((e=>{e.setAttribute("aria-expanded",!1)})),s.forEach((e=>{e.setAttribute("aria-hidden",!0)}))}function $(){const e=document.getElementById("statusList"),t=document.getElementById("status-frame"),r=document.querySelector(".side-menu");t.removeChild(document.getElementById("statusList")),t.append(B()),e.setAttribute("content","FETCHED"),r.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),p(),g(),m()}async function j(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),r=await new Promise(((r,s)=>{t.postMessage(e),t.onmessage=e=>{void 0!==e?r(e.data):s(void 0)}}));return!!r&&(document.getElementById("input_estimate").value=e,sessionStorage.setItem("FETCHED",JSON.stringify(r)),$(),J([r]),"IDB data Found.")}async function J(e){try{if(e?.hasOwnProperty("crates")){document.getElementById("input_estimate").value=e.reference;const{materials:t}=localStorage;return sessionStorage.clear(),sessionStorage.setItem("FETCHED",JSON.stringify(e,null)),localStorage.setItem("materials",t),$()}throw new TypeError("Data not found!")}catch(e){return e}}async function H(e){const t=`/api/v1/estimates/${e}`,r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){return await fetch(t,{method:"GET",headers:r}).then((async e=>await e.json())).then(J).catch((e=>alert(`Search ERROR! \n ${e}`)))}}async function X(){const e=document.getElementById("estimate_getter").value,t=(r=document.getElementById("input_estimate").value,async e=>{r&&r!==e&&f(!0)});var r;if(!function(e){switch(/[^-a-z-A-Z-0-9]/g.test(e)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(e)){const r=[j(e),H(e)];await Promise.all(r).then((async r=>{r[0]||0!==r[1]?.length?await Promise.resolve(t(e)).then((async()=>{if(r[1]?.length>0){d({reference:r[1][0].reference_id,crates:r[1][0].crates.crates,list:r[1][0].works.list},!0)}else y(!0)})):alert("Document not found! Please, try again.")}))}}function G(){globalThis.navigator.serviceWorker.ready.then((async e=>{await caches.delete("craterCache_v1"),await caches.delete("status_V1"),await caches.delete("pane1_v1"),await caches.delete("pane2_v1"),await e.unregister()}))}async function Z(){confirm("Are you sure to logout?")&&await fetch("/api/v1/logout",{method:"GET"}).then(G).then((e=>globalThis.location.assign(e.url))).catch((async()=>{await Promise.resolve(G).then(globalThis.location.replace("https://ottocratesolver.com/login"))}))}globalThis.onkeydown=e=>{const t="Enter"===e.key&&!0===e.ctrlKey,r=!0===e.ctrlKey&&!0===e.altKey&&"c"===e.key,s="Escape"===e.key;t&&L(),r&&o(),s&&W(),e.stopImmediatePropagation()},globalThis.onafterprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.onbeforeprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.document.getElementById("main-app").addEventListener("click",(e=>{const t=document.querySelector(".materials"),r=document.querySelector(".update-materials"),s=sessionStorage.getItem("crate");let a=s?+s.split("/")[0]:0;const n=s?+s.split("/")[1]:0,i=new GraphicCrates,c=document.getElementById("layer-count");let{id:l,className:u,attributes:d}=e.target;{const{shadowRoot:e}=t,r=e.querySelector(".upPane");r?.addEventListener("click",(e=>{const{id:t,className:s,tagName:a}=e.target,n=new CustomEvent("open-crate",{bubbles:!0,composed:!0,detail:{id:t,className:s,tagName:a}});r.dispatchEvent(n)}),!0)}{const{shadowRoot:e}=r,t=e.querySelector(".data-update");t?.addEventListener("click",(e=>{const{id:r,className:s}=e.target,a=new CustomEvent("update-materials-info",{bubbles:!0,composed:!0,detail:{id:r,className:s}});t.dispatchEvent(a),e.stopImmediatePropagation()}))}switch("crates"===d.content&&(u="crates"),l||(l=u)){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":M(e);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:e}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${e}`),globalThis.deferredPrompt=null}();break;case"add-btn":C();break;case"remove-btn":b();break;case"clear-btn":O();break;case"crate-btn":case"crate_btn":L();break;case"copy-pane1":_();break;case"copy-pane2":q();break;case"logout":case"logout-btn":Z();break;case"exchange-header":T(),async function(){const e=sessionStorage.getItem("currency"),t=JSON.parse(sessionStorage.getItem("coin1")),r=JSON.parse(sessionStorage.getItem("coin2")),s=document.getElementById("coin1"),a=document.getElementById("coin2");null!==t&&(s.value=t),null!==r&&(a.value=r),null===e&&await A()}(),M(e);break;case"ex-btn":case"exchange-btn":T(),M(e);break;case"fetch-btn":X();break;case"crate-layers":case"layer-crate":o();break;case"previous":case"layer-prev":a>1&&(a-=1,sessionStorage.setItem("crate",`${a}/${n}`),c.innerText=`Current crate: ${a} / ${n}`,i.show);break;case"next":case"layer-next":a<n&&(a+=1,sessionStorage.setItem("crate",`${a}/${n}`),c.innerText=`Current crate: ${a} / ${n}`,i.show);break;case"settings-content":"update-materials"!==u&&"new-material"!==u&&t.setAttribute("content","settings-content");break;case"packages":"update-materials"!==u&&"select-materials"!==u&&t.setAttribute("content","packages");break;case"select-materials":"update-materials"!==u&&"select-materials"!==u&&t.setAttribute("content","select-materials");break;case"materials":"update-materials"!==u&&"select-materials"!==u&&t.setAttribute("content","confirm-save");break;case"report":case"report":t.setAttribute("name","packages");break;case"pack-opts":case"works-packed":t.setAttribute("name","works-packed");break;case"reset-sizes":t.setAttribute("name","reset-sizes");break;case"reset-szs":t.setAttribute("name","reset-szs");break;case"adding-material":t.setAttribute("name","adding-material");break;case"add__new__field":t.setAttribute("name","add__new__field");break;case"cancel-remove":t.setAttribute("name","cancel-remove");break;case"new-material":t.setAttribute("name","new-material");break;case"confirm-save":t.setAttribute("name","confirm-save");break;case"printer-icon":case"printer-btn":case"printer-svg":case"printer":globalThis.print()}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(e=>{switch(e.preventDefault(),e.target.id){case"input_estimate":u();break;case"in":case"cm":P();break;case"dark-mode":U("dark");break;case"light-mode":U("light");break;case"coin1":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(e)),I(e,t)}();break;case"coin2":!function(){const e=document.getElementById("coin2").value,t=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(e)),I(e,t)}();break;case"units1":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"units2":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"selected-crate":o()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(e=>{let{id:t,className:r}=e.target;switch(t||(t=r)){case"coin1-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");I(t,s),s.value=`$ ${v(e,t,r,s)}`}();break;case"coin2-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");I(e,r),r.value=`$ ${v(e,t,r,s)}`}();break;case"input-unit1":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");s.value=0,s.value=E(e,t,r,s)}();break;case"input-unit2":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");r.value=0,r.value=E(e,t,r,s)}()}}),!0),globalThis.onsubmit=e=>{e.preventDefault()},globalThis.document.getElementById("main-app").addEventListener("open-crate",(e=>{const{id:t,className:r,tagName:s}=e.detail,a=document.querySelector(".materials");"A"===s&&a.setAttribute("content",`${t}-${r}`)}),!0),globalThis.document.getElementById("main-app").addEventListener("update-materials-info",(e=>{const{id:t}=e.detail,r=document.querySelector(".update-materials");e.stopImmediatePropagation(),"update-info"===t&&r.setAttribute("name","update")}),!0),globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(e=>{"Enter"===e.key&&X()})),globalThis.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),console.log("👍","beforeinstallprompt",e),globalThis.deferredPrompt=e}));
class Converter{#t;constructor(...t){this.#t=[...t]}get cmConvert(){return s.call(this.#t)}get inConvert(){return e.call(this.#t)}}function t(){const t=this.filter((t=>Number(t)?t:"string"==typeof t&&t?+t.trim():void 0));try{if(!t||t.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(t){return t}return t}function e(){const e=t.call(this);if(Array.isArray(e)){const t=2.54;return this.map((e=>+(e/t).toFixed(3)))}return e}function s(){const e=t.call(this);if(Array.isArray(e)){const t=2.54;return this.map((e=>+(e*t).toFixed(0)))}return e}class RegexChecker{#t;constructor(...t){this.#t=[...t]}get regexSizes(){return a.call(this.#t)}}function a(){try{const t=this.map((t=>{const e=/[0-9]{1,3}/.test(t);return!Number.isNaN(t)&&e})),e="Not a valid entry to RegexChecker!";if(t.includes(!1))throw new TypeError(e)}catch(t){return console.error(t),t}}class CubCalc{#e;#s;#a;constructor(t,e,s){this.#e=+t,this.#s=+e,this.#a=+s}get cubCalcAir(){return function(t,e,s){const a=new RegexChecker(t,e,s).regexSizes;if("object"==typeof a)return a;return+(t*e*s/6e3).toFixed(3)}(this.#e,this.#s,this.#a)}get cubArea(){return function(t,e,s){const a=new RegexChecker(t,e,s).regexSizes;if("object"==typeof a)return a;return+(t*e*s/1e6).toFixed(3)}(this.#e,this.#s,this.#a)}}class Hexaedro{constructor(t,e,s){try{if(!t||!e||!s)throw new TypeError("Please, provide a correct x, z or y value.")}catch(t){return t}this.x=+t,this.z=+e,this.y=+s}}class ArtWork extends Hexaedro{coordinates;packMaterials;code;#e;#s;#a;constructor(t,e,s,a,r){super(e,s,a);try{if(!t||t.trim()<=0){const e=`Please, provide a valid code. Current: ${t}`;throw new TypeError(e)}}catch(t){return t}this.code=""+t,this.#e=+e,this.#s=+s,this.#a=+a,this.packMaterials=r}#r(){const t={x:structuredClone(this.#e),z:structuredClone(this.#s),y:structuredClone(this.#a)};return this.packMaterials&&this.packMaterials.length&&this.packMaterials.map((e=>{t.x+=2*e[2],t.z+=2*e[2],t.y+=2*e[2]})),[this.code,t.x,t.z,t.y]}#i(t,e){return t.map(((t,s)=>{const a=[this.packMaterials[s][0]];return a.push(+(100*e/t).toFixed(0)),a}),0)}#n(t){return t.map(((t,e)=>"Roll"===this.packMaterials[e][5]?[t[0],+(t[1]/100).toFixed(2)]:[t[0],Math.ceil(t[1]/100)]),0)}#o(t){return t.map((t=>1-+(t[1]/100).toFixed(3)%1))}#c(){const t=this.packingDemanded,e=this.packMaterials.map((t=>t[1]*t[3]/100)),s=this.#i(e,t),a=e.map(((e,a)=>[s[a][0],e>t]),0),r=this.#o(s),i=this.packMaterials.map((t=>t[4])),n=this.packMaterials.map(((t,s)=>[t[5],e[s],t[0]]),0),o=i.map(((t,e)=>{const a=+(s[e][1]/100*t).toFixed(2);return[s[e][0],a,+t]}),0),c=this.#n(s,r);return{demand:t,percent:s,reuse:a,residual:r,types:n,cost:o,quantity:c}}get arr(){return[this.code,this.#e,this.#s,this.#a]}get cAir(){return new CubCalc(this.#e,this.#s,this.#a).cubCalcAir}get cubed(){return new CubCalc(this.#e,this.#s,this.#a).cubArea}get autoConvert(){let{x:t,z:e,y:s}=this;const a=new Converter(t,e,s).cmConvert;return t=a[0],e=a[1],s=a[2],[this.code,t,e,s]}get data(){return{code:this.code,x:this.#e,z:this.#s,y:this.#a,packing:this.packMaterials}}get packingDemanded(){const{x:t,z:e,y:s}=this;return+(2*(t*s+t*e+s*e)/100).toFixed(5)}get cratePosition(){return this.coordinates}get packedSized(){return this.#r()}get packInfo(){return this.#c()}set defCoordinate(t){this.coordinates=t}}class ArrangerLargestCanvas{#h;constructor(t){return this.#h=t,this.#l()}#d(){const t=this.filter((t=>t.x>=213&&t.y>=213?t:0));return!!t.length&&t}#l(){const{sorted:t}=this.#h,e=this.#d.call(t);return e&&e.map((t=>{t&&this.#h.sorted.splice(this.#h.sorted.indexOf(t),1)})),e&&(this.#h.largest=e),this.#h}}class ArrangerNoCanvas{#u;constructor(t){return this.#u=t,this.#m()}#p(t){t.map((t=>{this.sorted.splice(this.sorted.indexOf(t),1)}))}#y(){let{sorted:t,sameSize:e}=this.#u;let s=t.filter((t=>t.z>15)),a=e.filter((t=>t.z>15)),r=[];return s.map((t=>r.push(t))),this.#p.call(this.#u,s),a.map((t=>r.push(t))),this.#p.call(this.#u,a),t=null,e=null,s=null,a=null,this.#u.noCanvas=r,this.#u}#m(){return this.#y()}}class ArrangerSameSize{#h;constructor({sorted:t}){return this.#h=t,this.#f()}#g(){const t=[];return this.map((e=>{let s,a=0;if(e.z<=10)for(a in this)r=this[a],i=e,s=r.cubed<=i.cubed&&r.code!==i.code,!t.includes(this[a])&&s&&t.push(this[a]);var r,i})),t}#z(t,e){const s=e.x,a=e.y,r=e.cubed;return t.x===s&&t.y===a&&t.cubed<=r}#x(t){const e=[];return t.map((s=>{let a=[],r=0;for(r in t)this.#z(t[r],s)&&!e.includes(t[r])&&a.push(t[r]);a.length>=4&&a.map((t=>{e.push(t)})),a=null})),e}#f(){const t=this.#g.call(this.#h),e=this.#x(t);return e.map((t=>{this.#h.splice(this.#h.indexOf(t),1)})),{sorted:this.#h,sameSize:e}}}class ArrangerStarter{#h;constructor(t){return this.#h=t,this.#w()}#k(){return this.#h.map((t=>{const e=t.arr;return e.push(t.cubed),e}))}#C(t,e){if(t.length<=1)return t;const s=[],a=t.splice(0,1),r=[];return t.map((t=>{t[e]<=a[0][e]?s.push(t):r.push(t)})),this.#C(s,e).concat(a,this.#C(r,e))}#w(){const t=this.#k(),e=this.#C(t,4),s=[];return e.map((t=>{this.#h.find((e=>t[0]===e.code?s.push(e):0))})),{sorted:s}}}class ArrangerTube{#h;constructor(t){return this.#h=t,this.#b()}#b(){const{noCanvas:t}=this.#h,e=t.filter((t=>{const e=t.z<35&&t.y<35,s=t.z===t.y;if(e&&s&&t.x!==t.y&&s)return t}));return e.map((t=>{this.#h.noCanvas.splice(this.#h.noCanvas.indexOf(t),1)})),this.#h.tubes=e,this.#h}}class Arranger{#S;constructor(t){this.#S=t;const e=this.#v();return e&&"TypeError"===e.constructor.name?e:(this.#A(),Object.assign(Arranger,{list:this.#S}))}#A(){this.#I(),this.#f(),this.#T(),this.#E(),this.#B()}#v(){try{const t=t=>0===t.length||!t;if(!Array.isArray(this.#S)||t(this.#S)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#S.map((t=>"ArtWork"===t.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(t){return t}}#I(){this.#S=new ArrangerStarter(this.#S)}#f(){this.#S=new ArrangerSameSize(this.#S)}#T(){this.#S=new ArrangerNoCanvas(this.#S)}#E(){this.#S=new ArrangerLargestCanvas(this.#S)}#B(){this.#S=new ArrangerTube(this.#S)}}class CrateMaker{#L;#F;constructor(t,e=!1){if(!t)return!1;this.#L=t,this.#F=e}#P(t){const e=["Pinewood","Plywood"],s=t.filter((t=>e.includes(t[5]))),a=t.filter((t=>"Foam Sheet"===t[5]));let r=0,i=0,n=0,o=0,c=0;return s.map((t=>{r+=+t[2],i+=+t[2]})),a&&a.length&&a.map((t=>{if(this.#L>1&&t[2]<=2.5)return this.#F&&(this.#F=!1,n+=+t[2]),o=t[2],i+=+t[2]*(this.#L-1);r+=+t[2],i+=+t[2],n+=+t[2],t[2]>2.5&&(c=2*t[2])})),r*=2,i*=2,n*=2,{x:r,z:i,y:n,div:o,pad:c}}#O(){let{materials:t,crating:e}=localStorage;const s=[];return t=JSON.parse(t),e=JSON.parse(e),e.map((e=>{const a=t.find((t=>t[0]===e));a&&s.push(a)})),s.length?this.#P(s):{x:0,z:0,y:0}}get outSizes(){return this.#O()}}class WorksCoordinates{#N;#D;#R;#U;constructor(t=!1){t&&(this.#D=t,this.#U=this.#_())}#_(){const t={emptyArea:[],artLocation:new Map,baseSize:this.#D,usedMaterials:new Map,innerSize:[],finalSize:[],layers:[],get reset(){this.emptyArea=[[0,0,this.baseSize[0],this.baseSize[2]]]},get fillGaps(){const t=[];return this.layers.map((e=>{const{vacuum:s,works:a}=e,r=((t,e=0)=>(t.map((t=>!e||t.work[2]>e[1]?e=[t.work[0],t.work[2]]:0)),e))(a),{total:i,sizes:n}=((t,e=0,s=[])=>(t.map((t=>{if(t[0]===t[2]&&t[1]===t[3])return;let a=t[2]-t[0],r=t[3]-t[1];!a&&r&&(a=t[0]),a&&!r&&(r=t[1]),s.push([+a.toFixed(2),+r.toFixed(2)]),e+=+(a*r).toFixed(3)})),{total:e,sizes:s}))(s);t.push({highestZ:r,total:i,sizes:n})})),t},set defineLayer(t){const e=structuredClone(this.emptyArea),s=structuredClone(t[1]);this.layers.push({vacuum:e,works:s}),this.reset},get fillMaterials(){const t=JSON.parse(localStorage.getItem("materials")),e=JSON.parse(localStorage.getItem("crating"));t.map((t=>e.includes(t[0])?this.usedMaterials.set(t[0],t):0))}};return t.reset,t.fillMaterials,t}#M(t,e,{x:s,y:a,flip:r}){const{emptyArea:i}=this.#U,n=i[0][2],o=i[0][3];if(n===s&&o===a||n===a&&o===s)return;if(i.length>1){const c=i[0][0]===e[0];c&&!r?i[0][0]+=s:i[0][1]+=a;const h=i[0][0],l=i[0][1],d=h+s===n?n:0,u=l+a===o?o:0,m=c?[s+h,u,n,o]:[h,u,n,o],p=c?[d,a+l,n,o]:[d,l,n,o];return i.splice(t,1),c&&m[0]<n&&i.push(m),void(!c&&p[1]<o&&i.push(p))}const c=!(s===n)&&[s,0,n,o],h=!(a===o)&&[0,a,n,o];c&&i.push(c),h&&i.push(h)}#q(t,e){const s=e[0]===e[2]&&e[1]===e[3],a=e[2],r=e[3],i=t[1]+e[0]<=a&&e[0]<a,n=t[3]+e[1]<=r&&e[1]<r,o=t[3]+e[0]<=a&&e[0]<a,c=t[1]+e[1]<=r&&e[1]<r;return{check01:!s&&(i&&n),check02:!s&&(o&&c)}}#H({emptyArea:t,found:e,art:s,ind:a,pos:r}){t.length>1&&0===r&&r++;const i=t[r],n=t[0][0]===t[0][2]&&t[0][1]===t[0][3];if(e||!i||n)return e;const{check01:o,check02:c}=this.#q(s,i),h=t[0][2],l=t[0][3],d=s[1]===h&&s[3]===l||s[3]===h&&s[1]===l;let u,m,p=!1;return o?(e=!0,u=s[1],m=s[3],this.#R[a].defCoordinate={x:t[r][0],z:s[2],y:t[r][1]},0===r&&(t[0][0]=(u||m>0)&&!d?u:h,t[0][1]=(u>0||m)&&!d?m:l)):c&&(e=!0,u=s[3],m=s[1],s.push('<i class="nf nf-oct-sync"></i>'),p=!0,this.#R[a].defCoordinate={x:t[r][1],z:s[2],y:t[r][0]},0===r&&(t[0][1]=(u||m>0)&&!d?t[0][2]-s[3]:l,t[0][0]=(u>0||m)&&!d?t[0][3]-s[1]:h)),e?this.#M(r,i,{x:u,y:m,flip:p}):r++,this.#H({emptyArea:t,found:e,art:s,ind:a,pos:r})}#$(t,e,s){const a=void 0===t.emptyArea[0]&&void 0===t.emptyArea[1],r=t.emptyArea[0][0]===t.emptyArea[0][2],i=t.emptyArea[0][1]===t.emptyArea[0][3];if(a||!e[s]||r&&i)return t;let n;const{emptyArea:o,feat:c}=t,h=e[s],l=this.#R.findIndex((t=>t.code===h[0])),d={emptyArea:o,found:!1,art:h,ind:l,pos:0};return this.#H(d)&&(n=e.splice(s,1).flat(),c.push({work:n,list:s,raw:l})),this.#$(t,e,s-1)}get bluePrintCoordinates(){return this.#U}get fillLayer(){const{info:t,list:e,len:s,raw:a}=this.#N;return this.#R=a,!!this.#N&&this.#$(t,e,s)}set fillPreparing(t){this.#N=t}}class CraterPythagoras{#h;#l;#R;#U;constructor(t){return t&&0!==t.length?(this.#R=t,this.#l=t.map((t=>t.arr)),this.#h=structuredClone(this.#l),this.#W()):{largest:!1}}#X(t,e,s,a=1){if(!t.length&&!s)return this.#U;const{emptyArea:r}=this.#U,i={emptyArea:r,feat:[]},n=t.length-1;let o;return e.fillPreparing={info:i,list:t,len:n,raw:this.#R},o=e.fillLayer,this.#U.defineLayer=[a,o.feat],this.#X(t,e,s-1,a+1)}#J(t,e,s,a){const r=new WorksCoordinates(t);this.#U=r.bluePrintCoordinates,this.#X(this.#h,r,e),this.#R.map((t=>this.#U.artLocation.set(t.code,t))),this.#U.innerSize=[t[0]+a,s+a,t[2]+a]}#j(t,e){const s=new CrateMaker(e).outSizes,a=+(t[0]+s.x).toFixed(3),r=+(t[1]+s.z).toFixed(3),i=+(t[2]+s.y).toFixed(3),n=a%1>0?a:a.toFixed(0),o=r%1>0?r:r.toFixed(0),c=i%1>0?i:i.toFixed(0),h=s.div&&e.length>1?t[1]+s.div*(e-1):t[1];return this.#J(t,e,h,s.pad),[+n,+o,+c]}#Z(t){const e=+(Math.cos(Math.asin(240/t[2]))*t[2]).toFixed(3);return this.#U.finalSize=[t[0],e,240],[...this.#U.finalSize]}#Y(t){let e,s=0,a=0,r=0;return t.map((t=>{s<t[1]&&(s=t[1]),a<t[2]&&(a=t[2]),r<t[3]&&(r=t[3])})),e=s>=r?this.#j([s,a,r],t.length):this.#j([r,a,s],t.length),e}#V(t){let e;return e=this.#Y(t),t.map((t=>{t[1]<=e[2]&&t[3]>e[2]&&t.push('<i class="nf nf-oct-sync"></i>')})),this.#Z(e)}#G(){let t,e=[];for(;this.#l.length;)t=this.#l.splice(0,3),e.push(this.#V(t)),e.push({works:t});return e[0].push(this.#U),e}#W(){const t=this.#G();return this.largest={crates:t}}}class CraterStandard{#R;#h;#K;#Q;#U;#tt;#L=0;constructor(t,e,s,a){return t&&0!==t.length?(this.#R=t,this.#h=t.map((t=>t.packedSized)),this.#K=s??4,this.#Q=e,this.#et([],a)):{standard:!1}}#et(t,e){switch(e){case!1:return t=this.#st(),this.#Q?{crates:t,backUp:JSON.parse(JSON.stringify(t))}:{crates:t};case!0:return t=this.#at([],1,structuredClone(this.#h)),this.#Q?{crates:t,backUp:JSON.parse(JSON.stringify(t))}:{crates:t}}}#rt(t,e){let s,a,r,i,n,o=0,c=0;for(n in t)s=t[n][0]>e[n][0],a=t[n][0]!==e[n][0],r=t[n][2]>e[n][2],i=t[n][2]!==e[n][2],s&&a?o+=1:a&&(c+=1),r&&i?o+=1:i&&(c+=1);return{opt1:o,opt2:c}}#it(t,e){let s=0,a=0,r=0,i=0,n=2;return t.map((t=>t[0]<=300&&t[2]<=160?s++:r++)),e.map((t=>t[0]<=300&&t[2]<=160?a++:i++)),r===i?n=s<=a?1:2:r<i&&(n=s>=a?1:2),{bestArrange:n}}#st(){const t={opt1:this.#at([],0,structuredClone(this.#h)),opt2:this.#at([],1,structuredClone(this.#h))},e=[],s=[],a=new WeakSet;Object.entries(t).map((t=>{"opt1"===t[0]?t[1].map(((t,s)=>s%2==0?e.push(t):0),0):t[1].map(((t,e)=>e%2==0?s.push(t):0),0)}));let r,i;return r=e.length===s.length?this.#rt(e,s):this.#it(e,s),i=r.hasOwnProperty("bestArrange")?r.bestArrange:r.opt1<=r.opt2?1:2,a.add(r),1===i?t.opt1:t.opt2}#nt(t,e){if(t.length<=1)return t;const s=[],a=t.splice(0,1),r=[];return t.map((t=>{t[e]<=a[0][e]?s.push(t):r.push(t)})),this.#nt(s,e).concat(a,this.#nt(r,e))}#ot(t,e){let s=0,a=0,r=0;const i=new CrateMaker(this.#L).outSizes;if(this.#L>1)for(a in e)Object.entries(e[a]).map((t=>{t.includes("status")||(t[1].map((t=>{t[2]>r&&(r=t[2])})),s+=r,r=0)}));r=i.div*(this.#L-1)+s,this.#U.innerSize=[t[0]+i.pad,r+i.pad,t[2]+i.pad],i.x+=t[0],i.z+=s,i.y+=t[2],i.y+=8;const n=i.x%1>0?i.x.toFixed(3):i.x.toFixed(0),o=i.z%1>0?i.z.toFixed(3):i.z.toFixed(0),c=i.y%1>0?i.y.toFixed(3):i.y.toFixed(0);return this.#R.map((t=>this.#U.artLocation.set(t.code,t))),this.#U.finalSize=[+n,+o,+c],[+n,+o,+c,structuredClone(this.#U)]}#ct(t,e){switch(this){case 1:Array.isArray(e[0])?t.push({layer1:e}):t.push({layer1:[e]});break;case 2:Array.isArray(e[0])?t.push({layer2:e}):t.push({layer2:[e]});break;case 3:Array.isArray(e[0])?t.push({layer3:e}):t.push({layer3:[e]});break;case 4:Array.isArray(e[0])?t.push({layer4:e}):t.push({layer4:[e]});break;case 5:Array.isArray(e[0])?t.push({layer5:e}):t.push({layer5:[e]});break;default:return}return t}#ht(t,e){const s=new WorksCoordinates(t);this.#U=s.bluePrintCoordinates;const a=[];let r,i,n,o=[],c=0;try{for(;c++<this.#K&&e.length;){const{emptyArea:t}=this.#U;r={emptyArea:t,feat:[]},s.fillPreparing={info:r,list:e,len:e.length-1,raw:this.#R},i=s.fillLayer,n=structuredClone(i),o=n.feat.map((t=>{const e=this.#R.find((e=>e.code===t.work[0])).arr,s=structuredClone(t.work);return s[1]=e[1],s[2]=e[2],s[3]=e[3],s})),this.#ct.call(c,a,o),this.#U.defineLayer=[c,i.feat],o=null,i=null,r=null,o=[]}}catch(t){console.error(t)}return this.#L=c-1,delete this.#U.defineLayer,delete this.#U.reset,{crate:a,measure:t,list:e}}#lt(t,e,s){if(s<0)return t.x<t.y&&([t.x,t.y]=[t.y,t.x]),t;const a=e.length>5;return t.x=t.x<e[s][1]?e[s][1]:t.x,t.x=a&&t.x>=e[s][1]&&t.x+e[s][1]<=this.#tt?t.x+e[s][1]:t.x,t.z=e[s][2]>t.z?e[s][2]:t.z,t.y=e[s][3]>t.y?e[s][3]:t.y,t.y=a&&t.y>=e[s][3]&&t.y+e[s][3]<=140?t.y+e[s][3]:t.y,this.#lt(t,e,s-1)}#dt(t){const{x:e,z:s,y:a}=this.#lt({x:0,z:0,y:0},t,t.length-1);return[e,s,a]}#ut(t){let e=t.map((t=>(t.push(t[1]*t[3]),t)));return e=this.#nt(e,5),e=e.map((t=>(t.pop(),t))),t=e}#at(t,e,s){if(!s.length)return t;this.#tt=e?250:180,s=this.#ut(s);const a=this.#dt(s),{crate:r,measure:i,list:n}=this.#ht(a,s);return t.push(this.#ot(i,r)),t.push({works:r}),this.#at(t,e,n)}}class CraterLastCheckReArranger{#mt;constructor(t){return"crates ahead"===t[0]&&(this.#mt=t,this.#pt())}#nt(t,e){if(t.length<=1)return t;const s=[],a=t.splice(0,1),r=[];let i=0;for(i in t)t[i][e]<=a[0][e]?s.push(t[i]):r.push(t[i]);return this.#nt(s,e).concat(a,this.#nt(r,e))}#yt(t,e,s){const a=t[e],{works:r}=a;return r.map((t=>{Object.entries(t).map((t=>{t[1].map((t=>{1===t.length?s.push(t[0][0]):t.map((t=>Array.isArray(t[0])?s.push(t[0]):0))}))}))})),structuredClone(s)}#ft(t,e){const s=new WeakSet,a=e.works.length;let r,i=0,n=!0;for(;i++<t.length&&n;)i%2==1&&(r=1===a?structuredClone(e.works[0]):structuredClone(e.works),this.#yt(t,i,r),r=this.#nt(r,4),r=new CraterStandard(r,!1,5,!0),r.crates.length===t.length&&(t.splice(i,1,r.crates[1]),t.splice(i-1,1,r.crates[0]),n=!1),s.add(r));return!n}#gt(t,e,s){return s<0?e:(s%2==1&&this.#ft(t,e[s])&&(e.splice(s-1,2),s=e.length),this.#gt(t,e,s-1))}#zt(t){let e,s,a=0;for(s in t)if(a++%2==1&&5===t[s].works.length&&(e=t[s].works[4].layer5),e)break;return!!e&&{info:s,works:e}}#xt(t,e){let s,a=[];return Object.entries(e).map((t=>{t[1].map((t=>{let e;for(e in t)t[e].length>0&&Array.isArray(t[e])&&t[e].map((t=>a.push(t)))}))})),t.map((t=>a.push(t))),s=this.#nt(a,4),s}#wt(t,e,s,a){return t[a].works.pop(),t[a-1][1]-=10,t.splice(e-1,1,s.crates[0]),t.splice(e,1,s.crates[1]),t}#kt(){const{crates:t}=this.#mt.standardCrate,e=this.#zt(t);let s,a,r,i,n=0;if(e)for(i in t){if(!Array.isArray(t[i])&&n!==+e.info&&(s=this.#xt(e.works,t[i]),a=new CraterStandard(s,!1,5,!0),r=2===a.crates.length,r)){this.#wt(t,n,a,e.info);break}n++}}#pt(){const t=this.#mt.sameSizeCrate.crates,e=this.#mt.sameSizeCrate.backUp,s=this.#mt.standardCrate.crates;let a;if(t&&s){if(a=t.length,this.#gt(s,t,a),t.length===e.length)return this.#mt.sameSizeCrate.backUp=!1,void(this.#mt.standardCrate.backUp=!1);this.#kt()}}}class CraterNotCanvas{#u;#R;#U;#h;constructor(t){return t&&0!==t.length?(this.#R=t,this.#u=t.map((t=>t.arr)),this.#h=t.map((t=>t.arr)),this.#T()):{noCanvas:!1}}#nt(t,e){if(t.length<=1)return t;const s=[],a=t.splice(0,1),r=[];return t.map((t=>{t[e]<=a[0][e]?s.push(t):r.push(t)})),this.#nt(s,e).concat(a,this.#nt(r,e))}#J(t){const e=new WorksCoordinates(t);this.#U=e.bluePrintCoordinates;const{emptyArea:s}=this.#U,a={emptyArea:s,feat:[]},r=this.#h.length-1;let i;e.fillPreparing={info:a,list:this.#h,len:r,raw:this.#R},i=e.fillLayer,this.#U.defineLayer=[1,i.feat],this.#R.map((t=>this.#U.artLocation.set(t.code,t)))}#j(t){const e=new CrateMaker(this.#u).outSizes,s=+(t[0]+e.x).toFixed(3),a=+(t[1]+e.z).toFixed(3),r=+(t[2]+e.y).toFixed(3),i=s%1>0?s:s.toFixed(0),n=a%1>0?a:a.toFixed(0),o=r%1>0?r:r.toFixed(0),c=e.div?t[1]+e.div*this.#u.length:t[1];return this.#J([+i,+n,+o]),this.#U.innerSize=[t[0]+e.pad,c+e.pad,t[2]+e.pad],this.#U.finalSize=[+i,+n,+o],[...this.#U.finalSize,this.#U]}#Ct(t){let e,s=0,a=0,r=0,i=0;return e=t.length/2,t.map((t=>{e-- >0&&(s+=t[1],a<t[2]&&(a=t[2])),r=t[1],i<t[2]&&(i=t[2])})),r>s||(r=s),i+=a,{newX:r,newZ:i}}#bt(t){const e=t.length>4&&t.length%2==0;let s,a=0,r=0,i=0;return t.map((t=>{a+=t[1],r=t[2]>r?t[2]:r,i=t[3]>i?t[3]:i})),(a>277||e)&&(s=this.#Ct(t),a=s.newX,r=s.newZ),this.#j([a,r,i])}#St(t,e){const s=t[1]===e[1]&&t[1]<277,a=t[2]===e[2]&&t[2]<177,r=t[3]<=132;return!!(s&&a&&r)}#vt(t,e,s,a){return a.length%2==0&&t>554&&2*e+10<177?a.length:0===s||a[0][1]>554?1:s}#At(t){let e=10*t.length,s=0,a=0;const r=t[0];return t.map((t=>{const i=this.#St(t,r),n=t[2]-r[2],o=r[2]-t[2];(!0===i||(n>0&&n<=10||o>0&&o<=10))&&(a++,e+=t[1],s+=t[3])})),this.#vt(e,s,a,t)}#It(t){if(!Array.isArray(t))return t;let e=t.map((t=>(t.push(t[1]*t[2]),t)));return e=this.#nt(e,5),e=e.map((t=>(t.pop(),t))),this.#u=e}#T(){const t=[];let e;for(this.#It(this.#u);this.#u.length>0;)e=this.#At(this.#u),e=this.#u.splice(0,e),e.length>0?(t.push(this.#bt(e)),t.push({works:e})):(t.push(this.#bt(this.#u.splice(0,1))),t.push({works:e}));return{crates:t}}}class CraterSameSize{#u;#Tt;#R;#U;constructor(t){return t&&0!==t.length?(this.#R=structuredClone(t),this.#u=t.map((t=>t.arr)),this.#Tt=t[0].packedSized,this.#Et()):{sameSize:!1}}#X(t,e,s=1){if(!t.length)return this.#U;const{emptyArea:a}=this.#U,r={emptyArea:a,feat:[]},i=t.length-1;let n;return e.fillPreparing={info:r,list:t,len:i,raw:this.#R},n=e.fillLayer,this.#U.defineLayer=[s,n.feat],this.#X(t,e,s+1)}#J(t,e){const s=JSON.parse(localStorage.getItem("materials")),a=JSON.parse(localStorage.getItem("crating"));let r;a.map((t=>{const e=s.filter((e=>{return t===(s=e)[0]&&s[2]<5&&"Foam Sheet"===s[5];var s}));e.length&&(r=e.flat())})),e&&(t[2]=+r[2]);const i=new WorksCoordinates(t);this.#U=i.bluePrintCoordinates;const n=structuredClone(this.#u);return this.#X(n,i),this.#R.map((t=>this.#U.artLocation.set(t.code,t))),t}#Bt(t,e){const s=new CrateMaker(this.#u.length,e).outSizes,a=+(t[0]+s.x).toFixed(3),r=+(t[1]+s.z).toFixed(3),i=+(t[2]+s.y).toFixed(3),n=a%1>0?a:a.toFixed(0),o=r%1>0?r:r.toFixed(0),c=i%1>0?i:i.toFixed(0),h=t[1]+s.div*this.#u.length;return this.#J([+n,+o,+c],e),this.#U.innerSize=[t[0]+crate.pad,h+crate.pad,t[2]+crate.pad],this.#U.finalSize=[+n,+o,+c],[...this.#U.finalSize,this.#R]}#Lt(t,e,s){const a=t.map((t=>{const a=t[0]+e[0]<=s[0],r=t[1]+e[1]<=s[1],i=t[2]+e[2]<=s[2];if(a&&r&&i)return t}));return void 0!==a[0]&&a.map((e=>t.splice(t.indexOf(e),1))),void 0!==a[0]}#Ft(t,e){let s=[];return void 0!==e.map((e=>{const a=e[0]===t[0][0],r=e[2]===t[0][2],i=e[0]===t[0][0]-this.#Tt[1],n=e[2]===t[0][2]-this.#Tt[3];if(a&&r||i&&n)return e;if(s.length>0){if(this.#Lt(s,e,t))return e}else s.push(e)}))[0]}#Pt(t,e){const s=t.shift(),a=Array.isArray(e[0])?e[0].length:e.length;let r,i,n,o;return s?(r=a%2+a/2,i=t[0],n=r*this.#Tt[2],o=t[2]):(r=a%2+a,i=t[0],n=r*this.#Tt[2],o=t[2]),this.#Bt([i,n,o],s)}#Ot(t,e){const s=e.length>3?[e[0][1],e[0][2],e[0][3]]:e;let a=t[0],r=t[1],i=t[2]+s[2],n=!1;return i>132&&a<132?([i,a]=[a,i],n=!0):i>t[2]&&(n=!0),[n,[a,r,i]]}#Nt(t){let e,s,a=t.splice(0,1).flat(),r=t.splice(0,1).flat();return t.length>0&&(e=this.#Ft(a,t)),e?(a=this.#Ot(a,t.splice(0,1)),t[0].map((t=>r[0][0].push(t))),t.splice(0,t[0].length)):r[0].length>10&&r[0].length%2==0?a=this.#Ot(a,r[0]):a.unshift(!1),Array.isArray(r[0][0])&&(r=r.flat()),s=this.#Pt(a.flat(),r),{crate:s,works:r}}#Dt(t){const e=[];let s;for(;t.length;)s=this.#Nt(t),e.push(s.crate),e.push({works:s.works});return e}#Rt(){let t=this.#u[0][1],e=this.#u[0][2],s=this.#u[0][3],a=[[t,e,s]],r=[];return this.#u.map((i=>{i[2]<=14&&(i[1]!==t&&i[3]!==s&&(a.push([r]),t=i[1],e=i[2],s=i[3],a.push([t,e,s]),r=[]),r.push(i))})),a.push(r),a[1][0].length>=4?a:null}#Et(){let t=this.#Rt();if(null===t)return null;const e=this.#Dt(t);return t=null,{crates:e,backUp:structuredClone(e)}}}class CraterTube{#Ut;#_t;#U;#R;constructor(t){if(!t||0===t.length)return{tube:!1};this.#R=t,this.#Ut=t.map((t=>t.arr)),this.#_t=35;return this.#Ut.filter((t=>t[2]<this.#_t&&t)).find((t=>!1!==t))?this.#Mt():{tube:!1}}#Mt(){return this.#qt(),this.#Ut}#Ht(t,e){const s=new WorksCoordinates(t);this.#U=s.bluePrintCoordinates;const{emptyArea:a}=this.#U;let r,i={emptyArea:a,feat:[]},n=Array.isArray(e[0])?e.length-1:0;s.fillPreparing={info:i,list:e,len:n,raw:this.#R},r=s.fillLayer,this.#U.defineLayer=[1,r.feat],this.#U.innerSize=[t[0],t[1],t[2]],this.#R.map((t=>this.#U.artLocation.set(t.code,t)))}#$t(t){let e=t[0][1],s=t[0][2],a=0;return t.map((t=>{e=t[1]>e?t[1]:e,s=t[2]>s?t[2]:s,a+=t[3]})),[e,s,a]}#Wt(){const t=new CrateMaker(1),e=+(this[0]+t.x).toFixed(3),s=+(this[1]+t.z).toFixed(3),a=+(this[2]+t.y).toFixed(3),r=e%1>0?e:e.toFixed(0),i=s%1>0?s:s.toFixed(0),n=a%1>0?a:a.toFixed(0);return this.#Ht([this[0]+t.pad,this[1]+t.pad,this[2]+t.pad],structuredClone(list)),this.#U.finalSize=[+r,+i,+n],[...this.#U.finalSize]}#Xt(t){const e=this.#$t(t);return this.#Wt(e,t)}#Jt(t){switch(t.length){case 1:case 2:case 3:case 4:return this.#Xt(t)}}#jt(t){const e=[];let s;for(;t.length>=3;)s=t.splice(0,3),e.push(this.#Jt(s.length,s)),e.push({works:s});return e}#Zt(){const t=this.#Ut.filter((t=>{if(t[2]>this.#_t)return t}));return t.map((t=>{this.#Ut.splice(this.#Ut.indexOf(t),1)})),t}#qt(){let t=[],e=[];const s=this.#Zt();for((s.length>0||s.length>3)&&e.push(this.#jt(s));this.#Ut.length;)t=this.#Ut.splice(0,3),e.push(this.#Jt(t)),e.push({works:t});return this.#Ut.length>=1&&(e.push(this.#Jt(this.#Ut.length,this.#Ut)),e.push({works:this.#Ut})),this.#Ut={crates:e}}}class Crater{#S;#Yt;constructor(t){return t!==Arranger?{crater:!1}:(this.#S=t.list,this.#Yt=["crates ahead"],Object.assign(Crater,this.#Vt()))}#Vt(){let t=0;const e=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(t in this.#Xt(),this.#Gt(),this.#Kt(),this.#Qt(),this.#te(),this.#ee(),this.#Yt)this.#Yt[t]?.hasOwnProperty("crates")&&e.includes(t)||delete this.#Yt[t];return this.#se(),this.#ae(),this.#re(),this.#ie(),Array.isArray(this.#Yt?.sameSizeCrate?.backUp)&&(this.#ne(),this.#oe(),this.#ce()),{crates:this.#Yt}}#Xt(){const t=new CraterTube(this.#S?.tubes);this.#Yt.tubeCrate=t}#Gt(){const t=new CraterPythagoras(this.#S?.largest);this.#Yt.largestCrate=t}#Kt(){const t=new CraterSameSize(this.#S?.sameSize);this.#Yt.sameSizeCrate=t}#Qt(){const t=new CraterNotCanvas(this.#S?.noCanvas);this.#Yt.noCanvasCrate=t}#te(){const t=this.#Yt.sameSizeCrate.hasOwnProperty("crates"),e=new CraterStandard(this.#S?.sorted,t,4,!1);this.#Yt.standardCrate=e}#ee(){new CraterLastCheckReArranger(this.#Yt)}#se(){let t=0;const e=[],s=t=>{Array.isArray(t)&&e.push(t)};for(t in this.#Yt)this.#Yt[t]?.crates?.map(s);this.#Yt.allCrates=e}#ce(){let t,e,s=0;const a=[],r=t=>{Array.isArray(t)&&a.push(t)};for(s in this.#Yt)t="sameSizeCrate"===this.#Yt[s],e="standardCrate"===this.#Yt[s],(t||e)&&this.#Yt[s]?.backUp?.map(r),this.#Yt[s]?.crates?.map(r);this.#Yt.allCratesBackUp=a}#ae(){let t=0;const e=t=>{if(Array.isArray(t)&&t.length>=3){const e=t[0],s=t[1],a=t[2],r=new CubCalc(e,s,a).cubCalcAir,i=4===t.length?t.splice(3,1,r):t.push(r);Array.isArray(i)&&t.push(i)}};for(t in this.#Yt)this.#Yt[t]?.crates?.map(e);Array.isArray(this.#Yt?.sameSizeCrate?.backUp)&&(this.#Yt?.sameSizeCrate?.backUp?.map(e),this.#Yt?.standardCrate?.backUp?.map(e))}#re(){let t=0,e=[];const s=t=>{Array.isArray(t)&&e.push(t[3])};for(t in this.#Yt)this.#Yt[t]?.crates?.map(s);e=e.reduce(((t,e)=>t+e),0),this.#Yt.airCubTotal=e.toFixed(3)}#ne(){let t,e,s=[],a=0;const r=t=>{Array.isArray(t)&&s.push(t[3])};for(a in this.#Yt)t="sameSizeCrate"===this.#Yt[a],e="standardCrate"===this.#Yt[a],t||e?this.#Yt[a]?.backUp?.map(r):t||e||this.#Yt[a]?.crates?.map(r);s=s.reduce(((t,e)=>+(t+e).toFixed(3)),0),this.#Yt.airCubTotalBackUp=s}#he(t){if(Array.isArray(t)){const e=t[0],s=t[1],a=t[2];return e>300||s>200||a>160?"CARGO":"PAX"}}#ie(){let t,e=0,s=0,a=0;for(a in this.#Yt)this.#Yt[a]?.crates?.map((a=>{t=this.#he(a),"PAX"===t?e++:"CARGO"===t&&s++}));this.#Yt.whichAirPort=[{PAX:e},{CARGO:s}]}#oe(){let t,e,s,a=0,r=0,i=0;for(a in this.#Yt)t="sameSizeCrate"===this.#Yt[a],e="standardCrate"===this.#Yt[a],t||e?this.#Yt[a]?.backUp?.map((t=>{s=this.#he(t),"PAX"===s?r++:"CARGO"===s&&i++})):t||e||this.#Yt[a]?.crates?.map((t=>{s=this.#he(t),"PAX"===s?r++:"CARGO"===s&&i++}));this.#Yt.whichAirPortBackUp=[{PAX:r},{CARGO:i}]}}class UnitAdapter{#h;#le;constructor(t,e){return this.#h=t,this.#le=e,this.#de()}#ue(){try{if(!Array.isArray(this.#h)){throw new TypeError("Please, provide a valid list.")}if(this.#h.some((t=>"ArtWork"!==t.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#le&&"in"!==this.#le){throw new TypeError("Please, provide a valid unit.")}}catch(t){return t}return"pass"}async#de(){let t;const e=this.#ue();switch("pass"!==e?"error":"cm"===this.#le?"cm":"in"){case"error":return e;case"cm":return t=await this.#me(),t;case"in":return t=await this.#pe(),t}}#ye(t){const e=t?.hasOwnProperty("crates"),s=t?.hasOwnProperty("backUp");return Array.isArray(t)?t.map(r):t?.hasOwnProperty("crates")?((e||s)&&(t.crates=t.crates.map((t=>4===t.length?r(t):(Array.isArray(t.works[0])?t.works=t.works.map(r):t.works=t.works.map(i),t))),console.log(t.crates)),t):t}#fe(){return this.#h.map((t=>{const e=t.autoConvert,s=e[0],a=e[1],r=e[2],i=e[3];return new ArtWork(s,a,r,i)}))}#ge(t){let e=0;for(e in t)t[e].hasOwnProperty("crates")&&(t[e]=this.#ye(t[e]));return t.sameSizeCrate?.hasOwnProperty("backUp")&&(t.airCubTotalBackUp=+(.061023*t.airCubTotalBackUp).toFixed(3),t.allCratesBackUp=this.#ye(t.allCratesBackUp)),t.allCrates=this.#ye(t.allCrates),t}async#me(){return await Promise.resolve(new Arranger(this.#h)).then((t=>new Crater(t))).then((t=>t.crates)).catch((t=>t))}async#pe(){return await Promise.resolve(this.#fe()).then((t=>new Arranger(t))).then((t=>new Crater(t))).then((t=>this.#ge(t.crates))).catch((t=>t))}}function r(t){const e=.061023;let s,a,r,i;switch(console.log(t),t.length){case 4:return a=t[0],r=t[1],i=t[2],s=Array.from(new Converter(a,r,i).inConvert),s.push(+(t[3]*e).toFixed(3)),s;case 5:return a=t[1],r=t[2],i=t[3],s=Array.from(new Converter(a,r,i).inConvert),s.unshift(t[0]),s.push(+(t[3]*e).toFixed(3)),s;case 6:return a=t[1],r=t[2],i=t[3],s=Array.from(new Converter(a,r,i).inConvert),s.unshift(t[0]),s.push(+(t[3]*e).toFixed(3)),s.push(t[5]),s}}function i(t){let e;for(e in t)Array.isArray(t[e][0][0][0])?t[e][0].map((t=>t.splice(0,1,r(t[0])))):t[e]=[r(t[e][0])];return t}class largestCrateRender{#Yt;#ze;constructor(t,e){this.#Yt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class notCanvasCrateRender{#Yt;#ze;constructor(t,e){this.#Yt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}let n={showlegend:!0,legend:{title:{text:"Crate Layers:",font:{family:"Mitr, sans-serif",size:14}},font:{family:"Mitr, sans-serif",sizes:14,color:"#FFFFFFAA"},x:.02,xanchor:"left",y:.99,yanchor:"top",orientation:"v",groupclick:"sides"},legendgrouptitle:{},margin:{t:0,l:0,b:0,r:0,pad:10},scene:{aspectmode:"data",xaxis:{title:{text:"Length - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",ticks:"outside"},yaxis:{title:{text:"Depth - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},zaxis:{title:{text:"Height - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},camera:{eye:{x:0,y:3,z:1}}},paper_bgcolor:"#96979C"};class TraceMaker{#we;#ke;#Ce=new Map;constructor(){[["frame","#BF5E30"],["fill","#555FEF"],["padding","#222725"],["div","#BEBBBB"],["works","#BB0056BB"],["fill","#0B8325"],["structure","#002A3D"]].map((t=>{this.#Ce.set(t[0],t[1])})),this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]}#be(){const{info:t,coordinates:e,name:s,show:a}=this.#ke,r=this.#Ce.get(s);return this.#we.forEach(((i,n)=>{const o=e[i[0]],c=e[i[1]];t.push({x:[o.x,c.x],z:[o.y,c.y],y:[o.z,c.z],name:s,mode:"lines",type:"scatter3d",line:{color:r,width:3},ids:s,showlegend:!(!a||0!==n),legendgroup:s,hovertemplate:"L: %{x}<br>H: %{z}<br>D: %{y}<br>",contour:{show:!(!a||0!==n),color:"#BB0056BB",width:2}})})),t}set data(t){this.#ke=t}get defineTrace(){return this.#be()}}class DesignWalls{#ke;#Ce=new Map;#Se;constructor(){[["frame","yellow"],["fill","#3DDDDD"],["padding","#222725"],["div","#EFECBBBE"],["works","#BB0056BB"],["fill","#2DD751"],["structure","#557AEC"]].map((t=>{this.#Ce.set(t[0],t[1])})),this.#Se=[[[0,1,2],[0,2,3]],[[4,7,6],[4,6,5]],[[0,3,7],[0,7,4]],[[1,5,6],[1,6,2]],[[0,4,5],[0,5,1]],[[3,2,6],[3,6,7]]]}#ve(){const{width:t,depth:e,height:s,offsetX:a,offsetZ:r,offsetY:i,info:n,name:o}=this.#ke,c=this.#Ce.get(o),h=[[0,0,0],[t,0,0],[t,e,0],[0,e,0],[0,0,s],[t,0,s],[t,e,s],[0,e,s]].map((t=>[t[0]+a,t[1]+i,t[2]+r])),l=h.map((t=>t[0])),d=h.map((t=>t[1])),u=h.map((t=>t[2])),m=[],p=[],y=[];return this.#Se.map((t=>{t.map((t=>{m.push(t[0]),p.push(t[1]),y.push(t[2])}))})),n.push({x:l,y:d,z:u,i:m,j:p,k:y,name:o,type:"mesh3d",color:c,showlegend:!1,legendgroup:o,opacity:.2,flatshading:!0,showscale:!0,contour:{show:!0,color:"white",width:2}}),n}set objectData(t){this.#ke=t}get designSides(){return this.#ve()}}class sameSizeCrateRender{#Yt;#ze;constructor(t,e){this.#Yt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class CratesFrame{#we;#Ae;#Ie;constructor(t,e){this.#Ie=e,this.#Ae=t,this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#Ie[1]=+this.#Ie[1],this.#Ie[2]=+this.#Ie[2],this.#Ie[3]=+this.#Ie[3]}#Te(t){const e=[];return this.#we.forEach((s=>{const a=t[s[0]],r=t[s[1]];e.push({x:[a.x,r.x],y:[a.y,r.y],z:[a.z,r.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:1,line:{color:"#F0000000"}})})),e}#Ee(){return{offsetFeetRightFirst:{type:"feet",x:0,y:0,z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:0,offsetY:0,offsetZ:0},offsetFeetLeftFirst:{type:"feetR",x:this.#Ae[0],y:0,z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:this.#Ae[0]-this.#Ie[3],offsetY:0,offsetZ:0},offsetFeetRightSecond:{type:"feetUp",x:0,y:this.#Ie[2],z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:0,offsetY:0,offsetZ:this.#Ie[2]},offsetFeetLeftSecond:{type:"feetUpR",x:this.#Ae[0],y:this.#Ie[2],z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:this.#Ae[0]-this.#Ie[3],offsetY:0,offsetZ:this.#Ie[2]},offsetFacesRightBackV:{type:"faceV",x:this.#Ie[2],y:this.#Ie[3]+2*this.#Ie[2],z:0,width:this.#Ie[3],depth:this.#Ie[2],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ie[2],offsetY:0,offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetFacesLeftBackV:{type:"faceVR",x:this.#Ae[0]-this.#Ie[2],y:this.#Ie[3]+2*this.#Ie[2],z:0,width:this.#Ie[3],depth:this.#Ie[2],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ae[0]-(this.#Ie[3]+this.#Ie[2]),offsetY:0,offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetFacesRightFrontV:{type:"faceVB",x:this.#Ie[2],y:this.#Ie[3]+2*this.#Ie[2],z:this.#Ae[1],width:this.#Ie[3],depth:this.#Ie[2],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ie[2],offsetY:this.#Ae[1]-this.#Ie[2],offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetFacesLeftFrontV:{type:"faceVBR",x:this.#Ae[0]-this.#Ie[2],y:this.#Ie[3]+2*this.#Ie[2],z:this.#Ae[1],width:this.#Ie[3],depth:this.#Ie[2],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ae[0]-(this.#Ie[3]+this.#Ie[2]),offsetY:this.#Ae[1]-this.#Ie[2],offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetSidesRightVUp:{type:"sideHUp",x:0,y:this.#Ae[2]-this.#Ie[2],z:this.#Ie[2],width:this.#Ie[2],depth:this.#Ae[1]-2*this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:this.#Ie[2],offsetZ:this.#Ae[2]-(this.#Ie[3]+this.#Ie[2])},offsetSidesLeftVUp:{type:"sideLeftHUp",x:this.#Ae[0],y:this.#Ae[2]-this.#Ie[2],z:this.#Ie[2],width:this.#Ie[2],depth:this.#Ae[1]-2*this.#Ie[2],height:this.#Ie[3],offsetX:this.#Ae[0]-this.#Ie[2],offsetY:this.#Ie[2],offsetZ:this.#Ae[2]-(this.#Ie[3]+this.#Ie[2])},offsetSidesRightHDown:{type:"sideHDown",x:0,y:2*this.#Ie[2],z:this.#Ie[2],width:this.#Ie[2],depth:this.#Ae[1]-2*this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:this.#Ie[2],offsetZ:2*this.#Ie[2]},offsetSidesLeftHDown:{type:"sideLeftHDown",x:this.#Ae[0],y:2*this.#Ie[2],z:this.#Ie[2],width:this.#Ie[2],depth:this.#Ae[1]-2*this.#Ie[2],height:this.#Ie[3],offsetX:this.#Ae[0]-this.#Ie[2],offsetY:this.#Ie[2],offsetZ:2*this.#Ie[2]},offsetFacesBackUpH:{type:"faceHUp",x:0,y:this.#Ae[2]-this.#Ie[2],z:0,width:this.#Ae[0],depth:this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:0,offsetZ:this.#Ae[2]-(this.#Ie[2]+this.#Ie[3])},offsetFacesBackDownH:{type:"faceH",x:0,y:2*this.#Ie[2],z:0,width:this.#Ae[0],depth:this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:0,offsetZ:2*this.#Ie[2]},offsetFacesFrontUpH:{type:"faceHBackUp",x:0,y:this.#Ae[2]-this.#Ie[2],z:this.#Ae[1],width:this.#Ae[0],depth:this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:this.#Ae[1]-this.#Ie[2],offsetZ:this.#Ae[2]-(this.#Ie[2]+this.#Ie[3])},offsetFacesFrontDownH:{type:"faceHBackDown",x:0,y:2*this.#Ie[2],z:this.#Ae[1],width:this.#Ae[0],depth:this.#Ie[2],height:this.#Ie[3],offsetX:0,offsetY:this.#Ae[1]-this.#Ie[2],offsetZ:2*this.#Ie[2]},offsetSidesRightVBack:{type:"sideV",x:0,y:this.#Ie[3]+2*this.#Ie[2],z:0,width:this.#Ie[2],depth:this.#Ie[3],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:0,offsetY:0,offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetSidesRightVFront:{type:"sideRightFrontV",x:0,y:this.#Ie[3]+2*this.#Ie[2],z:this.#Ae[1]-this.#Ie[3],width:this.#Ie[2],depth:this.#Ie[3],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:0,offsetY:this.#Ae[1]-this.#Ie[3],offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetSidesLeftVBack:{type:"sideLeftV",x:this.#Ae[0],y:this.#Ie[3]+2*this.#Ie[2],z:0,width:this.#Ie[2],depth:this.#Ie[3],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ae[0]-this.#Ie[2],offsetY:0,offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetSidesLeftVFront:{type:"sideLeftFrontV",x:this.#Ae[0],y:this.#Ie[3]+2*this.#Ie[2],z:this.#Ae[1]-this.#Ie[3],width:this.#Ie[2],depth:this.#Ie[3],height:this.#Ae[2]-(2*this.#Ie[3]+3*this.#Ie[2]),offsetX:this.#Ae[0]-this.#Ie[2],offsetY:this.#Ae[1]-this.#Ie[3],offsetZ:2*this.#Ie[2]+this.#Ie[3]},offsetTopFrontH:{type:"topFace",x:this.#Ie[3],y:this.#Ae[2],z:0,width:this.#Ae[0]-2*this.#Ie[3],depth:this.#Ie[3],height:this.#Ie[2],offsetX:this.#Ie[3],offsetY:0,offsetZ:this.#Ae[2]-this.#Ie[2]},offsetTopBackH:{type:"topComp",x:this.#Ie[3],y:this.#Ae[2],z:this.#Ae[1],width:this.#Ae[0]-2*this.#Ie[3],depth:this.#Ie[3],height:this.#Ie[2],offsetX:this.#Ie[3],offsetY:this.#Ae[1]-this.#Ie[3],offsetZ:this.#Ae[2]-this.#Ie[2]},offsetTopRight:{type:"topFeet",x:0,y:this.#Ae[2],z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:0,offsetY:0,offsetZ:this.#Ae[2]-this.#Ie[2]},offsetTopLeft:{type:"topLeftFeet",x:this.#Ae[0],y:this.#Ae[2],z:0,width:this.#Ie[3],depth:this.#Ae[1],height:this.#Ie[2],offsetX:this.#Ae[0]-this.#Ie[3],offsetY:0,offsetZ:this.#Ae[2]-this.#Ie[2]}}}#Be(){const t=2*this.#Ie[2],e=this.#Ae[2]-this.#Ie[3]-this.#Ie[2],s=this.#Ae[0]-this.#Ie[3],a=this.#Ae[1]-this.#Ie[2],r=this.#Ae[2]-this.#Ie[3]-this.#Ie[2],i=this.#Ae[1]-this.#Ie[2],n=this.#Ae[0]-this.#Ie[2],o=this.#Ie[3]+this.#Ie[2],c=this.#Ae[0]-this.#Ie[3]-this.#Ie[2],h=this.#Ae[2]-this.#Ie[2],l=this.#Ae[1]-this.#Ie[3];return{feet:[{x:0,y:0,z:0},{x:this.#Ie[3],y:0,z:0},{x:this.#Ie[3],y:this.#Ie[2],z:0},{x:0,y:this.#Ie[2],z:0},{x:0,y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:this.#Ie[2],z:this.#Ae[1]},{x:0,y:this.#Ie[2],z:this.#Ae[1]}],feetR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:this.#Ie[2],z:0},{x:0,y:this.#Ie[2],z:0},{x:0,y:0,z:this.#Ae[1]},{x:s,y:0,z:this.#Ae[1]},{x:s,y:this.#Ie[2],z:this.#Ae[1]},{x:0,y:this.#Ie[2],z:this.#Ae[1]}],feetUp:[{x:0,y:0,z:0},{x:this.#Ie[3],y:0,z:0},{x:this.#Ie[3],y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:t,z:this.#Ae[1]},{x:0,y:t,z:this.#Ae[1]}],feetUpR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Ae[1]},{x:s,y:0,z:this.#Ae[1]},{x:s,y:t,z:this.#Ae[1]},{x:0,y:t,z:this.#Ae[1]}],faceV:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Ie[2]},{x:o,y:0,z:this.#Ie[2]},{x:o,y:e,z:this.#Ie[2]},{x:0,y:e,z:this.#Ie[2]}],faceVR:[{x:0,y:0,z:0},{x:c,y:0,z:0},{x:c,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Ie[2]},{x:c,y:0,z:this.#Ie[2]},{x:c,y:e,z:this.#Ie[2]},{x:0,y:e,z:this.#Ie[2]}],faceVB:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:a},{x:o,y:0,z:a},{x:o,y:e,z:a},{x:0,y:e,z:a}],faceVBR:[{x:0,y:0,z:0},{x:c,y:0,z:0},{x:c,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:a},{x:c,y:0,z:a},{x:c,y:e,z:a},{x:0,y:e,z:a}],faceH:[{x:0,y:0,z:0},{x:this.#Ae[0],y:0,z:0},{x:this.#Ae[0],y:this.#Ie[3]+t,z:0},{x:0,y:this.#Ie[3]+t,z:0},{x:0,y:0,z:this.#Ie[2]},{x:this.#Ae[0],y:0,z:this.#Ie[2]},{x:this.#Ae[0],y:this.#Ie[3]+t,z:this.#Ie[2]},{x:0,y:this.#Ie[3]+t,z:this.#Ie[2]}],faceHUp:[{x:0,y:0,z:0},{x:this.#Ae[0],y:0,z:0},{x:this.#Ae[0],y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:this.#Ie[2]},{x:this.#Ae[0],y:0,z:this.#Ie[2]},{x:this.#Ae[0],y:r,z:this.#Ie[2]},{x:0,y:r,z:this.#Ie[2]}],faceHBackUp:[{x:0,y:0,z:0},{x:this.#Ae[0],y:0,z:0},{x:this.#Ae[0],y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:a},{x:this.#Ae[0],y:0,z:a},{x:this.#Ae[0],y:r,z:a},{x:0,y:r,z:a}],faceHBackDown:[{x:0,y:0,z:0},{x:this.#Ae[0],y:0,z:0},{x:this.#Ae[0],y:this.#Ie[3]+t,z:0},{x:0,y:this.#Ie[3]+t,z:0},{x:0,y:0,z:a},{x:this.#Ae[0],y:0,z:a},{x:this.#Ae[0],y:this.#Ie[3]+t,z:a},{x:0,y:this.#Ie[3]+t,z:a}],sideHUp:[{x:0,y:0,z:0},{x:this.#Ie[2],y:0,z:0},{x:this.#Ie[2],y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:i},{x:this.#Ie[2],y:0,z:i},{x:this.#Ie[2],y:e,z:i},{x:0,y:e,z:i}],sideLeftHUp:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:i},{x:n,y:0,z:i},{x:n,y:e,z:i},{x:0,y:e,z:i}],sideHDown:[{x:0,y:0,z:0},{x:this.#Ie[2],y:0,z:0},{x:this.#Ie[2],y:this.#Ie[3]+t,z:0},{x:0,y:this.#Ie[3]+t,z:0},{x:0,y:0,z:i},{x:this.#Ie[2],y:0,z:i},{x:this.#Ie[2],y:this.#Ie[3]+t,z:i},{x:0,y:this.#Ie[3]+t,z:i}],sideLeftHDown:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:this.#Ie[3]+t,z:0},{x:0,y:this.#Ie[3]+t,z:0},{x:0,y:0,z:i},{x:n,y:0,z:i},{x:n,y:this.#Ie[3]+t,z:i},{x:0,y:this.#Ie[3]+t,z:i}],sideV:[{x:0,y:0,z:0},{x:this.#Ie[2],y:0,z:0},{x:this.#Ie[2],y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:this.#Ie[3]},{x:this.#Ie[2],y:0,z:this.#Ie[3]},{x:this.#Ie[2],y:r,z:this.#Ie[3]},{x:0,y:r,z:this.#Ie[3]}],sideRightFrontV:[{x:0,y:0,z:0},{x:this.#Ie[2],y:0,z:0},{x:this.#Ie[2],y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:this.#Ae[1]},{x:this.#Ie[2],y:0,z:this.#Ae[1]},{x:this.#Ie[2],y:r,z:this.#Ae[1]},{x:0,y:r,z:this.#Ae[1]}],sideLeftV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:this.#Ie[3]},{x:n,y:0,z:this.#Ie[3]},{x:n,y:r,z:this.#Ie[3]},{x:0,y:r,z:this.#Ie[3]}],sideLeftFrontV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:r,z:0},{x:0,y:r,z:0},{x:0,y:0,z:this.#Ae[1]},{x:n,y:0,z:this.#Ae[1]},{x:n,y:r,z:this.#Ae[1]},{x:0,y:r,z:this.#Ae[1]}],topFace:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Ie[3]},{x:s,y:0,z:this.#Ie[3]},{x:s,y:h,z:this.#Ie[3]},{x:0,y:h,z:this.#Ie[3]}],topComp:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:l},{x:s,y:0,z:l},{x:s,y:h,z:l},{x:0,y:h,z:l}],topFeet:[{x:0,y:0,z:0},{x:this.#Ie[3],y:0,z:0},{x:this.#Ie[3],y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:0,z:this.#Ae[1]},{x:this.#Ie[3],y:h,z:this.#Ae[1]},{x:0,y:h,z:this.#Ae[1]}],topLeftFeet:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Ae[1]},{x:s,y:0,z:this.#Ae[1]},{x:s,y:h,z:this.#Ae[1]},{x:0,y:h,z:this.#Ae[1]}]}}#Le(t,e){const{x:s,y:a,z:r}=t,i=structuredClone(e);return Object.entries(i).map(((t,e)=>{switch(e){case 0:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=a),0===t[1].z&&(t[1].z=r),t;case 1:return 0===t[1].y&&(t[1].y=a),0===t[1].z&&(t[1].z=r),t;case 2:return 0===t[1].z&&(t[1].z=r),t;case 3:return 0===t[1].x&&(t[1].x=s),0===t[1].z&&(t[1].z=r),t;case 4:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=a),t;case 5:return 0===t[1].y&&(t[1].y=a),t;case 7:return 0===t[1].x&&(t[1].x=s),t}})),i}async#Fe(t,e,s){const a=new TraceMaker,r=new DesignWalls;let i=!0;return Object.entries(s).map((s=>{const{type:n,offsetX:o,offsetY:c,offsetZ:h,width:l,depth:d,height:u}=s[1],m=e[n],p=this.#Le(s[1],m);a.data={info:t,coordinates:p,name:"frame",show:i},t=a.defineTrace,r.objectData={width:l,depth:d,height:u,info:t,name:"frame",offsetX:o,offsetY:c,offsetZ:h},t=r.designSides,i=!1})),t}async#Pe(){const t=Math.ceil(this.#Ae[0]),e=Math.ceil(this.#Ae[1]),s=Math.ceil(this.#Ae[2]),a=[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:s},{x:t,y:0,z:s},{x:t,y:e,z:s},{x:0,y:e,z:s}];let r=this.#Te(a);const i=this.#Be(),n=this.#Ee();return r=await this.#Fe(r,i,n),r}get setFrame(){return this.#Pe()}}class standardCrateRender{#Yt;#ze;constructor(t,e){this.#Yt=t,this.#ze=e}#Oe(t){return JSON.parse(localStorage.getItem("crating")).map((e=>t.usedMaterials.get(e)))}async#xe(){const{crates:t}=this.#Yt,e=await Promise.resolve(t.map(((t,e)=>{if(e%2==0){const e=this.#Oe(t.at(-1)[0]).find((t=>"Pinewood"===t.at(-1))),s=t.at(-1)[0].finalSize;return new CratesFrame(s,e).setFrame}}),0)),s=Promise.all(e),a=await s;return!!a.length&&{result:a[0],meta:this.#ze}}get composeCrate(){return this.#xe()}}class tubeCrateRender{#Yt;#ze;constructor(t,e){this.#Yt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class GraphicCrates{#Ne;#we;#Yt;constructor(){const{Plotly:t}=globalThis;this.#Yt=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"],this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#Ne=t}async#De(){const t=localStorage.getItem("refNumb"),e=new Worker(new URL("../panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});e.postMessage(t);return await new Promise(((s,a)=>{e.onmessage=e=>{const{data:r}=e;r?.reference===t?s(r):a(e)}}))}#Re(t,e){return this.#we.forEach((s=>{const a=e[s[0]],r=e[s[1]];t.push({x:[a.x,r.x],y:[a.y,r.y],z:[a.z,r.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:0,line:{color:"#00000000"}})})),t}async#Ue(t){let e=structuredClone(n);const s=this.#Yt.map((async a=>{const r=t.get(a);let i;switch(r?a:0){case"tubeCrate":i=new tubeCrateRender(r,e);const t=i.composeCrate;s.push(t.result),e=t.meta,i=null;break;case"largestCrate":i=new largestCrateRender(r,e);const a=i.composeCrate;s.push(a.result),e=a.meta,i=null;break;case"sameSizeCrate":i=new sameSizeCrateRender(r,e);const n=i.composeCrate;s.push(n.result),e=n.meta,i=null;break;case"noCanvasCrate":i=new notCanvasCrateRender(r,e);const o=i.composeCrate;s.push(o.result),e=o.meta,i=null;break;case"standardCrate":i=new standardCrateRender(r,e);const{result:c,meta:h}=await i.composeCrate;return e=h,i=null,c}}));return{result:(await Promise.all(s)).filter((t=>Array.isArray(t))).flat(),alterLayout:e}}async#_e(){const{crates:t}=await this.#De()||!1,e=new Map,s=sessionStorage.getItem("graphics")||!1;if(s){return JSON.parse(s)[sessionStorage.getItem("crate").split("/")[0]]}if(t){Object.entries(t).map((t=>{this.#Yt.includes(t[0])&&e.set(t[0],t[1])}));const s=this.#Ue(e);return globalThis.sessionStorage.setItem("crate",`1/${t.allCrates.length}`),globalThis.sessionStorage.setItem("graphics",JSON.stringify(s.designs)),document.getElementById("layer-count").innerText=`Courrent crate: 1 / ${t.allCrates.length}`,s}return!0}async#Me(){new DesignWalls,new TraceMaker;this.#Re([],[{x:0,y:0,z:0},{x:100,y:0,z:0},{x:100,y:30,z:0},{x:0,y:30,z:0},{x:0,y:0,z:100},{x:100,y:0,z:100},{x:100,y:30,z:100},{x:0,y:30,z:100}]);const{result:t,alterLayout:e}=await this.#_e();this.#Ne.newPlot("plotter-display",t,e,{displaylogo:!1})}get show(){this.#Me()}}async function o(){const t=new GraphicCrates,e=document.querySelectorAll(".toggle__plotter"),s=document.getElementById("layers");let a;for(a of e)"true"===a.ariaHidden?(a.ariaHidden="false",s.ariaHidden="true"):"false"===a.ariaHidden&&(a.ariaHidden="true",s.ariaHidden="false",sessionStorage.getItem("plotter")||(t.show,sessionStorage.setItem("plotter","true")))}function c(t,e,s,a){switch(t){case 409:!async function(t,e,s){if(confirm("This estimate already exist. Would you like to update it?")){const a="/api/v1/update/estimates";try{const r=await fetch(a,{method:"PUT",body:t,headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)));403===r&&c(r,s)}catch(t){alert(`ATTENTION: ${t}`)}}else alert("Not updated!")}(s,a,e);break;case 403:!async function(t){const e={"Content-Type":"application/json; charset=UTF-8"};try{const s=await fetch("/api/v1/shift/tokens",{method:"POST",headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)));h(t),console.log(s)}catch(t){alert(`ATTENTION: ${t}`)}}(e)}}async function h(t){const e=JSON.stringify(t),s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{c(await fetch("/api/v1/newEstimate",{method:"POST",body:e,headers:s}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`))),t,e,s)}catch(t){alert(`ATTENTION: ${t}`)}else!function(t){const e=localStorage,s=e.getItem("offResults"),a=void 0!==s&&JSON.parse(s);a?(a.push(t),e.removeItem("offResults"),e.setItem("offResults",JSON.stringify(a))):e.setItem("offResults",JSON.stringify([t]))}(t.reference)}function l(){const t="Results",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}function d(t,e=!1){const s=localStorage.getItem("refNumb"),a="Results",r=globalThis.indexedDB.open(a),i=globalThis.navigator.onLine;r.onerror=t=>{alert(`ERROR: ${t.target.errorCode}`)},r.onsuccess=async r=>{const n=r.target.result.transaction(a,"readwrite").objectStore(a),o=n.get(t.reference);o.onsuccess=async()=>{void 0===o.result?n.add(t):await Promise.resolve(n.delete(o.result.reference)).then(n.add(t)),u(s,e)},i||function(t,e){const s="off_line_results",a=document.getElementById("input_estimate").value,r=globalThis.indexedDB.open(s);r.onerror=t=>{alert(`ERROR: ${t.target.errorCode}`)},r.onsuccess=async r=>{const i=r.target.result.transaction(s,"readwrite").objectStore(s),n=i.get(t.reference);n.onsuccess=()=>{(void 0===n.result||i.delete(n.result.reference))&&i.add(t),u(a,e)}}}(t)}}async function u(t,e=!1){const s=globalThis.indexedDB.open("Results");s.onerror=t=>{alert(`WARNING: ${t.target.errorCode}`)},s.onsuccess=()=>{const a=s.result.transaction("Results").objectStore("Results").get(t);a.onsuccess=async()=>{const t=localStorage.getItem("refNumb"),s=a.result;globalThis.sessionStorage.setItem(t,JSON.stringify(s)),!1===e&&await async function(t){const{reference:e,list:s,crates:a}=t,r={reference:e,list:s,crates:Object.assign({},a)};await h(r)}(a.result),"crate"===e&&await async function(t){const e={"Content-Type":"application/json; charset=UTF-8"},{reference:s,list:a,crates:r}=t,i={reference:s,list:a,crates:Object.assign({},r)};try{await fetch("/api/v1/update/estimates",{method:"PUT",body:JSON.stringify(i),headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)))}catch(t){alert(`ATTENTION: ${t}`)}finally{return"updated"}}(a.result)}}}async function m(){const t=await z();let e=document.getElementById("count");return t&&t.length>0&&document.getElementById("statusList").setAttribute("content",t.length),e.innerText=t?"Counting: "+t?.length:"Counting 0",e}async function p(){let t;const e=document.getElementById("cub-meter");return t=await z(),t=t?.reduce(((t,e)=>t+e.cubed),0)??0,e.innerText="Cub: "+(1e3*t/1e3).toFixed(3)+"m³",e}async function y(){let t,e,s;return s="Air-Cub: ",e=document.getElementById("cub-air"),t=await z(),t=t?.reduce(((t,e)=>t+e.cAir),0)??0,e.innerText="Air-Cub: "+(1e3*t/1e3).toFixed(3),e}async function f(t=!1){const e={},s=new WeakSet,a=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let r,i=document.cookie.split("=")[1];const n=await async function(){const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",e=await z();let s;return 0===e.length?alert("Oops! Sounds like you do not added any work yet. Please, try again!"):(s=await Promise.resolve(new UnitAdapter(e,t)),s)}(),o=document.querySelector(":root"),c=document.querySelector(".update-materials"),h=document.querySelector(".materials");return(t||confirm("Ready to crate all works?")&&n)&&(!function(){const t=new DocumentFragment,e=new DocumentFragment,s=document.createElement("panel-info"),a=document.createElement("panel-info"),r=document.getElementById("first_pane"),i=document.getElementById("second_pane");for(;r.firstChild;)r.removeChild(r.firstChild);for(;i.firstChild;)i.removeChild(i.firstChild);s.id="first-pane",a.id="second-pane",s.setAttribute("name","pane1"),a.setAttribute("name","pane2"),t.append(s),e.append(a),r.append(t),i.append(e)}(),e.reference=a,r=await z(),e.list=r.map((t=>t.data)),e.crates=n,d(e,t),c.setAttribute("name","materials-used"),h.setAttribute("name","packed-works"),h.setAttribute("content","crates"),("FULL"===i||"PLOTTER"===i||!i)&&(document.getElementById("crate-layers").disabled=!1),o.style.setProperty("--layer-state","block"),sessionStorage.removeItem("crate")),s.add(e),"Crated"}async function g(t=!1){document.getElementById("input_code").value="",document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="";const e=document.getElementById("show-layer"),s=document.querySelectorAll("padding-dialog").length,a=document.querySelector(":root"),r=document.querySelector(".update-materials");let i=document.cookie;i=i.split("=")[1],e&&e.hasChildNodes()&&o(),globalThis.document.getElementById("input_estimate").select(),globalThis.document.getElementById("input_code").select(),"update-materials"!==r.getAttribute("name")&&r.setAttribute("name","update-materials"),m(),p(),y(),s>0&&sessionStorage.setItem("CLOSED","NOW"),a.style.setProperty("--layer-state","none")}async function z(){const t=localStorage,e=[];let s;const a=["doneList","mode","storage","currency","metrica","refNumb","offResults","FETCHED","materials","packing","crating"];return Object.entries(t).map((t=>{!a.includes(t[0])&&e.push(JSON.parse(t[1]))})),e.length>0&&(s=e.map((t=>{const{code:e,x:s,z:a,y:r,packing:i}=t;return new ArtWork(e,s,a,r,i)}))),s||void 0}function x(t){const e=function(t){let e=2;const s=/^[0-9\.0-9]{1,7}$/;for(;--e>=0;)if(!s.test(t[e]))switch(e){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return t}([t[1],t[2],t[3]].map((t=>parseInt(t))));const s=/[^-a-z-A-Z-0-9]/g,a=document.getElementById("input_estimate").value,r=function(){const t=JSON.parse(localStorage.getItem("packing")),e=JSON.parse(localStorage.getItem("materials")),s=[];return!(!t||0===t.length)&&(t.filter((t=>{s.push(e.find((e=>e[0]===t)).flat())})),s)}();let i=0;if(!r)return alert("Please, select some packing material to apply to the artwork."),"material";if(s.test(t[0])||s.test(a))return alert('Found special character NOT allowed on "Work code",\t\tor "Estimate" input. Please, try again!'),!1;for(i in localStorage.key(i))if(t[0]===localStorage.key(i))return alert(`${t[0]} already added to the list. Please, try again`),!1;return function(){const t=localStorage.getItem("refNumb"),e=document.getElementById("input_estimate").value;t&&t!==e&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",e),document.getElementById("input_estimate").value=e):document.getElementById("input_estimate").value=t);localStorage.setItem("refNumb",e)}(),!!Array.isArray(e)&&new ArtWork(t[0],e[0],e[1],e[2],r)}async function w(){const t=document.getElementById("input_estimate").value,e=document.getElementById("input_code").value,s=document.getElementById("input_length").value,a=document.getElementById("input_depth").value,r=document.getElementById("input_height").value;let i;return t?""===(e&&s&&a&&r)?(alert("Oops! Do not forget to fill each field. Please, try again!"),function(){let t=!1;["input_estimate","input_code","input_length","input_depth","input_height"].find((e=>{const s=document.getElementById(e);if(console.log(s.value),!s.value&&!t)return t=!0,s.select()}))}()):(i=x([e,s,a,r]),i&&"material"!==i&&(await async function({code:t}){const e=sessionStorage,s=JSON.parse(e.getItem("codes"));let a;return s?(a=Number.parseInt(s[s.length-1]),a+=1,s.push([a,t]),e.setItem("codes",JSON.stringify(s))):e.setItem("codes",JSON.stringify([[0,t]]))}(i.data),localStorage.setItem(i.data.code,JSON.stringify(i.data)),localStorage.setItem("storage","art-work"),m(),y(),p(),g()),i&&"material"!==i?g():0):alert('Attention! Please, add the "Doc:" reference field!')}function k(){const t=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(t))!function(t){const e=sessionStorage,s=JSON.parse(e.getItem("codes"));let a=0;for(;s[a][1]!==t&&a<=s.length;)a++;s.splice(a,1),e.setItem("codes",JSON.stringify(s))}(t),localStorage.removeItem(t),m(),y(),p();else{if(null===t)return g();alert(`"${t}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),g()}function C(t){const e=document.createDocumentFragment();return t.map((t=>{const s=document.createElement("option");s.textContent=t,e.appendChild(s)})),e}function b(t,e,s,a){const r=JSON.parse(sessionStorage.getItem("currency")),i=1e3,n=Number.parseFloat(s.value)===r[t],o=Number.parseFloat(a.value)===r[e];return t===e?n?a.value:s.value:n&&o?~~(r[t]*r[e]*i)/i:r[t]<r[e]?!0===n?~~(a.value/r[e]*r[t]*i)/i:~~(s.value*r[e]/r[t]*i)/i:!0===o?~~(s.value*r[e]/r[t]*i)/i:~~(a.value/r[e]*r[t]*i)/i}async function S(){const t=await fetch("/api/v1/currencies",{method:"GET"}).then((async t=>await t.json())).catch((t=>alert(`CurrencyError: ${t}!`))),{rates:e}=t.response,s=globalThis.sessionStorage;return e&&s.setItem("currency",JSON.stringify(e))}function v(t,e){const s=JSON.parse(sessionStorage.getItem("currency"));if(!s)return!1;e.value=s[t]}async function A(){await S(),await async function(){const t=JSON.parse(sessionStorage.getItem("currency")),e=document.getElementById("coin1"),s=document.getElementById("coin2"),a=Object.keys(t);if(!t)return"Error";e.appendChild(C(a)),s.appendChild(C(a))}()}function I(t,e,s,a){return"centimeters"===t?function(t,e,s,a){const r=2.54,i=.01,n=T(t,e);if(t===e)return s.value>a.value?s.value:a.value;if(n.checked1)return E(s,a,r,"in");return E(s,a,i,"m")}(t,e,s,a):"inches"===t?function(t,e,s,a){const r=.393,i=.0254,n=T(t,e);if(t===e)return s.value>a.value?s.value:a.value;if(n.checked2)return E(s,a,r,"cm");return E(s,a,i,"m")}(t,e,s,a):function(t,e,s,a){const r=.01,i=.0254,n=T(t,e);if(t===e)return s.value>a.value?s.value:a.value;if(n.checked3)return E(s,a,r,"cm");return E(s,a,i,"in")}(t,e,s,a)}function T(t,e){return{checked1:"centimeters"===t&&"inches"===e,checked2:"inches"===t&&"centimeters"===e,checked3:"meters"===t&&"centimeters"===e}}function E(t,e,s,a){const r=1e3;return"m"!==a?t.value>e.value?~~(t.value/s*r)/r:~~(e.value*s*r)/r:t.value<e.value?~~(e.value/s*r)/r:~~(t.value*s*r)/r}function B(){const t=new DocumentFragment,e=document.createElement("panel-info");return e.setAttribute("name","status"),e.id="statusList",e.class="addedStatus",e.setAttribute("content",0),t.appendChild(e)}if(globalThis.onstorage=()=>{p(),y(),m()},globalThis.onload=async()=>{const t=localStorage.getItem("mode"),e=document.getElementById("status-frame"),s=document.getElementById("statusList");sessionStorage.removeItem("onCrate"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"),s?s.setAttribute("content","reload"):e.append(B()),O(),null===t&&localStorage.setItem("mode","light"),N(),function(){const t=localStorage.getItem("mode"),e=document.body;switch(t){case"light":document.getElementById("light-mode").checked=!0,e.classList.remove("dark-mode"),e.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,e.classList.remove("light-mode"),e.classList.toggle("dark-mode")}}(),async function(){const t=new DocumentFragment,e=new DocumentFragment,s=document.createElement("pack-up"),a=document.createElement("pack-down"),r=document.getElementById("contents1"),i=document.getElementById("contents2");s.setAttribute("name","select-materials"),s.className="materials",s.ariaHidden="false",a.setAttribute("name","update-materials"),a.setAttribute("content","0"),a.className="update-materials",t.appendChild(s),e.appendChild(a),r.appendChild(t),i.appendChild(e)}()},!localStorage.getItem("metrica")){const t=document.getElementById("cm").value;localStorage.setItem("metrica",t)}function L(){const t=localStorage.getItem("metrica"),e=confirm("Attention! You are going to change the measurement of the works.");t&&void 0!==t?e&&("cm - centimeters"===t?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")):localStorage.setItem("metrica",document.getElementById("cm").value),N()}const F=()=>{O(),f();const t=document.querySelector(".result");sessionStorage.getItem("codes")&&(t&&"true"===t.ariaHidden&&o(),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};const P=()=>{const t=document.querySelector(".result"),e=document.getElementById("layers"),s=document.querySelector(".plotter__menu"),a=document.getElementById("statusList"),r=document.getElementById("status-frame"),i=document.getElementById("first_pane"),n=document.getElementById("second_pane"),o=document.querySelector(".side-menu");confirm("Do you really want to delete the whole list?")&&(!function(){const{mode:t,metrica:e,materials:s}=localStorage;localStorage.clear(),sessionStorage.clear(),localStorage.setItem("mode",t),localStorage.setItem("metrica",e),localStorage.setItem("materials",s),m(),p(),y()}(),g(!0),globalThis.document.getElementById("input_estimate").value="",globalThis.document.getElementById("input_estimate").select(),openCloseDisplay([t,e,s]),a.setAttribute("content",void 0),r.removeChild(document.getElementById("statusList")),i.firstChild&&i.removeChild(document.getElementById("first-pane")),n.firstChild&&n.removeChild(document.getElementById("second-pane")),r.append(B()),o.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),document.querySelector(".materials").setAttribute("name","select-materials"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"))};function O(){const t=localStorage.getItem("refNumb");let e=document.cookie;return e=e.split("=")[1],t&&(document.getElementById("input_estimate").value=t),l(),function(){const t="Materials",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"materials"}),s.createIndex("materials","materials",{unique:!0})}}(),"OFF"!==e&&"FULL"!==e||function(){const t="off_line_results",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}(),p()&&y()&&m()}function N(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function D({works:t}){let e=[];const s=Array.isArray(t[0][0])?t[0]:t;return s?.map((t=>{let s;if(Array.isArray(t))return e.push(t);for(s in t)e.push(s),1===t[s].length?e.push(t[s][0]):Array.isArray(t[0])?t[s][0].map((t=>e.push(t))):t[s].map((t=>e.push(t)))})),e}function R(t){if(!t)return"There is no crates. Please, try again!";const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",s=t.map((t=>{let s;return"string"==typeof t?`LAYER layer ${t?.at(-1)}:`:t.length>=5?(s=`CODE: ${t[0]} - ${t[1]} x ${t[2]} x ${t[3]} - ${e}`,s):4===t.length?(s=`CRATE: ${t[0]} x ${t[1]} x ${t[2]} - ${e}`,s):void 0})),a=function(t,e){for(;e--;)t=(t=(t=(t=(t=t.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return t=(t=t.replace("[","")).replace("]","")}(JSON.stringify(s),s.length);navigator.clipboard.writeText(a)}function U(){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),e=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(e))return alert('Please, press the "Crate" button if already added works.');t.postMessage(e),t.onmessage=t=>{(Array.isArray(t.data.crates)||t.data.hasOwnProperty("crates"))&&function({crates:t}){sessionStorage.setItem("copy1","done!"),R(t.allCrates)}(t.data)}}function _(){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),e=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(e))return alert('Please, press the "Crate" button if already added works.');t.postMessage(e),t.onmessage=t=>function({crates:t}){let e,s,a=[];for(e in t)t[e].hasOwnProperty("crates")&&t[e].crates.map(((t,e)=>{switch(e%2){case 0:a.push(t);break;case 1:s=D(t),s.map((t=>a.push(t))),s=null}}),0);return sessionStorage.setItem("copy2","done!"),R(a)}(t.data)}function M(t){localStorage.setItem("mode",t),function(t){const e=document.body.classList;e.remove("light-mode"),e.remove("dark-mode"),"dark"===t?e.add("dark-mode"):e.add("light-mode")}(t)}function q(t){const e=t.target.closest(".accordion-panel");if("body-app"===t.target.id)return H();e&&function(t){const e=t.parentElement.querySelectorAll("button"),s=t.parentElement.querySelectorAll(".menu__input");e.forEach((t=>{t.setAttribute("aria-expanded",!1)})),s.forEach((t=>{t.setAttribute("aria-hidden",!0)})),function(t){t.querySelector("button").setAttribute("aria-expanded",!0),t.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(t)}(e)}function H(){const t=document.querySelector(".accordion-panel");let e,s,a;for(e in t)s=t.parentElement.querySelectorAll("button"),a=t.parentElement.querySelectorAll(".menu__input"),s.forEach((t=>{t.setAttribute("aria-expanded",!1)})),a.forEach((t=>{t.setAttribute("aria-hidden",!0)}))}function $(){const t=document.getElementById("statusList"),e=document.getElementById("status-frame"),s=document.querySelector(".side-menu");e.removeChild(document.getElementById("statusList")),e.append(B()),t.setAttribute("content","FETCHED"),s.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),p(),y(),m()}async function W(t){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),s=await new Promise(((s,a)=>{e.postMessage(t),e.onmessage=t=>{void 0!==t?s(t.data):a(void 0)}}));return!!s&&(document.getElementById("input_estimate").value=t,sessionStorage.setItem("FETCHED",JSON.stringify(s)),$(),X([s]),"IDB data Found.")}async function X(t){try{if(t?.hasOwnProperty("crates")){document.getElementById("input_estimate").value=t.reference;const{materials:e}=localStorage;return sessionStorage.clear(),sessionStorage.setItem("FETCHED",JSON.stringify(t,null)),localStorage.setItem("materials",e),$()}throw new TypeError("Data not found!")}catch(t){return t}}async function J(t){const e=`/api/v1/estimates/${t}`,s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){return await fetch(e,{method:"GET",headers:s}).then((async t=>await t.json())).then(X).catch((t=>alert(`Search ERROR! \n ${t}`)))}}async function j(){const t=document.getElementById("estimate_getter").value,e=(s=document.getElementById("input_estimate").value,async t=>{s&&s!==t&&g(!0)});var s;if(!function(t){switch(/[^-a-z-A-Z-0-9]/g.test(t)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(t)){const s=[W(t),J(t)];await Promise.all(s).then((async s=>{s[0]||0!==s[1]?.length?await Promise.resolve(e(t)).then((async()=>{if(s[1]?.length>0){d({reference:s[1][0].reference_id,crates:s[1][0].crates.crates,list:s[1][0].works.list},!0)}else f(!0)})):alert("Document not found! Please, try again.")}))}}function Z(){globalThis.navigator.serviceWorker.ready.then((async t=>{await caches.delete("craterCache_v1"),await caches.delete("status_V1"),await caches.delete("pane1_v1"),await caches.delete("pane2_v1"),await t.unregister()}))}async function Y(){confirm("Are you sure to logout?")&&await fetch("/api/v1/logout",{method:"GET"}).then(Z).then((t=>globalThis.location.assign(t.url))).catch((async()=>{await Promise.resolve(Z).then(globalThis.location.replace("https://ottocratesolver.com/login"))}))}globalThis.onkeydown=t=>{const e="Enter"===t.key&&!0===t.ctrlKey,s=!0===t.ctrlKey&&!0===t.altKey&&"c"===t.key,a="Escape"===t.key;e&&F(),s&&o(),a&&H(),t.stopImmediatePropagation()},globalThis.onafterprint=()=>{const{shadowRoot:t}=document.querySelector(".update-materials");[...t.querySelectorAll("[aria-hidden]")].map((t=>t.ariaHidden="false"))},globalThis.onbeforeprint=()=>{const{shadowRoot:t}=document.querySelector(".update-materials");[...t.querySelectorAll("[aria-hidden]")].map((t=>t.ariaHidden="false"))},globalThis.document.getElementById("main-app").addEventListener("click",(t=>{const e=document.querySelector(".materials"),s=document.querySelector(".update-materials"),a=sessionStorage.getItem("crate");let r=a?+a.split("/")[0]:0;const i=a?+a.split("/")[1]:0,n=new GraphicCrates,c=document.getElementById("layer-count");let{id:h,className:l,attributes:d}=t.target;{const{shadowRoot:t}=e,s=t.querySelector(".upPane");s?.addEventListener("click",(t=>{const{id:e,className:a,tagName:r}=t.target,i=new CustomEvent("open-crate",{bubbles:!0,composed:!0,detail:{id:e,className:a,tagName:r}});s.dispatchEvent(i)}),!0)}{const{shadowRoot:t}=s,e=t.querySelector(".data-update");e?.addEventListener("click",(t=>{const{id:s,className:a}=t.target,r=new CustomEvent("update-materials-info",{bubbles:!0,composed:!0,detail:{id:s,className:a}});e.dispatchEvent(r),t.stopImmediatePropagation()}))}switch("crates"===d.content&&(l="crates"),h||(h=l)){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":q(t);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:t}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${t}`),globalThis.deferredPrompt=null}();break;case"add-btn":w();break;case"remove-btn":k();break;case"clear-btn":P();break;case"crate-btn":case"crate_btn":F();break;case"copy-pane1":U();break;case"copy-pane2":_();break;case"logout":case"logout-btn":Y();break;case"exchange-header":A(),async function(){const t=sessionStorage.getItem("currency"),e=JSON.parse(sessionStorage.getItem("coin1")),s=JSON.parse(sessionStorage.getItem("coin2")),a=document.getElementById("coin1"),r=document.getElementById("coin2");null!==e&&(a.value=e),null!==s&&(r.value=s),null===t&&await S()}(),q(t);break;case"ex-btn":case"exchange-btn":A(),q(t);break;case"fetch-btn":j();break;case"crate-layers":case"layer-crate":o();break;case"previous":case"layer-prev":r>1&&(r-=1,sessionStorage.setItem("crate",`${r}/${i}`),c.innerText=`Current crate: ${r} / ${i}`,n.show);break;case"next":case"layer-next":r<i&&(r+=1,sessionStorage.setItem("crate",`${r}/${i}`),c.innerText=`Current crate: ${r} / ${i}`,n.show);break;case"settings-content":"update-materials"!==l&&"new-material"!==l&&e.setAttribute("content","settings-content");break;case"packages":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","packages");break;case"select-materials":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","select-materials");break;case"materials":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","confirm-save");break;case"report":case"report":e.setAttribute("name","packages");break;case"pack-opts":case"works-packed":e.setAttribute("name","works-packed");break;case"reset-sizes":e.setAttribute("name","reset-sizes");break;case"reset-szs":e.setAttribute("name","reset-szs");break;case"adding-material":e.setAttribute("name","adding-material");break;case"add__new__field":e.setAttribute("name","add__new__field");break;case"cancel-remove":e.setAttribute("name","cancel-remove");break;case"new-material":e.setAttribute("name","new-material");break;case"confirm-save":e.setAttribute("name","confirm-save");break;case"printer-icon":case"printer-btn":case"printer-svg":case"printer":globalThis.print()}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(t=>{switch(t.preventDefault(),t.target.id){case"input_estimate":l();break;case"in":case"cm":L();break;case"dark-mode":M("dark");break;case"light-mode":M("light");break;case"coin1":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(t)),v(t,e)}();break;case"coin2":!function(){const t=document.getElementById("coin2").value,e=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(t)),v(t,e)}();break;case"units1":!function(){const t=globalThis.document.getElementById("input-unit1"),e=globalThis.document.getElementById("input-unit2");t.value=0,e.value=0}();break;case"units2":!function(){const t=globalThis.document.getElementById("input-unit1"),e=globalThis.document.getElementById("input-unit2");t.value=0,e.value=0}();break;case"selected-crate":o()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(t=>{let{id:e,className:s}=t.target;switch(e||(e=s)){case"coin1-input":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),a=document.getElementById("coin2-input");v(e,a),a.value=`$ ${b(t,e,s,a)}`}();break;case"coin2-input":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),a=document.getElementById("coin2-input");v(t,s),s.value=`$ ${b(t,e,s,a)}`}();break;case"input-unit1":!function(){const t=globalThis.document.getElementById("units1").value,e=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),a=globalThis.document.getElementById("input-unit2");a.value=0,a.value=I(t,e,s,a)}();break;case"input-unit2":!function(){const t=globalThis.document.getElementById("units1").value,e=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),a=globalThis.document.getElementById("input-unit2");s.value=0,s.value=I(t,e,s,a)}()}}),!0),globalThis.onsubmit=t=>{t.preventDefault()},globalThis.document.getElementById("main-app").addEventListener("open-crate",(t=>{const{id:e,className:s,tagName:a}=t.detail,r=document.querySelector(".materials");"A"===a&&r.setAttribute("content",`${e}-${s}`)}),!0),globalThis.document.getElementById("main-app").addEventListener("update-materials-info",(t=>{const{id:e}=t.detail,s=document.querySelector(".update-materials");t.stopImmediatePropagation(),"update-info"===e&&s.setAttribute("name","update")}),!0),globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(t=>{"Enter"===t.key&&j()})),globalThis.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),console.log("👍","beforeinstallprompt",t),globalThis.deferredPrompt=t}));
class Converter{#t;constructor(...t){this.#t=[...t]}get cmConvert(){return s.call(this.#t)}get inConvert(){return e.call(this.#t)}}function t(){const t=this.filter((t=>Number(t)?t:"string"==typeof t&&t?+t.trim():void 0));try{if(!t||t.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(t){return t}return t}function e(){const e=t.call(this);if(Array.isArray(e)){const t=2.54;return this.map((e=>+(e/t).toFixed(3)))}return e}function s(){const e=t.call(this);if(Array.isArray(e)){const t=2.54;return this.map((e=>+(e*t).toFixed(0)))}return e}class RegexChecker{#t;constructor(...t){this.#t=[...t]}get regexSizes(){return i.call(this.#t)}}function i(){try{const t=this.map((t=>{const e=/[0-9]{1,3}/.test(t);return!Number.isNaN(t)&&e})),e="Not a valid entry to RegexChecker!";if(t.includes(!1))throw new TypeError(e)}catch(t){return console.error(t),t}}class CubCalc{#e;#s;#i;constructor(t,e,s){this.#e=+t,this.#s=+e,this.#i=+s}get cubCalcAir(){return function(t,e,s){const i=new RegexChecker(t,e,s).regexSizes;if("object"==typeof i)return i;return+(t*e*s/6e3).toFixed(3)}(this.#e,this.#s,this.#i)}get cubArea(){return function(t,e,s){const i=new RegexChecker(t,e,s).regexSizes;if("object"==typeof i)return i;return+(t*e*s/1e6).toFixed(3)}(this.#e,this.#s,this.#i)}}class Hexaedro{constructor(t,e,s){try{if(!t||!e||!s)throw new TypeError("Please, provide a correct x, z or y value.")}catch(t){return t}this.x=+t,this.z=+e,this.y=+s}}class ArtWork extends Hexaedro{coordinates;packMaterials;code;#e;#s;#i;constructor(t,e,s,i,a){super(e,s,i);try{if(!t||t.trim()<=0){const e=`Please, provide a valid code. Current: ${t}`;throw new TypeError(e)}}catch(t){return t}this.code=""+t,this.#e=+e,this.#s=+s,this.#i=+i,this.packMaterials=a}#a(){const t={x:structuredClone(this.#e),z:structuredClone(this.#s),y:structuredClone(this.#i)};return this.packMaterials&&this.packMaterials.length&&this.packMaterials.map((e=>{t.x+=2*e[2],t.z+=2*e[2],t.y+=2*e[2]})),[this.code,t.x,t.z,t.y]}#r(t,e){return t.map(((t,s)=>{const i=[this.packMaterials[s][0]];return i.push(+(100*e/t).toFixed(0)),i}),0)}#n(t){return t.map(((t,e)=>"Roll"===this.packMaterials[e][5]?[t[0],+(t[1]/100).toFixed(2)]:[t[0],Math.ceil(t[1]/100)]),0)}#o(t){return t.map((t=>1-+(t[1]/100).toFixed(3)%1))}#c(){const t=this.packingDemanded,e=this.packMaterials.map((t=>t[1]*t[3]/100)),s=this.#r(e,t),i=e.map(((e,i)=>[s[i][0],e>t]),0),a=this.#o(s),r=this.packMaterials.map((t=>t[4])),n=this.packMaterials.map(((t,s)=>[t[5],e[s],t[0]]),0),o=r.map(((t,e)=>{const i=+(s[e][1]/100*t).toFixed(2);return[s[e][0],i,+t]}),0),c=this.#n(s,a);return{demand:t,percent:s,reuse:i,residual:a,types:n,cost:o,quantity:c}}get arr(){return[this.code,this.#e,this.#s,this.#i]}get cAir(){return new CubCalc(this.#e,this.#s,this.#i).cubCalcAir}get cubed(){return new CubCalc(this.#e,this.#s,this.#i).cubArea}get autoConvert(){let{x:t,z:e,y:s}=this;const i=new Converter(t,e,s).cmConvert;return t=i[0],e=i[1],s=i[2],[this.code,t,e,s]}get data(){return{code:this.code,x:this.#e,z:this.#s,y:this.#i,packing:this.packMaterials}}get packingDemanded(){const{x:t,z:e,y:s}=this;return+(2*(t*s+t*e+s*e)/100).toFixed(5)}get cratePosition(){return this.coordinates}get packedSized(){return this.#a()}get packInfo(){return this.#c()}set defCoordinate(t){this.coordinates=t}}class ArrangerLargestCanvas{#h;constructor(t){return this.#h=t,this.#l()}#d(){const t=this.filter((t=>t.x>=213&&t.y>=213?t:0));return!!t.length&&t}#l(){const{sorted:t}=this.#h,e=this.#d.call(t);return e&&e.map((t=>{t&&this.#h.sorted.splice(this.#h.sorted.indexOf(t),1)})),e&&(this.#h.largest=e),this.#h}}class ArrangerNoCanvas{#u;constructor(t){return this.#u=t,this.#p()}#m(t){t.map((t=>{this.sorted.splice(this.sorted.indexOf(t),1)}))}#y(){let{sorted:t,sameSize:e}=this.#u;let s=t.filter((t=>t.z>15)),i=e.filter((t=>t.z>15)),a=[];return s.map((t=>a.push(t))),this.#m.call(this.#u,s),i.map((t=>a.push(t))),this.#m.call(this.#u,i),t=null,e=null,s=null,i=null,this.#u.noCanvas=a,this.#u}#p(){return this.#y()}}class ArrangerSameSize{#h;constructor({sorted:t}){return this.#h=t,this.#f()}#g(){const t=[];return this.map((e=>{let s,i=0;if(e.z<=10)for(i in this)a=this[i],r=e,s=a.cubed<=r.cubed&&a.code!==r.code,!t.includes(this[i])&&s&&t.push(this[i]);var a,r})),t}#z(t,e){const s=e.x,i=e.y,a=e.cubed;return t.x===s&&t.y===i&&t.cubed<=a}#x(t){const e=[];return t.map((s=>{let i=[],a=0;for(a in t)this.#z(t[a],s)&&!e.includes(t[a])&&i.push(t[a]);i.length>=4&&i.map((t=>{e.push(t)})),i=null})),e}#f(){const t=this.#g.call(this.#h),e=this.#x(t);return e.map((t=>{this.#h.splice(this.#h.indexOf(t),1)})),{sorted:this.#h,sameSize:e}}}class ArrangerStarter{#h;constructor(t){return this.#h=t,this.#w()}#k(){return this.#h.map((t=>{const e=t.arr;return e.push(t.cubed),e}))}#C(t,e){if(t.length<=1)return t;const s=[],i=t.splice(0,1),a=[];return t.map((t=>{t[e]<=i[0][e]?s.push(t):a.push(t)})),this.#C(s,e).concat(i,this.#C(a,e))}#w(){const t=this.#k(),e=this.#C(t,4),s=[];return e.map((t=>{this.#h.find((e=>t[0]===e.code?s.push(e):0))})),{sorted:s}}}class ArrangerTube{#h;constructor(t){return this.#h=t,this.#b()}#b(){const{noCanvas:t}=this.#h,e=t.filter((t=>{const e=t.z<35&&t.y<35,s=t.z===t.y;if(e&&s&&t.x!==t.y&&s)return t}));return e.map((t=>{this.#h.noCanvas.splice(this.#h.noCanvas.indexOf(t),1)})),this.#h.tubes=e,this.#h}}class Arranger{#S;constructor(t){this.#S=t;const e=this.#v();return e&&"TypeError"===e.constructor.name?e:(this.#A(),Object.assign(Arranger,{list:this.#S}))}#A(){this.#I(),this.#f(),this.#T(),this.#E(),this.#B()}#v(){try{const t=t=>0===t.length||!t;if(!Array.isArray(this.#S)||t(this.#S)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#S.map((t=>"ArtWork"===t.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(t){return t}}#I(){this.#S=new ArrangerStarter(this.#S)}#f(){this.#S=new ArrangerSameSize(this.#S)}#T(){this.#S=new ArrangerNoCanvas(this.#S)}#E(){this.#S=new ArrangerLargestCanvas(this.#S)}#B(){this.#S=new ArrangerTube(this.#S)}}class CrateMaker{#F;#L;constructor(t,e=!1){if(!t)return!1;this.#F=t,this.#L=e}#P(t){const e=["Pinewood","Plywood"],s=t.filter((t=>e.includes(t[5]))),i=t.filter((t=>"Foam Sheet"===t[5]));let a=0,r=0,n=0,o=0,c=0;return s.map((t=>{a+=+t[2],r+=+t[2]})),i&&i.length&&i.map((t=>{if(this.#F>1&&t[2]<=2.5)return this.#L&&(this.#L=!1,n+=+t[2]),o=t[2],r+=+t[2]*(this.#F-1);a+=+t[2],r+=+t[2],n+=+t[2],t[2]>2.5&&(c=2*t[2])})),a*=2,r*=2,n*=2,{x:a,z:r,y:n,div:o,pad:c}}#O(){let{materials:t,crating:e}=localStorage;const s=[];return t=JSON.parse(t),e=JSON.parse(e),e.map((e=>{const i=t.find((t=>t[0]===e));i&&s.push(i)})),s.length?this.#P(s):{x:0,z:0,y:0}}get outSizes(){return this.#O()}}class WorksCoordinates{#N;#D;#R;#U;constructor(t=!1){t&&(this.#D=t,this.#U=this.#_())}#_(){const t={emptyArea:[],artLocation:new Map,baseSize:this.#D,usedMaterials:new Map,innerSize:[],finalSize:[],layers:[],get reset(){this.emptyArea=[[0,0,this.baseSize[0],this.baseSize[2]]]},get fillGaps(){const t=[];return this.layers.map((e=>{const{vacuum:s,works:i}=e,a=((t,e=0)=>(t.map((t=>!e||t.work[2]>e[1]?e=[t.work[0],t.work[2]]:0)),e))(i),{total:r,sizes:n}=((t,e=0,s=[])=>(t.map((t=>{if(t[0]===t[2]&&t[1]===t[3])return;let i=t[2]-t[0],a=t[3]-t[1];!i&&a&&(i=t[0]),i&&!a&&(a=t[1]),s.push([+i.toFixed(2),+a.toFixed(2)]),e+=+(i*a).toFixed(3)})),{total:e,sizes:s}))(s);t.push({highestZ:a,total:r,sizes:n})})),t},set defineLayer(t){const e=structuredClone(this.emptyArea),s=structuredClone(t[1]);this.layers.push({vacuum:e,works:s}),this.reset},get fillMaterials(){const t=JSON.parse(localStorage.getItem("materials")),e=JSON.parse(localStorage.getItem("crating"));t.map((t=>e.includes(t[0])?this.usedMaterials.set(t[0],t):0))}};return t.reset,t.fillMaterials,t}#M(t,e,{x:s,y:i,flip:a}){const{emptyArea:r}=this.#U,n=r[0][2],o=r[0][3];if(n===s&&o===i||n===i&&o===s)return;if(r.length>1){const c=r[0][0]===e[0];c&&!a?r[0][0]+=s:r[0][1]+=i;const h=r[0][0],l=r[0][1],d=h+s===n?n:0,u=l+i===o?o:0,p=c?[s+h,u,n,o]:[h,u,n,o],m=c?[d,i+l,n,o]:[d,l,n,o];return r.splice(t,1),c&&p[0]<n&&r.push(p),void(!c&&m[1]<o&&r.push(m))}const c=!(s===n)&&[s,0,n,o],h=!(i===o)&&[0,i,n,o];c&&r.push(c),h&&r.push(h)}#W(t,e){const s=e[0]===e[2]&&e[1]===e[3],i=e[2],a=e[3],r=t[1]+e[0]<=i&&e[0]<i,n=t[3]+e[1]<=a&&e[1]<a,o=t[3]+e[0]<=i&&e[0]<i,c=t[1]+e[1]<=a&&e[1]<a;return{check01:!s&&(r&&n),check02:!s&&(o&&c)}}#X({emptyArea:t,found:e,art:s,ind:i,pos:a}){t.length>1&&0===a&&a++;const r=t[a],n=t[0][0]===t[0][2]&&t[0][1]===t[0][3];if(e||!r||n)return e;const{check01:o,check02:c}=this.#W(s,r),h=t[0][2],l=t[0][3],d=s[1]===h&&s[3]===l||s[3]===h&&s[1]===l;let u,p,m=!1;return o?(e=!0,u=s[1],p=s[3],this.#R[i].defCoordinate={x:t[a][0],z:s[2],y:t[a][1]},0===a&&(t[0][0]=(u||p>0)&&!d?u:h,t[0][1]=(u>0||p)&&!d?p:l)):c&&(e=!0,u=s[3],p=s[1],s.push('<i class="nf nf-oct-sync"></i>'),m=!0,this.#R[i].defCoordinate={x:t[a][1],z:s[2],y:t[a][0]},0===a&&(t[0][1]=(u||p>0)&&!d?t[0][2]-s[3]:l,t[0][0]=(u>0||p)&&!d?t[0][3]-s[1]:h)),e?this.#M(a,r,{x:u,y:p,flip:m}):a++,this.#X({emptyArea:t,found:e,art:s,ind:i,pos:a})}#q(t,e,s){const i=void 0===t.emptyArea[0]&&void 0===t.emptyArea[1],a=t.emptyArea[0][0]===t.emptyArea[0][2],r=t.emptyArea[0][1]===t.emptyArea[0][3];if(i||!e[s]||a&&r)return t;let n;const{emptyArea:o,feat:c}=t,h=e[s],l=this.#R.findIndex((t=>t.code===h[0])),d={emptyArea:o,found:!1,art:h,ind:l,pos:0};return this.#X(d)&&(n=e.splice(s,1).flat(),c.push({work:n,list:s,raw:l})),this.#q(t,e,s-1)}get bluePrintCoordinates(){return this.#U}get fillLayer(){const{info:t,list:e,len:s,raw:i}=this.#N;return this.#R=i,!!this.#N&&this.#q(t,e,s)}set fillPreparing(t){this.#N=t}}class CraterPythagoras{#h;#l;#R;#U;constructor(t){return t&&0!==t.length?(this.#R=t,this.#l=t.map((t=>t.arr)),this.#h=structuredClone(this.#l),this.#Z()):{largest:!1}}#H(t,e,s,i=1){if(!t.length&&!s)return this.#U;const{emptyArea:a}=this.#U,r={emptyArea:a,feat:[]},n=t.length-1;let o;return e.fillPreparing={info:r,list:t,len:n,raw:this.#R},o=e.fillLayer,this.#U.defineLayer=[i,o.feat],this.#H(t,e,s-1,i+1)}#Y(t,e,s,i){const a=new WorksCoordinates(t);this.#U=a.bluePrintCoordinates,this.#H(this.#h,a,e),this.#R.map((t=>this.#U.artLocation.set(t.code,t))),this.#U.innerSize=[t[0]+i,s+i,t[2]+i]}#$(t,e){const s=new CrateMaker(e).outSizes,i=+(t[0]+s.x).toFixed(3),a=+(t[1]+s.z).toFixed(3),r=+(t[2]+s.y).toFixed(3),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),c=r%1>0?r:r.toFixed(0),h=s.div&&e.length>1?t[1]+s.div*(e-1):t[1];return this.#Y(t,e,h,s.pad),[+n,+o,+c]}#j(t){const e=+(Math.cos(Math.asin(240/t[2]))*t[2]).toFixed(3);return this.#U.finalSize=[t[0],e,240],[...this.#U.finalSize]}#J(t){let e,s=0,i=0,a=0;return t.map((t=>{s<t[1]&&(s=t[1]),i<t[2]&&(i=t[2]),a<t[3]&&(a=t[3])})),e=s>=a?this.#$([s,i,a],t.length):this.#$([a,i,s],t.length),e}#V(t){let e;return e=this.#J(t),t.map((t=>{t[1]<=e[2]&&t[3]>e[2]&&t.push('<i class="nf nf-oct-sync"></i>')})),this.#j(e)}#G(){let t,e=[];for(;this.#l.length;)t=this.#l.splice(0,3),e.push(this.#V(t)),e.push({works:t});return e[0].push(this.#U),e}#Z(){const t=this.#G();return this.largest={crates:t}}}class CraterStandard{#R;#h;#K;#Q;#U;#tt;#F=0;constructor(t,e,s,i){return t&&0!==t.length?(this.#R=t,this.#h=t.map((t=>t.packedSized)),this.#K=s??4,this.#Q=e,this.#et([],i)):{standard:!1}}#et(t,e){switch(e){case!1:return t=this.#st(),this.#Q?{crates:t,backUp:JSON.parse(JSON.stringify(t))}:{crates:t};case!0:return t=this.#it([],1,structuredClone(this.#h)),this.#Q?{crates:t,backUp:JSON.parse(JSON.stringify(t))}:{crates:t}}}#at(t,e){let s,i,a,r,n,o=0,c=0;for(n in t)s=t[n][0]>e[n][0],i=t[n][0]!==e[n][0],a=t[n][2]>e[n][2],r=t[n][2]!==e[n][2],s&&i?o+=1:i&&(c+=1),a&&r?o+=1:r&&(c+=1);return{opt1:o,opt2:c}}#rt(t,e){let s=0,i=0,a=0,r=0,n=2;return t.map((t=>t[0]<=300&&t[2]<=160?s++:a++)),e.map((t=>t[0]<=300&&t[2]<=160?i++:r++)),a===r?n=s<=i?1:2:a<r&&(n=s>=i?1:2),{bestArrange:n}}#st(){const t={opt1:this.#it([],0,structuredClone(this.#h)),opt2:this.#it([],1,structuredClone(this.#h))},e=[],s=[],i=new WeakSet;Object.entries(t).map((t=>{"opt1"===t[0]?t[1].map(((t,s)=>s%2==0?e.push(t):0),0):t[1].map(((t,e)=>e%2==0?s.push(t):0),0)}));let a,r;return a=e.length===s.length?this.#at(e,s):this.#rt(e,s),r=a.hasOwnProperty("bestArrange")?a.bestArrange:a.opt1<=a.opt2?1:2,i.add(a),1===r?t.opt1:t.opt2}#nt(t,e){if(t.length<=1)return t;const s=[],i=t.splice(0,1),a=[];return t.map((t=>{t[e]<=i[0][e]?s.push(t):a.push(t)})),this.#nt(s,e).concat(i,this.#nt(a,e))}#ot(t,e){let s=0,i=0,a=0;const r=new CrateMaker(this.#F).outSizes;if(this.#F>1)for(i in e)Object.entries(e[i]).map((t=>{t.includes("status")||(t[1].map((t=>{t[2]>a&&(a=t[2])})),s+=a,a=0)}));a=r.div*(this.#F-1)+s,this.#U.innerSize=[t[0]+r.pad,a+r.pad,t[2]+r.pad],r.x+=t[0],r.z+=s,r.y+=t[2],r.y+=8;const n=r.x%1>0?r.x.toFixed(3):r.x.toFixed(0),o=r.z%1>0?r.z.toFixed(3):r.z.toFixed(0),c=r.y%1>0?r.y.toFixed(3):r.y.toFixed(0);return this.#R.map((t=>this.#U.artLocation.set(t.code,t))),this.#U.finalSize=[+n,+o,+c],[+n,+o,+c,structuredClone(this.#U)]}#ct(t,e){switch(this){case 1:Array.isArray(e[0])?t.push({layer1:e}):t.push({layer1:[e]});break;case 2:Array.isArray(e[0])?t.push({layer2:e}):t.push({layer2:[e]});break;case 3:Array.isArray(e[0])?t.push({layer3:e}):t.push({layer3:[e]});break;case 4:Array.isArray(e[0])?t.push({layer4:e}):t.push({layer4:[e]});break;case 5:Array.isArray(e[0])?t.push({layer5:e}):t.push({layer5:[e]});break;default:return}return t}#ht(t,e){const s=new WorksCoordinates(t);this.#U=s.bluePrintCoordinates;const i=[];let a,r,n,o=[],c=0;try{for(;c++<this.#K&&e.length;){const{emptyArea:t}=this.#U;a={emptyArea:t,feat:[]},s.fillPreparing={info:a,list:e,len:e.length-1,raw:this.#R},r=s.fillLayer,n=structuredClone(r),o=n.feat.map((t=>{const e=this.#R.find((e=>e.code===t.work[0])).arr,s=structuredClone(t.work);return s[1]=e[1],s[2]=e[2],s[3]=e[3],s})),this.#ct.call(c,i,o),this.#U.defineLayer=[c,r.feat],o=null,r=null,a=null,o=[]}}catch(t){console.error(t)}return this.#F=c-1,delete this.#U.defineLayer,delete this.#U.reset,{crate:i,measure:t,list:e}}#lt(t,e,s){if(s<0)return t.x<t.y&&([t.x,t.y]=[t.y,t.x]),t;const i=e.length>5;return t.x=t.x<e[s][1]?e[s][1]:t.x,t.x=i&&t.x>=e[s][1]&&t.x+e[s][1]<=this.#tt?t.x+e[s][1]:t.x,t.z=e[s][2]>t.z?e[s][2]:t.z,t.y=e[s][3]>t.y?e[s][3]:t.y,t.y=i&&t.y>=e[s][3]&&t.y+e[s][3]<=140?t.y+e[s][3]:t.y,this.#lt(t,e,s-1)}#dt(t){const{x:e,z:s,y:i}=this.#lt({x:0,z:0,y:0},t,t.length-1);return[e,s,i]}#ut(t){let e=t.map((t=>(t.push(t[1]*t[3]),t)));return e=this.#nt(e,5),e=e.map((t=>(t.pop(),t))),t=e}#it(t,e,s){if(!s.length)return t;this.#tt=e?250:180,s=this.#ut(s);const i=this.#dt(s),{crate:a,measure:r,list:n}=this.#ht(i,s);return t.push(this.#ot(r,a)),t.push({works:a}),this.#it(t,e,n)}}class CraterLastCheckReArranger{#pt;constructor(t){return"crates ahead"===t[0]&&(this.#pt=t,this.#mt())}#nt(t,e){if(t.length<=1)return t;const s=[],i=t.splice(0,1),a=[];let r=0;for(r in t)t[r][e]<=i[0][e]?s.push(t[r]):a.push(t[r]);return this.#nt(s,e).concat(i,this.#nt(a,e))}#yt(t,e,s){const i=t[e],{works:a}=i;return a.map((t=>{Object.entries(t).map((t=>{t[1].map((t=>{1===t.length?s.push(t[0][0]):t.map((t=>Array.isArray(t[0])?s.push(t[0]):0))}))}))})),structuredClone(s)}#ft(t,e){const s=new WeakSet,i=e.works.length;let a,r=0,n=!0;for(;r++<t.length&&n;)r%2==1&&(a=1===i?structuredClone(e.works[0]):structuredClone(e.works),this.#yt(t,r,a),a=this.#nt(a,4),a=new CraterStandard(a,!1,5,!0),a.crates.length===t.length&&(t.splice(r,1,a.crates[1]),t.splice(r-1,1,a.crates[0]),n=!1),s.add(a));return!n}#gt(t,e,s){return s<0?e:(s%2==1&&this.#ft(t,e[s])&&(e.splice(s-1,2),s=e.length),this.#gt(t,e,s-1))}#zt(t){let e,s,i=0;for(s in t)if(i++%2==1&&5===t[s].works.length&&(e=t[s].works[4].layer5),e)break;return!!e&&{info:s,works:e}}#xt(t,e){let s,i=[];return Object.entries(e).map((t=>{t[1].map((t=>{let e;for(e in t)t[e].length>0&&Array.isArray(t[e])&&t[e].map((t=>i.push(t)))}))})),t.map((t=>i.push(t))),s=this.#nt(i,4),s}#wt(t,e,s,i){return t[i].works.pop(),t[i-1][1]-=10,t.splice(e-1,1,s.crates[0]),t.splice(e,1,s.crates[1]),t}#kt(){const{crates:t}=this.#pt.standardCrate,e=this.#zt(t);let s,i,a,r,n=0;if(e)for(r in t){if(!Array.isArray(t[r])&&n!==+e.info&&(s=this.#xt(e.works,t[r]),i=new CraterStandard(s,!1,5,!0),a=2===i.crates.length,a)){this.#wt(t,n,i,e.info);break}n++}}#mt(){const t=this.#pt.sameSizeCrate.crates,e=this.#pt.sameSizeCrate.backUp,s=this.#pt.standardCrate.crates;let i;if(t&&s){if(i=t.length,this.#gt(s,t,i),t.length===e.length)return this.#pt.sameSizeCrate.backUp=!1,void(this.#pt.standardCrate.backUp=!1);this.#kt()}}}class CraterNotCanvas{#u;#R;#U;#h;constructor(t){return t&&0!==t.length?(this.#R=t,this.#u=t.map((t=>t.arr)),this.#h=t.map((t=>t.arr)),this.#T()):{noCanvas:!1}}#nt(t,e){if(t.length<=1)return t;const s=[],i=t.splice(0,1),a=[];return t.map((t=>{t[e]<=i[0][e]?s.push(t):a.push(t)})),this.#nt(s,e).concat(i,this.#nt(a,e))}#Y(t){const e=new WorksCoordinates(t);this.#U=e.bluePrintCoordinates;const{emptyArea:s}=this.#U,i={emptyArea:s,feat:[]},a=this.#h.length-1;let r;e.fillPreparing={info:i,list:this.#h,len:a,raw:this.#R},r=e.fillLayer,this.#U.defineLayer=[1,r.feat],this.#R.map((t=>this.#U.artLocation.set(t.code,t)))}#$(t){const e=new CrateMaker(this.#u).outSizes,s=+(t[0]+e.x).toFixed(3),i=+(t[1]+e.z).toFixed(3),a=+(t[2]+e.y).toFixed(3),r=s%1>0?s:s.toFixed(0),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),c=e.div?t[1]+e.div*this.#u.length:t[1];return this.#Y([+r,+n,+o]),this.#U.innerSize=[t[0]+e.pad,c+e.pad,t[2]+e.pad],this.#U.finalSize=[+r,+n,+o],[...this.#U.finalSize,this.#U]}#Ct(t){let e,s=0,i=0,a=0,r=0;return e=t.length/2,t.map((t=>{e-- >0&&(s+=t[1],i<t[2]&&(i=t[2])),a=t[1],r<t[2]&&(r=t[2])})),a>s||(a=s),r+=i,{newX:a,newZ:r}}#bt(t){const e=t.length>4&&t.length%2==0;let s,i=0,a=0,r=0;return t.map((t=>{i+=t[1],a=t[2]>a?t[2]:a,r=t[3]>r?t[3]:r})),(i>277||e)&&(s=this.#Ct(t),i=s.newX,a=s.newZ),this.#$([i,a,r])}#St(t,e){const s=t[1]===e[1]&&t[1]<277,i=t[2]===e[2]&&t[2]<177,a=t[3]<=132;return!!(s&&i&&a)}#vt(t,e,s,i){return i.length%2==0&&t>554&&2*e+10<177?i.length:0===s||i[0][1]>554?1:s}#At(t){let e=10*t.length,s=0,i=0;const a=t[0];return t.map((t=>{const r=this.#St(t,a),n=t[2]-a[2],o=a[2]-t[2];(!0===r||(n>0&&n<=10||o>0&&o<=10))&&(i++,e+=t[1],s+=t[3])})),this.#vt(e,s,i,t)}#It(t){if(!Array.isArray(t))return t;let e=t.map((t=>(t.push(t[1]*t[2]),t)));return e=this.#nt(e,5),e=e.map((t=>(t.pop(),t))),this.#u=e}#T(){const t=[];let e;for(this.#It(this.#u);this.#u.length>0;)e=this.#At(this.#u),e=this.#u.splice(0,e),e.length>0?(t.push(this.#bt(e)),t.push({works:e})):(t.push(this.#bt(this.#u.splice(0,1))),t.push({works:e}));return{crates:t}}}class CraterSameSize{#u;#Tt;#R;#U;constructor(t){return t&&0!==t.length?(this.#R=structuredClone(t),this.#u=t.map((t=>t.arr)),this.#Tt=t[0].packedSized,this.#Et()):{sameSize:!1}}#H(t,e,s=1){if(!t.length)return this.#U;const{emptyArea:i}=this.#U,a={emptyArea:i,feat:[]},r=t.length-1;let n;return e.fillPreparing={info:a,list:t,len:r,raw:this.#R},n=e.fillLayer,this.#U.defineLayer=[s,n.feat],this.#H(t,e,s+1)}#Y(t,e){const s=JSON.parse(localStorage.getItem("materials")),i=JSON.parse(localStorage.getItem("crating"));let a;i.map((t=>{const e=s.filter((e=>{return t===(s=e)[0]&&s[2]<5&&"Foam Sheet"===s[5];var s}));e.length&&(a=e.flat())})),e&&(t[2]=+a[2]);const r=new WorksCoordinates(t);this.#U=r.bluePrintCoordinates;const n=structuredClone(this.#u);return this.#H(n,r),this.#R.map((t=>this.#U.artLocation.set(t.code,t))),t}#Bt(t,e){const s=new CrateMaker(this.#u.length,e).outSizes,i=+(t[0]+s.x).toFixed(3),a=+(t[1]+s.z).toFixed(3),r=+(t[2]+s.y).toFixed(3),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),c=r%1>0?r:r.toFixed(0),h=t[1]+s.div*this.#u.length;return this.#Y([+n,+o,+c],e),this.#U.innerSize=[t[0]+crate.pad,h+crate.pad,t[2]+crate.pad],this.#U.finalSize=[+n,+o,+c],[...this.#U.finalSize,this.#R]}#Ft(t,e,s){const i=t.map((t=>{const i=t[0]+e[0]<=s[0],a=t[1]+e[1]<=s[1],r=t[2]+e[2]<=s[2];if(i&&a&&r)return t}));return void 0!==i[0]&&i.map((e=>t.splice(t.indexOf(e),1))),void 0!==i[0]}#Lt(t,e){let s=[];return void 0!==e.map((e=>{const i=e[0]===t[0][0],a=e[2]===t[0][2],r=e[0]===t[0][0]-this.#Tt[1],n=e[2]===t[0][2]-this.#Tt[3];if(i&&a||r&&n)return e;if(s.length>0){if(this.#Ft(s,e,t))return e}else s.push(e)}))[0]}#Pt(t,e){const s=t.shift(),i=Array.isArray(e[0])?e[0].length:e.length;let a,r,n,o;return s?(a=i%2+i/2,r=t[0],n=a*this.#Tt[2],o=t[2]):(a=i%2+i,r=t[0],n=a*this.#Tt[2],o=t[2]),this.#Bt([r,n,o],s)}#Ot(t,e){const s=e.length>3?[e[0][1],e[0][2],e[0][3]]:e;let i=t[0],a=t[1],r=t[2]+s[2],n=!1;return r>132&&i<132?([r,i]=[i,r],n=!0):r>t[2]&&(n=!0),[n,[i,a,r]]}#Nt(t){let e,s,i=t.splice(0,1).flat(),a=t.splice(0,1).flat();return t.length>0&&(e=this.#Lt(i,t)),e?(i=this.#Ot(i,t.splice(0,1)),t[0].map((t=>a[0][0].push(t))),t.splice(0,t[0].length)):a[0].length>10&&a[0].length%2==0?i=this.#Ot(i,a[0]):i.unshift(!1),Array.isArray(a[0][0])&&(a=a.flat()),s=this.#Pt(i.flat(),a),{crate:s,works:a}}#Dt(t){const e=[];let s;for(;t.length;)s=this.#Nt(t),e.push(s.crate),e.push({works:s.works});return e}#Rt(){let t=this.#u[0][1],e=this.#u[0][2],s=this.#u[0][3],i=[[t,e,s]],a=[];return this.#u.map((r=>{r[2]<=14&&(r[1]!==t&&r[3]!==s&&(i.push([a]),t=r[1],e=r[2],s=r[3],i.push([t,e,s]),a=[]),a.push(r))})),i.push(a),i[1][0].length>=4?i:null}#Et(){let t=this.#Rt();if(null===t)return null;const e=this.#Dt(t);return t=null,{crates:e,backUp:structuredClone(e)}}}class CraterTube{#Ut;#_t;#U;#R;constructor(t){if(!t||0===t.length)return{tube:!1};this.#R=t,this.#Ut=t.map((t=>t.arr)),this.#_t=35;return this.#Ut.filter((t=>t[2]<this.#_t&&t)).find((t=>!1!==t))?this.#Mt():{tube:!1}}#Mt(){return this.#Wt(),this.#Ut}#Xt(t,e){const s=new WorksCoordinates(t);this.#U=s.bluePrintCoordinates;const{emptyArea:i}=this.#U;let a,r={emptyArea:i,feat:[]},n=Array.isArray(e[0])?e.length-1:0;s.fillPreparing={info:r,list:e,len:n,raw:this.#R},a=s.fillLayer,this.#U.defineLayer=[1,a.feat],this.#U.innerSize=[t[0],t[1],t[2]],this.#R.map((t=>this.#U.artLocation.set(t.code,t)))}#qt(t){let e=t[0][1],s=t[0][2],i=0;return t.map((t=>{e=t[1]>e?t[1]:e,s=t[2]>s?t[2]:s,i+=t[3]})),[e,s,i]}#Zt(){const t=new CrateMaker(1),e=+(this[0]+t.x).toFixed(3),s=+(this[1]+t.z).toFixed(3),i=+(this[2]+t.y).toFixed(3),a=e%1>0?e:e.toFixed(0),r=s%1>0?s:s.toFixed(0),n=i%1>0?i:i.toFixed(0);return this.#Xt([this[0]+t.pad,this[1]+t.pad,this[2]+t.pad],structuredClone(list)),this.#U.finalSize=[+a,+r,+n],[...this.#U.finalSize]}#Ht(t){const e=this.#qt(t);return this.#Zt(e,t)}#Yt(t){switch(t.length){case 1:case 2:case 3:case 4:return this.#Ht(t)}}#$t(t){const e=[];let s;for(;t.length>=3;)s=t.splice(0,3),e.push(this.#Yt(s.length,s)),e.push({works:s});return e}#jt(){const t=this.#Ut.filter((t=>{if(t[2]>this.#_t)return t}));return t.map((t=>{this.#Ut.splice(this.#Ut.indexOf(t),1)})),t}#Wt(){let t=[],e=[];const s=this.#jt();for((s.length>0||s.length>3)&&e.push(this.#$t(s));this.#Ut.length;)t=this.#Ut.splice(0,3),e.push(this.#Yt(t)),e.push({works:t});return this.#Ut.length>=1&&(e.push(this.#Yt(this.#Ut.length,this.#Ut)),e.push({works:this.#Ut})),this.#Ut={crates:e}}}class Crater{#S;#Jt;constructor(t){return t!==Arranger?{crater:!1}:(this.#S=t.list,this.#Jt=["crates ahead"],Object.assign(Crater,this.#Vt()))}#Vt(){let t=0;const e=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(t in this.#Ht(),this.#Gt(),this.#Kt(),this.#Qt(),this.#te(),this.#ee(),this.#Jt)this.#Jt[t]?.hasOwnProperty("crates")&&e.includes(t)||delete this.#Jt[t];return this.#se(),this.#ie(),this.#ae(),this.#re(),Array.isArray(this.#Jt?.sameSizeCrate?.backUp)&&(this.#ne(),this.#oe(),this.#ce()),{crates:this.#Jt}}#Ht(){const t=new CraterTube(this.#S?.tubes);this.#Jt.tubeCrate=t}#Gt(){const t=new CraterPythagoras(this.#S?.largest);this.#Jt.largestCrate=t}#Kt(){const t=new CraterSameSize(this.#S?.sameSize);this.#Jt.sameSizeCrate=t}#Qt(){const t=new CraterNotCanvas(this.#S?.noCanvas);this.#Jt.noCanvasCrate=t}#te(){const t=this.#Jt.sameSizeCrate.hasOwnProperty("crates"),e=new CraterStandard(this.#S?.sorted,t,4,!1);this.#Jt.standardCrate=e}#ee(){new CraterLastCheckReArranger(this.#Jt)}#se(){let t=0;const e=[],s=t=>{Array.isArray(t)&&e.push(t)};for(t in this.#Jt)this.#Jt[t]?.crates?.map(s);this.#Jt.allCrates=e}#ce(){let t,e,s=0;const i=[],a=t=>{Array.isArray(t)&&i.push(t)};for(s in this.#Jt)t="sameSizeCrate"===this.#Jt[s],e="standardCrate"===this.#Jt[s],(t||e)&&this.#Jt[s]?.backUp?.map(a),this.#Jt[s]?.crates?.map(a);this.#Jt.allCratesBackUp=i}#ie(){let t=0;const e=t=>{if(Array.isArray(t)&&t.length>=3){const e=t[0],s=t[1],i=t[2],a=new CubCalc(e,s,i).cubCalcAir,r=4===t.length?t.splice(3,1,a):t.push(a);Array.isArray(r)&&t.push(r)}};for(t in this.#Jt)this.#Jt[t]?.crates?.map(e);Array.isArray(this.#Jt?.sameSizeCrate?.backUp)&&(this.#Jt?.sameSizeCrate?.backUp?.map(e),this.#Jt?.standardCrate?.backUp?.map(e))}#ae(){let t=0,e=[];const s=t=>{Array.isArray(t)&&e.push(t[3])};for(t in this.#Jt)this.#Jt[t]?.crates?.map(s);e=e.reduce(((t,e)=>t+e),0),this.#Jt.airCubTotal=e.toFixed(3)}#ne(){let t,e,s=[],i=0;const a=t=>{Array.isArray(t)&&s.push(t[3])};for(i in this.#Jt)t="sameSizeCrate"===this.#Jt[i],e="standardCrate"===this.#Jt[i],t||e?this.#Jt[i]?.backUp?.map(a):t||e||this.#Jt[i]?.crates?.map(a);s=s.reduce(((t,e)=>+(t+e).toFixed(3)),0),this.#Jt.airCubTotalBackUp=s}#he(t){if(Array.isArray(t)){const e=t[0],s=t[1],i=t[2];return e>300||s>200||i>160?"CARGO":"PAX"}}#re(){let t,e=0,s=0,i=0;for(i in this.#Jt)this.#Jt[i]?.crates?.map((i=>{t=this.#he(i),"PAX"===t?e++:"CARGO"===t&&s++}));this.#Jt.whichAirPort=[{PAX:e},{CARGO:s}]}#oe(){let t,e,s,i=0,a=0,r=0;for(i in this.#Jt)t="sameSizeCrate"===this.#Jt[i],e="standardCrate"===this.#Jt[i],t||e?this.#Jt[i]?.backUp?.map((t=>{s=this.#he(t),"PAX"===s?a++:"CARGO"===s&&r++})):t||e||this.#Jt[i]?.crates?.map((t=>{s=this.#he(t),"PAX"===s?a++:"CARGO"===s&&r++}));this.#Jt.whichAirPortBackUp=[{PAX:a},{CARGO:r}]}}class UnitAdapter{#h;#le;constructor(t,e){return this.#h=t,this.#le=e,this.#de()}#ue(){try{if(!Array.isArray(this.#h)){throw new TypeError("Please, provide a valid list.")}if(this.#h.some((t=>"ArtWork"!==t.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#le&&"in"!==this.#le){throw new TypeError("Please, provide a valid unit.")}}catch(t){return t}return"pass"}async#de(){let t;const e=this.#ue();switch("pass"!==e?"error":"cm"===this.#le?"cm":"in"){case"error":return e;case"cm":return t=await this.#pe(),t;case"in":return t=await this.#me(),t}}#ye(t){const e=t?.hasOwnProperty("crates"),s=t?.hasOwnProperty("backUp");return Array.isArray(t)?t.map(a):t?.hasOwnProperty("crates")?((e||s)&&(t.crates=t.crates.map((t=>4===t.length?a(t):(Array.isArray(t.works[0])?t.works=t.works.map(a):t.works=t.works.map(r),t))),console.log(t.crates)),t):t}#fe(){return this.#h.map((t=>{const e=t.autoConvert,s=e[0],i=e[1],a=e[2],r=e[3];return new ArtWork(s,i,a,r)}))}#ge(t){let e=0;for(e in t)t[e].hasOwnProperty("crates")&&(t[e]=this.#ye(t[e]));return t.sameSizeCrate?.hasOwnProperty("backUp")&&(t.airCubTotalBackUp=+(.061023*t.airCubTotalBackUp).toFixed(3),t.allCratesBackUp=this.#ye(t.allCratesBackUp)),t.allCrates=this.#ye(t.allCrates),t}async#pe(){return await Promise.resolve(new Arranger(this.#h)).then((t=>new Crater(t))).then((t=>t.crates)).catch((t=>t))}async#me(){return await Promise.resolve(this.#fe()).then((t=>new Arranger(t))).then((t=>new Crater(t))).then((t=>this.#ge(t.crates))).catch((t=>t))}}function a(t){const e=.061023;let s,i,a,r;switch(console.log(t),t.length){case 4:return i=t[0],a=t[1],r=t[2],s=Array.from(new Converter(i,a,r).inConvert),s.push(+(t[3]*e).toFixed(3)),s;case 5:return i=t[1],a=t[2],r=t[3],s=Array.from(new Converter(i,a,r).inConvert),s.unshift(t[0]),s.push(+(t[3]*e).toFixed(3)),s;case 6:return i=t[1],a=t[2],r=t[3],s=Array.from(new Converter(i,a,r).inConvert),s.unshift(t[0]),s.push(+(t[3]*e).toFixed(3)),s.push(t[5]),s}}function r(t){let e;for(e in t)Array.isArray(t[e][0][0][0])?t[e][0].map((t=>t.splice(0,1,a(t[0])))):t[e]=[a(t[e][0])];return t}class largestCrateRender{#Jt;#ze;constructor(t,e){this.#Jt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class notCanvasCrateRender{#Jt;#ze;constructor(t,e){this.#Jt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}let n={showlegend:!0,legend:{title:{text:"Crate Layers:",font:{family:"Mitr, sans-serif",size:14}},font:{family:"Mitr, sans-serif",sizes:14,color:"#FFFFFFAA"},x:.02,xanchor:"left",y:.99,yanchor:"top",orientation:"v",groupclick:"sides"},legendgrouptitle:{},margin:{t:0,l:0,b:0,r:0,pad:10},scene:{aspectmode:"data",xaxis:{title:{text:"Length - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",ticks:"outside"},yaxis:{title:{text:"Depth - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},zaxis:{title:{text:"Height - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},camera:{eye:{x:0,y:3,z:1}}},paper_bgcolor:"#96979C"};class TraceMaker{#we;#ke;#Ce=new Map;constructor(){[["frame","#BF5E30"],["walls","#555FEF"],["padding","#FFFFF0"],["div","#BEBBBB"],["works","#BB0056BB"],["fill","#0B8325"],["structure","#002A3D"]].map((t=>{this.#Ce.set(t[0],t[1])})),this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]}#be(){const{info:t,coordinates:e,name:s,show:i}=this.#ke,a=this.#Ce.get(s);return this.#we.forEach(((r,n)=>{const o=e[r[0]],c=e[r[1]];t.push({x:[o.x,c.x],z:[o.y,c.y],y:[o.z,c.z],name:s,mode:"lines",type:"scatter3d",line:{color:a,width:3},ids:s,showlegend:!(!i||0!==n),legendgroup:s,hovertemplate:"L: %{x}<br>H: %{z}<br>D: %{y}<br>",contour:{show:!(!i||0!==n),color:"#BB0056BB",width:2}})})),t}set data(t){this.#ke=t}get defineTrace(){return this.#be()}}class DesignWalls{#ke;#Ce=new Map;#Se;constructor(){[["frame","yellow"],["walls","#3DDDDD"],["padding","#222725"],["div","#EFECBBBE"],["works","#BB0056BB"],["fill","#2DD751"],["structure","#557AEC"]].map((t=>{this.#Ce.set(t[0],t[1])})),this.#Se=[[[0,1,2],[0,2,3]],[[4,7,6],[4,6,5]],[[0,3,7],[0,7,4]],[[1,5,6],[1,6,2]],[[0,4,5],[0,5,1]],[[3,2,6],[3,6,7]]]}#ve(){const{width:t,depth:e,height:s,offsetX:i,offsetZ:a,offsetY:r,info:n,name:o}=this.#ke,c=this.#Ce.get(o),h=[[0,0,0],[t,0,0],[t,e,0],[0,e,0],[0,0,s],[t,0,s],[t,e,s],[0,e,s]].map((t=>[t[0]+i,t[1]+r,t[2]+a])),l=h.map((t=>t[0])),d=h.map((t=>t[1])),u=h.map((t=>t[2])),p=[],m=[],y=[];return this.#Se.map((t=>{t.map((t=>{p.push(t[0]),m.push(t[1]),y.push(t[2])}))})),n.push({x:l,y:d,z:u,i:p,j:m,k:y,name:o,type:"mesh3d",color:c,showlegend:!1,legendgroup:o,opacity:.2,flatshading:!0,showscale:!0,contour:{show:!0,color:"white",width:2}}),n}set objectData(t){this.#ke=t}get designSides(){return this.#ve()}}class sameSizeCrateRender{#Jt;#ze;constructor(t,e){this.#Jt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class SetCrateWalls{#ke;#Ae;#Ie;#Te;constructor(t,e,s,i){this.#Te=t,this.#ke=e,this.#Ae=i,this.#Ie=s,this.#Ie[1]=+this.#Ie[1],this.#Ie[2]=+this.#Ie[2],this.#Ie[3]=+this.#Ie[3]}#Ee(){const t=this.#Ae[2]+this.#Ie[2],e=this.#Te[0]-this.#Ae[2],s=this.#Te[2]-t,i=this.#Te[1]-t,a=this.#Te[0]-t,r=this.#Ae[2]+this.#Ie[2],n=2*this.#Ae[2]+this.#Ie[2],o=this.#Te[1]-this.#Ae[2];return{backFace:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:this.#Ie[2]},{x:e,y:0,z:this.#Ie[2]},{x:e,y:s,z:this.#Ie[2]},{x:0,y:s,z:this.#Ie[2]}],frontFace:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:e,y:0,z:i},{x:e,y:s,z:i},{x:0,y:s,z:i}],sideRight:[{x:0,y:0,z:0},{x:r,y:0,z:0},{x:r,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:r,y:0,z:i},{x:r,y:s,z:i},{x:0,y:s,z:i}],sideLeft:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:a,y:0,z:i},{x:a,y:s,z:i},{x:0,y:s,z:i}],top:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:o},{x:e,y:0,z:o},{x:e,y:s,z:o},{x:0,y:s,z:o}],bottom:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:n,z:0},{x:0,y:n,z:0},{x:0,y:0,z:o},{x:e,y:0,z:o},{x:e,y:n,z:o},{x:0,y:n,z:o}]}}#Be(t,e){const{x:s,y:i,z:a}=t,r=structuredClone(e);return Object.entries(r).map(((t,e)=>{switch(e){case 0:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 1:return 0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 2:return 0===t[1].z&&(t[1].z=a),t;case 3:return 0===t[1].x&&(t[1].x=s),0===t[1].z&&(t[1].z=a),t;case 4:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),t;case 5:return 0===t[1].y&&(t[1].y=i),t;case 7:return 0===t[1].x&&(t[1].x=s),t}})),r}#Fe(){return{faceBack:{type:"backFace",x:this.#Ae[2],y:3*this.#Ae[2],z:2*this.#Ae[2],width:this.#Te[0]-2*this.#Ae[2],depth:this.#Ae[2],height:this.#Te[2]-5*this.#Ae[2],offsetX:this.#Ae[2],offsetY:this.#Ae[2],offsetZ:3*this.#Ae[2]},faceFront:{type:"frontFace",x:this.#Ae[2],y:3*this.#Ae[2],z:this.#Te[1]-this.#Ae[2],width:this.#Te[0]-2*this.#Ae[2],depth:this.#Ae[2],height:this.#Te[2]-5*this.#Ae[2],offsetX:this.#Ae[2],offsetY:this.#Te[1]-2*this.#Ae[2],offsetZ:3*this.#Ae[2]},faceRight:{type:"sideRight",x:this.#Ae[2],y:3*this.#Ae[2],z:2*this.#Ae[2],width:this.#Ae[2],depth:this.#Te[1]-4*this.#Ae[2],height:this.#Te[2]-5*this.#Ae[2],offsetX:this.#Ae[2],offsetY:2*this.#Ae[2],offsetZ:3*this.#Ae[2]},faceLeft:{type:"sideLeft",x:this.#Te[0]-this.#Ae[2],y:3*this.#Ae[2],z:2*this.#Ae[2],width:this.#Ae[2],depth:this.#Te[1]-4*this.#Ae[2],height:this.#Te[2]-5*this.#Ae[2],offsetX:this.#Te[0]-2*this.#Ae[2],offsetY:2*this.#Ae[2],offsetZ:3*this.#Ae[2]},top:{type:"top",x:this.#Ae[2],y:this.#Te[2]-this.#Ae[2],z:this.#Ae[2],width:this.#Te[0]-2*this.#Ae[2],depth:this.#Te[1]-2*this.#Ae[2],height:this.#Ae[2],offsetX:this.#Ae[2],offsetY:this.#Ae[2],offsetZ:this.#Te[2]-2*this.#Ae[2]},bottom:{type:"bottom",x:this.#Ae[2],y:2*this.#Ae[2],z:this.#Ae[2],width:this.#Te[0]-2*this.#Ae[2],depth:this.#Te[1]-2*this.#Ae[2],height:this.#Ae[2],offsetX:this.#Ae[2],offsetY:this.#Ae[2],offsetZ:2*this.#Ae[2]}}}#Le(){const t=new TraceMaker,e=new DesignWalls,s=this.#Ee(),i=this.#Fe();let a=structuredClone(this.#ke),r=!0;return Object.entries(i).map((i=>{const{type:n,offsetX:o,offsetY:c,offsetZ:h,width:l,depth:d,height:u}=i[1],p=s[n],m=this.#Be(i[1],p);t.data={info:a,coordinates:m,name:"walls",show:r},a=t.defineTrace,e.objectData={width:l,depth:d,height:u,info:a,name:"walls",offsetX:o,offsetY:c,offsetZ:h},a=this.#ke=e.designSides,r=!1})),a}get setWalls(){return this.#Le()}}class CratesFrame{#we;#Pe;#Oe;constructor(t,e){this.#Oe=e,this.#Pe=t,this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#Oe[1]=+this.#Oe[1],this.#Oe[2]=+this.#Oe[2],this.#Oe[3]=+this.#Oe[3]}#Ne(t){const e=[];return this.#we.forEach((s=>{const i=t[s[0]],a=t[s[1]];e.push({x:[i.x,a.x],y:[i.y,a.y],z:[i.z,a.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:1,line:{color:"#F0000000"}})})),e}#De(){return{offsetFeetRightFirst:{type:"feet",x:0,y:0,z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:0,offsetY:0,offsetZ:0},offsetFeetLeftFirst:{type:"feetR",x:this.#Pe[0],y:0,z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:this.#Pe[0]-this.#Oe[3],offsetY:0,offsetZ:0},offsetFeetRightSecond:{type:"feetUp",x:0,y:this.#Oe[2],z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:0,offsetY:0,offsetZ:this.#Oe[2]},offsetFeetLeftSecond:{type:"feetUpR",x:this.#Pe[0],y:this.#Oe[2],z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:this.#Pe[0]-this.#Oe[3],offsetY:0,offsetZ:this.#Oe[2]},offsetFacesRightBackV:{type:"faceV",x:this.#Oe[2],y:this.#Oe[3]+2*this.#Oe[2],z:0,width:this.#Oe[3],depth:this.#Oe[2],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Oe[2],offsetY:0,offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetFacesLeftBackV:{type:"faceVR",x:this.#Pe[0]-this.#Oe[2],y:this.#Oe[3]+2*this.#Oe[2],z:0,width:this.#Oe[3],depth:this.#Oe[2],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Pe[0]-(this.#Oe[3]+this.#Oe[2]),offsetY:0,offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetFacesRightFrontV:{type:"faceVB",x:this.#Oe[2],y:this.#Oe[3]+2*this.#Oe[2],z:this.#Pe[1],width:this.#Oe[3],depth:this.#Oe[2],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Oe[2],offsetY:this.#Pe[1]-this.#Oe[2],offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetFacesLeftFrontV:{type:"faceVBR",x:this.#Pe[0]-this.#Oe[2],y:this.#Oe[3]+2*this.#Oe[2],z:this.#Pe[1],width:this.#Oe[3],depth:this.#Oe[2],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Pe[0]-(this.#Oe[3]+this.#Oe[2]),offsetY:this.#Pe[1]-this.#Oe[2],offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetSidesRightVUp:{type:"sideHUp",x:0,y:this.#Pe[2]-this.#Oe[2],z:this.#Oe[2],width:this.#Oe[2],depth:this.#Pe[1]-2*this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:this.#Oe[2],offsetZ:this.#Pe[2]-(this.#Oe[3]+this.#Oe[2])},offsetSidesLeftVUp:{type:"sideLeftHUp",x:this.#Pe[0],y:this.#Pe[2]-this.#Oe[2],z:this.#Oe[2],width:this.#Oe[2],depth:this.#Pe[1]-2*this.#Oe[2],height:this.#Oe[3],offsetX:this.#Pe[0]-this.#Oe[2],offsetY:this.#Oe[2],offsetZ:this.#Pe[2]-(this.#Oe[3]+this.#Oe[2])},offsetSidesRightHDown:{type:"sideHDown",x:0,y:2*this.#Oe[2],z:this.#Oe[2],width:this.#Oe[2],depth:this.#Pe[1]-2*this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:this.#Oe[2],offsetZ:2*this.#Oe[2]},offsetSidesLeftHDown:{type:"sideLeftHDown",x:this.#Pe[0],y:2*this.#Oe[2],z:this.#Oe[2],width:this.#Oe[2],depth:this.#Pe[1]-2*this.#Oe[2],height:this.#Oe[3],offsetX:this.#Pe[0]-this.#Oe[2],offsetY:this.#Oe[2],offsetZ:2*this.#Oe[2]},offsetFacesBackUpH:{type:"faceHUp",x:0,y:this.#Pe[2]-this.#Oe[2],z:0,width:this.#Pe[0],depth:this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:0,offsetZ:this.#Pe[2]-(this.#Oe[2]+this.#Oe[3])},offsetFacesBackDownH:{type:"faceH",x:0,y:2*this.#Oe[2],z:0,width:this.#Pe[0],depth:this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:0,offsetZ:2*this.#Oe[2]},offsetFacesFrontUpH:{type:"faceHBackUp",x:0,y:this.#Pe[2]-this.#Oe[2],z:this.#Pe[1],width:this.#Pe[0],depth:this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:this.#Pe[1]-this.#Oe[2],offsetZ:this.#Pe[2]-(this.#Oe[2]+this.#Oe[3])},offsetFacesFrontDownH:{type:"faceHBackDown",x:0,y:2*this.#Oe[2],z:this.#Pe[1],width:this.#Pe[0],depth:this.#Oe[2],height:this.#Oe[3],offsetX:0,offsetY:this.#Pe[1]-this.#Oe[2],offsetZ:2*this.#Oe[2]},offsetSidesRightVBack:{type:"sideV",x:0,y:this.#Oe[3]+2*this.#Oe[2],z:0,width:this.#Oe[2],depth:this.#Oe[3],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:0,offsetY:0,offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetSidesRightVFront:{type:"sideRightFrontV",x:0,y:this.#Oe[3]+2*this.#Oe[2],z:this.#Pe[1]-this.#Oe[3],width:this.#Oe[2],depth:this.#Oe[3],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:0,offsetY:this.#Pe[1]-this.#Oe[3],offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetSidesLeftVBack:{type:"sideLeftV",x:this.#Pe[0],y:this.#Oe[3]+2*this.#Oe[2],z:0,width:this.#Oe[2],depth:this.#Oe[3],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Pe[0]-this.#Oe[2],offsetY:0,offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetSidesLeftVFront:{type:"sideLeftFrontV",x:this.#Pe[0],y:this.#Oe[3]+2*this.#Oe[2],z:this.#Pe[1]-this.#Oe[3],width:this.#Oe[2],depth:this.#Oe[3],height:this.#Pe[2]-(2*this.#Oe[3]+3*this.#Oe[2]),offsetX:this.#Pe[0]-this.#Oe[2],offsetY:this.#Pe[1]-this.#Oe[3],offsetZ:2*this.#Oe[2]+this.#Oe[3]},offsetTopFrontH:{type:"topFace",x:this.#Oe[3],y:this.#Pe[2],z:0,width:this.#Pe[0]-2*this.#Oe[3],depth:this.#Oe[3],height:this.#Oe[2],offsetX:this.#Oe[3],offsetY:0,offsetZ:this.#Pe[2]-this.#Oe[2]},offsetTopBackH:{type:"topComp",x:this.#Oe[3],y:this.#Pe[2],z:this.#Pe[1],width:this.#Pe[0]-2*this.#Oe[3],depth:this.#Oe[3],height:this.#Oe[2],offsetX:this.#Oe[3],offsetY:this.#Pe[1]-this.#Oe[3],offsetZ:this.#Pe[2]-this.#Oe[2]},offsetTopRight:{type:"topFeet",x:0,y:this.#Pe[2],z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:0,offsetY:0,offsetZ:this.#Pe[2]-this.#Oe[2]},offsetTopLeft:{type:"topLeftFeet",x:this.#Pe[0],y:this.#Pe[2],z:0,width:this.#Oe[3],depth:this.#Pe[1],height:this.#Oe[2],offsetX:this.#Pe[0]-this.#Oe[3],offsetY:0,offsetZ:this.#Pe[2]-this.#Oe[2]}}}#Re(){const t=2*this.#Oe[2],e=this.#Pe[2]-this.#Oe[3]-this.#Oe[2],s=this.#Pe[0]-this.#Oe[3],i=this.#Pe[1]-this.#Oe[2],a=this.#Pe[2]-this.#Oe[3]-this.#Oe[2],r=this.#Pe[1]-this.#Oe[2],n=this.#Pe[0]-this.#Oe[2],o=this.#Oe[3]+this.#Oe[2],c=this.#Pe[0]-this.#Oe[3]-this.#Oe[2],h=this.#Pe[2]-this.#Oe[2],l=this.#Pe[1]-this.#Oe[3];return{feet:[{x:0,y:0,z:0},{x:this.#Oe[3],y:0,z:0},{x:this.#Oe[3],y:this.#Oe[2],z:0},{x:0,y:this.#Oe[2],z:0},{x:0,y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:this.#Oe[2],z:this.#Pe[1]},{x:0,y:this.#Oe[2],z:this.#Pe[1]}],feetR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:this.#Oe[2],z:0},{x:0,y:this.#Oe[2],z:0},{x:0,y:0,z:this.#Pe[1]},{x:s,y:0,z:this.#Pe[1]},{x:s,y:this.#Oe[2],z:this.#Pe[1]},{x:0,y:this.#Oe[2],z:this.#Pe[1]}],feetUp:[{x:0,y:0,z:0},{x:this.#Oe[3],y:0,z:0},{x:this.#Oe[3],y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:t,z:this.#Pe[1]},{x:0,y:t,z:this.#Pe[1]}],feetUpR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Pe[1]},{x:s,y:0,z:this.#Pe[1]},{x:s,y:t,z:this.#Pe[1]},{x:0,y:t,z:this.#Pe[1]}],faceV:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Oe[2]},{x:o,y:0,z:this.#Oe[2]},{x:o,y:e,z:this.#Oe[2]},{x:0,y:e,z:this.#Oe[2]}],faceVR:[{x:0,y:0,z:0},{x:c,y:0,z:0},{x:c,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Oe[2]},{x:c,y:0,z:this.#Oe[2]},{x:c,y:e,z:this.#Oe[2]},{x:0,y:e,z:this.#Oe[2]}],faceVB:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:i},{x:o,y:0,z:i},{x:o,y:e,z:i},{x:0,y:e,z:i}],faceVBR:[{x:0,y:0,z:0},{x:c,y:0,z:0},{x:c,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:i},{x:c,y:0,z:i},{x:c,y:e,z:i},{x:0,y:e,z:i}],faceH:[{x:0,y:0,z:0},{x:this.#Pe[0],y:0,z:0},{x:this.#Pe[0],y:this.#Oe[3]+t,z:0},{x:0,y:this.#Oe[3]+t,z:0},{x:0,y:0,z:this.#Oe[2]},{x:this.#Pe[0],y:0,z:this.#Oe[2]},{x:this.#Pe[0],y:this.#Oe[3]+t,z:this.#Oe[2]},{x:0,y:this.#Oe[3]+t,z:this.#Oe[2]}],faceHUp:[{x:0,y:0,z:0},{x:this.#Pe[0],y:0,z:0},{x:this.#Pe[0],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Oe[2]},{x:this.#Pe[0],y:0,z:this.#Oe[2]},{x:this.#Pe[0],y:a,z:this.#Oe[2]},{x:0,y:a,z:this.#Oe[2]}],faceHBackUp:[{x:0,y:0,z:0},{x:this.#Pe[0],y:0,z:0},{x:this.#Pe[0],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:i},{x:this.#Pe[0],y:0,z:i},{x:this.#Pe[0],y:a,z:i},{x:0,y:a,z:i}],faceHBackDown:[{x:0,y:0,z:0},{x:this.#Pe[0],y:0,z:0},{x:this.#Pe[0],y:this.#Oe[3]+t,z:0},{x:0,y:this.#Oe[3]+t,z:0},{x:0,y:0,z:i},{x:this.#Pe[0],y:0,z:i},{x:this.#Pe[0],y:this.#Oe[3]+t,z:i},{x:0,y:this.#Oe[3]+t,z:i}],sideHUp:[{x:0,y:0,z:0},{x:this.#Oe[2],y:0,z:0},{x:this.#Oe[2],y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:r},{x:this.#Oe[2],y:0,z:r},{x:this.#Oe[2],y:e,z:r},{x:0,y:e,z:r}],sideLeftHUp:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:r},{x:n,y:0,z:r},{x:n,y:e,z:r},{x:0,y:e,z:r}],sideHDown:[{x:0,y:0,z:0},{x:this.#Oe[2],y:0,z:0},{x:this.#Oe[2],y:this.#Oe[3]+t,z:0},{x:0,y:this.#Oe[3]+t,z:0},{x:0,y:0,z:r},{x:this.#Oe[2],y:0,z:r},{x:this.#Oe[2],y:this.#Oe[3]+t,z:r},{x:0,y:this.#Oe[3]+t,z:r}],sideLeftHDown:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:this.#Oe[3]+t,z:0},{x:0,y:this.#Oe[3]+t,z:0},{x:0,y:0,z:r},{x:n,y:0,z:r},{x:n,y:this.#Oe[3]+t,z:r},{x:0,y:this.#Oe[3]+t,z:r}],sideV:[{x:0,y:0,z:0},{x:this.#Oe[2],y:0,z:0},{x:this.#Oe[2],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Oe[3]},{x:this.#Oe[2],y:0,z:this.#Oe[3]},{x:this.#Oe[2],y:a,z:this.#Oe[3]},{x:0,y:a,z:this.#Oe[3]}],sideRightFrontV:[{x:0,y:0,z:0},{x:this.#Oe[2],y:0,z:0},{x:this.#Oe[2],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Pe[1]},{x:this.#Oe[2],y:0,z:this.#Pe[1]},{x:this.#Oe[2],y:a,z:this.#Pe[1]},{x:0,y:a,z:this.#Pe[1]}],sideLeftV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Oe[3]},{x:n,y:0,z:this.#Oe[3]},{x:n,y:a,z:this.#Oe[3]},{x:0,y:a,z:this.#Oe[3]}],sideLeftFrontV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Pe[1]},{x:n,y:0,z:this.#Pe[1]},{x:n,y:a,z:this.#Pe[1]},{x:0,y:a,z:this.#Pe[1]}],topFace:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Oe[3]},{x:s,y:0,z:this.#Oe[3]},{x:s,y:h,z:this.#Oe[3]},{x:0,y:h,z:this.#Oe[3]}],topComp:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:l},{x:s,y:0,z:l},{x:s,y:h,z:l},{x:0,y:h,z:l}],topFeet:[{x:0,y:0,z:0},{x:this.#Oe[3],y:0,z:0},{x:this.#Oe[3],y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:0,z:this.#Pe[1]},{x:this.#Oe[3],y:h,z:this.#Pe[1]},{x:0,y:h,z:this.#Pe[1]}],topLeftFeet:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:h,z:0},{x:0,y:h,z:0},{x:0,y:0,z:this.#Pe[1]},{x:s,y:0,z:this.#Pe[1]},{x:s,y:h,z:this.#Pe[1]},{x:0,y:h,z:this.#Pe[1]}]}}#Ue(t,e){const{x:s,y:i,z:a}=t,r=structuredClone(e);return Object.entries(r).map(((t,e)=>{switch(e){case 0:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 1:return 0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 2:return 0===t[1].z&&(t[1].z=a),t;case 3:return 0===t[1].x&&(t[1].x=s),0===t[1].z&&(t[1].z=a),t;case 4:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),t;case 5:return 0===t[1].y&&(t[1].y=i),t;case 7:return 0===t[1].x&&(t[1].x=s),t}})),r}async#_e(t,e,s){const i=new TraceMaker,a=new DesignWalls;let r=!0;return Object.entries(s).map((s=>{const{type:n,offsetX:o,offsetY:c,offsetZ:h,width:l,depth:d,height:u}=s[1],p=e[n],m=this.#Ue(s[1],p);i.data={info:t,coordinates:m,name:"frame",show:r},t=i.defineTrace,a.objectData={width:l,depth:d,height:u,info:t,name:"frame",offsetX:o,offsetY:c,offsetZ:h},t=a.designSides,r=!1})),t}async#Me(){const t=Math.ceil(this.#Pe[0]),e=Math.ceil(this.#Pe[1]),s=Math.ceil(this.#Pe[2]),i=[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:s},{x:t,y:0,z:s},{x:t,y:e,z:s},{x:0,y:e,z:s}];let a=this.#Ne(i);const r=this.#Re(),n=this.#De();return a=await this.#_e(a,r,n),a}get setFrame(){return this.#Me()}}class PaddingCrate{#ke;#Ae;#Ie;#Te;#We;constructor(t,e,s,i,a){this.#We=a,this.#Te=t,this.#ke=e,this.#Ae=i,this.#Ie=s,this.#Ie[1]=+this.#Ie[1],this.#Ie[2]=+this.#Ie[2],this.#Ie[3]=+this.#Ie[3],this.#We[1]=+this.#We[1],this.#We[2]=+this.#We[2],this.#We[3]=+this.#We[3],console.log(this.#We)}#Xe(){const t=this.#Ie[2]+this.#Ae[2],e=this.#Te[0]-(this.#Ae[2]+this.#Ie[2]+2*this.#Ie[2]),s=this.#Te[2]-t-this.#We[2],i=this.#Te[1]-t,a=this.#Te[0]-t,r=this.#Ae[2]+this.#Ie[2]+this.#We[2],n=2*this.#Ae[2]+this.#Ie[2]+this.#We[2],o=this.#Te[1]-this.#Ae[2]-this.#Ie[2];return{backFace:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:this.#We[2]},{x:e,y:0,z:this.#We[2]},{x:e,y:s,z:this.#We[2]},{x:0,y:s,z:this.#We[2]}],frontFace:[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:e,y:0,z:i},{x:e,y:s,z:i},{x:0,y:s,z:i}],sideRight:[{x:0,y:0,z:0},{x:r,y:0,z:0},{x:r,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:r,y:0,z:i},{x:r,y:s,z:i},{x:0,y:s,z:i}],sideLeft:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:a,y:0,z:i},{x:a,y:s,z:i},{x:0,y:s,z:i}],top:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:o},{x:a,y:0,z:o},{x:a,y:s,z:o},{x:0,y:s,z:o}],bottom:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:n,z:0},{x:0,y:n,z:0},{x:0,y:0,z:o},{x:a,y:0,z:o},{x:a,y:n,z:o},{x:0,y:n,z:o}]}}#Be(t,e){const{x:s,y:i,z:a}=t,r=structuredClone(e);return Object.entries(r).map(((t,e)=>{switch(e){case 0:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 1:return 0===t[1].y&&(t[1].y=i),0===t[1].z&&(t[1].z=a),t;case 2:return 0===t[1].z&&(t[1].z=a),t;case 3:return 0===t[1].x&&(t[1].x=s),0===t[1].z&&(t[1].z=a),t;case 4:return 0===t[1].x&&(t[1].x=s),0===t[1].y&&(t[1].y=i),t;case 5:return 0===t[1].y&&(t[1].y=i),t;case 7:return 0===t[1].x&&(t[1].x=s),t}})),r}#Fe(){return{faceBack:{type:"backFace",x:this.#Ae[2]+this.#Ie[2]+this.#We[2],y:2*this.#Ae[2]+this.#Ie[2]+this.#We[2],z:this.#Ae[2]+this.#Ie[2]+this.#We[2],width:this.#Te[0]-(2*this.#Ae[2]+2*this.#Ie[2]+2*this.#We[2]),depth:this.#We[2],height:this.#Te[2]-4*this.#Ae[2]-3*this.#Ie[2]-this.#We[2],offsetX:this.#Ae[2]+this.#Ie[2]+this.#We[2],offsetY:this.#We[2],offsetZ:3*this.#Ae[2]+2*this.#Ie[2]},faceFront:{type:"frontFace",x:this.#Ae[2]+this.#Ie[2]+this.#We[2],y:2*this.#Ae[2]+this.#Ie[2]+this.#We[2],z:this.#Te[1]-this.#Ae[2]-this.#Ie[2]-this.#We[2],width:this.#Te[0]-(2*this.#Ae[2]+2*this.#Ie[2]+2*this.#We[2]),depth:this.#We[2],height:this.#Te[2]-4*this.#Ae[2]-3*this.#Ie[2]-this.#We[2],offsetX:this.#Ae[2]+this.#Ie[2]+this.#We[2],offsetY:this.#Te[1]-2*this.#We[2],offsetZ:3*this.#Ae[2]+2*this.#Ie[2]},faceRight:{type:"sideRight",x:this.#Ae[2]+this.#Ie[2],y:2*this.#Ae[2]+this.#Ie[2]+this.#We[2],z:this.#Ae[2]+this.#Ie[2],width:this.#We[2],depth:this.#Te[1]-2*this.#Ae[2]-2*this.#Ae[2],height:this.#Te[2]-3*this.#Ae[2]-2*this.#Ie[2]-2*this.#We[2],offsetX:this.#Ae[2]+this.#Ie[2],offsetY:2*this.#Ae[2],offsetZ:2*this.#Ae[2]+this.#Ie[2]+this.#We[2]},faceLeft:{type:"sideLeft",x:this.#Te[0]-this.#Ae[2]-this.#Ie[2]-this.#We[2],y:2*this.#Ae[2]+this.#Ie[2]+this.#We[2],z:this.#Ae[2]+this.#Ie[2],width:this.#We[2],depth:this.#Te[1]-2*this.#Ae[2]-2*this.#Ae[2],height:this.#Te[2]-3*this.#Ae[2]-2*this.#Ie[2]-2*this.#We[2],offsetX:this.#Te[0]-this.#Ie[2]-this.#Ae[2]-this.#We[2],offsetY:2*this.#Ae[2],offsetZ:2*this.#Ae[2]+this.#Ie[2]+this.#We[2]},top:{type:"top",x:this.#Ae[2]+this.#Ie[2],y:this.#Te[2]-this.#Ae[2]-this.#Ie[2],z:this.#Ae[2]+this.#Ie[2],width:this.#Te[0]-(2*this.#Ae[2]+2*this.#Ie[2]),depth:this.#Te[1]-(this.#Ae[2]+this.#Ie[2]+this.#We[2]),height:this.#We[2],offsetX:this.#Ae[2]+this.#Ie[2],offsetY:this.#Ae[2]+this.#Ie[2],offsetZ:this.#Te[2]-(2*this.#Ae[2]+2*this.#Ie[2])},bottom:{type:"bottom",x:this.#Ae[2]+this.#Ie[2],y:2*this.#Ae[2]+this.#Ie[2],z:this.#Ae[2]+this.#Ie[2],width:this.#Te[0]-(2*this.#Ae[2]+2*this.#Ie[2]),depth:this.#Te[1]-(2*this.#Ae[2]+2*this.#Ie[2]),height:this.#We[2],offsetX:this.#Ae[2]+this.#Ie[2],offsetY:this.#Ae[2]+this.#Ie[2],offsetZ:2*this.#Ae[2]+this.#Ie[2]}}}#qe(){const t=new TraceMaker,e=new DesignWalls,s=this.#Xe(),i=this.#Fe();let a=structuredClone(this.#ke),r=!0;return Object.entries(i).map((i=>{const{type:n,offsetX:o,offsetY:c,offsetZ:h,width:l,depth:d,height:u}=i[1],p=s[n],m=this.#Be(i[1],p);t.data={info:a,coordinates:m,name:"padding",show:r},a=t.defineTrace,e.objectData={width:l,depth:d,height:u,info:a,name:"padding",offsetX:o,offsetY:c,offsetZ:h},a=this.#ke=e.designSides,r=!1})),a}get setPadding(){return this.#qe()}}class standardCrateRender{#Jt;#ze;constructor(t,e){this.#Jt=t,this.#ze=e}#Ze(t){return JSON.parse(localStorage.getItem("crating")).map((e=>t.usedMaterials.get(e)))}async#xe(){const{crates:t}=this.#Jt,e=await Promise.resolve(t.map((async(t,e)=>{if(e%2==0){const e=this.#Ze(t.at(-1)[0]),s=e.find((t=>"Pinewood"===t.at(-1))),i=e.find((t=>"Plywood"===t.at(-1))),a=e.find((t=>"Foam Sheet"===t.at(-1)&&t[2]>2.5));e.find((t=>"Foam Sheet"===t.at(-1)&&t[2]<=2.5));const r=t.at(-1)[0].finalSize,n=s?new CratesFrame(r,s):0;let o=await n.setFrame;o=new SetCrateWalls(r,o,i,s).setWalls;return o=new PaddingCrate(r,o,i,s,a).setPadding,o}}),0)),s=Promise.all(e),i=await s;return!!i.length&&{result:i[0],meta:this.#ze}}get composeCrate(){return this.#xe()}}class tubeCrateRender{#Jt;#ze;constructor(t,e){this.#Jt=t,this.#ze=e}#xe(){return{result:undefined,meta:this.#ze}}get composeCrate(){return this.#xe()}}class GraphicCrates{#He;#we;#Jt;constructor(){const{Plotly:t}=globalThis;this.#Jt=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"],this.#we=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#He=t}async#Ye(){const t=localStorage.getItem("refNumb"),e=new Worker(new URL("../panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});e.postMessage(t);return await new Promise(((s,i)=>{e.onmessage=e=>{const{data:a}=e;a?.reference===t?s(a):i(e)}}))}#$e(t,e){return this.#we.forEach((s=>{const i=e[s[0]],a=e[s[1]];t.push({x:[i.x,a.x],y:[i.y,a.y],z:[i.z,a.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:0,line:{color:"#00000000"}})})),t}async#je(t){let e=structuredClone(n);const s=this.#Jt.map((async i=>{const a=t.get(i);let r;switch(a?i:0){case"tubeCrate":r=new tubeCrateRender(a,e);const t=r.composeCrate;s.push(t.result),e=t.meta,r=null;break;case"largestCrate":r=new largestCrateRender(a,e);const i=r.composeCrate;s.push(i.result),e=i.meta,r=null;break;case"sameSizeCrate":r=new sameSizeCrateRender(a,e);const n=r.composeCrate;s.push(n.result),e=n.meta,r=null;break;case"noCanvasCrate":r=new notCanvasCrateRender(a,e);const o=r.composeCrate;s.push(o.result),e=o.meta,r=null;break;case"standardCrate":r=new standardCrateRender(a,e);const{result:c,meta:h}=await r.composeCrate;return e=h,r=null,c}}));return{result:(await Promise.all(s)).filter((t=>Array.isArray(t))).flat(),alterLayout:e}}async#Je(){const{crates:t}=await this.#Ye()||!1,e=new Map,s=sessionStorage.getItem("graphics")||!1;if(s){return JSON.parse(s)[sessionStorage.getItem("crate").split("/")[0]]}if(t){Object.entries(t).map((t=>{this.#Jt.includes(t[0])&&e.set(t[0],t[1])}));const s=this.#je(e);return globalThis.sessionStorage.setItem("crate",`1/${t.allCrates.length}`),globalThis.sessionStorage.setItem("graphics",JSON.stringify(s.designs)),document.getElementById("layer-count").innerText=`Courrent crate: 1 / ${t.allCrates.length}`,s}return!0}async#Ve(){new DesignWalls,new TraceMaker;this.#$e([],[{x:0,y:0,z:0},{x:100,y:0,z:0},{x:100,y:30,z:0},{x:0,y:30,z:0},{x:0,y:0,z:100},{x:100,y:0,z:100},{x:100,y:30,z:100},{x:0,y:30,z:100}]);const{result:t,alterLayout:e}=await this.#Je();this.#He.newPlot("plotter-display",t,e,{displaylogo:!1})}get show(){this.#Ve()}}async function o(){const t=new GraphicCrates,e=document.querySelectorAll(".toggle__plotter"),s=document.getElementById("layers");let i;for(i of e)"true"===i.ariaHidden?(i.ariaHidden="false",s.ariaHidden="true"):"false"===i.ariaHidden&&(i.ariaHidden="true",s.ariaHidden="false",sessionStorage.getItem("plotter")||(t.show,sessionStorage.setItem("plotter","true")))}function c(t,e,s,i){switch(t){case 409:!async function(t,e,s){if(confirm("This estimate already exist. Would you like to update it?")){const i="/api/v1/update/estimates";try{const a=await fetch(i,{method:"PUT",body:t,headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)));403===a&&c(a,s)}catch(t){alert(`ATTENTION: ${t}`)}}else alert("Not updated!")}(s,i,e);break;case 403:!async function(t){const e={"Content-Type":"application/json; charset=UTF-8"};try{const s=await fetch("/api/v1/shift/tokens",{method:"POST",headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)));h(t),console.log(s)}catch(t){alert(`ATTENTION: ${t}`)}}(e)}}async function h(t){const e=JSON.stringify(t),s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{c(await fetch("/api/v1/newEstimate",{method:"POST",body:e,headers:s}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`))),t,e,s)}catch(t){alert(`ATTENTION: ${t}`)}else!function(t){const e=localStorage,s=e.getItem("offResults"),i=void 0!==s&&JSON.parse(s);i?(i.push(t),e.removeItem("offResults"),e.setItem("offResults",JSON.stringify(i))):e.setItem("offResults",JSON.stringify([t]))}(t.reference)}function l(){const t="Results",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}function d(t,e=!1){const s=localStorage.getItem("refNumb"),i="Results",a=globalThis.indexedDB.open(i),r=globalThis.navigator.onLine;a.onerror=t=>{alert(`ERROR: ${t.target.errorCode}`)},a.onsuccess=async a=>{const n=a.target.result.transaction(i,"readwrite").objectStore(i),o=n.get(t.reference);o.onsuccess=async()=>{void 0===o.result?n.add(t):await Promise.resolve(n.delete(o.result.reference)).then(n.add(t)),u(s,e)},r||function(t,e){const s="off_line_results",i=document.getElementById("input_estimate").value,a=globalThis.indexedDB.open(s);a.onerror=t=>{alert(`ERROR: ${t.target.errorCode}`)},a.onsuccess=async a=>{const r=a.target.result.transaction(s,"readwrite").objectStore(s),n=r.get(t.reference);n.onsuccess=()=>{(void 0===n.result||r.delete(n.result.reference))&&r.add(t),u(i,e)}}}(t)}}async function u(t,e=!1){const s=globalThis.indexedDB.open("Results");s.onerror=t=>{alert(`WARNING: ${t.target.errorCode}`)},s.onsuccess=()=>{const i=s.result.transaction("Results").objectStore("Results").get(t);i.onsuccess=async()=>{const t=localStorage.getItem("refNumb"),s=i.result;globalThis.sessionStorage.setItem(t,JSON.stringify(s)),!1===e&&await async function(t){const{reference:e,list:s,crates:i}=t,a={reference:e,list:s,crates:Object.assign({},i)};await h(a)}(i.result),"crate"===e&&await async function(t){const e={"Content-Type":"application/json; charset=UTF-8"},{reference:s,list:i,crates:a}=t,r={reference:s,list:i,crates:Object.assign({},a)};try{await fetch("/api/v1/update/estimates",{method:"PUT",body:JSON.stringify(r),headers:e}).then((t=>t.status)).catch((t=>console.error(`ALERT ${t}`)))}catch(t){alert(`ATTENTION: ${t}`)}finally{return"updated"}}(i.result)}}}async function p(){const t=await z();let e=document.getElementById("count");return t&&t.length>0&&document.getElementById("statusList").setAttribute("content",t.length),e.innerText=t?"Counting: "+t?.length:"Counting 0",e}async function m(){let t;const e=document.getElementById("cub-meter");return t=await z(),t=t?.reduce(((t,e)=>t+e.cubed),0)??0,e.innerText="Cub: "+(1e3*t/1e3).toFixed(3)+"m³",e}async function y(){let t,e,s;return s="Air-Cub: ",e=document.getElementById("cub-air"),t=await z(),t=t?.reduce(((t,e)=>t+e.cAir),0)??0,e.innerText="Air-Cub: "+(1e3*t/1e3).toFixed(3),e}async function f(t=!1){const e={},s=new WeakSet,i=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let a,r=document.cookie.split("=")[1];const n=await async function(){const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",e=await z();let s;return 0===e.length?alert("Oops! Sounds like you do not added any work yet. Please, try again!"):(s=await Promise.resolve(new UnitAdapter(e,t)),s)}(),o=document.querySelector(":root"),c=document.querySelector(".update-materials"),h=document.querySelector(".materials");return(t||confirm("Ready to crate all works?")&&n)&&(!function(){const t=new DocumentFragment,e=new DocumentFragment,s=document.createElement("panel-info"),i=document.createElement("panel-info"),a=document.getElementById("first_pane"),r=document.getElementById("second_pane");for(;a.firstChild;)a.removeChild(a.firstChild);for(;r.firstChild;)r.removeChild(r.firstChild);s.id="first-pane",i.id="second-pane",s.setAttribute("name","pane1"),i.setAttribute("name","pane2"),t.append(s),e.append(i),a.append(t),r.append(e)}(),e.reference=i,a=await z(),e.list=a.map((t=>t.data)),e.crates=n,d(e,t),c.setAttribute("name","materials-used"),h.setAttribute("name","packed-works"),h.setAttribute("content","crates"),("FULL"===r||"PLOTTER"===r||!r)&&(document.getElementById("crate-layers").disabled=!1),o.style.setProperty("--layer-state","block"),sessionStorage.removeItem("crate"),sessionStorage.removeItem("plotter")),s.add(e),"Crated"}async function g(t=!1){document.getElementById("input_code").value="",document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="";const e=document.getElementById("show-layer"),s=document.querySelectorAll("padding-dialog").length,i=document.querySelector(":root"),a=document.querySelector(".update-materials");let r=document.cookie;r=r.split("=")[1],e&&e.hasChildNodes()&&o(),globalThis.document.getElementById("input_estimate").select(),globalThis.document.getElementById("input_code").select(),"update-materials"!==a.getAttribute("name")&&a.setAttribute("name","update-materials"),p(),m(),y(),s>0&&sessionStorage.setItem("CLOSED","NOW"),i.style.setProperty("--layer-state","none")}async function z(){const t=localStorage,e=[];let s;const i=["doneList","mode","storage","currency","metrica","refNumb","offResults","FETCHED","materials","packing","crating"];return Object.entries(t).map((t=>{!i.includes(t[0])&&e.push(JSON.parse(t[1]))})),e.length>0&&(s=e.map((t=>{const{code:e,x:s,z:i,y:a,packing:r}=t;return new ArtWork(e,s,i,a,r)}))),s||void 0}function x(t){const e=function(t){let e=2;const s=/^[0-9\.0-9]{1,7}$/;for(;--e>=0;)if(!s.test(t[e]))switch(e){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return t}([t[1],t[2],t[3]].map((t=>parseInt(t))));const s=/[^-a-z-A-Z-0-9]/g,i=document.getElementById("input_estimate").value,a=function(){const t=JSON.parse(localStorage.getItem("packing")),e=JSON.parse(localStorage.getItem("materials")),s=[];return!(!t||0===t.length)&&(t.filter((t=>{s.push(e.find((e=>e[0]===t)).flat())})),s)}();let r=0;if(!a)return alert("Please, select some packing material to apply to the artwork."),"material";if(s.test(t[0])||s.test(i))return alert('Found special character NOT allowed on "Work code",\t\tor "Estimate" input. Please, try again!'),!1;for(r in localStorage.key(r))if(t[0]===localStorage.key(r))return alert(`${t[0]} already added to the list. Please, try again`),!1;return function(){const t=localStorage.getItem("refNumb"),e=document.getElementById("input_estimate").value;t&&t!==e&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",e),document.getElementById("input_estimate").value=e):document.getElementById("input_estimate").value=t);localStorage.setItem("refNumb",e)}(),!!Array.isArray(e)&&new ArtWork(t[0],e[0],e[1],e[2],a)}async function w(){const t=document.getElementById("input_estimate").value,e=document.getElementById("input_code").value,s=document.getElementById("input_length").value,i=document.getElementById("input_depth").value,a=document.getElementById("input_height").value;let r;return t?""===(e&&s&&i&&a)?(alert("Oops! Do not forget to fill each field. Please, try again!"),function(){let t=!1;["input_estimate","input_code","input_length","input_depth","input_height"].find((e=>{const s=document.getElementById(e);if(console.log(s.value),!s.value&&!t)return t=!0,s.select()}))}()):(r=x([e,s,i,a]),r&&"material"!==r&&(await async function({code:t}){const e=sessionStorage,s=JSON.parse(e.getItem("codes"));let i;return s?(i=Number.parseInt(s[s.length-1]),i+=1,s.push([i,t]),e.setItem("codes",JSON.stringify(s))):e.setItem("codes",JSON.stringify([[0,t]]))}(r.data),localStorage.setItem(r.data.code,JSON.stringify(r.data)),localStorage.setItem("storage","art-work"),p(),y(),m(),g()),r&&"material"!==r?g():0):alert('Attention! Please, add the "Doc:" reference field!')}function k(){const t=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(t))!function(t){const e=sessionStorage,s=JSON.parse(e.getItem("codes"));let i=0;for(;s[i][1]!==t&&i<=s.length;)i++;s.splice(i,1),e.setItem("codes",JSON.stringify(s))}(t),localStorage.removeItem(t),p(),y(),m();else{if(null===t)return g();alert(`"${t}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),g()}function C(t){const e=document.createDocumentFragment();return t.map((t=>{const s=document.createElement("option");s.textContent=t,e.appendChild(s)})),e}function b(t,e,s,i){const a=JSON.parse(sessionStorage.getItem("currency")),r=1e3,n=Number.parseFloat(s.value)===a[t],o=Number.parseFloat(i.value)===a[e];return t===e?n?i.value:s.value:n&&o?~~(a[t]*a[e]*r)/r:a[t]<a[e]?!0===n?~~(i.value/a[e]*a[t]*r)/r:~~(s.value*a[e]/a[t]*r)/r:!0===o?~~(s.value*a[e]/a[t]*r)/r:~~(i.value/a[e]*a[t]*r)/r}async function S(){const t=await fetch("/api/v1/currencies",{method:"GET"}).then((async t=>await t.json())).catch((t=>alert(`CurrencyError: ${t}!`))),{rates:e}=t.response,s=globalThis.sessionStorage;return e&&s.setItem("currency",JSON.stringify(e))}function v(t,e){const s=JSON.parse(sessionStorage.getItem("currency"));if(!s)return!1;e.value=s[t]}async function A(){await S(),await async function(){const t=JSON.parse(sessionStorage.getItem("currency")),e=document.getElementById("coin1"),s=document.getElementById("coin2"),i=Object.keys(t);if(!t)return"Error";e.appendChild(C(i)),s.appendChild(C(i))}()}function I(t,e,s,i){return"centimeters"===t?function(t,e,s,i){const a=2.54,r=.01,n=T(t,e);if(t===e)return s.value>i.value?s.value:i.value;if(n.checked1)return E(s,i,a,"in");return E(s,i,r,"m")}(t,e,s,i):"inches"===t?function(t,e,s,i){const a=.393,r=.0254,n=T(t,e);if(t===e)return s.value>i.value?s.value:i.value;if(n.checked2)return E(s,i,a,"cm");return E(s,i,r,"m")}(t,e,s,i):function(t,e,s,i){const a=.01,r=.0254,n=T(t,e);if(t===e)return s.value>i.value?s.value:i.value;if(n.checked3)return E(s,i,a,"cm");return E(s,i,r,"in")}(t,e,s,i)}function T(t,e){return{checked1:"centimeters"===t&&"inches"===e,checked2:"inches"===t&&"centimeters"===e,checked3:"meters"===t&&"centimeters"===e}}function E(t,e,s,i){const a=1e3;return"m"!==i?t.value>e.value?~~(t.value/s*a)/a:~~(e.value*s*a)/a:t.value<e.value?~~(e.value/s*a)/a:~~(t.value*s*a)/a}function B(){const t=new DocumentFragment,e=document.createElement("panel-info");return e.setAttribute("name","status"),e.id="statusList",e.class="addedStatus",e.setAttribute("content",0),t.appendChild(e)}if(globalThis.onstorage=()=>{m(),y(),p()},globalThis.onload=async()=>{const t=localStorage.getItem("mode"),e=document.getElementById("status-frame"),s=document.getElementById("statusList");sessionStorage.removeItem("onCrate"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"),s?s.setAttribute("content","reload"):e.append(B()),O(),null===t&&localStorage.setItem("mode","light"),N(),function(){const t=localStorage.getItem("mode"),e=document.body;switch(t){case"light":document.getElementById("light-mode").checked=!0,e.classList.remove("dark-mode"),e.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,e.classList.remove("light-mode"),e.classList.toggle("dark-mode")}}(),async function(){const t=new DocumentFragment,e=new DocumentFragment,s=document.createElement("pack-up"),i=document.createElement("pack-down"),a=document.getElementById("contents1"),r=document.getElementById("contents2");s.setAttribute("name","select-materials"),s.className="materials",s.ariaHidden="false",i.setAttribute("name","update-materials"),i.setAttribute("content","0"),i.className="update-materials",t.appendChild(s),e.appendChild(i),a.appendChild(t),r.appendChild(e)}()},!localStorage.getItem("metrica")){const t=document.getElementById("cm").value;localStorage.setItem("metrica",t)}function F(){const t=localStorage.getItem("metrica"),e=confirm("Attention! You are going to change the measurement of the works.");t&&void 0!==t?e&&("cm - centimeters"===t?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")):localStorage.setItem("metrica",document.getElementById("cm").value),N()}const L=()=>{O(),f();const t=document.querySelector(".result");sessionStorage.getItem("codes")&&(t&&"true"===t.ariaHidden&&o(),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};const P=()=>{const t=document.querySelector(".result"),e=document.getElementById("layers"),s=document.querySelector(".plotter__menu"),i=document.getElementById("statusList"),a=document.getElementById("status-frame"),r=document.getElementById("first_pane"),n=document.getElementById("second_pane"),o=document.querySelector(".side-menu");confirm("Do you really want to delete the whole list?")&&(!function(){const{mode:t,metrica:e,materials:s}=localStorage;localStorage.clear(),sessionStorage.clear(),localStorage.setItem("mode",t),localStorage.setItem("metrica",e),localStorage.setItem("materials",s),p(),m(),y()}(),g(!0),globalThis.document.getElementById("input_estimate").value="",globalThis.document.getElementById("input_estimate").select(),openCloseDisplay([t,e,s]),i.setAttribute("content",void 0),a.removeChild(document.getElementById("statusList")),r.firstChild&&r.removeChild(document.getElementById("first-pane")),n.firstChild&&n.removeChild(document.getElementById("second-pane")),a.append(B()),o.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),document.querySelector(".materials").setAttribute("name","select-materials"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"))};function O(){const t=localStorage.getItem("refNumb");let e=document.cookie;return e=e.split("=")[1],t&&(document.getElementById("input_estimate").value=t),l(),function(){const t="Materials",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"materials"}),s.createIndex("materials","materials",{unique:!0})}}(),"OFF"!==e&&"FULL"!==e||function(){const t="off_line_results",e=globalThis.indexedDB.open(t);e.onerror=t=>{alert(`ATTENTION! ${t.target.errorCode}`)},e.onupgradeneeded=e=>{let s;s=e.target.result.createObjectStore(t,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}(),m()&&y()&&p()}function N(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function D({works:t}){let e=[];const s=Array.isArray(t[0][0])?t[0]:t;return s?.map((t=>{let s;if(Array.isArray(t))return e.push(t);for(s in t)e.push(s),1===t[s].length?e.push(t[s][0]):Array.isArray(t[0])?t[s][0].map((t=>e.push(t))):t[s].map((t=>e.push(t)))})),e}function R(t){if(!t)return"There is no crates. Please, try again!";const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",s=t.map((t=>{let s;return"string"==typeof t?`LAYER layer ${t?.at(-1)}:`:t.length>=5?(s=`CODE: ${t[0]} - ${t[1]} x ${t[2]} x ${t[3]} - ${e}`,s):4===t.length?(s=`CRATE: ${t[0]} x ${t[1]} x ${t[2]} - ${e}`,s):void 0})),i=function(t,e){for(;e--;)t=(t=(t=(t=(t=t.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return t=(t=t.replace("[","")).replace("]","")}(JSON.stringify(s),s.length);navigator.clipboard.writeText(i)}function U(){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),e=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(e))return alert('Please, press the "Crate" button if already added works.');t.postMessage(e),t.onmessage=t=>{(Array.isArray(t.data.crates)||t.data.hasOwnProperty("crates"))&&function({crates:t}){sessionStorage.setItem("copy1","done!"),R(t.allCrates)}(t.data)}}function _(){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),e=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(e))return alert('Please, press the "Crate" button if already added works.');t.postMessage(e),t.onmessage=t=>function({crates:t}){let e,s,i=[];for(e in t)t[e].hasOwnProperty("crates")&&t[e].crates.map(((t,e)=>{switch(e%2){case 0:i.push(t);break;case 1:s=D(t),s.map((t=>i.push(t))),s=null}}),0);return sessionStorage.setItem("copy2","done!"),R(i)}(t.data)}function M(t){localStorage.setItem("mode",t),function(t){const e=document.body.classList;e.remove("light-mode"),e.remove("dark-mode"),"dark"===t?e.add("dark-mode"):e.add("light-mode")}(t)}function W(t){const e=t.target.closest(".accordion-panel");if("body-app"===t.target.id)return X();e&&function(t){const e=t.parentElement.querySelectorAll("button"),s=t.parentElement.querySelectorAll(".menu__input");e.forEach((t=>{t.setAttribute("aria-expanded",!1)})),s.forEach((t=>{t.setAttribute("aria-hidden",!0)})),function(t){t.querySelector("button").setAttribute("aria-expanded",!0),t.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(t)}(e)}function X(){const t=document.querySelector(".accordion-panel");let e,s,i;for(e in t)s=t.parentElement.querySelectorAll("button"),i=t.parentElement.querySelectorAll(".menu__input"),s.forEach((t=>{t.setAttribute("aria-expanded",!1)})),i.forEach((t=>{t.setAttribute("aria-hidden",!0)}))}function q(){const t=document.getElementById("statusList"),e=document.getElementById("status-frame"),s=document.querySelector(".side-menu");e.removeChild(document.getElementById("statusList")),e.append(B()),t.setAttribute("content","FETCHED"),s.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),m(),y(),p()}async function Z(t){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),s=await new Promise(((s,i)=>{e.postMessage(t),e.onmessage=t=>{void 0!==t?s(t.data):i(void 0)}}));return!!s&&(document.getElementById("input_estimate").value=t,sessionStorage.setItem("FETCHED",JSON.stringify(s)),q(),H([s]),"IDB data Found.")}async function H(t){try{if(t?.hasOwnProperty("crates")){document.getElementById("input_estimate").value=t.reference;const{materials:e}=localStorage;return sessionStorage.clear(),sessionStorage.setItem("FETCHED",JSON.stringify(t,null)),localStorage.setItem("materials",e),q()}throw new TypeError("Data not found!")}catch(t){return t}}async function Y(t){const e=`/api/v1/estimates/${t}`,s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){return await fetch(e,{method:"GET",headers:s}).then((async t=>await t.json())).then(H).catch((t=>alert(`Search ERROR! \n ${t}`)))}}async function $(){const t=document.getElementById("estimate_getter").value,e=(s=document.getElementById("input_estimate").value,async t=>{s&&s!==t&&g(!0)});var s;if(!function(t){switch(/[^-a-z-A-Z-0-9]/g.test(t)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(t)){const s=[Z(t),Y(t)];await Promise.all(s).then((async s=>{s[0]||0!==s[1]?.length?await Promise.resolve(e(t)).then((async()=>{if(s[1]?.length>0){d({reference:s[1][0].reference_id,crates:s[1][0].crates.crates,list:s[1][0].works.list},!0)}else f(!0)})):alert("Document not found! Please, try again.")}))}}function j(){globalThis.navigator.serviceWorker.ready.then((async t=>{await caches.delete("craterCache_v1"),await caches.delete("status_V1"),await caches.delete("pane1_v1"),await caches.delete("pane2_v1"),await t.unregister()}))}async function J(){confirm("Are you sure to logout?")&&await fetch("/api/v1/logout",{method:"GET"}).then(j).then((t=>globalThis.location.assign(t.url))).catch((async()=>{await Promise.resolve(j).then(globalThis.location.replace("https://ottocratesolver.com/login"))}))}globalThis.onkeydown=t=>{const e="Enter"===t.key&&!0===t.ctrlKey,s=!0===t.ctrlKey&&!0===t.altKey&&"c"===t.key,i="Escape"===t.key;e&&L(),s&&o(),i&&X(),t.stopImmediatePropagation()},globalThis.onafterprint=()=>{const{shadowRoot:t}=document.querySelector(".update-materials");[...t.querySelectorAll("[aria-hidden]")].map((t=>t.ariaHidden="false"))},globalThis.onbeforeprint=()=>{const{shadowRoot:t}=document.querySelector(".update-materials");[...t.querySelectorAll("[aria-hidden]")].map((t=>t.ariaHidden="false"))},globalThis.document.getElementById("main-app").addEventListener("click",(t=>{const e=document.querySelector(".materials"),s=document.querySelector(".update-materials"),i=sessionStorage.getItem("crate");let a=i?+i.split("/")[0]:0;const r=i?+i.split("/")[1]:0,n=new GraphicCrates,c=document.getElementById("layer-count");let{id:h,className:l,attributes:d}=t.target;{const{shadowRoot:t}=e,s=t.querySelector(".upPane");s?.addEventListener("click",(t=>{const{id:e,className:i,tagName:a}=t.target,r=new CustomEvent("open-crate",{bubbles:!0,composed:!0,detail:{id:e,className:i,tagName:a}});s.dispatchEvent(r)}),!0)}{const{shadowRoot:t}=s,e=t.querySelector(".data-update");e?.addEventListener("click",(t=>{const{id:s,className:i}=t.target,a=new CustomEvent("update-materials-info",{bubbles:!0,composed:!0,detail:{id:s,className:i}});e.dispatchEvent(a),t.stopImmediatePropagation()}))}switch("crates"===d.content&&(l="crates"),h||(h=l)){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":W(t);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:t}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${t}`),globalThis.deferredPrompt=null}();break;case"add-btn":w();break;case"remove-btn":k();break;case"clear-btn":P();break;case"crate-btn":case"crate_btn":L();break;case"copy-pane1":U();break;case"copy-pane2":_();break;case"logout":case"logout-btn":J();break;case"exchange-header":A(),async function(){const t=sessionStorage.getItem("currency"),e=JSON.parse(sessionStorage.getItem("coin1")),s=JSON.parse(sessionStorage.getItem("coin2")),i=document.getElementById("coin1"),a=document.getElementById("coin2");null!==e&&(i.value=e),null!==s&&(a.value=s),null===t&&await S()}(),W(t);break;case"ex-btn":case"exchange-btn":A(),W(t);break;case"fetch-btn":$();break;case"crate-layers":case"layer-crate":o();break;case"previous":case"layer-prev":a>1&&(a-=1,sessionStorage.setItem("crate",`${a}/${r}`),c.innerText=`Current crate: ${a} / ${r}`,n.show);break;case"next":case"layer-next":a<r&&(a+=1,sessionStorage.setItem("crate",`${a}/${r}`),c.innerText=`Current crate: ${a} / ${r}`,n.show);break;case"settings-content":"update-materials"!==l&&"new-material"!==l&&e.setAttribute("content","settings-content");break;case"packages":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","packages");break;case"select-materials":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","select-materials");break;case"materials":"update-materials"!==l&&"select-materials"!==l&&e.setAttribute("content","confirm-save");break;case"report":case"report":e.setAttribute("name","packages");break;case"pack-opts":case"works-packed":e.setAttribute("name","works-packed");break;case"reset-sizes":e.setAttribute("name","reset-sizes");break;case"reset-szs":e.setAttribute("name","reset-szs");break;case"adding-material":e.setAttribute("name","adding-material");break;case"add__new__field":e.setAttribute("name","add__new__field");break;case"cancel-remove":e.setAttribute("name","cancel-remove");break;case"new-material":e.setAttribute("name","new-material");break;case"confirm-save":e.setAttribute("name","confirm-save");break;case"printer-icon":case"printer-btn":case"printer-svg":case"printer":globalThis.print()}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(t=>{switch(t.preventDefault(),t.target.id){case"input_estimate":l();break;case"in":case"cm":F();break;case"dark-mode":M("dark");break;case"light-mode":M("light");break;case"coin1":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(t)),v(t,e)}();break;case"coin2":!function(){const t=document.getElementById("coin2").value,e=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(t)),v(t,e)}();break;case"units1":!function(){const t=globalThis.document.getElementById("input-unit1"),e=globalThis.document.getElementById("input-unit2");t.value=0,e.value=0}();break;case"units2":!function(){const t=globalThis.document.getElementById("input-unit1"),e=globalThis.document.getElementById("input-unit2");t.value=0,e.value=0}();break;case"selected-crate":o()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(t=>{let{id:e,className:s}=t.target;switch(e||(e=s)){case"coin1-input":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),i=document.getElementById("coin2-input");v(e,i),i.value=`$ ${b(t,e,s,i)}`}();break;case"coin2-input":!function(){const t=document.getElementById("coin1").value,e=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),i=document.getElementById("coin2-input");v(t,s),s.value=`$ ${b(t,e,s,i)}`}();break;case"input-unit1":!function(){const t=globalThis.document.getElementById("units1").value,e=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),i=globalThis.document.getElementById("input-unit2");i.value=0,i.value=I(t,e,s,i)}();break;case"input-unit2":!function(){const t=globalThis.document.getElementById("units1").value,e=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),i=globalThis.document.getElementById("input-unit2");s.value=0,s.value=I(t,e,s,i)}()}}),!0),globalThis.onsubmit=t=>{t.preventDefault()},globalThis.document.getElementById("main-app").addEventListener("open-crate",(t=>{const{id:e,className:s,tagName:i}=t.detail,a=document.querySelector(".materials");"A"===i&&a.setAttribute("content",`${e}-${s}`)}),!0),globalThis.document.getElementById("main-app").addEventListener("update-materials-info",(t=>{const{id:e}=t.detail,s=document.querySelector(".update-materials");t.stopImmediatePropagation(),"update-info"===e&&s.setAttribute("name","update")}),!0),globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(t=>{"Enter"===t.key&&$()})),globalThis.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),console.log("👍","beforeinstallprompt",t),globalThis.deferredPrompt=t}));
