class Converter{#e;constructor(...e){this.#e=[...e]}get cmConvert(){return s.call(this.#e)}get inConvert(){return t.call(this.#e)}}function e(){const e=this.filter((e=>Number(e)?e:"string"==typeof e&&e?+e.trim():void 0));try{if(!e||e.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(e){return e}return e}function t(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t/e).toFixed(3)))}return t}function s(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t*e).toFixed(0)))}return t}class RegexChecker{#e;constructor(...e){this.#e=[...e]}get regexSizes(){return i.call(this.#e)}}function i(){try{const e=this.map((e=>{const t=/[0-9]{1,3}/.test(e);return!Number.isNaN(e)&&t})),t="Not a valid entry to RegexChecker!";if(e.includes(!1))throw new TypeError(t)}catch(e){return console.error(e),e}}class CubCalc{#t;#s;#i;constructor(e,t,s){this.#t=+e,this.#s=+t,this.#i=+s}get cubCalcAir(){return function(e,t,s){const i=new RegexChecker(e,t,s).regexSizes;if("object"==typeof i)return i;return+(e*t*s/6e3).toFixed(3)}(this.#t,this.#s,this.#i)}get cubArea(){return function(e,t,s){const i=new RegexChecker(e,t,s).regexSizes;if("object"==typeof i)return i;return+(e*t*s/1e6).toFixed(3)}(this.#t,this.#s,this.#i)}}class Hexaedro{constructor(e,t,s){try{if(!e||!t||!s)throw new TypeError("Please, provide a correct x, z or y value.")}catch(e){return e}this.x=+e,this.z=+t,this.y=+s}}class ArtWork extends Hexaedro{coordinates;packMaterials;code;#t;#s;#i;constructor(e,t,s,i,a){super(t,s,i);try{if(!e||e.trim()<=0){const t=`Please, provide a valid code. Current: ${e}`;throw new TypeError(t)}}catch(e){return e}this.code=""+e,this.#t=+t,this.#s=+s,this.#i=+i,this.packMaterials=a}#a(){const e={x:structuredClone(this.#t),z:structuredClone(this.#s),y:structuredClone(this.#i)};return this.packMaterials&&this.packMaterials.length&&this.packMaterials.map((t=>{e.x+=2*t[2],e.z+=2*t[2],e.y+=2*t[2]})),[this.code,+e.x.toFixed(3),+e.z.toFixed(3),+e.y.toFixed(3)]}#r(e,t){return e.map(((e,s)=>{const i=[this.packMaterials[s][0]];return i.push(+(100*t/e).toFixed(0)),i}),0)}#n(e){return e.map(((e,t)=>"Roll"===this.packMaterials[t][5]?[e[0],+(e[1]/100).toFixed(2)]:[e[0],Math.ceil(e[1]/100)]),0)}#o(e){return e.map((e=>1-+(e[1]/100).toFixed(3)%1))}#h(){const e=this.packingDemanded,t=this.packMaterials.map((e=>e[1]*e[3]/100)),s=this.#r(t,e),i=t.map(((t,i)=>[s[i][0],t>e]),0),a=this.#o(s),r=this.packMaterials.map((e=>e[4])),n=this.packMaterials.map(((e,s)=>[e[5],t[s],e[0]]),0),o=r.map(((e,t)=>{const i=+(s[t][1]/100*e).toFixed(2);return[s[t][0],i,+e]}),0),h=this.#n(s,a);return{demand:e,percent:s,reuse:i,residual:a,types:n,cost:o,quantity:h}}get arr(){return[this.code,this.#t,this.#s,this.#i]}get cAir(){return new CubCalc(this.#t,this.#s,this.#i).cubCalcAir}get cubed(){return new CubCalc(this.#t,this.#s,this.#i).cubArea}get autoConvert(){let{x:e,z:t,y:s}=this;const i=new Converter(e,t,s).cmConvert;return e=i[0],t=i[1],s=i[2],[this.code,e,t,s]}get data(){return{code:this.code,x:this.#t,z:this.#s,y:this.#i,packing:this.packMaterials}}get packingDemanded(){const{x:e,z:t,y:s}=this;return+(2*(e*s+e*t+s*t)/100).toFixed(5)}get cratePosition(){return this.coordinates}get packedSized(){return this.#a()}get packInfo(){return this.#h()}set defCoordinate(e){this.coordinates=e}}class ArrangerLargestCanvas{#c;constructor(e){return this.#c=e,this.#l()}#d(){const e=this.filter((e=>e.x>=213&&e.y>=213?e:0));return!!e.length&&e}#l(){const{sorted:e}=this.#c,t=this.#d.call(e);return t&&t.map((e=>{e&&this.#c.sorted.splice(this.#c.sorted.indexOf(e),1)})),t&&(this.#c.largest=t),this.#c}}class ArrangerNoCanvas{#p;constructor(e){return this.#p=e,this.#u()}#y(e){e.map((e=>{this.sorted.splice(this.sorted.indexOf(e),1)}))}#f(){let{sorted:e,sameSize:t}=this.#p;let s=e.filter((e=>e.z>15)),i=t.filter((e=>e.z>15)),a=[];return s.map((e=>a.push(e))),this.#y.call(this.#p,s),i.map((e=>a.push(e))),this.#y.call(this.#p,i),e=null,t=null,s=null,i=null,this.#p.noCanvas=a,this.#p}#u(){return this.#f()}}class ArrangerSameSize{#c;constructor({sorted:e}){return this.#c=e,this.#m()}#g(){const e=[];return this.map((t=>{let s,i=0;if(t.z<=10)for(i in this)a=this[i],r=t,s=a.cubed<=r.cubed&&a.code!==r.code,!e.includes(this[i])&&s&&e.push(this[i]);var a,r})),e}#z(e,t){const s=t.x,i=t.y,a=t.cubed;return e.x===s&&e.y===i&&e.cubed<=a}#x(e){const t=[];return e.map((s=>{let i=[],a=0;for(a in e)this.#z(e[a],s)&&!t.includes(e[a])&&i.push(e[a]);i.length>=4&&i.map((e=>{t.push(e)})),i=null})),t}#m(){const e=this.#g.call(this.#c),t=this.#x(e);return t.map((e=>{this.#c.splice(this.#c.indexOf(e),1)})),{sorted:this.#c,sameSize:t}}}class ArrangerStarter{#c;constructor(e){return this.#c=e,this.#w()}#C(){return this.#c.map((e=>{const t=e.arr;return t.push(e.cubed),t}))}#k(e,t){if(e.length<=1)return e;const s=[],i=e.splice(0,1),a=[];return e.map((e=>{e[t]<=i[0][t]?s.push(e):a.push(e)})),this.#k(s,t).concat(i,this.#k(a,t))}#w(){const e=this.#C(),t=this.#k(e,4),s=[];return t.map((e=>{this.#c.find((t=>e[0]===t.code?s.push(t):0))})),{sorted:s}}}class ArrangerTube{#c;constructor(e){return this.#c=e,this.#b()}#b(){const{noCanvas:e}=this.#c,t=e.filter((e=>{const t=e.z<35&&e.y<35,s=e.z===e.y;if(t&&s&&e.x!==e.y&&s)return e}));return t.map((e=>{this.#c.noCanvas.splice(this.#c.noCanvas.indexOf(e),1)})),this.#c.tubes=t,this.#c}}class Arranger{#S;constructor(e){this.#S=e;const t=this.#v();return t&&"TypeError"===t.constructor.name?t:(this.#A(),Object.assign(Arranger,{list:this.#S}))}#A(){this.#I(),this.#m(),this.#T(),this.#E(),this.#F()}#v(){try{const e=e=>0===e.length||!e;if(!Array.isArray(this.#S)||e(this.#S)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#S.map((e=>"ArtWork"===e.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(e){return e}}#I(){this.#S=new ArrangerStarter(this.#S)}#m(){this.#S=new ArrangerSameSize(this.#S)}#T(){this.#S=new ArrangerNoCanvas(this.#S)}#E(){this.#S=new ArrangerLargestCanvas(this.#S)}#F(){this.#S=new ArrangerTube(this.#S)}}class CrateMaker{#L;#B;constructor(e,t=!1){if(!e)return!1;this.#L=e,this.#B=t}#P(e){const t=["Pinewood","Plywood"],s=e.filter((e=>t.includes(e[5]))),i=e.filter((e=>"Foam Sheet"===e[5]));let a=0,r=0,n=0,o=0,h=0;return s.map((e=>{a+=+e[2],r+=+e[2]})),a*=2,r*=2,n*=2,i&&i.length&&i.map((e=>{if(this.#L>1&&e[2]<=2.5)return this.#B&&(this.#B=!1,n+=+e[2]),o=e[2],r+=+e[2]*(this.#L-1);1===this.#L&&e[2]<=2.5||(a+=2*+e[2],r+=2*+e[2],n+=2*+e[2],e[2]>2.5&&(h=2*e[2]))})),{x:a,z:r,y:n,div:o,pad:h}}#O(){let{materials:e,crating:t}=localStorage;const s=[];return e=JSON.parse(e),t=JSON.parse(t),t.map((t=>{const i=e.find((e=>e[0]===t));i&&s.push(i)})),s.length?this.#P(s):{x:0,z:0,y:0}}get outSizes(){return this.#O()}}class WorksCoordinates{#N;#D;#R;#X;constructor(e=!1){e&&(this.#D=[+e[0].toFixed(3),+e[1].toFixed(3),+e[2].toFixed(3)],this.#X=this.#W())}#W(){const e={emptyArea:[],artLocation:new Map,baseSize:this.#D,usedMaterials:new Map,innerSize:[],finalSize:[],layers:[],get reset(){this.emptyArea=[[0,0,this.baseSize[0],this.baseSize[2]]]},get fillGaps(){const e=[];return this.layers.map((t=>{const{vacuum:s,works:i}=t,a=((e,t=0)=>(e.map((e=>!t||e.work[2]>t[1]?t=[e.work[0],e.work[2]]:0)),t))(i),{total:r,sizes:n}=((e,t=0,s=[])=>(e.map((e=>{if(e[0]===e[2]&&e[1]===e[3])return;let i=e[2]-e[0],a=e[3]-e[1];!i&&a&&(i=e[0]),i&&!a&&(a=e[1]),s.push([+i.toFixed(2),+a.toFixed(2)]),t+=+(i*a).toFixed(3)})),{total:t,sizes:s}))(s);e.push({highestZ:a,total:r,sizes:n})})),e},set defineLayer(e){const t=structuredClone(this.emptyArea),s=structuredClone(e[1]);this.layers.push({vacuum:t,works:s}),this.reset},get fillMaterials(){const e=JSON.parse(localStorage.getItem("materials")),t=JSON.parse(localStorage.getItem("crating"));e.map((e=>t.includes(e[0])?this.usedMaterials.set(e[0],e):0))}};return e.reset,e.fillMaterials,e}#M(e,t,{x:s,y:i},a,r){const n=a[0][2],o=a[0][3],h=a[0][0],c=a[0][1],l=e&&h===n||!e&&h+s===n?n:t[0],d=!e&&c===o||e&&c+i===o?o:t[1];return{emptyX:e&&l<n?[+(t[0]+s).toFixed(3),+(t[1]+i).toFixed(3),n,o,r]:[n,t[1],n,o,r],emptyY:!e&&d<o?[t[0],+(t[1]+i).toFixed(3),n,o,r]:[+(t[0]+s).toFixed(3),o,n,o,r],pointX:l,pointY:d}}#U({prevX:e,prevY:t,x:s,y:i,pos:a},r,n,o){const h=n[0][2],c=n[0][3];(i===t||s===e)&&n.splice(a,1),(o||!r.pointX&&r.emptyX[0]<h)&&n.push(r.emptyX),(!o||!r.pointY&&r.emptyY[1]<c)&&n.push(r.emptyY)}#_(e,t,{x:s,y:i,flip:a},r){const{emptyArea:n}=this.#X,o=n[0][2],h=n[0][3];if(o===s&&h===i||o===i&&h===s)return;if(n.length>1){const{feat:o}=this.#N.info,{work:h}=o.find((e=>e.work[0]===t.at(-1))),c=n[0][0]===t[0];c&&!a?n[0][0]+=s:n[0][1]+=i;const l=h.length>3?h[1]:h[3],d=h.length>3?h[3]:h[1],p=this.#M(c,t,{x:s,y:i},n,r);return(c&&i<d||!c&&s<l)&&(c?(n[e][0]=t[0],n[e][1]=t[1]+i):(n[e][0]=t[0]+s,n[e][1]=t[1])),this.#U({x:s,y:i,pos:e,prevX:l,prevY:d},p,n,c)}const c=!(s===o)&&[s,0,o,h,r],l=!(i===h)&&[0,i,o,h,r];c&&n.push(c),l&&n.push(l)}#Z(e,t){const s=t[0]===t[2]&&t[1]===t[3],i=t[2],a=t[3],r=e[1]+t[0]<=i&&t[0]<i,n=e[3]+t[1]<=a&&t[1]<a,o=e[3]+t[0]<=i&&t[0]<i,h=e[1]+t[1]<=a&&t[1]<a;return{check01:!s&&(r&&n),check02:!s&&(o&&h)}}#Y({emptyArea:e,found:t,art:s,ind:i,pos:a}){const r=e[a],n=e[0][0]===e[0][2]&&e[0][1]===e[0][3];if(t||!r||n)return t;const{check01:o,check02:h}=this.#Z(s,r),c=e[0][2],l=e[0][3],d=s[1]===c&&s[3]===l||s[3]===c&&s[1]===l,p=e[0][0]===e[a][0];let u,y,f=!1;return o?(t=!0,u=s[1],y=s[3],this.#R[i].defCoordinate={x:e[a][0],z:s[2],y:e[a][1]},0===a&&(p?e[0][0]=(u||y>0)&&!d?u:c:e[0][1]=(u>0||y)&&!d?y:l)):h&&(t=!0,u=s[3],y=s[1],s.push('<i class="nf nf-oct-sync"></i>'),f=!0,this.#R[i].defCoordinate={x:e[a][0],z:s[2],y:e[a][1]},0===a&&(p?e[0][1]=(u||y>0)&&!d?e[0][2]-s[3]:l:e[0][0]=(u>0||y)&&!d?e[0][3]-s[1]:c)),t?this.#_(a,r,{x:u,y,flip:f},s[0]):a--,this.#Y({emptyArea:e,found:t,art:s,ind:i,pos:a})}#q(e,t,s){const i=void 0===e.emptyArea[0]&&void 0===e.emptyArea[1],a=e.emptyArea[0][0]===e.emptyArea[0][2],r=e.emptyArea[0][1]===e.emptyArea[0][3];if(i||!t[s]||a&&r)return e;let n;const{emptyArea:o,feat:h}=e,c=t[s],l=this.#R.findIndex((e=>e.code===c[0])),d={emptyArea:o,found:!1,art:c,ind:l,pos:o.length-1};return this.#Y(d)&&(n=t.splice(s,1).flat(),h.push({work:n,list:s,raw:l})),this.#q(e,t,s-1)}get bluePrintCoordinates(){return this.#X}get fillLayer(){const{info:e,list:t,len:s,raw:i}=this.#N;return this.#R=i,!!this.#N&&this.#q(e,t,s)}set fillPreparing(e){this.#N=e}}class CraterPythagoras{#c;#l;#R;#X;constructor(e){return e&&0!==e.length?(this.#R=e,this.#l=e.map((e=>e.arr)),this.#c=structuredClone(this.#l),this.#H()):{largest:!1}}#$(e,t,s,i=1){if(!e.length&&!s)return this.#X;const{emptyArea:a}=this.#X,r={emptyArea:a,feat:[]},n=e.length-1;let o;return t.fillPreparing={info:r,list:e,len:n,raw:this.#R},o=t.fillLayer,this.#X.defineLayer=[i,o.feat],this.#$(e,t,s-1,i+1)}#j(e,t,s,i){const a=new WorksCoordinates(e);this.#X=a.bluePrintCoordinates,this.#$(this.#c,a,t),this.#R.map((e=>this.#X.artLocation.set(e.code,e))),this.#X.innerSize=[e[0]+i,s+i,e[2]+i]}#J(e,t){const s=new CrateMaker(t).outSizes,i=+(e[0]+s.x).toFixed(3),a=+(e[1]+s.z).toFixed(3),r=+(e[2]+s.y).toFixed(3),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),h=r%1>0?r:r.toFixed(0),c=s.div&&t.length>1?e[1]+s.div*(t-1):e[1];return this.#j(e,t,c,s.pad),[+n,+o,+h]}#V(e){const t=+(Math.cos(Math.asin(240/e[2]))*e[2]).toFixed(3);return this.#X.finalSize=[e[0],t,240],[...this.#X.finalSize]}#G(e){let t,s=0,i=0,a=0;return e.map((e=>{s<e[1]&&(s=e[1]),i<e[2]&&(i=e[2]),a<e[3]&&(a=e[3])})),t=s>=a?this.#J([s,i,a],e.length):this.#J([a,i,s],e.length),t}#K(e){let t;return t=this.#G(e),e.map((e=>{e[1]<=t[2]&&e[3]>t[2]&&e.push('<i class="nf nf-oct-sync"></i>')})),this.#V(t)}#Q(){let e,t=[];for(;this.#l.length;)e=this.#l.splice(0,3),t.push(this.#K(e)),t.push({works:e});return t[0].push(this.#X),t}#H(){const e=this.#Q();return this.largest={crates:e}}}class CraterStandard{#R;#c;#ee;#te;#X;#se;#L=0;constructor(e,t,s,i){return e&&0!==e.length?(this.#R=e,this.#c=e.map((e=>e.packedSized)),this.#ee=s??4,this.#te=t,this.#ie([],i)):{standard:!1}}#ie(e,t){switch(t){case!1:return e=this.#ae(),this.#te?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e};case!0:return e=this.#re([],1,structuredClone(this.#c)),this.#te?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e}}}#ne(e,t){let s,i,a,r,n,o=0,h=0;for(n in e)s=e[n][0]>t[n][0],i=e[n][0]!==t[n][0],a=e[n][2]>t[n][2],r=e[n][2]!==t[n][2],s&&i?o+=1:i&&(h+=1),a&&r?o+=1:r&&(h+=1);return{opt1:o,opt2:h}}#oe(e,t){let s=0,i=0,a=0,r=0,n=2;return e.map((e=>e[0]<=300&&e[2]<=160?s++:a++)),t.map((e=>e[0]<=300&&e[2]<=160?i++:r++)),a===r?n=s<=i?1:2:a<r&&(n=s>=i?1:2),{bestArrange:n}}#ae(){const e={opt1:this.#re([],0,structuredClone(this.#c)),opt2:this.#re([],1,structuredClone(this.#c))},t=[],s=[],i=new WeakSet;Object.entries(e).map((e=>{"opt1"===e[0]?e[1].map(((e,s)=>s%2==0?t.push(e):0),0):e[1].map(((e,t)=>t%2==0?s.push(e):0),0)}));let a,r;return a=t.length===s.length?this.#ne(t,s):this.#oe(t,s),r=a.hasOwnProperty("bestArrange")?a.bestArrange:a.opt1<=a.opt2?1:2,i.add(a),1===r?e.opt1:e.opt2}#he(e,t){if(e.length<=1)return e;const s=[],i=e.splice(0,1),a=[];return e.map((e=>{e[t]<=i[0][t]?s.push(e):a.push(e)})),this.#he(s,t).concat(i,this.#he(a,t))}#ce(e,t){let s=0,i=0,a=0;const r=new CrateMaker(this.#L).outSizes;if(this.#L>1)for(i in t)Object.entries(t[i]).map((e=>{e.includes("status")||(e[1].map((e=>{e[2]>a&&(a=e[2])})),s+=a,a=0)}));a=r.div*(this.#L-1)+s,this.#X.innerSize=[+(e[0]+r.pad).toFixed(3),+(a+r.pad).toFixed(3),+(e[2]+r.pad).toFixed(3)],r.x+=e[0],r.z+=a||e[1],r.y+=e[2],r.y+=8;const n=r.x%1>0?r.x.toFixed(3):r.x.toFixed(0),o=r.z%1>0?r.z.toFixed(3):r.z.toFixed(0),h=r.y%1>0?r.y.toFixed(3):r.y.toFixed(0);return this.#R.map((e=>this.#X.artLocation.set(e.code,e))),this.#X.finalSize=[+n,+o,+h],[+n,+o,+h,structuredClone(this.#X)]}#le(e,t){switch(this){case 1:Array.isArray(t[0])?e.push({layer1:t}):e.push({layer1:[t]});break;case 2:Array.isArray(t[0])?e.push({layer2:t}):e.push({layer2:[t]});break;case 3:Array.isArray(t[0])?e.push({layer3:t}):e.push({layer3:[t]});break;case 4:Array.isArray(t[0])?e.push({layer4:t}):e.push({layer4:[t]});break;case 5:Array.isArray(t[0])?e.push({layer5:t}):e.push({layer5:[t]});break;default:return}return e}#de(e,t){const s=new WorksCoordinates(e);this.#X=s.bluePrintCoordinates;const i=[];let a,r,n,o=[],h=0;try{for(;h++<this.#ee&&t.length;){const{emptyArea:e}=this.#X;a={emptyArea:e,feat:[]},s.fillPreparing={info:a,list:t,len:t.length-1,raw:this.#R},r=s.fillLayer,n=structuredClone(r),o=n.feat.map((e=>{const t=this.#R.find((t=>t.code===e.work[0])).arr,s=structuredClone(e.work);return s[1]=t[1],s[2]=t[2],s[3]=t[3],s})),this.#le.call(h,i,o),this.#X.defineLayer=[h,r.feat],o=null,r=null,a=null,o=[]}}catch(e){console.error(e)}return this.#L=h-1,delete this.#X.defineLayer,delete this.#X.reset,{crate:i,measure:e,list:t}}#pe(e,t,s){if(s<0)return e.x<e.y&&([e.x,e.y]=[e.y,e.x]),e;const i=e.x*e.y>t[s][0]*t[s][3];return e.x=e.x<t[s][1]?t[s][1]:e.x,e.x=i&&e.x>=t[s][1]&&e.x+t[s][1]<=this.#se?e.x+t[s][1]:e.x,e.z=t[s][2]>e.z?t[s][2]:e.z,e.y=t[s][3]>e.y?t[s][3]:e.y,e.y=i&&e.y>=t[s][3]&&e.y+t[s][3]<=140?e.y+t[s][3]:e.y,this.#pe(e,t,s-1)}#ue(e){const{x:t,z:s,y:i}=this.#pe({x:0,z:0,y:0},e,e.length-1);return[t,s,i]}#ye(e){let t=e.map((e=>(e.push(e[1]*e[3]),e)));return t=this.#he(t,5),t=t.map((e=>(e.pop(),e))),e=t}#re(e,t,s){if(!s.length)return e;this.#se=t?250:180,s=this.#ye(s);const i=this.#ue(s),{crate:a,measure:r,list:n}=this.#de(i,s);return e.push(this.#ce(r,a)),e.push({works:a}),this.#re(e,t,n)}}class CraterLastCheckReArranger{#fe;constructor(e){return"crates ahead"===e[0]&&(this.#fe=e,this.#me())}#he(e,t){if(e.length<=1)return e;const s=[],i=e.splice(0,1),a=[];let r=0;for(r in e)e[r][t]<=i[0][t]?s.push(e[r]):a.push(e[r]);return this.#he(s,t).concat(i,this.#he(a,t))}#ge(e,t,s){const i=e[t],{works:a}=i;return a.map((e=>{Object.entries(e).map((e=>{e[1].map((e=>{1===e.length?s.push(e[0][0]):e.map((e=>Array.isArray(e[0])?s.push(e[0]):0))}))}))})),structuredClone(s)}#ze(e,t){const s=new WeakSet,i=t.works.length;let a,r=0,n=!0;for(;r++<e.length&&n;)r%2==1&&(a=1===i?structuredClone(t.works[0]):structuredClone(t.works),this.#ge(e,r,a),a=this.#he(a,4),a=new CraterStandard(a,!1,5,!0),a.crates.length===e.length&&(e.splice(r,1,a.crates[1]),e.splice(r-1,1,a.crates[0]),n=!1),s.add(a));return!n}#xe(e,t,s){return s<0?t:(s%2==1&&this.#ze(e,t[s])&&(t.splice(s-1,2),s=t.length),this.#xe(e,t,s-1))}#we(e){let t,s,i=0;for(s in e)if(i++%2==1&&5===e[s].works.length&&(t=e[s].works[4].layer5),t)break;return!!t&&{info:s,works:t}}#Ce(e,t){let s,i=[];return Object.entries(t).map((e=>{e[1].map((e=>{let t;for(t in e)e[t].length>0&&Array.isArray(e[t])&&e[t].map((e=>i.push(e)))}))})),e.map((e=>i.push(e))),s=this.#he(i,4),s}#ke(e,t,s,i){return e[i].works.pop(),e[i-1][1]-=10,e.splice(t-1,1,s.crates[0]),e.splice(t,1,s.crates[1]),e}#be(){const{crates:e}=this.#fe.standardCrate,t=this.#we(e);let s,i,a,r,n=0;if(t)for(r in e){if(!Array.isArray(e[r])&&n!==+t.info&&(s=this.#Ce(t.works,e[r]),i=new CraterStandard(s,!1,5,!0),a=2===i.crates.length,a)){this.#ke(e,n,i,t.info);break}n++}}#me(){const e=this.#fe.sameSizeCrate.crates,t=this.#fe.sameSizeCrate.backUp,s=this.#fe.standardCrate.crates;let i;if(e&&s){if(i=e.length,this.#xe(s,e,i),e.length===t.length)return this.#fe.sameSizeCrate.backUp=!1,void(this.#fe.standardCrate.backUp=!1);this.#be()}}}class CraterNotCanvas{#p;#R;#X;#c;constructor(e){return e&&0!==e.length?(this.#R=e,this.#p=e.map((e=>e.arr)),this.#c=e.map((e=>e.arr)),this.#T()):{noCanvas:!1}}#he(e,t){if(e.length<=1)return e;const s=[],i=e.splice(0,1),a=[];return e.map((e=>{e[t]<=i[0][t]?s.push(e):a.push(e)})),this.#he(s,t).concat(i,this.#he(a,t))}#j(e){const t=new WorksCoordinates(e);this.#X=t.bluePrintCoordinates;const{emptyArea:s}=this.#X,i={emptyArea:s,feat:[]},a=this.#c.length-1;let r;t.fillPreparing={info:i,list:this.#c,len:a,raw:this.#R},r=t.fillLayer,this.#X.defineLayer=[1,r.feat],this.#R.map((e=>this.#X.artLocation.set(e.code,e)))}#J(e){const t=new CrateMaker(this.#p).outSizes,s=+(e[0]+t.x).toFixed(3),i=+(e[1]+t.z).toFixed(3),a=+(e[2]+t.y).toFixed(3),r=s%1>0?s:s.toFixed(0),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),h=t.div?e[1]+t.div*this.#p.length:e[1];return this.#j([+r,+n,+o]),this.#X.innerSize=[e[0]+t.pad,h+t.pad,e[2]+t.pad],this.#X.finalSize=[+r,+n,+o],[...this.#X.finalSize,this.#X]}#Se(e){let t,s=0,i=0,a=0,r=0;return t=e.length/2,e.map((e=>{t-- >0&&(s+=e[1],i<e[2]&&(i=e[2])),a=e[1],r<e[2]&&(r=e[2])})),a>s||(a=s),r+=i,{newX:a,newZ:r}}#ve(e){const t=e.length>4&&e.length%2==0;let s,i=0,a=0,r=0;return e.map((e=>{i+=e[1],a=e[2]>a?e[2]:a,r=e[3]>r?e[3]:r})),(i>277||t)&&(s=this.#Se(e),i=s.newX,a=s.newZ),this.#J([i,a,r])}#Ae(e,t){const s=e[1]===t[1]&&e[1]<277,i=e[2]===t[2]&&e[2]<177,a=e[3]<=132;return!!(s&&i&&a)}#Ie(e,t,s,i){return i.length%2==0&&e>554&&2*t+10<177?i.length:0===s||i[0][1]>554?1:s}#Te(e){let t=10*e.length,s=0,i=0;const a=e[0];return e.map((e=>{const r=this.#Ae(e,a),n=e[2]-a[2],o=a[2]-e[2];(!0===r||(n>0&&n<=10||o>0&&o<=10))&&(i++,t+=e[1],s+=e[3])})),this.#Ie(t,s,i,e)}#Ee(e){if(!Array.isArray(e))return e;let t=e.map((e=>(e.push(e[1]*e[2]),e)));return t=this.#he(t,5),t=t.map((e=>(e.pop(),e))),this.#p=t}#T(){const e=[];let t;for(this.#Ee(this.#p);this.#p.length>0;)t=this.#Te(this.#p),t=this.#p.splice(0,t),t.length>0?(e.push(this.#ve(t)),e.push({works:t})):(e.push(this.#ve(this.#p.splice(0,1))),e.push({works:t}));return{crates:e}}}class CraterSameSize{#p;#Fe;#R;#X;constructor(e){return e&&0!==e.length?(this.#R=structuredClone(e),this.#p=e.map((e=>e.arr)),this.#Fe=e[0].packedSized,this.#Le()):{sameSize:!1}}#$(e,t,s=1){if(!e.length)return this.#X;const{emptyArea:i}=this.#X,a={emptyArea:i,feat:[]},r=e.length-1;let n;return t.fillPreparing={info:a,list:e,len:r,raw:this.#R},n=t.fillLayer,this.#X.defineLayer=[s,n.feat],this.#$(e,t,s+1)}#j(e,t){const s=JSON.parse(localStorage.getItem("materials")),i=JSON.parse(localStorage.getItem("crating"));let a;i.map((e=>{const t=s.filter((t=>{return e===(s=t)[0]&&s[2]<5&&"Foam Sheet"===s[5];var s}));t.length&&(a=t.flat())})),t&&(e[2]=+a[2]);const r=new WorksCoordinates(e);this.#X=r.bluePrintCoordinates;const n=structuredClone(this.#p);return this.#$(n,r),this.#R.map((e=>this.#X.artLocation.set(e.code,e))),e}#Be(e,t){const s=new CrateMaker(this.#p.length,t).outSizes,i=+(e[0]+s.x).toFixed(3),a=+(e[1]+s.z).toFixed(3),r=+(e[2]+s.y).toFixed(3),n=i%1>0?i:i.toFixed(0),o=a%1>0?a:a.toFixed(0),h=r%1>0?r:r.toFixed(0),c=e[1]+s.div*this.#p.length;return this.#j([+n,+o,+h],t),this.#X.innerSize=[e[0]+crate.pad,c+crate.pad,e[2]+crate.pad],this.#X.finalSize=[+n,+o,+h],[...this.#X.finalSize,this.#R]}#Pe(e,t,s){const i=e.map((e=>{const i=e[0]+t[0]<=s[0],a=e[1]+t[1]<=s[1],r=e[2]+t[2]<=s[2];if(i&&a&&r)return e}));return void 0!==i[0]&&i.map((t=>e.splice(e.indexOf(t),1))),void 0!==i[0]}#Oe(e,t){let s=[];return void 0!==t.map((t=>{const i=t[0]===e[0][0],a=t[2]===e[0][2],r=t[0]===e[0][0]-this.#Fe[1],n=t[2]===e[0][2]-this.#Fe[3];if(i&&a||r&&n)return t;if(s.length>0){if(this.#Pe(s,t,e))return t}else s.push(t)}))[0]}#Ne(e,t){const s=e.shift(),i=Array.isArray(t[0])?t[0].length:t.length;let a,r,n,o;return s?(a=i%2+i/2,r=e[0],n=a*this.#Fe[2],o=e[2]):(a=i%2+i,r=e[0],n=a*this.#Fe[2],o=e[2]),this.#Be([r,n,o],s)}#De(e,t){const s=t.length>3?[t[0][1],t[0][2],t[0][3]]:t;let i=e[0],a=e[1],r=e[2]+s[2],n=!1;return r>132&&i<132?([r,i]=[i,r],n=!0):r>e[2]&&(n=!0),[n,[i,a,r]]}#Re(e){let t,s,i=e.splice(0,1).flat(),a=e.splice(0,1).flat();return e.length>0&&(t=this.#Oe(i,e)),t?(i=this.#De(i,e.splice(0,1)),e[0].map((e=>a[0][0].push(e))),e.splice(0,e[0].length)):a[0].length>10&&a[0].length%2==0?i=this.#De(i,a[0]):i.unshift(!1),Array.isArray(a[0][0])&&(a=a.flat()),s=this.#Ne(i.flat(),a),{crate:s,works:a}}#Xe(e){const t=[];let s;for(;e.length;)s=this.#Re(e),t.push(s.crate),t.push({works:s.works});return t}#We(){let e=this.#p[0][1],t=this.#p[0][2],s=this.#p[0][3],i=[[e,t,s]],a=[];return this.#p.map((r=>{r[2]<=14&&(r[1]!==e&&r[3]!==s&&(i.push([a]),e=r[1],t=r[2],s=r[3],i.push([e,t,s]),a=[]),a.push(r))})),i.push(a),i[1][0].length>=4?i:null}#Le(){let e=this.#We();if(null===e)return null;const t=this.#Xe(e);return e=null,{crates:t,backUp:structuredClone(t)}}}class CraterTube{#Me;#Ue;#X;#R;constructor(e){if(!e||0===e.length)return{tube:!1};this.#R=e,this.#Me=e.map((e=>e.arr)),this.#Ue=35;return this.#Me.filter((e=>e[2]<this.#Ue&&e)).find((e=>!1!==e))?this.#_e():{tube:!1}}#_e(){return this.#Ze(),this.#Me}#Ye(e,t){const s=new WorksCoordinates(e);this.#X=s.bluePrintCoordinates;const{emptyArea:i}=this.#X;let a,r={emptyArea:i,feat:[]},n=Array.isArray(t[0])?t.length-1:0;s.fillPreparing={info:r,list:t,len:n,raw:this.#R},a=s.fillLayer,this.#X.defineLayer=[1,a.feat],this.#X.innerSize=[e[0],e[1],e[2]],this.#R.map((e=>this.#X.artLocation.set(e.code,e)))}#qe(e){let t=e[0][1],s=e[0][2],i=0;return e.map((e=>{t=e[1]>t?e[1]:t,s=e[2]>s?e[2]:s,i+=e[3]})),[t,s,i]}#He(){const e=new CrateMaker(1),t=+(this[0]+e.x).toFixed(3),s=+(this[1]+e.z).toFixed(3),i=+(this[2]+e.y).toFixed(3),a=t%1>0?t:t.toFixed(0),r=s%1>0?s:s.toFixed(0),n=i%1>0?i:i.toFixed(0);return this.#Ye([this[0]+e.pad,this[1]+e.pad,this[2]+e.pad],structuredClone(list)),this.#X.finalSize=[+a,+r,+n],[...this.#X.finalSize]}#$e(e){const t=this.#qe(e);return this.#He(t,e)}#je(e){switch(e.length){case 1:case 2:case 3:case 4:return this.#$e(e)}}#Je(e){const t=[];let s;for(;e.length>=3;)s=e.splice(0,3),t.push(this.#je(s.length,s)),t.push({works:s});return t}#Ve(){const e=this.#Me.filter((e=>{if(e[2]>this.#Ue)return e}));return e.map((e=>{this.#Me.splice(this.#Me.indexOf(e),1)})),e}#Ze(){let e=[],t=[];const s=this.#Ve();for((s.length>0||s.length>3)&&t.push(this.#Je(s));this.#Me.length;)e=this.#Me.splice(0,3),t.push(this.#je(e)),t.push({works:e});return this.#Me.length>=1&&(t.push(this.#je(this.#Me.length,this.#Me)),t.push({works:this.#Me})),this.#Me={crates:t}}}class Crater{#S;#Ge;constructor(e){return e!==Arranger?{crater:!1}:(this.#S=e.list,this.#Ge=["crates ahead"],Object.assign(Crater,this.#Ke()))}#Ke(){let e=0;const t=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(e in this.#$e(),this.#Qe(),this.#et(),this.#tt(),this.#st(),this.#it(),this.#Ge)this.#Ge[e]?.hasOwnProperty("crates")&&t.includes(e)||delete this.#Ge[e];return this.#at(),this.#rt(),this.#nt(),this.#ot(),Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#ht(),this.#ct(),this.#lt()),{crates:this.#Ge}}#$e(){const e=new CraterTube(this.#S?.tubes);this.#Ge.tubeCrate=e}#Qe(){const e=new CraterPythagoras(this.#S?.largest);this.#Ge.largestCrate=e}#et(){const e=new CraterSameSize(this.#S?.sameSize);this.#Ge.sameSizeCrate=e}#tt(){const e=new CraterNotCanvas(this.#S?.noCanvas);this.#Ge.noCanvasCrate=e}#st(){const e=this.#Ge.sameSizeCrate.hasOwnProperty("crates"),t=new CraterStandard(this.#S?.sorted,e,4,!1);this.#Ge.standardCrate=t}#it(){new CraterLastCheckReArranger(this.#Ge)}#at(){let e=0;const t=[],s=e=>{Array.isArray(e)&&t.push(e)};for(e in this.#Ge)this.#Ge[e]?.crates?.map(s);this.#Ge.allCrates=t}#lt(){let e,t,s=0;const i=[],a=e=>{Array.isArray(e)&&i.push(e)};for(s in this.#Ge)e="sameSizeCrate"===this.#Ge[s],t="standardCrate"===this.#Ge[s],(e||t)&&this.#Ge[s]?.backUp?.map(a),this.#Ge[s]?.crates?.map(a);this.#Ge.allCratesBackUp=i}#rt(){let e=0;const t=e=>{if(Array.isArray(e)&&e.length>=3){const t=e[0],s=e[1],i=e[2],a=new CubCalc(t,s,i).cubCalcAir,r=4===e.length?e.splice(3,1,a):e.push(a);Array.isArray(r)&&e.push(r)}};for(e in this.#Ge)this.#Ge[e]?.crates?.map(t);Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#Ge?.sameSizeCrate?.backUp?.map(t),this.#Ge?.standardCrate?.backUp?.map(t))}#nt(){let e=0,t=[];const s=e=>{Array.isArray(e)&&t.push(e[3])};for(e in this.#Ge)this.#Ge[e]?.crates?.map(s);t=t.reduce(((e,t)=>e+t),0),this.#Ge.airCubTotal=t.toFixed(3)}#ht(){let e,t,s=[],i=0;const a=e=>{Array.isArray(e)&&s.push(e[3])};for(i in this.#Ge)e="sameSizeCrate"===this.#Ge[i],t="standardCrate"===this.#Ge[i],e||t?this.#Ge[i]?.backUp?.map(a):e||t||this.#Ge[i]?.crates?.map(a);s=s.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ge.airCubTotalBackUp=s}#dt(e){if(Array.isArray(e)){const t=e[0],s=e[1],i=e[2];return t>300||s>200||i>160?"CARGO":"PAX"}}#ot(){let e,t=0,s=0,i=0;for(i in this.#Ge)this.#Ge[i]?.crates?.map((i=>{e=this.#dt(i),"PAX"===e?t++:"CARGO"===e&&s++}));this.#Ge.whichAirPort=[{PAX:t},{CARGO:s}]}#ct(){let e,t,s,i=0,a=0,r=0;for(i in this.#Ge)e="sameSizeCrate"===this.#Ge[i],t="standardCrate"===this.#Ge[i],e||t?this.#Ge[i]?.backUp?.map((e=>{s=this.#dt(e),"PAX"===s?a++:"CARGO"===s&&r++})):e||t||this.#Ge[i]?.crates?.map((e=>{s=this.#dt(e),"PAX"===s?a++:"CARGO"===s&&r++}));this.#Ge.whichAirPortBackUp=[{PAX:a},{CARGO:r}]}}class UnitAdapter{#c;#pt;constructor(e,t){return this.#c=e,this.#pt=t,this.#ut()}#yt(){try{if(!Array.isArray(this.#c)){throw new TypeError("Please, provide a valid list.")}if(this.#c.some((e=>"ArtWork"!==e.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#pt&&"in"!==this.#pt){throw new TypeError("Please, provide a valid unit.")}}catch(e){return e}return"pass"}async#ut(){let e;const t=this.#yt();switch("pass"!==t?"error":"cm"===this.#pt?"cm":"in"){case"error":return t;case"cm":return e=await this.#ft(),e;case"in":return e=await this.#mt(),e}}#gt(e){const t=e?.hasOwnProperty("crates"),s=e?.hasOwnProperty("backUp");return Array.isArray(e)?e.map(a):e?.hasOwnProperty("crates")?((t||s)&&(e.crates=e.crates.map((e=>4===e.length?a(e):(Array.isArray(e.works[0])?e.works=e.works.map(a):e.works=e.works.map(r),e))),console.log(e.crates)),e):e}#zt(){return this.#c.map((e=>{const t=e.autoConvert,s=t[0],i=t[1],a=t[2],r=t[3];return new ArtWork(s,i,a,r)}))}#xt(e){let t=0;for(t in e)e[t].hasOwnProperty("crates")&&(e[t]=this.#gt(e[t]));return e.sameSizeCrate?.hasOwnProperty("backUp")&&(e.airCubTotalBackUp=+(.061023*e.airCubTotalBackUp).toFixed(3),e.allCratesBackUp=this.#gt(e.allCratesBackUp)),e.allCrates=this.#gt(e.allCrates),e}async#ft(){return await Promise.resolve(new Arranger(this.#c)).then((e=>new Crater(e))).then((e=>e.crates)).catch((e=>e))}async#mt(){return await Promise.resolve(this.#zt()).then((e=>new Arranger(e))).then((e=>new Crater(e))).then((e=>this.#xt(e.crates))).catch((e=>e))}}function a(e){const t=.061023;let s,i,a,r;switch(console.log(e),e.length){case 4:return i=e[0],a=e[1],r=e[2],s=Array.from(new Converter(i,a,r).inConvert),s.push(+(e[3]*t).toFixed(3)),s;case 5:return i=e[1],a=e[2],r=e[3],s=Array.from(new Converter(i,a,r).inConvert),s.unshift(e[0]),s.push(+(e[3]*t).toFixed(3)),s;case 6:return i=e[1],a=e[2],r=e[3],s=Array.from(new Converter(i,a,r).inConvert),s.unshift(e[0]),s.push(+(e[3]*t).toFixed(3)),s.push(e[5]),s}}function r(e){let t;for(t in e)Array.isArray(e[t][0][0][0])?e[t][0].map((e=>e.splice(0,1,a(e[0])))):e[t]=[a(e[t][0])];return e}class largestCrateRender{#Ge;#wt;constructor(e,t){this.#Ge=e,this.#wt=t}#Ct(){return{result:undefined,meta:this.#wt}}get composeCrate(){return this.#Ct()}}class notCanvasCrateRender{#Ge;#wt;constructor(e,t){this.#Ge=e,this.#wt=t}#Ct(){return{result:undefined,meta:this.#wt}}get composeCrate(){return this.#Ct()}}let n={showlegend:!0,legend:{title:{text:"Proto crate:",font:{family:"Mitr, sans-serif",size:14}},font:{family:"Mitr, sans-serif",sizes:14,color:"#FFFFFFAA"},x:.02,xanchor:"left",y:.99,yanchor:"top",orientation:"v",groupclick:"sides"},margin:{t:0,l:0,b:0,r:0,pad:10},scene:{aspectmode:"data",xaxis:{title:{text:"Length - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",ticks:"outside"},yaxis:{title:{text:"Depth - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},zaxis:{title:{text:"Height - (cm)",family:"Mitr, sans-serif"},color:"white",thickcolor:"white",tick:"outside"},camera:{eye:{x:0,y:3,z:1}}},paper_bgcolor:"#96979C"};class TraceMaker{#kt;#bt;#St=new Map;constructor(){[["fill","#BF5E30"],["frame","#002A3D"],["walls","yellow"],["padding","#FFFFF0"],["div","#002A3D"]].map((e=>{this.#St.set(e[0],e[1])})),this.#kt=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]}#vt(){const{info:e,coordinates:t,name:s,show:i}=this.#bt,a=this.#St.get(s.color??s)??s.color;return this.#kt.forEach(((r,n)=>{const o=t[r[0]],h=t[r[1]];e.push({x:[o.x,h.x],z:[o.y,h.y],y:[o.z,h.z],name:s.name??s,mode:"lines",type:"scatter3d",line:{color:a,width:1.5},showlegend:!(!i||0!==n),hovertext:s.code??s,legendgroup:s.name??s,hovertemplate:`L: %{x}<br>H: %{z}<br>D: %{y}<br>Code: ${s.code}`,contour:{show:!(!i||0!==n),color:"#BB0056BB",width:2}})})),e}set data(e){this.#bt=e}get defineTrace(){return this.#vt()}}class DesignWalls{#bt;#St=new Map;#At;constructor(){[["frame","yellow"],["walls","#BF5E30"],["padding","#222725"],["div","#EFECBBBE"],["fill","#2DD751"]].map((e=>{this.#St.set(e[0],e[1])})),this.#At=[[[0,1,2],[0,2,3]],[[4,7,6],[4,6,5]],[[0,3,7],[0,7,4]],[[1,5,6],[1,6,2]],[[0,4,5],[0,5,1]],[[3,2,6],[3,6,7]]]}#It(){const{width:e,depth:t,height:s,offsetX:i,offsetZ:a,offsetY:r,info:n,name:o}=this.#bt,h=this.#St.get(o.color||o),c=[[0,0,0],[e,0,0],[e,t,0],[0,t,0],[0,0,s],[e,0,s],[e,t,s],[0,t,s]].map((e=>[e[0]+i,e[1]+r,e[2]+a])),l=c.map((e=>e[0])),d=c.map((e=>e[1])),p=c.map((e=>e[2])),u=[],y=[],f=[];return this.#At.map((e=>{e.map((e=>{u.push(e[0]),y.push(e[1]),f.push(e[2])}))})),n.push({x:l,y:d,z:p,i:u,j:y,k:f,name:o.name??o,type:"mesh3d",color:h,hovertext:o.code??o,hovertemplate:o.code?`L: %{x}<br>H: %{z}<br>D: %{y}<br>Code: ${o.code}`:"L: %{x}<br>H: %{z}<br>D: %{y}<br>",showlegend:!1,legendgroup:o.name??o,opacity:.2,flatshading:!0,showscale:!0,contour:{show:!0,color:"white",width:2}}),n}set objectData(e){this.#bt=e}get designSides(){return this.#It()}}class sameSizeCrateRender{#Ge;#wt;constructor(e,t){this.#Ge=e,this.#wt=t}#Ct(){return{result:undefined,meta:this.#wt}}get composeCrate(){return this.#Ct()}}class SetCrateWalls{#bt;#Tt;#Et;#Ft;constructor(e,t,s){const i=JSON.parse(localStorage.getItem("crating")).map((e=>t.usedMaterials.get(e)));this.#Tt=i.find((e=>"Pinewood"===e.at(-1))),this.#Et=i.find((e=>"Plywood"===e.at(-1))),this.#Ft=e,this.#bt=s,this.#Et[1]=+this.#Et[1],this.#Et[2]=+this.#Et[2],this.#Et[3]=+this.#Et[3]}#Lt(){const e=this.#Tt[2]+this.#Et[2],t=this.#Ft[0]-this.#Tt[2],s=this.#Ft[2]-e,i=this.#Ft[1]-e,a=this.#Ft[0]-e,r=this.#Tt[2]+this.#Et[2],n=2*this.#Tt[2]+this.#Et[2],o=this.#Ft[1]-this.#Tt[2];return{backFace:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:this.#Et[2]},{x:t,y:0,z:this.#Et[2]},{x:t,y:s,z:this.#Et[2]},{x:0,y:s,z:this.#Et[2]}],frontFace:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:t,y:0,z:i},{x:t,y:s,z:i},{x:0,y:s,z:i}],sideRight:[{x:0,y:0,z:0},{x:r,y:0,z:0},{x:r,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:r,y:0,z:i},{x:r,y:s,z:i},{x:0,y:s,z:i}],sideLeft:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:a,y:0,z:i},{x:a,y:s,z:i},{x:0,y:s,z:i}],top:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:o},{x:t,y:0,z:o},{x:t,y:s,z:o},{x:0,y:s,z:o}],bottom:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:n,z:0},{x:0,y:n,z:0},{x:0,y:0,z:o},{x:t,y:0,z:o},{x:t,y:n,z:o},{x:0,y:n,z:o}]}}#Bt(e,t){const{x:s,y:i,z:a}=e,r=structuredClone(t);return Object.entries(r).map(((e,t)=>{switch(t){case 0:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 1:return 0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 2:return 0===e[1].z&&(e[1].z=a),e;case 3:return 0===e[1].x&&(e[1].x=s),0===e[1].z&&(e[1].z=a),e;case 4:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),e;case 5:return 0===e[1].y&&(e[1].y=i),e;case 7:return 0===e[1].x&&(e[1].x=s),e}})),r}#Pt(){return{faceBack:{type:"backFace",x:this.#Tt[2],y:3*this.#Tt[2],z:2*this.#Tt[2],width:this.#Ft[0]-2*this.#Tt[2],depth:this.#Tt[2],height:this.#Ft[2]-(3*this.#Tt[2]+2*this.#Et[2]),offsetX:this.#Tt[2],offsetY:this.#Tt[2],offsetZ:3*this.#Tt[2]},faceFront:{type:"frontFace",x:this.#Tt[2],y:3*this.#Tt[2],z:this.#Ft[1]-this.#Tt[2],width:this.#Ft[0]-2*this.#Tt[2],depth:this.#Tt[2],height:this.#Ft[2]-(3*this.#Tt[2]+2*this.#Et[2]),offsetX:this.#Tt[2],offsetY:this.#Ft[1]-2*this.#Tt[2],offsetZ:3*this.#Tt[2]},faceRight:{type:"sideRight",x:this.#Tt[2],y:3*this.#Tt[2],z:2*this.#Tt[2],width:this.#Tt[2],depth:this.#Ft[1]-4*this.#Tt[2],height:this.#Ft[2]-(3*this.#Tt[2]+2*this.#Et[2]),offsetX:this.#Tt[2],offsetY:2*this.#Tt[2],offsetZ:3*this.#Tt[2]},faceLeft:{type:"sideLeft",x:this.#Ft[0]-this.#Tt[2],y:3*this.#Tt[2],z:2*this.#Tt[2],width:this.#Tt[2],depth:this.#Ft[1]-(2*this.#Tt[2]+2*this.#Et[2]),height:this.#Ft[2]-(3*this.#Tt[2]+2*this.#Et[2]),offsetX:this.#Ft[0]-2*this.#Tt[2],offsetY:2*this.#Tt[2],offsetZ:3*this.#Tt[2]},top:{type:"top",x:this.#Tt[2],y:this.#Ft[2]-this.#Tt[2],z:this.#Tt[2],width:this.#Ft[0]-2*this.#Tt[2],depth:this.#Ft[1]-2*this.#Tt[2],height:this.#Tt[2],offsetX:this.#Tt[2],offsetY:this.#Tt[2],offsetZ:this.#Ft[2]-2*this.#Tt[2]},bottom:{type:"bottom",x:this.#Tt[2],y:2*this.#Tt[2],z:this.#Tt[2],width:this.#Ft[0]-2*this.#Tt[2],depth:this.#Ft[1]-2*this.#Tt[2],height:this.#Tt[2],offsetX:this.#Tt[2],offsetY:this.#Tt[2],offsetZ:2*this.#Tt[2]}}}#Ot(){const e=new TraceMaker,t=new DesignWalls,s=this.#Lt(),i=this.#Pt();let a=structuredClone(this.#bt),r=!0;return this.#Et?(Object.entries(i).map((i=>{const{type:n,offsetX:o,offsetY:h,offsetZ:c,width:l,depth:d,height:p}=i[1],u=s[n],y=this.#Bt(i[1],u);e.data={info:a,coordinates:y,name:"walls",show:r},a=e.defineTrace,t.objectData={width:l,depth:d,height:p,info:a,name:"walls",offsetX:o,offsetY:h,offsetZ:c},a=this.#bt=t.designSides,r=!1})),a):this.#bt}get setWalls(){return this.#Ot()}}class CratesFrame{#kt;#Nt;#Tt;constructor(e,t){const s=JSON.parse(localStorage.getItem("crating")).map((e=>t.usedMaterials.get(e)));this.#Tt=s.find((e=>"Pinewood"===e.at(-1))),this.#Nt=e,this.#kt=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#Tt[1]=+this.#Tt[1],this.#Tt[2]=+this.#Tt[2],this.#Tt[3]=+this.#Tt[3]}#Dt(e){const t=[];return this.#kt.forEach((s=>{const i=e[s[0]],a=e[s[1]];t.push({x:[i.x,a.x],y:[i.y,a.y],z:[i.z,a.z],name:"",mode:"lines",type:"scatter3d",showlegend:!1,opacity:0,line:{color:"#F0000000"}})})),t}#Rt(){return{offsetFeetRightFirst:{type:"feet",x:0,y:0,z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:0,offsetY:0,offsetZ:0},offsetFeetLeftFirst:{type:"feetR",x:this.#Nt[0],y:0,z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:this.#Nt[0]-this.#Tt[3],offsetY:0,offsetZ:0},offsetFeetRightSecond:{type:"feetUp",x:0,y:this.#Tt[2],z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:0,offsetY:0,offsetZ:this.#Tt[2]},offsetFeetLeftSecond:{type:"feetUpR",x:this.#Nt[0],y:this.#Tt[2],z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:this.#Nt[0]-this.#Tt[3],offsetY:0,offsetZ:this.#Tt[2]},offsetFacesRightBackV:{type:"faceV",x:this.#Tt[2],y:this.#Tt[3]+2*this.#Tt[2],z:0,width:this.#Tt[3],depth:this.#Tt[2],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Tt[2],offsetY:0,offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetFacesLeftBackV:{type:"faceVR",x:this.#Nt[0]-this.#Tt[2],y:this.#Tt[3]+2*this.#Tt[2],z:0,width:this.#Tt[3],depth:this.#Tt[2],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Nt[0]-(this.#Tt[3]+this.#Tt[2]),offsetY:0,offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetFacesRightFrontV:{type:"faceVB",x:this.#Tt[2],y:this.#Tt[3]+2*this.#Tt[2],z:this.#Nt[1],width:this.#Tt[3],depth:this.#Tt[2],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Tt[2],offsetY:this.#Nt[1]-this.#Tt[2],offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetFacesLeftFrontV:{type:"faceVBR",x:this.#Nt[0]-this.#Tt[2],y:this.#Tt[3]+2*this.#Tt[2],z:this.#Nt[1],width:this.#Tt[3],depth:this.#Tt[2],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Nt[0]-(this.#Tt[3]+this.#Tt[2]),offsetY:this.#Nt[1]-this.#Tt[2],offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetSidesRightVUp:{type:"sideHUp",x:0,y:this.#Nt[2]-this.#Tt[2],z:this.#Tt[2],width:this.#Tt[2],depth:this.#Nt[1]-2*this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:this.#Tt[2],offsetZ:this.#Nt[2]-(this.#Tt[3]+this.#Tt[2])},offsetSidesLeftVUp:{type:"sideLeftHUp",x:this.#Nt[0],y:this.#Nt[2]-this.#Tt[2],z:this.#Tt[2],width:this.#Tt[2],depth:this.#Nt[1]-2*this.#Tt[2],height:this.#Tt[3],offsetX:this.#Nt[0]-this.#Tt[2],offsetY:this.#Tt[2],offsetZ:this.#Nt[2]-(this.#Tt[3]+this.#Tt[2])},offsetSidesRightHDown:{type:"sideHDown",x:0,y:2*this.#Tt[2],z:this.#Tt[2],width:this.#Tt[2],depth:this.#Nt[1]-2*this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:this.#Tt[2],offsetZ:2*this.#Tt[2]},offsetSidesLeftHDown:{type:"sideLeftHDown",x:this.#Nt[0],y:2*this.#Tt[2],z:this.#Tt[2],width:this.#Tt[2],depth:this.#Nt[1]-2*this.#Tt[2],height:this.#Tt[3],offsetX:this.#Nt[0]-this.#Tt[2],offsetY:this.#Tt[2],offsetZ:2*this.#Tt[2]},offsetFacesBackUpH:{type:"faceHUp",x:0,y:this.#Nt[2]-this.#Tt[2],z:0,width:this.#Nt[0],depth:this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:0,offsetZ:this.#Nt[2]-(this.#Tt[2]+this.#Tt[3])},offsetFacesBackDownH:{type:"faceH",x:0,y:2*this.#Tt[2],z:0,width:this.#Nt[0],depth:this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:0,offsetZ:2*this.#Tt[2]},offsetFacesFrontUpH:{type:"faceHBackUp",x:0,y:this.#Nt[2]-this.#Tt[2],z:this.#Nt[1],width:this.#Nt[0],depth:this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:this.#Nt[1]-this.#Tt[2],offsetZ:this.#Nt[2]-(this.#Tt[2]+this.#Tt[3])},offsetFacesFrontDownH:{type:"faceHBackDown",x:0,y:2*this.#Tt[2],z:this.#Nt[1],width:this.#Nt[0],depth:this.#Tt[2],height:this.#Tt[3],offsetX:0,offsetY:this.#Nt[1]-this.#Tt[2],offsetZ:2*this.#Tt[2]},offsetSidesRightVBack:{type:"sideV",x:0,y:this.#Tt[3]+2*this.#Tt[2],z:0,width:this.#Tt[2],depth:this.#Tt[3],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:0,offsetY:0,offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetSidesRightVFront:{type:"sideRightFrontV",x:0,y:this.#Tt[3]+2*this.#Tt[2],z:this.#Nt[1]-this.#Tt[3],width:this.#Tt[2],depth:this.#Tt[3],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:0,offsetY:this.#Nt[1]-this.#Tt[3],offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetSidesLeftVBack:{type:"sideLeftV",x:this.#Nt[0],y:this.#Tt[3]+2*this.#Tt[2],z:0,width:this.#Tt[2],depth:this.#Tt[3],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Nt[0]-this.#Tt[2],offsetY:0,offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetSidesLeftVFront:{type:"sideLeftFrontV",x:this.#Nt[0],y:this.#Tt[3]+2*this.#Tt[2],z:this.#Nt[1]-this.#Tt[3],width:this.#Tt[2],depth:this.#Tt[3],height:this.#Nt[2]-(2*this.#Tt[3]+3*this.#Tt[2]),offsetX:this.#Nt[0]-this.#Tt[2],offsetY:this.#Nt[1]-this.#Tt[3],offsetZ:2*this.#Tt[2]+this.#Tt[3]},offsetTopFrontH:{type:"topFace",x:this.#Tt[3],y:this.#Nt[2],z:0,width:this.#Nt[0]-2*this.#Tt[3],depth:this.#Tt[3],height:this.#Tt[2],offsetX:this.#Tt[3],offsetY:0,offsetZ:this.#Nt[2]-this.#Tt[2]},offsetTopBackH:{type:"topComp",x:this.#Tt[3],y:this.#Nt[2],z:this.#Nt[1],width:this.#Nt[0]-2*this.#Tt[3],depth:this.#Tt[3],height:this.#Tt[2],offsetX:this.#Tt[3],offsetY:this.#Nt[1]-this.#Tt[3],offsetZ:this.#Nt[2]-this.#Tt[2]},offsetTopRight:{type:"topFeet",x:0,y:this.#Nt[2],z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:0,offsetY:0,offsetZ:this.#Nt[2]-this.#Tt[2]},offsetTopLeft:{type:"topLeftFeet",x:this.#Nt[0],y:this.#Nt[2],z:0,width:this.#Tt[3],depth:this.#Nt[1],height:this.#Tt[2],offsetX:this.#Nt[0]-this.#Tt[3],offsetY:0,offsetZ:this.#Nt[2]-this.#Tt[2]}}}#Xt(){const e=2*this.#Tt[2],t=this.#Nt[2]-this.#Tt[3]-this.#Tt[2],s=this.#Nt[0]-this.#Tt[3],i=this.#Nt[1]-this.#Tt[2],a=this.#Nt[2]-this.#Tt[3]-this.#Tt[2],r=this.#Nt[1]-this.#Tt[2],n=this.#Nt[0]-this.#Tt[2],o=this.#Tt[3]+this.#Tt[2],h=this.#Nt[0]-this.#Tt[3]-this.#Tt[2],c=this.#Nt[2]-this.#Tt[2],l=this.#Nt[1]-this.#Tt[3];return{feet:[{x:0,y:0,z:0},{x:this.#Tt[3],y:0,z:0},{x:this.#Tt[3],y:this.#Tt[2],z:0},{x:0,y:this.#Tt[2],z:0},{x:0,y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:this.#Tt[2],z:this.#Nt[1]},{x:0,y:this.#Tt[2],z:this.#Nt[1]}],feetR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:this.#Tt[2],z:0},{x:0,y:this.#Tt[2],z:0},{x:0,y:0,z:this.#Nt[1]},{x:s,y:0,z:this.#Nt[1]},{x:s,y:this.#Tt[2],z:this.#Nt[1]},{x:0,y:this.#Tt[2],z:this.#Nt[1]}],feetUp:[{x:0,y:0,z:0},{x:this.#Tt[3],y:0,z:0},{x:this.#Tt[3],y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:e,z:this.#Nt[1]},{x:0,y:e,z:this.#Nt[1]}],feetUpR:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:e,z:0},{x:0,y:e,z:0},{x:0,y:0,z:this.#Nt[1]},{x:s,y:0,z:this.#Nt[1]},{x:s,y:e,z:this.#Nt[1]},{x:0,y:e,z:this.#Nt[1]}],faceV:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Tt[2]},{x:o,y:0,z:this.#Tt[2]},{x:o,y:t,z:this.#Tt[2]},{x:0,y:t,z:this.#Tt[2]}],faceVR:[{x:0,y:0,z:0},{x:h,y:0,z:0},{x:h,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:this.#Tt[2]},{x:h,y:0,z:this.#Tt[2]},{x:h,y:t,z:this.#Tt[2]},{x:0,y:t,z:this.#Tt[2]}],faceVB:[{x:0,y:0,z:0},{x:o,y:0,z:0},{x:o,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:i},{x:o,y:0,z:i},{x:o,y:t,z:i},{x:0,y:t,z:i}],faceVBR:[{x:0,y:0,z:0},{x:h,y:0,z:0},{x:h,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:i},{x:h,y:0,z:i},{x:h,y:t,z:i},{x:0,y:t,z:i}],faceH:[{x:0,y:0,z:0},{x:this.#Nt[0],y:0,z:0},{x:this.#Nt[0],y:this.#Tt[3]+e,z:0},{x:0,y:this.#Tt[3]+e,z:0},{x:0,y:0,z:this.#Tt[2]},{x:this.#Nt[0],y:0,z:this.#Tt[2]},{x:this.#Nt[0],y:this.#Tt[3]+e,z:this.#Tt[2]},{x:0,y:this.#Tt[3]+e,z:this.#Tt[2]}],faceHUp:[{x:0,y:0,z:0},{x:this.#Nt[0],y:0,z:0},{x:this.#Nt[0],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Tt[2]},{x:this.#Nt[0],y:0,z:this.#Tt[2]},{x:this.#Nt[0],y:a,z:this.#Tt[2]},{x:0,y:a,z:this.#Tt[2]}],faceHBackUp:[{x:0,y:0,z:0},{x:this.#Nt[0],y:0,z:0},{x:this.#Nt[0],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:i},{x:this.#Nt[0],y:0,z:i},{x:this.#Nt[0],y:a,z:i},{x:0,y:a,z:i}],faceHBackDown:[{x:0,y:0,z:0},{x:this.#Nt[0],y:0,z:0},{x:this.#Nt[0],y:this.#Tt[3]+e,z:0},{x:0,y:this.#Tt[3]+e,z:0},{x:0,y:0,z:i},{x:this.#Nt[0],y:0,z:i},{x:this.#Nt[0],y:this.#Tt[3]+e,z:i},{x:0,y:this.#Tt[3]+e,z:i}],sideHUp:[{x:0,y:0,z:0},{x:this.#Tt[2],y:0,z:0},{x:this.#Tt[2],y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:r},{x:this.#Tt[2],y:0,z:r},{x:this.#Tt[2],y:t,z:r},{x:0,y:t,z:r}],sideLeftHUp:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:r},{x:n,y:0,z:r},{x:n,y:t,z:r},{x:0,y:t,z:r}],sideHDown:[{x:0,y:0,z:0},{x:this.#Tt[2],y:0,z:0},{x:this.#Tt[2],y:this.#Tt[3]+e,z:0},{x:0,y:this.#Tt[3]+e,z:0},{x:0,y:0,z:r},{x:this.#Tt[2],y:0,z:r},{x:this.#Tt[2],y:this.#Tt[3]+e,z:r},{x:0,y:this.#Tt[3]+e,z:r}],sideLeftHDown:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:this.#Tt[3]+e,z:0},{x:0,y:this.#Tt[3]+e,z:0},{x:0,y:0,z:r},{x:n,y:0,z:r},{x:n,y:this.#Tt[3]+e,z:r},{x:0,y:this.#Tt[3]+e,z:r}],sideV:[{x:0,y:0,z:0},{x:this.#Tt[2],y:0,z:0},{x:this.#Tt[2],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Tt[3]},{x:this.#Tt[2],y:0,z:this.#Tt[3]},{x:this.#Tt[2],y:a,z:this.#Tt[3]},{x:0,y:a,z:this.#Tt[3]}],sideRightFrontV:[{x:0,y:0,z:0},{x:this.#Tt[2],y:0,z:0},{x:this.#Tt[2],y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Nt[1]},{x:this.#Tt[2],y:0,z:this.#Nt[1]},{x:this.#Tt[2],y:a,z:this.#Nt[1]},{x:0,y:a,z:this.#Nt[1]}],sideLeftV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Tt[3]},{x:n,y:0,z:this.#Tt[3]},{x:n,y:a,z:this.#Tt[3]},{x:0,y:a,z:this.#Tt[3]}],sideLeftFrontV:[{x:0,y:0,z:0},{x:n,y:0,z:0},{x:n,y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:this.#Nt[1]},{x:n,y:0,z:this.#Nt[1]},{x:n,y:a,z:this.#Nt[1]},{x:0,y:a,z:this.#Nt[1]}],topFace:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:c,z:0},{x:0,y:c,z:0},{x:0,y:0,z:this.#Tt[3]},{x:s,y:0,z:this.#Tt[3]},{x:s,y:c,z:this.#Tt[3]},{x:0,y:c,z:this.#Tt[3]}],topComp:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:c,z:0},{x:0,y:c,z:0},{x:0,y:0,z:l},{x:s,y:0,z:l},{x:s,y:c,z:l},{x:0,y:c,z:l}],topFeet:[{x:0,y:0,z:0},{x:this.#Tt[3],y:0,z:0},{x:this.#Tt[3],y:c,z:0},{x:0,y:c,z:0},{x:0,y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:0,z:this.#Nt[1]},{x:this.#Tt[3],y:c,z:this.#Nt[1]},{x:0,y:c,z:this.#Nt[1]}],topLeftFeet:[{x:0,y:0,z:0},{x:s,y:0,z:0},{x:s,y:c,z:0},{x:0,y:c,z:0},{x:0,y:0,z:this.#Nt[1]},{x:s,y:0,z:this.#Nt[1]},{x:s,y:c,z:this.#Nt[1]},{x:0,y:c,z:this.#Nt[1]}]}}#Wt(e,t){const{x:s,y:i,z:a}=e,r=structuredClone(t);return Object.entries(r).map(((e,t)=>{switch(t){case 0:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 1:return 0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 2:return 0===e[1].z&&(e[1].z=a),e;case 3:return 0===e[1].x&&(e[1].x=s),0===e[1].z&&(e[1].z=a),e;case 4:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),e;case 5:return 0===e[1].y&&(e[1].y=i),e;case 7:return 0===e[1].x&&(e[1].x=s),e}})),r}#Mt(e,t,s){const i=new TraceMaker,a=new DesignWalls;let r=!0;return Object.entries(s).map((s=>{const{type:n,offsetX:o,offsetY:h,offsetZ:c,width:l,depth:d,height:p}=s[1],u=t[n],y=this.#Wt(s[1],u);i.data={info:e,coordinates:y,name:"frame",show:r},e=i.defineTrace,a.objectData={width:l,depth:d,height:p,info:e,name:"frame",offsetX:o,offsetY:h,offsetZ:c},e=a.designSides,r=!1})),e}#Ut(){const e=Math.ceil(this.#Nt[0]),t=Math.ceil(this.#Nt[1]),s=Math.ceil(this.#Nt[2]),i=[{x:0,y:0,z:0},{x:e,y:0,z:0},{x:e,y:t,z:0},{x:0,y:t,z:0},{x:0,y:0,z:s},{x:e,y:0,z:s},{x:e,y:t,z:s},{x:0,y:t,z:s}];let a=this.#Dt(i);if(!this.#Tt)return a;const r=this.#Xt(),n=this.#Rt();return a=this.#Mt(a,r,n),a}get setFrame(){return this.#Ut()}}class PaddingCrate{#bt;#Tt;#Et;#Ft;#_t;constructor(e,t,s){const i=JSON.parse(localStorage.getItem("crating")).map((e=>t.usedMaterials.get(e)));this.#Ft=e,this.#bt=s,this.#Tt=i.find((e=>"Pinewood"===e.at(-1))),this.#Et=i.find((e=>"Plywood"===e.at(-1))),this.#_t=i.find((e=>"Foam Sheet"===e.at(-1)&&e[2]>2.5)),this.#_t[1]=+this.#_t[1],this.#_t[2]=+this.#_t[2],this.#_t[3]=+this.#_t[3]}#Zt(){const e=this.#Et[2]+this.#Tt[2],t=this.#Ft[0]-(this.#Tt[2]+this.#Et[2]+2*this.#Et[2]),s=this.#Ft[2]-e-this.#_t[2],i=this.#Ft[1]-e,a=this.#Ft[0]-e,r=this.#Tt[2]+this.#Et[2]+this.#_t[2],n=2*this.#Tt[2]+this.#Et[2]+this.#_t[2],o=this.#Ft[1]-this.#Tt[2]-this.#Et[2];return{backFace:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:this.#_t[2]},{x:t,y:0,z:this.#_t[2]},{x:t,y:s,z:this.#_t[2]},{x:0,y:s,z:this.#_t[2]}],frontFace:[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:t,y:0,z:i},{x:t,y:s,z:i},{x:0,y:s,z:i}],sideRight:[{x:0,y:0,z:0},{x:r,y:0,z:0},{x:r,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:r,y:0,z:i},{x:r,y:s,z:i},{x:0,y:s,z:i}],sideLeft:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:i},{x:a,y:0,z:i},{x:a,y:s,z:i},{x:0,y:s,z:i}],top:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:s,z:0},{x:0,y:s,z:0},{x:0,y:0,z:o},{x:a,y:0,z:o},{x:a,y:s,z:o},{x:0,y:s,z:o}],bottom:[{x:0,y:0,z:0},{x:a,y:0,z:0},{x:a,y:n,z:0},{x:0,y:n,z:0},{x:0,y:0,z:o},{x:a,y:0,z:o},{x:a,y:n,z:o},{x:0,y:n,z:o}]}}#Bt(e,t){const{x:s,y:i,z:a}=e,r=structuredClone(t);return Object.entries(r).map(((e,t)=>{switch(t){case 0:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 1:return 0===e[1].y&&(e[1].y=i),0===e[1].z&&(e[1].z=a),e;case 2:return 0===e[1].z&&(e[1].z=a),e;case 3:return 0===e[1].x&&(e[1].x=s),0===e[1].z&&(e[1].z=a),e;case 4:return 0===e[1].x&&(e[1].x=s),0===e[1].y&&(e[1].y=i),e;case 5:return 0===e[1].y&&(e[1].y=i),e;case 7:return 0===e[1].x&&(e[1].x=s),e}})),r}#Pt(){return{faceBack:{type:"backFace",x:this.#Tt[2]+this.#Et[2]+this.#_t[2],y:2*this.#Tt[2]+this.#Et[2]+this.#_t[2],z:this.#Tt[2]+this.#Et[2]+this.#_t[2],width:this.#Ft[0]-(2*this.#Tt[2]+2*this.#Et[2]+2*this.#_t[2]),depth:this.#_t[2],height:this.#Ft[2]-4*this.#Tt[2]-3*this.#Et[2]-this.#_t[2],offsetX:this.#Tt[2]+this.#Et[2]+this.#_t[2],offsetY:this.#_t[2],offsetZ:3*this.#Tt[2]+2*this.#Et[2]},faceFront:{type:"frontFace",x:this.#Tt[2]+this.#Et[2]+this.#_t[2],y:2*this.#Tt[2]+this.#Et[2]+this.#_t[2],z:this.#Ft[1]-this.#Tt[2]-this.#Et[2]-this.#_t[2],width:this.#Ft[0]-(2*this.#Tt[2]+2*this.#Et[2]+2*this.#_t[2]),depth:this.#_t[2],height:this.#Ft[2]-4*this.#Tt[2]-3*this.#Et[2]-this.#_t[2],offsetX:this.#Tt[2]+this.#Et[2]+this.#_t[2],offsetY:this.#Ft[1]-2*this.#_t[2],offsetZ:3*this.#Tt[2]+2*this.#Et[2]},faceRight:{type:"sideRight",x:this.#Tt[2]+this.#Et[2],y:2*this.#Tt[2]+this.#Et[2]+this.#_t[2],z:this.#Tt[2]+this.#Et[2],width:this.#_t[2],depth:this.#Ft[1]-2*this.#Tt[2]-2*this.#Tt[2],height:this.#Ft[2]-3*this.#Tt[2]-2*this.#Et[2]-2*this.#_t[2],offsetX:this.#Tt[2]+this.#Et[2],offsetY:2*this.#Tt[2],offsetZ:2*this.#Tt[2]+this.#Et[2]+this.#_t[2]},faceLeft:{type:"sideLeft",x:this.#Ft[0]-this.#Tt[2]-this.#Et[2]-this.#_t[2],y:2*this.#Tt[2]+this.#Et[2]+this.#_t[2],z:this.#Tt[2]+this.#Et[2],width:this.#_t[2],depth:this.#Ft[1]-2*this.#Tt[2]-2*this.#Tt[2],height:this.#Ft[2]-3*this.#Tt[2]-2*this.#Et[2]-2*this.#_t[2],offsetX:this.#Ft[0]-this.#Et[2]-this.#Tt[2]-this.#_t[2],offsetY:2*this.#Tt[2],offsetZ:2*this.#Tt[2]+this.#Et[2]+this.#_t[2]},top:{type:"top",x:this.#Tt[2]+this.#Et[2],y:this.#Ft[2]-this.#Tt[2]-this.#Et[2],z:this.#Tt[2]+this.#Et[2],width:this.#Ft[0]-(2*this.#Tt[2]+2*this.#Et[2]),depth:this.#Ft[1]-(this.#Tt[2]+this.#Et[2]+this.#_t[2]),height:this.#_t[2],offsetX:this.#Tt[2]+this.#Et[2],offsetY:this.#Tt[2]+this.#Et[2],offsetZ:this.#Ft[2]-(2*this.#Tt[2]+2*this.#Et[2])},bottom:{type:"bottom",x:this.#Tt[2]+this.#Et[2],y:2*this.#Tt[2]+this.#Et[2],z:this.#Tt[2]+this.#Et[2],width:this.#Ft[0]-(2*this.#Tt[2]+2*this.#Et[2]),depth:this.#Ft[1]-(2*this.#Tt[2]+2*this.#Et[2]),height:this.#_t[2],offsetX:this.#Tt[2]+this.#Et[2],offsetY:this.#Tt[2]+this.#Et[2],offsetZ:2*this.#Tt[2]+this.#Et[2]}}}#Yt(){const e=new TraceMaker,t=new DesignWalls,s=this.#Zt(),i=this.#Pt();let a=structuredClone(this.#bt),r=!0;return this.#_t?(Object.entries(i).map((i=>{const{type:n,offsetX:o,offsetY:h,offsetZ:c,width:l,depth:d,height:p}=i[1],u=s[n],y=this.#Bt(i[1],u);e.data={info:a,coordinates:y,name:"padding",show:r},a=e.defineTrace,t.objectData={width:l,depth:d,height:p,info:a,name:"padding",offsetX:o,offsetY:h,offsetZ:c},a=this.#bt=t.designSides,r=!1})),a):this.#bt}get setPadding(){return this.#Yt()}}class FillGaps{#qt;#bt;constructor(e,t){this.#qt=t,this.#bt=e}#Ht({x:e,y:t,z:s},i){const a=this.#bt.offset[0]+i.x,r=this.#bt.offZ+s,n=i.y?i.y+t+this.#bt.offset[2]-this.#bt.pad[2]:t+this.#bt.offset[2]-this.#bt.pad[2],o=e+this.#bt.offset[0]+i.x,h=i.y?this.#bt.offset[2]+i.y-this.#bt.pad[2]:i.y+this.#bt.offset[2];return{div:[{x:a,y:n,z:r},{x:o,y:n,z:r},{x:o,y:h,z:r},{x:a,y:h,z:r},{x:a,y:n,z:this.#bt.offZ},{x:o,y:n,z:this.#bt.offZ},{x:o,y:h,z:this.#bt.offZ},{x:a,y:h,z:this.#bt.offZ}],width:e,depth:s,height:i.y?t:t-this.#bt.pad[2],offsetX:a,offsetY:this.#bt.offZ,offsetZ:i.y?i.y+this.#bt.offset[2]-this.#bt.pad[2]:this.#bt.offset[2]+i.y,layer:{name:`layer-${this.#qt}`,color:"padding"}}}#$t(e,t){e[2],e[3]}#jt(){const e=[],t=[],s={lastX:[],lastY:[]};let i=0,a=0;const{vacuum:r}=this.#bt,n=r.length>2?r.length-1:r.length;r.map(((e,t)=>r[t].push(e[0]*e[1])),0),r.sort(((e,t)=>e.at(-1)-t.at(-1))),r.reverse().map(((e,t)=>{(r.length-1>=t||2===r.length)&&this.#$t(e,s)}),0);return r.map(((s,r)=>{if(s[0]===i&&s[1]===a||n===r)return;e.length?e.push(e.at(-1)-i):e.push(s[0]),t.push(s[1]);const o=+t.reverse().reduce(((e,t)=>s[3]-t-e),0).toFixed(3),h={location:{x:e.at(-1)>0?e.at(-1):s[0],y:t.at(-1)>0&&!e.at(-1)?t.at(-1):s[1]},size:{x:+(s[2]-s[0]).toFixed(3),y:s[1]?o:t.at(-1)-s[1],z:this.#bt.thickness>this.#bt.div[2]?this.#bt.pad[2]:this.#bt.div[2]}};return i=s[0],a=s[1],h}),0).filter((e=>void 0!==e))}#Jt(){return this.#jt().map((e=>this.#Ht(e.size,e.location)))}get fill(){return this.#Jt()}}class PositionWorksInSideCrate{#Ft;#bt;#N;#Vt;#Gt;#_t;#Kt;constructor(e,t,s){const i=JSON.parse(localStorage.getItem("crating")).map((e=>t.at(-1)[0].usedMaterials.get(e))),a=i.find((e=>"Pinewood"===e.at(-1))),r=i.find((e=>"Plywood"===e.at(-1)));this.#_t=i.find((e=>"Foam Sheet"===e.at(-1)&&e[2]>2.5)),this.#Gt=i.find((e=>"Foam Sheet"===e.at(-1)&&e[2]<=2.5)),this.#Ft=e,this.#bt=s,this.#N=t.at(-1)[0],this.#Vt=[],this.#Kt=e.innerSize;const n=e=>{this.#Vt.push(e),this.#Vt.push(e),this.#Vt.push(e)},o=e=>{this.#Vt[0]+=e,this.#Vt[1]+=e,this.#Vt[2]+=e};[a,r,this.#_t].map((e=>{if(Array.isArray(e))switch(e.at(-1)){case"Pinewood":const t=e[2],s=e[2],i=2*e[2];if(!this.#Vt.length)return this.#Vt.push(t),this.#Vt.push(s),this.#Vt.push(i),e;this.#Vt[0]+=t,this.#Vt[1]+=i,this.#Vt[2]+=s;break;case"Plywood":case"Foam Sheet":if(!this.#Vt.length)return n(e[2]),e;o(e[2]);break;default:return e}})),this.#Gt[1]=+this.#Gt[1],this.#Gt[2]=+this.#Gt[2],this.#Gt[3]=+this.#Gt[3]}#Qt(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}#es(e,t,s){return Object.entries(e).map((e=>{const{coordinates:i,code:a,art:r}=e[1],n=i.y-this.#_t[2],o=this.#Vt[0],h=i.y?this.#Vt[2]+n:this.#Vt[2],c=this.#Vt[1]+i.z+t;e[1].layer={code:a,name:`layer-${s}`,color:this.#Qt()},r.map(((e,t)=>{switch(t){case 0:return 0===e.x&&(e.x=o+i.x),0===e.y&&(e.y=h),0===e.z&&(e.z=c),e;case 1:return 0===e.y&&(e.y=h),0===e.z&&(e.z=c),e;case 2:return 0===e.z&&(e.z=c),e;case 3:return 0===e.x&&(e.x=o+i.x),0===e.z&&(e.z=c),e;case 4:return 0===e.x&&(e.x=o+i.x),0===e.y&&(e.y=h),e;case 5:return 0===e.y&&(e.y=h),r;case 7:return 0===e.x&&(e.x=o+i.x),e}return e}),0)})),e}#ts(e,t,s){let i=e.length>4?+e[3]+this.#Vt[0]-this.#_t[2]:+e[1]+this.#Vt[0]-this.#_t[2],a=e.length>4?+e[1]+this.#Vt[2]-this.#_t[2]:+e[3]+this.#Vt[2]-this.#_t[2];const r=s+this.#Vt[1],{coordinates:n,code:o}=t;n.x?i+=this.#_t[2]+n.x:i+=this.#_t[2],n.y&&(a+=n.y);return{coordinates:n,code:o,art:[{x:0,y:0,z:0},{x:i,y:0,z:0},{x:i,y:a,z:0},{x:0,y:a,z:0},{x:0,y:0,z:r},{x:i,y:0,z:r},{x:i,y:a,z:r},{x:0,y:a,z:r}],width:i-this.#Vt[0]-n.x,depth:e[2],height:n.y?a-this.#Vt[2]-n.y+this.#_t[2]:a-this.#Vt[2]-n.y,offsetX:this.#Vt[0]+n.x,offsetY:this.#Vt[1]+s,offsetZ:n.y?this.#Vt[2]+n.y-this.#_t[2]:this.#Vt[2]}}#ss({x:e,y:t},s,i){const a=s+this.#Vt[2],r=this.#Vt[0],n=s+this.#Vt[2]-this.#Gt[2],o=this.#Vt[2];let h=structuredClone(i);return{div:[{x:r,y:o,z:n},{x:e,y:o,z:n},{x:e,y:t-=this.#Gt[2],z:n},{x:r,y:t,z:n},{x:r,y:o,z:a},{x:e,y:o,z:a},{x:e,y:t,z:a},{x:r,y:t,z:a}],width:e-2*this.#_t[2],depth:this.#Gt[2],height:t-2*this.#_t[2]-this.#Gt[2],offsetX:this.#Vt[0],offsetY:s+this.#Vt[2]-this.#Gt[2],offsetZ:this.#Vt[2],layer:{name:"layer-"+ ++h,color:"div"}}}#is(e,t,s,i=[]){if(s[0]<=0&&s[2]<=0)return i;let a=s[0]<this.#Gt[1]?s[0]:s[0]-this.#Gt[0],r=s[2]<this.#Gt[3]?s[2]:s[2]-this.#Gt[3];return a!==s[0]?s[0]-=a:s[0]=0,r!==s[2]?s[2]-=r:s[2]=0,i.push(this.#ss({x:a,y:r},t,e)),this.#is(e,t,s,i)}#as(e){let t=structuredClone(this.#bt);const s=new TraceMaker,i=new DesignWalls;let a;return e.map((e=>{e.map((e=>{const{div:r,layer:n,art:o,offsetX:h,offsetY:c,offsetZ:l,width:d,depth:p,height:u}=e;s.data={info:t,coordinates:o||r,name:n??r,show:!r&&a!==n.name},t=s.defineTrace,i.objectData={width:d,depth:p,height:u,info:t,name:n??r,offsetX:h,offsetY:c,offsetZ:l},t=i.designSides,a=r||n.name===a?a:n.name}))})),t}#rs(){}#ns(){}#os(){}#hs(){}#cs(){const{layers:e,fillGaps:t,artLocation:s}=this.#N,i=[];let a=0,r=0;return e.map(((n,o)=>{const{vacuum:h,works:c}=n,l=c.map((e=>this.#ts(e.work,s.get(e.work[0]),a))),d=h.length>1;if(i.push(this.#es(l,a,o+1)),c.filter((e=>!r||r<e.work[2]?r=e.work[2]:0)),d){const e={vacuum:h,maxZ:t,offZ:+(a+this.#Vt[1]).toFixed(3),pad:this.#_t,div:this.#Gt,offset:this.#Vt};new FillGaps(e,o+1).fill}a+=+r.toFixed(3),e.length>1&&e.length-1>o&&(i.push(this.#is(o+1,a,structuredClone(this.#Kt))),a+=this.#Gt[2]),r=0}),0),this.#as(i)}#ls(){switch(this.#Ft.type){case"tubeCrate":return this.#rs();case"sameSizeCrate":return this.#hs();case"largestCrate":return this.#os();case"noCanvasCrate":return this.#ns();case"standardCrate":return this.#cs()}}get arrange(){return this.#ls()}}class standardCrateRender{#Ge;#wt;constructor(e,t){this.#Ge=e,this.#wt=t}#Ct(){const{crates:e}=this.#Ge,t=e.map(((e,t)=>{if(t%2==0){const{finalSize:t,innerSize:s}=e.at(-1)[0];let i=new CratesFrame(t,e.at(-1)[0]).setFrame;i=new SetCrateWalls(t,e.at(-1)[0],i).setWalls;i=new PaddingCrate(t,e.at(-1)[0],i).setPadding;return i=new PositionWorksInSideCrate({sized:t,innerSize:s,type:"standardCrate"},e,i).arrange,i}}),0);return!!t.length&&{result:t[0],meta:this.#wt}}get composeCrate(){return this.#Ct()}}class tubeCrateRender{#Ge;#wt;constructor(e,t){this.#Ge=e,this.#wt=t}#Ct(){return{result:undefined,meta:this.#wt}}get composeCrate(){return this.#Ct()}}class GraphicCrates{#ds;#kt;#Ge;constructor(){const{Plotly:e}=globalThis;this.#Ge=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"],this.#kt=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.#ds=e}async#ps(){const e=localStorage.getItem("refNumb"),t=new Worker(new URL("../panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});t.postMessage(e);return await new Promise(((s,i)=>{t.onmessage=t=>{const{data:a}=t;a?.reference===e?s(a):i(t)}}))}#us(e,t){return this.#kt.forEach((s=>{const i=t[s[0]],a=t[s[1]];e.push({x:[i.x,a.x],y:[i.y,a.y],z:[i.z,a.z],name:"Frame",mode:"lines",type:"scatter3d",showlegend:!1,opacity:0,line:{color:"#00000000"}})})),e}#ys(e){let t=structuredClone(n);const s=this.#Ge.map((i=>{const a=e.get(i);let r;switch(a?i:0){case"tubeCrate":r=new tubeCrateRender(a,t);const e=r.composeCrate;s.push(e.result),t=e.meta,r=null;break;case"largestCrate":r=new largestCrateRender(a,t);const i=r.composeCrate;s.push(i.result),t=i.meta,r=null;break;case"sameSizeCrate":r=new sameSizeCrateRender(a,t);const n=r.composeCrate;s.push(n.result),t=n.meta,r=null;break;case"noCanvasCrate":r=new notCanvasCrateRender(a,t);const o=r.composeCrate;s.push(o.result),t=o.meta,r=null;break;case"standardCrate":r=new standardCrateRender(a,t);const{result:h,meta:c}=r.composeCrate;return t=c,r=null,h}}));return{result:s.filter((e=>Array.isArray(e))).flat(),alterLayout:t}}async#fs(){const{crates:e}=await this.#ps()||!1,t=new Map,s=sessionStorage.getItem("graphics")||!1;if(s){return JSON.parse(s)[sessionStorage.getItem("crate").split("/")[0]]}if(e){Object.entries(e).map((e=>{this.#Ge.includes(e[0])&&t.set(e[0],e[1])}));const s=this.#ys(t);return globalThis.sessionStorage.setItem("crate",`1/${e.allCrates.length}`),globalThis.sessionStorage.setItem("graphics",JSON.stringify(s.designs)),document.getElementById("layer-count").innerText=`Courrent crate: 1 / ${e.allCrates.length}`,s}return!0}async#ms(){new DesignWalls,new TraceMaker;this.#us([],[{x:0,y:0,z:0},{x:100,y:0,z:0},{x:100,y:30,z:0},{x:0,y:30,z:0},{x:0,y:0,z:100},{x:100,y:0,z:100},{x:100,y:30,z:100},{x:0,y:30,z:100}]);const{result:e,alterLayout:t}=await this.#fs();this.#ds.newPlot("plotter-display",e,t,{displaylogo:!1})}get show(){this.#ms()}}async function o(){const e=new GraphicCrates,t=document.querySelectorAll(".toggle__plotter"),s=document.getElementById("layers");let i;for(i of t)"true"===i.ariaHidden?(i.ariaHidden="false",s.ariaHidden="true"):"false"===i.ariaHidden&&(i.ariaHidden="true",s.ariaHidden="false",sessionStorage.getItem("plotter")||(e.show,sessionStorage.setItem("plotter","true")))}function h(e,t,s,i){switch(e){case 409:!async function(e,t,s){if(confirm("This estimate already exist. Would you like to update it?")){const i="/api/v1/update/estimates";try{const a=await fetch(i,{method:"PUT",body:e,headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));403===a&&h(a,s)}catch(e){alert(`ATTENTION: ${e}`)}}else alert("Not updated!")}(s,i,t);break;case 403:!async function(e){const t={"Content-Type":"application/json; charset=UTF-8"};try{const s=await fetch("/api/v1/shift/tokens",{method:"POST",headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));c(e),console.log(s)}catch(e){alert(`ATTENTION: ${e}`)}}(t)}}async function c(e){const t=JSON.stringify(e),s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{h(await fetch("/api/v1/newEstimate",{method:"POST",body:t,headers:s}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),e,t,s)}catch(e){alert(`ATTENTION: ${e}`)}else!function(e){const t=localStorage,s=t.getItem("offResults"),i=void 0!==s&&JSON.parse(s);i?(i.push(e),t.removeItem("offResults"),t.setItem("offResults",JSON.stringify(i))):t.setItem("offResults",JSON.stringify([e]))}(e.reference)}function l(){const e="Results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let s;s=t.target.result.createObjectStore(e,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}function d(e,t=!1){const s=localStorage.getItem("refNumb"),i="Results",a=globalThis.indexedDB.open(i),r=globalThis.navigator.onLine;a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const n=a.target.result.transaction(i,"readwrite").objectStore(i),o=n.get(e.reference);o.onsuccess=async()=>{void 0===o.result?n.add(e):await Promise.resolve(n.delete(o.result.reference)).then(n.add(e)),p(s,t)},r||function(e,t){const s="off_line_results",i=document.getElementById("input_estimate").value,a=globalThis.indexedDB.open(s);a.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},a.onsuccess=async a=>{const r=a.target.result.transaction(s,"readwrite").objectStore(s),n=r.get(e.reference);n.onsuccess=()=>{(void 0===n.result||r.delete(n.result.reference))&&r.add(e),p(i,t)}}}(e)}}async function p(e,t=!1){const s=globalThis.indexedDB.open("Results");s.onerror=e=>{alert(`WARNING: ${e.target.errorCode}`)},s.onsuccess=()=>{const i=s.result.transaction("Results").objectStore("Results").get(e);i.onsuccess=async()=>{const e=localStorage.getItem("refNumb"),s=i.result;globalThis.sessionStorage.setItem(e,JSON.stringify(s)),!1===t&&await async function(e){const{reference:t,list:s,crates:i}=e,a={reference:t,list:s,crates:Object.assign({},i)};await c(a)}(i.result),"crate"===t&&await async function(e){const t={"Content-Type":"application/json; charset=UTF-8"},{reference:s,list:i,crates:a}=e,r={reference:s,list:i,crates:Object.assign({},a)};try{await fetch("/api/v1/update/estimates",{method:"PUT",body:JSON.stringify(r),headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)))}catch(e){alert(`ATTENTION: ${e}`)}finally{return"updated"}}(i.result)}}}async function u(){const e=await z();let t=document.getElementById("count");return e&&e.length>0&&document.getElementById("statusList").setAttribute("content",e.length),t.innerText=e?"Counting: "+e?.length:"Counting 0",t}async function y(){let e;const t=document.getElementById("cub-meter");return e=await z(),e=e?.reduce(((e,t)=>e+t.cubed),0)??0,t.innerText="Cub: "+(1e3*e/1e3).toFixed(3)+"m³",t}async function f(){let e,t,s;return s="Air-Cub: ",t=document.getElementById("cub-air"),e=await z(),e=e?.reduce(((e,t)=>e+t.cAir),0)??0,t.innerText="Air-Cub: "+(1e3*e/1e3).toFixed(3),t}async function m(e=!1){const t={},s=new WeakSet,i=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let a,r=document.cookie.split("=")[1];const n=await async function(){const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",t=await z();let s;return 0===t.length?alert("Oops! Sounds like you do not added any work yet. Please, try again!"):(s=await Promise.resolve(new UnitAdapter(t,e)),s)}(),o=document.querySelector(":root"),h=document.querySelector(".update-materials"),c=document.querySelector(".materials");return(e||confirm("Ready to crate all works?")&&n)&&(!function(){const e=new DocumentFragment,t=new DocumentFragment,s=document.createElement("panel-info"),i=document.createElement("panel-info"),a=document.getElementById("first_pane"),r=document.getElementById("second_pane");for(;a.firstChild;)a.removeChild(a.firstChild);for(;r.firstChild;)r.removeChild(r.firstChild);s.id="first-pane",i.id="second-pane",s.setAttribute("name","pane1"),i.setAttribute("name","pane2"),e.append(s),t.append(i),a.append(e),r.append(t)}(),t.reference=i,a=await z(),t.list=a.map((e=>e.data)),t.crates=n,d(t,e),h.setAttribute("name","materials-used"),c.setAttribute("name","packed-works"),c.setAttribute("content","crates"),("FULL"===r||"PLOTTER"===r||!r)&&(document.getElementById("crate-layers").disabled=!1),o.style.setProperty("--layer-state","block"),sessionStorage.removeItem("crate"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics")),s.add(t),"Crated"}async function g(e=!1){document.getElementById("input_code").value="",document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="";const t=document.getElementById("show-layer"),s=document.querySelectorAll("padding-dialog").length,i=document.querySelector(":root"),a=document.querySelector(".update-materials");let r=document.cookie;r=r.split("=")[1],t&&t.hasChildNodes()&&o(),globalThis.document.getElementById("input_estimate").select(),globalThis.document.getElementById("input_code").select(),"update-materials"!==a.getAttribute("name")&&a.setAttribute("name","update-materials"),u(),y(),f(),s>0&&sessionStorage.setItem("CLOSED","NOW"),i.style.setProperty("--layer-state","none")}async function z(){const e=localStorage,t=[];let s;const i=["doneList","mode","storage","currency","metrica","refNumb","offResults","FETCHED","materials","packing","crating"];return Object.entries(e).map((e=>{!i.includes(e[0])&&t.push(JSON.parse(e[1]))})),t.length>0&&(s=t.map((e=>{const{code:t,x:s,z:i,y:a,packing:r}=e;return new ArtWork(t,s,i,a,r)}))),s||void 0}function x(e){const t=function(e){let t=2;const s=/^[0-9\.0-9]{1,7}$/;for(;--t>=0;)if(!s.test(e[t]))switch(t){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return e}([e[1],e[2],e[3]].map((e=>parseInt(e))));const s=/[^-a-z-A-Z-0-9]/g,i=document.getElementById("input_estimate").value,a=function(){const e=JSON.parse(localStorage.getItem("packing")),t=JSON.parse(localStorage.getItem("materials")),s=[];return!(!e||0===e.length)&&(e.filter((e=>{s.push(t.find((t=>t[0]===e)).flat())})),s)}();let r=0;if(!a)return alert("Please, select some packing material to apply to the artwork."),"material";if(s.test(e[0])||s.test(i))return alert('Found special character NOT allowed on "Work code",\t\tor "Estimate" input. Please, try again!'),!1;for(r in localStorage.key(r))if(e[0]===localStorage.key(r))return alert(`${e[0]} already added to the list. Please, try again`),!1;return function(){const e=localStorage.getItem("refNumb"),t=document.getElementById("input_estimate").value;e&&e!==t&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",t),document.getElementById("input_estimate").value=t):document.getElementById("input_estimate").value=e);localStorage.setItem("refNumb",t)}(),!!Array.isArray(t)&&new ArtWork(e[0],t[0],t[1],t[2],a)}async function w(){const e=document.getElementById("input_estimate").value,t=document.getElementById("input_code").value,s=document.getElementById("input_length").value,i=document.getElementById("input_depth").value,a=document.getElementById("input_height").value;let r;return e?""===(t&&s&&i&&a)?(alert("Oops! Do not forget to fill each field. Please, try again!"),function(){let e=!1;["input_estimate","input_code","input_length","input_depth","input_height"].find((t=>{const s=document.getElementById(t);if(console.log(s.value),!s.value&&!e)return e=!0,s.select()}))}()):(r=x([t,s,i,a]),r&&"material"!==r&&(await async function({code:e}){const t=sessionStorage,s=JSON.parse(t.getItem("codes"));let i;return s?(i=Number.parseInt(s[s.length-1]),i+=1,s.push([i,e]),t.setItem("codes",JSON.stringify(s))):t.setItem("codes",JSON.stringify([[0,e]]))}(r.data),localStorage.setItem(r.data.code,JSON.stringify(r.data)),localStorage.setItem("storage","art-work"),u(),f(),y(),g()),r&&"material"!==r?g():0):alert('Attention! Please, add the "Doc:" reference field!')}function C(){const e=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(e))!function(e){const t=sessionStorage,s=JSON.parse(t.getItem("codes"));let i=0;for(;s[i][1]!==e&&i<=s.length;)i++;s.splice(i,1),t.setItem("codes",JSON.stringify(s))}(e),localStorage.removeItem(e),u(),f(),y();else{if(null===e)return g();alert(`"${e}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),g()}function k(e){const t=document.createDocumentFragment();return e.map((e=>{const s=document.createElement("option");s.textContent=e,t.appendChild(s)})),t}function b(e,t,s,i){const a=JSON.parse(sessionStorage.getItem("currency")),r=1e3,n=Number.parseFloat(s.value)===a[e],o=Number.parseFloat(i.value)===a[t];return e===t?n?i.value:s.value:n&&o?~~(a[e]*a[t]*r)/r:a[e]<a[t]?!0===n?~~(i.value/a[t]*a[e]*r)/r:~~(s.value*a[t]/a[e]*r)/r:!0===o?~~(s.value*a[t]/a[e]*r)/r:~~(i.value/a[t]*a[e]*r)/r}async function S(){const e=await fetch("/api/v1/currencies",{method:"GET"}).then((async e=>await e.json())).catch((e=>alert(`CurrencyError: ${e}!`))),{rates:t}=e.response,s=globalThis.sessionStorage;return t&&s.setItem("currency",JSON.stringify(t))}function v(e,t){const s=JSON.parse(sessionStorage.getItem("currency"));if(!s)return!1;t.value=s[e]}async function A(){await S(),await async function(){const e=JSON.parse(sessionStorage.getItem("currency")),t=document.getElementById("coin1"),s=document.getElementById("coin2"),i=Object.keys(e);if(!e)return"Error";t.appendChild(k(i)),s.appendChild(k(i))}()}function I(e,t,s,i){return"centimeters"===e?function(e,t,s,i){const a=2.54,r=.01,n=T(e,t);if(e===t)return s.value>i.value?s.value:i.value;if(n.checked1)return E(s,i,a,"in");return E(s,i,r,"m")}(e,t,s,i):"inches"===e?function(e,t,s,i){const a=.393,r=.0254,n=T(e,t);if(e===t)return s.value>i.value?s.value:i.value;if(n.checked2)return E(s,i,a,"cm");return E(s,i,r,"m")}(e,t,s,i):function(e,t,s,i){const a=.01,r=.0254,n=T(e,t);if(e===t)return s.value>i.value?s.value:i.value;if(n.checked3)return E(s,i,a,"cm");return E(s,i,r,"in")}(e,t,s,i)}function T(e,t){return{checked1:"centimeters"===e&&"inches"===t,checked2:"inches"===e&&"centimeters"===t,checked3:"meters"===e&&"centimeters"===t}}function E(e,t,s,i){const a=1e3;return"m"!==i?e.value>t.value?~~(e.value/s*a)/a:~~(t.value*s*a)/a:e.value<t.value?~~(t.value/s*a)/a:~~(e.value*s*a)/a}function F(){const e=new DocumentFragment,t=document.createElement("panel-info");return t.setAttribute("name","status"),t.id="statusList",t.class="addedStatus",t.setAttribute("content",0),e.appendChild(t)}if(globalThis.onstorage=()=>{y(),f(),u()},globalThis.onload=async()=>{const e=localStorage.getItem("mode"),t=document.getElementById("status-frame"),s=document.getElementById("statusList");sessionStorage.removeItem("onCrate"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"),s?s.setAttribute("content","reload"):t.append(F()),O(),null===e&&localStorage.setItem("mode","light"),N(),function(){const e=localStorage.getItem("mode"),t=document.body;switch(e){case"light":document.getElementById("light-mode").checked=!0,t.classList.remove("dark-mode"),t.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,t.classList.remove("light-mode"),t.classList.toggle("dark-mode")}}(),async function(){const e=new DocumentFragment,t=new DocumentFragment,s=document.createElement("pack-up"),i=document.createElement("pack-down"),a=document.getElementById("contents1"),r=document.getElementById("contents2");s.setAttribute("name","select-materials"),s.className="materials",s.ariaHidden="false",i.setAttribute("name","update-materials"),i.setAttribute("content","0"),i.className="update-materials",e.appendChild(s),t.appendChild(i),a.appendChild(e),r.appendChild(t)}()},!localStorage.getItem("metrica")){const e=document.getElementById("cm").value;localStorage.setItem("metrica",e)}function L(){const e=localStorage.getItem("metrica"),t=confirm("Attention! You are going to change the measurement of the works.");e&&void 0!==e?t&&("cm - centimeters"===e?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")):localStorage.setItem("metrica",document.getElementById("cm").value),N()}const B=()=>{O(),m();const e=document.querySelector(".result");sessionStorage.getItem("codes")&&(e&&"true"===e.ariaHidden&&o(),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};const P=()=>{const e=document.querySelector(".result"),t=document.getElementById("layers"),s=document.querySelector(".plotter__menu"),i=document.getElementById("statusList"),a=document.getElementById("status-frame"),r=document.getElementById("first_pane"),n=document.getElementById("second_pane"),o=document.querySelector(".side-menu");confirm("Do you really want to delete the whole list?")&&(!function(){const{mode:e,metrica:t,materials:s}=localStorage;localStorage.clear(),sessionStorage.clear(),localStorage.setItem("mode",e),localStorage.setItem("metrica",unit),localStorage.setItem("metrica",t),localStorage.setItem("materials",s),u(),y(),f()}(),g(!0),globalThis.document.getElementById("input_estimate").value="",globalThis.document.getElementById("input_estimate").select(),openCloseDisplay([e,t,s]),i.setAttribute("content",void 0),a.removeChild(document.getElementById("statusList")),r.firstChild&&r.removeChild(document.getElementById("first-pane")),n.firstChild&&n.removeChild(document.getElementById("second-pane")),a.append(F()),o.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),document.querySelector(".materials").setAttribute("name","select-materials"),sessionStorage.removeItem("plotter"),sessionStorage.removeItem("graphics"),sessionStorage.removeItem("crate"))};function O(){const e=localStorage.getItem("refNumb");let t=document.cookie;return t=t.split("=")[1],e&&(document.getElementById("input_estimate").value=e),l(),function(){const e="Materials",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let s;s=t.target.result.createObjectStore(e,{keyPath:"materials"}),s.createIndex("materials","materials",{unique:!0})}}(),"OFF"!==t&&"FULL"!==t||function(){const e="off_line_results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let s;s=t.target.result.createObjectStore(e,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0})}}(),y()&&f()&&u()}function N(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function D({works:e}){let t=[];const s=Array.isArray(e[0][0])?e[0]:e;return s?.map((e=>{let s;if(Array.isArray(e))return t.push(e);for(s in e)t.push(s),1===e[s].length?t.push(e[s][0]):Array.isArray(e[0])?e[s][0].map((e=>t.push(e))):e[s].map((e=>t.push(e)))})),t}function R(e){if(!e)return"There is no crates. Please, try again!";const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",s=e.map((e=>{let s;return"string"==typeof e?`LAYER layer ${e?.at(-1)}:`:e.length>=5?(s=`CODE: ${e[0]} - ${e[1]} x ${e[2]} x ${e[3]} - ${t}`,s):4===e.length?(s=`CRATE: ${e[0]} x ${e[1]} x ${e[2]} - ${t}`,s):void 0})),i=function(e,t){for(;t--;)e=(e=(e=(e=(e=e.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return e=(e=e.replace("[","")).replace("]","")}(JSON.stringify(s),s.length);navigator.clipboard.writeText(i)}function X(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>{(Array.isArray(e.data.crates)||e.data.hasOwnProperty("crates"))&&function({crates:e}){sessionStorage.setItem("copy1","done!"),R(e.allCrates)}(e.data)}}function W(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>function({crates:e}){let t,s,i=[];for(t in e)e[t].hasOwnProperty("crates")&&e[t].crates.map(((e,t)=>{switch(t%2){case 0:i.push(e);break;case 1:s=D(e),s.map((e=>i.push(e))),s=null}}),0);return sessionStorage.setItem("copy2","done!"),R(i)}(e.data)}function M(e){localStorage.setItem("mode",e),function(e){const t=document.body.classList;t.remove("light-mode"),t.remove("dark-mode"),"dark"===e?t.add("dark-mode"):t.add("light-mode")}(e)}function U(e){const t=e.target.closest(".accordion-panel");if("body-app"===e.target.id)return _();t&&function(e){const t=e.parentElement.querySelectorAll("button"),s=e.parentElement.querySelectorAll(".menu__input");t.forEach((e=>{e.setAttribute("aria-expanded",!1)})),s.forEach((e=>{e.setAttribute("aria-hidden",!0)})),function(e){e.querySelector("button").setAttribute("aria-expanded",!0),e.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(e)}(t)}function _(){const e=document.querySelector(".accordion-panel");let t,s,i;for(t in e)s=e.parentElement.querySelectorAll("button"),i=e.parentElement.querySelectorAll(".menu__input"),s.forEach((e=>{e.setAttribute("aria-expanded",!1)})),i.forEach((e=>{e.setAttribute("aria-hidden",!0)}))}function Z(){const e=document.getElementById("statusList"),t=document.getElementById("status-frame"),s=document.querySelector(".side-menu");t.removeChild(document.getElementById("statusList")),t.append(F()),e.setAttribute("content","FETCHED"),s.getElementsByTagName("panel-info").length>0&&document.querySelector(".side-menu").lastElementChild.setAttribute("name","close"),y(),f(),u()}async function Y(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),s=await new Promise(((s,i)=>{t.postMessage(e),t.onmessage=e=>{void 0!==e?s(e.data):i(void 0)}}));return!!s&&(document.getElementById("input_estimate").value=e,sessionStorage.setItem("FETCHED",JSON.stringify(s)),Z(),q([s]),"IDB data Found.")}async function q(e){try{if(e?.hasOwnProperty("crates")){document.getElementById("input_estimate").value=e.reference,globalThis.sessionStorage.clear(),globalThis.sessionStorage.setItem("FETCHED",JSON.stringify(e,null));const{materials:t}=localStorage;return sessionStorage.clear(),sessionStorage.setItem("FETCHED",JSON.stringify(e,null)),localStorage.setItem("materials",t),Z()}throw new TypeError("Data not found!")}catch(e){return e}}async function H(e){const t=`/api/v1/estimates/${e}`,s={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){return await fetch(t,{method:"GET",headers:s}).then((async e=>await e.json())).then(q).catch((e=>alert(`Search ERROR! \n ${e}`)))}}async function $(){const e=document.getElementById("estimate_getter").value,t=(s=document.getElementById("input_estimate").value,async e=>{s&&s!==e&&g(!0)});var s;if(!function(e){switch(/[^-a-z-A-Z-0-9]/g.test(e)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(e)){const s=[Y(e),H(e)];await Promise.all(s).then((async s=>{s[0]||0!==s[1]?.length?await Promise.resolve(t(e)).then((async()=>{if(s[1]?.length>0){d({reference:s[1][0].reference_id,crates:s[1][0].crates.crates,list:s[1][0].works.list},!0)}else m(!0)})):alert("Document not found! Please, try again.")}))}}function j(){globalThis.navigator.serviceWorker.ready.then((async e=>{await caches.delete("craterCache_v1"),await caches.delete("status_V1"),await caches.delete("pane1_v1"),await caches.delete("pane2_v1"),await e.unregister()}))}async function J(){confirm("Are you sure to logout?")&&await fetch("/api/v1/logout",{method:"GET"}).then(j).then((e=>globalThis.location.assign(e.url))).catch((async()=>{await Promise.resolve(j).then(globalThis.location.replace("https://ottocratesolver.com/login"))}))}globalThis.onkeydown=e=>{const t="Enter"===e.key&&!0===e.ctrlKey,s=!0===e.ctrlKey&&!0===e.altKey&&"c"===e.key,i="Escape"===e.key;t&&B(),s&&o(),i&&_(),e.stopImmediatePropagation()},globalThis.onafterprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.onbeforeprint=()=>{const{shadowRoot:e}=document.querySelector(".update-materials");[...e.querySelectorAll("[aria-hidden]")].map((e=>e.ariaHidden="false"))},globalThis.document.getElementById("main-app").addEventListener("click",(e=>{const t=document.querySelector(".materials"),s=document.querySelector(".update-materials"),i=sessionStorage.getItem("crate");let a=i?+i.split("/")[0]:0;const r=i?+i.split("/")[1]:0,n=new GraphicCrates,h=document.getElementById("layer-count");let{id:c,className:l,attributes:d}=e.target;{const{shadowRoot:e}=t,s=e.querySelector(".upPane");s?.addEventListener("click",(e=>{const{id:t,className:i,tagName:a}=e.target,r=new CustomEvent("open-crate",{bubbles:!0,composed:!0,detail:{id:t,className:i,tagName:a}});s.dispatchEvent(r)}),!0)}{const{shadowRoot:e}=s,t=e.querySelector(".data-update");t?.addEventListener("click",(e=>{const{id:s,className:i}=e.target,a=new CustomEvent("update-materials-info",{bubbles:!0,composed:!0,detail:{id:s,className:i}});t.dispatchEvent(a),e.stopImmediatePropagation()}))}switch("crates"===d.content&&(l="crates"),c||(c=l)){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":U(e);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:e}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${e}`),globalThis.deferredPrompt=null}();break;case"add-btn":w();break;case"remove-btn":C();break;case"clear-btn":P();break;case"crate-btn":case"crate_btn":B();break;case"copy-pane1":X();break;case"copy-pane2":W();break;case"logout":case"logout-btn":J();break;case"exchange-header":A(),async function(){const e=sessionStorage.getItem("currency"),t=JSON.parse(sessionStorage.getItem("coin1")),s=JSON.parse(sessionStorage.getItem("coin2")),i=document.getElementById("coin1"),a=document.getElementById("coin2");null!==t&&(i.value=t),null!==s&&(a.value=s),null===e&&await S()}(),U(e);break;case"ex-btn":case"exchange-btn":A(),U(e);break;case"fetch-btn":$();break;case"crate-layers":case"layer-crate":o();break;case"previous":case"layer-prev":a>1&&(a-=1,sessionStorage.setItem("crate",`${a}/${r}`),h.innerText=`Current crate: ${a} / ${r}`,n.show);break;case"next":case"layer-next":a<r&&(a+=1,sessionStorage.setItem("crate",`${a}/${r}`),h.innerText=`Current crate: ${a} / ${r}`,n.show);break;case"settings-content":"update-materials"!==l&&"new-material"!==l&&t.setAttribute("content","settings-content");break;case"packages":"update-materials"!==l&&"select-materials"!==l&&t.setAttribute("content","packages");break;case"select-materials":"update-materials"!==l&&"select-materials"!==l&&t.setAttribute("content","select-materials");break;case"materials":"update-materials"!==l&&"select-materials"!==l&&t.setAttribute("content","confirm-save");break;case"report":case"report":t.setAttribute("name","packages");break;case"pack-opts":case"works-packed":t.setAttribute("name","works-packed");break;case"reset-sizes":t.setAttribute("name","reset-sizes");break;case"reset-szs":t.setAttribute("name","reset-szs");break;case"adding-material":t.setAttribute("name","adding-material");break;case"add__new__field":t.setAttribute("name","add__new__field");break;case"cancel-remove":t.setAttribute("name","cancel-remove");break;case"new-material":t.setAttribute("name","new-material");break;case"confirm-save":t.setAttribute("name","confirm-save");break;case"printer-icon":case"printer-btn":case"printer-svg":case"printer":globalThis.print()}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(e=>{switch(e.preventDefault(),e.target.id){case"input_estimate":l();break;case"in":case"cm":L();break;case"dark-mode":M("dark");break;case"light-mode":M("light");break;case"coin1":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(e)),v(e,t)}();break;case"coin2":!function(){const e=document.getElementById("coin2").value,t=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(e)),v(e,t)}();break;case"units1":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"units2":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"selected-crate":o()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(e=>{let{id:t,className:s}=e.target;switch(t||(t=s)){case"coin1-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),i=document.getElementById("coin2-input");v(t,i),i.value=`$ ${b(e,t,s,i)}`}();break;case"coin2-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),i=document.getElementById("coin2-input");v(e,s),s.value=`$ ${b(e,t,s,i)}`}();break;case"input-unit1":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),i=globalThis.document.getElementById("input-unit2");i.value=0,i.value=I(e,t,s,i)}();break;case"input-unit2":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),i=globalThis.document.getElementById("input-unit2");s.value=0,s.value=I(e,t,s,i)}()}}),!0),globalThis.onsubmit=e=>{e.preventDefault()},globalThis.document.getElementById("main-app").addEventListener("open-crate",(e=>{const{id:t,className:s,tagName:i}=e.detail,a=document.querySelector(".materials");"A"===i&&a.setAttribute("content",`${t}-${s}`)}),!0),globalThis.document.getElementById("main-app").addEventListener("update-materials-info",(e=>{const{id:t}=e.detail,s=document.querySelector(".update-materials");e.stopImmediatePropagation(),"update-info"===t&&s.setAttribute("name","update")}),!0),globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(e=>{"Enter"===e.key&&$()})),globalThis.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),console.log("👍","beforeinstallprompt",e),globalThis.deferredPrompt=e}));
